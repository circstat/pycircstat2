
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../regression/">
      
      
        <link rel="next" href="../clustering/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Distributions - pycircstat2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pycircstat2.distributions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="pycircstat2" class="md-header__button md-logo" aria-label="pycircstat2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pycircstat2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Distributions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pycircstat2" class="md-nav__button md-logo" aria-label="pycircstat2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pycircstat2
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feature-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Circular Data Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../descriptive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Descriptive Statistics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hypothesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hypothesis Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../correlation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Correlation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regression
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Distributions
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Distributions
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;distributions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.CircularContinuous" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CircularContinuous
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.CircularContinuousFrozen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CircularContinuousFrozen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.circularuniform_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;circularuniform_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.triangular_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;triangular_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.cardioid_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;cardioid_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.cartwright_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;cartwright_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapnorm_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapnorm_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapcauchy_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapcauchy_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.vonmises_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;vonmises_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.vonmises_flattopped_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;vonmises_flattopped_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_sineskewed_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_sineskewed_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_asym_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_asym_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.inverse_batschelet_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;inverse_batschelet_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapstable_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapstable_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.katojones_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;katojones_gen
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clustering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clustering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;distributions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.CircularContinuous" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CircularContinuous
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.CircularContinuousFrozen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CircularContinuousFrozen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.circularuniform_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;circularuniform_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.triangular_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;triangular_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.cardioid_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;cardioid_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.cartwright_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;cartwright_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapnorm_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapnorm_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapcauchy_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapcauchy_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.vonmises_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;vonmises_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.vonmises_flattopped_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;vonmises_flattopped_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_sineskewed_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_sineskewed_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.jonespewsey_asym_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;jonespewsey_asym_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.inverse_batschelet_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;inverse_batschelet_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.wrapstable_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;wrapstable_gen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pycircstat2.distributions.katojones_gen" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;katojones_gen
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Distributions</h1>

<div class="doc doc-object doc-module">



<a id="pycircstat2.distributions"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.CircularContinuous" class="doc doc-heading">
            <code>CircularContinuous</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="scipy.stats.rv_continuous">rv_continuous</span></code></p>



        <p>Base class for circular distributions with fixed loc=0 and scale=1.</p>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li><code>loc</code>/<code>scale</code> are intentionally removed from the user-facing API; the
  named parameters of each distribution already encode location/shape.</li>
<li>Circular data are assumed to be pre-wrapped to <code>[0, 2π)</code>; for
  convenience every public method wraps angular inputs to that support.</li>
<li>Cumulative methods remain circular/periodic under this wrapping
  (<code>cdf(θ + 2π) == cdf(θ)</code>).</li>
</ul>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CircularContinuous</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for circular distributions with fixed loc=0 and scale=1.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - ``loc``/``scale`` are intentionally removed from the user-facing API; the</span>
<span class="sd">      named parameters of each distribution already encode location/shape.</span>
<span class="sd">    - Circular data are assumed to be pre-wrapped to ``[0, 2π)``; for</span>
<span class="sd">      convenience every public method wraps angular inputs to that support.</span>
<span class="sd">    - Cumulative methods remain circular/periodic under this wrapping</span>
<span class="sd">      (``cdf(θ + 2π) == cdf(θ)``).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_loc_default</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">_scale_default</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">momtype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">support</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">,</span>
        <span class="n">badvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">longname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">shapes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">support</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">support_a</span><span class="p">,</span> <span class="n">support_b</span> <span class="o">=</span> <span class="n">support</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">support_a</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">support_b</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">momtype</span><span class="o">=</span><span class="n">momtype</span><span class="p">,</span>
            <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
            <span class="n">xtol</span><span class="o">=</span><span class="n">xtol</span><span class="p">,</span>
            <span class="n">badvalue</span><span class="o">=</span><span class="n">badvalue</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">longname</span><span class="o">=</span><span class="n">longname</span><span class="p">,</span>
            <span class="n">shapes</span><span class="o">=</span><span class="n">shapes</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_circular_arg_wrapped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_arg_parsers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_period</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Internal helpers</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_normalization_cache&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache</span> <span class="o">=</span> <span class="n">cache</span>
        <span class="k">return</span> <span class="n">cache</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_arg_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure internal arg-parsing keeps loc/scale fixed to defaults.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_circular_arg_wrapped&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_parse_args&quot;</span><span class="p">,</span> <span class="s2">&quot;_parse_args_rvs&quot;</span><span class="p">,</span> <span class="s2">&quot;_parse_args_stats&quot;</span><span class="p">):</span>
            <span class="n">original</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">__orig</span><span class="o">=</span><span class="n">original</span><span class="p">,</span> <span class="n">__name</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="n">__name</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">__orig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="n">wrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_circular_arg_wrapped</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_period</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">period</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">period</span><span class="p">)</span> <span class="ow">or</span> <span class="n">period</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">lower</span><span class="p">,</span> <span class="n">period</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">values</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span>

        <span class="n">wrapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">):</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">upper_bound</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                    <span class="n">wrapped</span> <span class="o">=</span> <span class="n">wrapped</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">wrapped</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper_bound</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize the ``random_state`` argument to a NumPy ``Generator``.</span>

<span class="sd">        Accepts integers, ``RandomState`` instances, ``Generator`` objects, or</span>
<span class="sd">        ``None`` (in which case the distribution&#39;s cached generator is used).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">random_state</span> <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_random_state&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">candidate</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">):</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">generator</span>
            <span class="k">return</span> <span class="n">generator</span>

        <span class="k">if</span> <span class="n">candidate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">generator</span>
            <span class="k">return</span> <span class="n">generator</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive branch</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;random_state must be None, an int seed, RandomState, or Generator.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_random_state</span> <span class="o">=</span> <span class="n">generator</span>

        <span class="k">return</span> <span class="n">generator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_call_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">caller</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_separate_shape_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split positional/keyword shape parameters from kwargs for functions that</span>
<span class="sd">        delegate to SciPy helpers lacking keyword support (e.g. ``expect``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="p">{}</span>

        <span class="n">remaining_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">shape_args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">shapespec</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;shapes&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shapespec</span><span class="p">:</span>
            <span class="n">shape_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">shapespec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shape_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remaining_kwargs</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">remaining_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape_args</span><span class="p">):</span>
                    <span class="n">existing</span> <span class="o">=</span> <span class="n">shape_args</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">equal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">equal</span> <span class="o">=</span> <span class="n">existing</span> <span class="o">==</span> <span class="n">value</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> received conflicting values for `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shape_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape_args</span><span class="p">),</span> <span class="n">remaining_kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kwargs</span>

        <span class="n">cleaned</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">mutated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="s2">&quot;loc&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">loc_val</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_default_value</span><span class="p">(</span><span class="n">loc_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_default</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not support a free `loc` parameter.&quot;</span>
                <span class="p">)</span>
            <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mutated</span> <span class="k">else</span> <span class="n">cleaned</span>
            <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">scale_val</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_default_value</span><span class="p">(</span><span class="n">scale_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_default</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not support a free `scale` parameter.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mutated</span><span class="p">:</span>
                <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
                <span class="n">mutated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mutated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">forbidden_aliases</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="s2">&quot;fix_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;fix_scale&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">forbidden_aliases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not support `</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">`; the distribution fixes location/scale.&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">cleaned</span> <span class="k">if</span> <span class="n">mutated</span> <span class="k">else</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># pragma: no cover - fallback if casting fails</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_dist_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dist_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dist_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">caller</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">caller</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalization_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="n">key_components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scalar</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">scalar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="n">key_components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">scalar</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">key_components</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_cached_normalizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compute</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache_key</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compute</span><span class="p">()</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_normalization_cache</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">freeze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CircularContinuousFrozen&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a frozen circular distribution while enforcing fixed loc/scale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CircularContinuousFrozen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="fm">__call__</span> <span class="o">=</span> <span class="n">freeze</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Public overrides</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;pdf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;logpdf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;cdf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;logcdf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logcdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;sf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;logsf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logsf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nnlf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">nnlf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">wrapped_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">wrapped_data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit_loc_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pragma: no cover - API guard</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Circular distributions have fixed location and scale; use `fit` for shape parameters only.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sanitize_fit_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Reject attempts to seed loc/scale with non-default values.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">((</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_default</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_default</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_default_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">default</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> fixes `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` to </span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s2">; remove the argument.&quot;</span>
                    <span class="p">)</span>
                <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;fix_loc&quot;</span><span class="p">,</span> <span class="s2">&quot;fix_scale&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not expose `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">`; the distribution is already fixed.&quot;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">((</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_default</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_default</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_default_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">default</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_name</span><span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> requires `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` == </span><span class="si">{</span><span class="n">default</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;floc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_default</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;fscale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_default</span>
        <span class="k">return</span> <span class="n">kwds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_attach_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover - mirrors parent for pickling</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_attach_methods</span><span class="p">()</span>
        <span class="c1"># Reapply wrappers; _attach_methods is used during unpickling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_circular_arg_wrapped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_arg_parsers</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_wrap_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap a direction onto the distribution&#39;s support if known, otherwise [0, 2π).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">angmod</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Numeric integration helpers</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf_integral</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">integrand</span><span class="p">,</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span>
        <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Numerically integrate a one-dimensional PDF to obtain CDF values.</span>

<span class="sd">        Evaluates the cumulative integral of ``integrand`` from ``lower`` to each</span>
<span class="sd">        point in ``x``, reusing work across sorted evaluation points to minimise</span>
<span class="sd">        the number of quadrature calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">scalar_input</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">x_vals</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">scalar_input</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">original_shape</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">x_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">original_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">lower</span><span class="p">)</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="k">if</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">upper</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">scalar_integrand</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">integrand</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;mergesort&quot;</span><span class="p">)</span>
        <span class="n">sorted_vals</span> <span class="o">=</span> <span class="n">x_vals</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

        <span class="n">cumulative</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">lower_bound</span>

        <span class="k">for</span> <span class="n">order_idx</span><span class="p">,</span> <span class="n">orig_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sorted_vals</span><span class="p">[</span><span class="n">order_idx</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">results</span><span class="p">[</span><span class="n">orig_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">lower_bound</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">orig_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">continue</span>

            <span class="n">clipped</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clipped</span> <span class="o">&gt;</span> <span class="n">current</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">:</span>
                <span class="n">segment</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span>
                    <span class="n">scalar_integrand</span><span class="p">,</span>
                    <span class="n">current</span><span class="p">,</span>
                    <span class="n">clipped</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                    <span class="n">epsabs</span><span class="o">=</span><span class="n">epsabs</span><span class="p">,</span>
                    <span class="n">epsrel</span><span class="o">=</span><span class="n">epsrel</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">cumulative</span> <span class="o">+=</span> <span class="n">segment</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">clipped</span>

            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">upper_bound</span><span class="p">:</span>
                <span class="n">cumulative</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">upper_bound</span>
                <span class="n">results</span><span class="p">[</span><span class="n">orig_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">orig_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf_from_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">quad_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience wrapper around `_cdf_integral` using ``self._pdf``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_integral</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span>
            <span class="n">params</span><span class="p">,</span>
            <span class="n">lower</span><span class="o">=</span><span class="n">quad_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">upper</span><span class="o">=</span><span class="n">quad_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">epsabs</span><span class="o">=</span><span class="n">quad_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;epsabs&quot;</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">),</span>
            <span class="n">epsrel</span><span class="o">=</span><span class="n">quad_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;epsrel&quot;</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">),</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">quad_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="c1"># Circular descriptive helpers</span>
    <span class="c1"># ------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">trig_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular (trigonometric) moment m_p = E[e^{i p Θ}] = C_p + i S_p.</span>

<span class="sd">        Falls back to numeric evaluation via ``self.expect``; subclasses may</span>
<span class="sd">        override with closed-form expressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape_args</span><span class="p">,</span> <span class="n">non_shape_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_separate_shape_parameters</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span><span class="p">)</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">non_shape_kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span><span class="p">)</span>
        <span class="n">C_p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">shape_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">S_p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">shape_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">C_p</span><span class="p">,</span> <span class="n">S_p</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mean resultant length R = |m₁|.&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular mean direction μ = arg(m₁).&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular median (50% quantile).&quot;&quot;&quot;</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular variance V = 1 - R.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular standard deviation s = sqrt(-2 ln R).&quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular dispersion δ̂ = (1 - ρ₂) / (2 ρ₁²).&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">skewness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pewsey-style circular skewness.&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">denom_base</span><span class="o">**</span><span class="mf">1.5</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pewsey-style circular kurtosis.&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">denom_base</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenience bundle of circular descriptive statistics.&quot;&quot;&quot;</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>

        <span class="n">r1_is_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="n">mean_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

        <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>

        <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
            <span class="n">skew</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
            <span class="n">kurt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skew</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom_base</span><span class="o">**</span><span class="mf">1.5</span><span class="p">))</span>
            <span class="n">kurt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom_base</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">std_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))))</span>
        <span class="p">)</span>
        <span class="n">dispersion_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="nb">float</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
            <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span>
            <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">),</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
            <span class="s2">&quot;dispersion&quot;</span><span class="p">:</span> <span class="n">dispersion_val</span><span class="p">,</span>
            <span class="s2">&quot;skewness&quot;</span><span class="p">:</span> <span class="n">skew</span><span class="p">,</span>
            <span class="s2">&quot;kurtosis&quot;</span><span class="p">:</span> <span class="n">kurt</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.freeze" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">freeze</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a frozen circular distribution while enforcing fixed loc/scale.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">freeze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CircularContinuousFrozen&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a frozen circular distribution while enforcing fixed loc/scale.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">CircularContinuousFrozen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.trig_moment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trig_moment</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular (trigonometric) moment m_p = E[e^{i p Θ}] = C_p + i S_p.</p>
<p>Falls back to numeric evaluation via <code>self.expect</code>; subclasses may
override with closed-form expressions.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trig_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular (trigonometric) moment m_p = E[e^{i p Θ}] = C_p + i S_p.</span>

<span class="sd">    Falls back to numeric evaluation via ``self.expect``; subclasses may</span>
<span class="sd">    override with closed-form expressions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape_args</span><span class="p">,</span> <span class="n">non_shape_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_separate_shape_parameters</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span><span class="p">)</span>
    <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">non_shape_kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span><span class="p">)</span>
    <span class="n">C_p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">shape_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">S_p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">shape_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">C_p</span><span class="p">,</span> <span class="n">S_p</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.r" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Mean resultant length R = |m₁|.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mean resultant length R = |m₁|.&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular mean direction μ = arg(m₁).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circular mean direction μ = arg(m₁).&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.median" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">median</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular median (50% quantile).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circular median (50% quantile).&quot;&quot;&quot;</span>
    <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.var" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">var</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular variance V = 1 - R.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circular variance V = 1 - R.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.std" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">std</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular standard deviation s = sqrt(-2 ln R).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circular standard deviation s = sqrt(-2 ln R).&quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.dispersion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dispersion</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular dispersion δ̂ = (1 - ρ₂) / (2 ρ₁²).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Circular dispersion δ̂ = (1 - ρ₂) / (2 ρ₁²).&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.skewness" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">skewness</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pewsey-style circular skewness.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">skewness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pewsey-style circular skewness.&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">denom_base</span><span class="o">**</span><span class="mf">1.5</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.kurtosis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kurtosis</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pewsey-style circular kurtosis.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pewsey-style circular kurtosis.&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">denom_base</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.CircularContinuous.stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stats</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convenience bundle of circular descriptive statistics.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience bundle of circular descriptive statistics.&quot;&quot;&quot;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>

    <span class="n">r1_is_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
    <span class="n">mean_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

    <span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>

    <span class="n">denom_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denom_base</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="n">kurt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom_base</span><span class="o">**</span><span class="mf">1.5</span><span class="p">))</span>
        <span class="n">kurt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">r2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">u1</span><span class="p">)</span> <span class="o">-</span> <span class="n">r1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom_base</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">std_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))))</span>
    <span class="p">)</span>
    <span class="n">dispersion_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">r1_is_zero</span> <span class="k">else</span> <span class="nb">float</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">r1</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_val</span><span class="p">,</span>
        <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span>
        <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">),</span>
        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_val</span><span class="p">,</span>
        <span class="s2">&quot;dispersion&quot;</span><span class="p">:</span> <span class="n">dispersion_val</span><span class="p">,</span>
        <span class="s2">&quot;skewness&quot;</span><span class="p">:</span> <span class="n">skew</span><span class="p">,</span>
        <span class="s2">&quot;kurtosis&quot;</span><span class="p">:</span> <span class="n">kurt</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.CircularContinuousFrozen" class="doc doc-heading">
            <code>CircularContinuousFrozen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="scipy.stats._distn_infrastructure.rv_continuous_frozen">rv_continuous_frozen</span></code></p>



        <p>Frozen circular distribution exposing circular descriptive helpers.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CircularContinuousFrozen</span><span class="p">(</span><span class="n">rv_continuous_frozen</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Frozen circular distribution exposing circular descriptive helpers.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call_dist_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">call_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">call_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">trig_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">call_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">call_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">args</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="o">.</span><span class="n">trig_moment</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">call_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_dist_method</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_dist_method</span><span class="p">(</span><span class="s2">&quot;dispersion&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">skewness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_dist_method</span><span class="p">(</span><span class="s2">&quot;skewness&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_dist_method</span><span class="p">(</span><span class="s2">&quot;kurtosis&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_dist_method</span><span class="p">(</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.circularuniform_gen" class="doc doc-heading">
            <code>circularuniform_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Continuous Circular Uniform Distribution</p>
<p><img alt="circularuniform" src="../../images/circ-mod-circularuniform.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, *args, **kwargs) (pycircstat2.distributions.circularuniform_gen.pdf)" href="#pycircstat2.distributions.circularuniform_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, *args, **kwargs) (pycircstat2.distributions.circularuniform_gen.cdf)" href="#pycircstat2.distributions.circularuniform_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, *args, **kwargs) (pycircstat2.distributions.circularuniform_gen.ppf)" href="#pycircstat2.distributions.circularuniform_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse of CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(size=None, random_state=None) (pycircstat2.distributions.circularuniform_gen.rvs)" href="#pycircstat2.distributions.circularuniform_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">circularuniform_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Continuous Circular Uniform Distribution</span>

<span class="sd">    ![circularuniform](../images/circ-mod-circularuniform.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q)</span>
<span class="sd">        Percent-point function (inverse of CDF).</span>

<span class="sd">    rvs(size, random_state) </span>
<span class="sd">        Random variates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Circular Uniform distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{1}{2\pi}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Circular Uniform distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \frac{\theta}{2\pi}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">q</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse of the CDF) of the Circular Uniform distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        Q(q) = F^{-1}(q) = 2\pi q, \space 0 \leq q \leq 1</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Values at the given quantiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Random variate generation for the circular uniform distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Number of samples to draw. If ``None`` (default), return a single value.</span>
<span class="sd">        random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">            Random number generator to use. If ``None``, fall back to the</span>
<span class="sd">            distribution&#39;s internal generator.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Samples drawn uniformly from the interval ``[0, 2π)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The circular uniform distribution has no free parameters to estimate,</span>
<span class="sd">        so calling ``fit`` is undefined. A ``NotImplementedError`` is raised to</span>
<span class="sd">        signal that users should rely on descriptive helpers (e.g.,</span>
<span class="sd">        ``circ_mean_and_r``) instead of maximum-likelihood fitting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;circularuniform.fit() is undefined: the distribution has no parameters to estimate.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.circularuniform_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Circular Uniform distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{1}{2\pi}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Circular Uniform distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{1}{2\pi}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.circularuniform_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Circular Uniform distribution.</p>
<div class="arithmatex">\[
F(\theta) = \frac{\theta}{2\pi}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Circular Uniform distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \frac{\theta}{2\pi}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.circularuniform_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse of the CDF) of the Circular Uniform distribution.</p>
<div class="arithmatex">\[
Q(q) = F^{-1}(q) = 2\pi q, \space 0 \leq q \leq 1
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values at the given quantiles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse of the CDF) of the Circular Uniform distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    Q(q) = F^{-1}(q) = 2\pi q, \space 0 \leq q \leq 1</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Values at the given quantiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.circularuniform_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Random variate generation for the circular uniform distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw. If <code>None</code> (default), return a single value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>np.random.Generator, np.random.RandomState, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator to use. If <code>None</code>, fall back to the
distribution's internal generator.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Samples drawn uniformly from the interval <code>[0, 2π)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random variate generation for the circular uniform distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Number of samples to draw. If ``None`` (default), return a single value.</span>
<span class="sd">    random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">        Random number generator to use. If ``None``, fall back to the</span>
<span class="sd">        distribution&#39;s internal generator.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Samples drawn uniformly from the interval ``[0, 2π)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.circularuniform_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The circular uniform distribution has no free parameters to estimate,
so calling <code>fit</code> is undefined. A <code>NotImplementedError</code> is raised to
signal that users should rely on descriptive helpers (e.g.,
<code>circ_mean_and_r</code>) instead of maximum-likelihood fitting.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The circular uniform distribution has no free parameters to estimate,</span>
<span class="sd">    so calling ``fit`` is undefined. A ``NotImplementedError`` is raised to</span>
<span class="sd">    signal that users should rely on descriptive helpers (e.g.,</span>
<span class="sd">    ``circ_mean_and_r``) instead of maximum-likelihood fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;circularuniform.fit() is undefined: the distribution has no parameters to estimate.&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.triangular_gen" class="doc doc-heading">
            <code>triangular_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Triangular Distribution</p>
<p><img alt="triangular" src="../../images/circ-mod-triangular.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, rho, *args, **kwargs) (pycircstat2.distributions.triangular_gen.pdf)" href="#pycircstat2.distributions.triangular_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, rho, *args, **kwargs) (pycircstat2.distributions.triangular_gen.cdf)" href="#pycircstat2.distributions.triangular_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, rho, *args, **kwargs) (pycircstat2.distributions.triangular_gen.ppf)" href="#pycircstat2.distributions.triangular_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Closed-form quantile (inverse CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(rho=None, size=None, random_state=None) (pycircstat2.distributions.triangular_gen.rvs)" href="#pycircstat2.distributions.triangular_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates via inverse-transform using the closed-form quantile.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False) (pycircstat2.distributions.triangular_gen.fit)" href="#pycircstat2.distributions.triangular_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the distribution to the data and return the parameter (rho).</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Implementation based on Section 2.2.3 of Jammalamadaka &amp; SenGupta (2001)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">triangular_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Triangular Distribution</span>

<span class="sd">    ![triangular](../images/circ-mod-triangular.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, rho)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, rho)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, rho)</span>
<span class="sd">        Closed-form quantile (inverse CDF).</span>

<span class="sd">    rvs(rho, size=None, random_state=None)</span>
<span class="sd">        Random variates via inverse-transform using the closed-form quantile.</span>

<span class="sd">    fit(data)</span>
<span class="sd">        Fit the distribution to the data and return the parameter (rho).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implementation based on Section 2.2.3 of Jammalamadaka &amp; SenGupta (2001)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&lt;=</span> <span class="mf">4.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="mf">8.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Triangular distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{4 - \pi^2 \rho + 2\pi \rho |\pi - \theta|}{8\pi}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Concentratio parameter, 0 &lt;= rho &lt;= 4/pi^2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">x_b</span><span class="p">,</span> <span class="n">rho_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">rho_arr</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># lower branch: 0 &lt;= x &lt;= pi</span>
        <span class="n">mask_lower</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_b</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_b</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_lower</span><span class="p">):</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="n">x_b</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span>
            <span class="n">rl</span> <span class="o">=</span> <span class="n">rho_b</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rl</span><span class="p">)</span> <span class="o">*</span> <span class="n">xl</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rl</span> <span class="o">*</span> <span class="n">xl</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="p">)</span>

        <span class="c1"># upper branch: pi &lt; x &lt; 2pi</span>
        <span class="n">mask_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_b</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_b</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_upper</span><span class="p">):</span>
            <span class="n">xu</span> <span class="o">=</span> <span class="n">x_b</span><span class="p">[</span><span class="n">mask_upper</span><span class="p">]</span>
            <span class="n">ru</span> <span class="o">=</span> <span class="n">rho_b</span><span class="p">[</span><span class="n">mask_upper</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_upper</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ru</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xu</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ru</span> <span class="o">*</span> <span class="p">(</span><span class="n">xu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="c1"># upper tail: x &gt;= 2pi</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_b</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta;\,\rho)=</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        \dfrac{(4+\pi^2\rho)\,\theta - \pi\rho\,\theta^2}{8\pi}, &amp; 0 \le \theta \le \pi,\\[6pt]</span>
<span class="sd">        \dfrac{1}{2} + \dfrac{(4 - 3\pi^2\rho)\,(\theta-\pi) + \pi\rho\,(\theta^2-\pi^2)}{8\pi},</span>
<span class="sd">            &amp; \pi &lt; \theta &lt; 2\pi.</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>

<span class="sd">        (With $F(\theta)=0$ for $\theta&lt;0$ and $F(\theta)=1$ for $\theta\ge 2\pi$.)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Angles in radians on $[0, 2\pi)$.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Concentration parameter, $0 \le \rho \le 4/\pi^2$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">q_b</span><span class="p">,</span> <span class="n">rho_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">q_arr</span><span class="p">,</span> <span class="n">rho_arr</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mask_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rho_b</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_zero</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_zero</span><span class="p">]</span> <span class="o">=</span> <span class="n">q_b</span><span class="p">[</span><span class="n">mask_zero</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">mask_general</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_zero</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_general</span><span class="p">):</span>
            <span class="n">q_g</span> <span class="o">=</span> <span class="n">q_b</span><span class="p">[</span><span class="n">mask_general</span><span class="p">]</span>
            <span class="n">rho_g</span> <span class="o">=</span> <span class="n">rho_b</span><span class="p">[</span><span class="n">mask_general</span><span class="p">]</span>

            <span class="n">a_left</span> <span class="o">=</span> <span class="n">rho_g</span>
            <span class="n">b_left</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_g</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">a_right</span> <span class="o">=</span> <span class="n">rho_g</span>
            <span class="n">b_right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_g</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">res_general</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_g</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">mask_left</span> <span class="o">=</span> <span class="n">q_g</span> <span class="o">&lt;=</span> <span class="mf">0.5</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_left</span><span class="p">):</span>
                <span class="n">c_left</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">q_g</span><span class="p">[</span><span class="n">mask_left</span><span class="p">]</span>
                <span class="n">disc_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">b_left</span><span class="p">[</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a_left</span><span class="p">[</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_left</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">res_general</span><span class="p">[</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="o">-</span><span class="n">b_left</span><span class="p">[</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">disc_left</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a_left</span><span class="p">[</span><span class="n">mask_left</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">mask_left</span><span class="p">):</span>
                <span class="n">c_right</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_g</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">q_g</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span>
                <span class="n">disc_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
                    <span class="n">b_right</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a_right</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">*</span> <span class="n">c_right</span><span class="p">,</span>
                    <span class="mf">0.0</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">res_general</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="o">-</span><span class="n">b_right</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">disc_right</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a_right</span><span class="p">[</span><span class="o">~</span><span class="n">mask_left</span><span class="p">])</span>

            <span class="n">result</span><span class="p">[</span><span class="n">mask_general</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_general</span>

        <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (quantile) of the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">        For $\rho=0$ (circular uniform):</span>

<span class="sd">        $$</span>
<span class="sd">        \operatorname{PPF}(q;0)=2\pi q.</span>
<span class="sd">        $$</span>

<span class="sd">        For $\rho&gt;0$:</span>

<span class="sd">        $$</span>
<span class="sd">        \operatorname{PPF}(q;\rho)=</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        \dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}</span>
<span class="sd">        - \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,q}\right),</span>
<span class="sd">        &amp; 0 \le q \le \tfrac{1}{2}, \\[10pt]</span>
<span class="sd">        \pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(q-\tfrac{1}{2})}}</span>
<span class="sd">        {2\pi\rho},</span>
<span class="sd">        &amp; \tfrac{1}{2} &lt; q &lt; 1.</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles in $[0, 1]$.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Concentration parameter, $0 \le \rho \le 4/\pi^2$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Quantiles (angles in radians on $[0, 2\pi)$).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Random variates from the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">        Sampling uses **inverse-transform** with the closed-form quantile:</span>
<span class="sd">        let $U \sim \mathrm{Unif}(0,1)$ and set $\theta = \operatorname{PPF}(U;\rho)$, where</span>

<span class="sd">        - For $\rho = 0$ (circular uniform):</span>

<span class="sd">        $$</span>
<span class="sd">        \theta = 2\pi U.</span>
<span class="sd">        $$</span>

<span class="sd">        - For $\rho &gt; 0$ (piecewise quadratic inverse):</span>

<span class="sd">        $$</span>
<span class="sd">        \theta =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">            \dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}</span>
<span class="sd">            - \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,U}\right),</span>
<span class="sd">            &amp; 0 \le U \le \tfrac{1}{2}, \\[10pt]</span>
<span class="sd">            \pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(U-\tfrac{1}{2})}}</span>
<span class="sd">            {2\pi\rho},</span>
<span class="sd">            &amp; \tfrac{1}{2} &lt; U &lt; 1.</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float, optional</span>
<span class="sd">            Concentration, $0 \le \rho \le 4/\pi^2$. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Output shape. If ``None`` (default), return a single scalar.</span>
<span class="sd">        random_state : int, numpy.random.Generator, numpy.random.RandomState, optional</span>
<span class="sd">            PRNG seed or generator. If ``None``, use the distribution&#39;s internal RNG.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Angles in radians on $[0, 2\pi)$, with shape ``size``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is equivalent in law to R&#39;s **circular** `rtriangular` after</span>
<span class="sd">        shifting its output by $+\pi$ modulo $2\pi$.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>
        <span class="k">if</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the concentration parameter $\rho$ of the circular triangular law on $[0,2\pi)$.</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>

<span class="sd">        mle (default): </span>
<span class="sd">            maximize the log-likelihood. This solves the 1-D score equation</span>
<span class="sd">            $\sum_i \frac{c_i}{4+\rho\,c_i}=0$ with $c_i = 2\pi\,|\,\pi-x_i\,| - \pi^2$.</span>
<span class="sd">            Unique solution in $[0, 4/\pi^2)$ or at a boundary.</span>
<span class="sd">        moments :</span>
<span class="sd">            closed-form $\hat\rho = \max\{0, \min\{4/\pi^2,\ \overline{\cos x}\}\}$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to $[0, 2\pi)$ internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Nonnegative sample weights. Broadcastable to `data`. Interpreted as frequencies.</span>
<span class="sd">        method : {&quot;mle&quot;,&quot;moments&quot;}, optional</span>
<span class="sd">            Estimation method (see above).</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a dict with diagnostics (loglik, se, n_effective, method).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rho_hat : float</span>
<span class="sd">            Estimated concentration $\hat\rho \in [0, 4/\pi^2]$.</span>
<span class="sd">        info : dict, optional</span>
<span class="sd">            Returned only if `return_info=True`. Contains keys:</span>
<span class="sd">            {&quot;loglik&quot;, &quot;se&quot;, &quot;n_effective&quot;, &quot;method&quot;, &quot;converged&quot;}.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For this distribution $\mathbb{E}[\cos \Theta]=\rho$, so the method-of-moments</span>
<span class="sd">        estimator is simply the (weighted) mean of $\cos x$ clipped to $[0,4/\pi^2]$.</span>
<span class="sd">        The MLE solves a strictly monotone score equation, so bracketing root-finding</span>
<span class="sd">        is robust and $O(n)$ per evaluation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;weights must be nonnegative&quot;</span><span class="p">)</span>
            <span class="c1"># broadcast</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Effective sample size for diagnostics</span>
        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sum of weights must be positive&quot;</span><span class="p">)</span>
        <span class="n">w_norm</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">w_sum</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Kish effective n</span>

        <span class="c1"># Method-of-moments (always available; used as fallback/initial intuition)</span>
        <span class="n">r_bar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w_norm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_bar</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
            <span class="c1"># log-likelihood at MoM (for info only)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">w_sum</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="c1"># observed Fisher info for SE</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">info_obs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">rho_hat</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">info_obs</span><span class="p">))</span> <span class="k">if</span> <span class="n">info_obs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;se&quot;</span><span class="p">:</span> <span class="n">se</span><span class="p">,</span> <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">rho_hat</span>

        <span class="c1"># --- MLE via monotone root of the score ---</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>                 <span class="c1"># in [0, π]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>              <span class="c1"># in [-π^2, π^2]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">c</span><span class="p">))))</span>

        <span class="c1"># Bracket: score(ρ) is strictly decreasing on [0, ρ_max)</span>
        <span class="n">rho_lo</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rho_hi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1e-12</span>

        <span class="n">s_lo</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">rho_lo</span><span class="p">)</span>  <span class="c1"># = (1/4) * sum w*c</span>
        <span class="k">if</span> <span class="n">s_lo</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>         <span class="c1"># likelihood decreasing at 0 → boundary optimum</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s_hi</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">rho_hi</span><span class="p">)</span>  <span class="c1"># tends negative if any y_i≈0</span>
            <span class="k">if</span> <span class="n">s_hi</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># all mass far from π (extreme case) → boundary at ρ_max</span>
                <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_hi</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unique root inside (0, ρ_max)</span>
                <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">brentq</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">rho_lo</span><span class="p">,</span> <span class="n">rho_hi</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">256</span><span class="p">))</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Diagnostics</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">w_sum</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">info_obs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">rho_hat</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">info_obs</span><span class="p">))</span> <span class="k">if</span> <span class="n">info_obs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;se&quot;</span><span class="p">:</span> <span class="n">se</span><span class="p">,</span> <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="n">converged</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">rho_hat</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.triangular_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Triangular distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{4 - \pi^2 \rho + 2\pi \rho |\pi - \theta|}{8\pi}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentratio parameter, 0 &lt;= rho &lt;= 4/pi^2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Triangular distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{4 - \pi^2 \rho + 2\pi \rho |\pi - \theta|}{8\pi}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Concentratio parameter, 0 &lt;= rho &lt;= 4/pi^2.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.triangular_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the circular triangular distribution on <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
<div class="arithmatex">\[
F(\theta;\,\rho)=
\begin{cases}
\dfrac{(4+\pi^2\rho)\,\theta - \pi\rho\,\theta^2}{8\pi}, &amp; 0 \le \theta \le \pi,\\[6pt]
\dfrac{1}{2} + \dfrac{(4 - 3\pi^2\rho)\,(\theta-\pi) + \pi\rho\,(\theta^2-\pi^2)}{8\pi},
    &amp; \pi &lt; \theta &lt; 2\pi.
\end{cases}
\]</div>
<p>(With <span class="arithmatex">\(F(\theta)=0\)</span> for <span class="arithmatex">\(\theta&lt;0\)</span> and <span class="arithmatex">\(F(\theta)=1\)</span> for <span class="arithmatex">\(\theta\ge 2\pi\)</span>.)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles in radians on <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(0 \le \rho \le 4/\pi^2\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta;\,\rho)=</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \dfrac{(4+\pi^2\rho)\,\theta - \pi\rho\,\theta^2}{8\pi}, &amp; 0 \le \theta \le \pi,\\[6pt]</span>
<span class="sd">    \dfrac{1}{2} + \dfrac{(4 - 3\pi^2\rho)\,(\theta-\pi) + \pi\rho\,(\theta^2-\pi^2)}{8\pi},</span>
<span class="sd">        &amp; \pi &lt; \theta &lt; 2\pi.</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    (With $F(\theta)=0$ for $\theta&lt;0$ and $F(\theta)=1$ for $\theta\ge 2\pi$.)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Angles in radians on $[0, 2\pi)$.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Concentration parameter, $0 \le \rho \le 4/\pi^2$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.triangular_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (quantile) of the circular triangular distribution on <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
<p>For <span class="arithmatex">\(\rho=0\)</span> (circular uniform):</p>
<div class="arithmatex">\[
\operatorname{PPF}(q;0)=2\pi q.
\]</div>
<p>For <span class="arithmatex">\(\rho&gt;0\)</span>:</p>
<div class="arithmatex">\[
\operatorname{PPF}(q;\rho)=
\begin{cases}
\dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}
- \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,q}\right),
&amp; 0 \le q \le \tfrac{1}{2}, \\[10pt]
\pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(q-\tfrac{1}{2})}}
{2\pi\rho},
&amp; \tfrac{1}{2} &lt; q &lt; 1.
\end{cases}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles in <span class="arithmatex">\([0, 1]\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(0 \le \rho \le 4/\pi^2\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles (angles in radians on <span class="arithmatex">\([0, 2\pi)\)</span>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (quantile) of the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">    For $\rho=0$ (circular uniform):</span>

<span class="sd">    $$</span>
<span class="sd">    \operatorname{PPF}(q;0)=2\pi q.</span>
<span class="sd">    $$</span>

<span class="sd">    For $\rho&gt;0$:</span>

<span class="sd">    $$</span>
<span class="sd">    \operatorname{PPF}(q;\rho)=</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}</span>
<span class="sd">    - \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,q}\right),</span>
<span class="sd">    &amp; 0 \le q \le \tfrac{1}{2}, \\[10pt]</span>
<span class="sd">    \pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(q-\tfrac{1}{2})}}</span>
<span class="sd">    {2\pi\rho},</span>
<span class="sd">    &amp; \tfrac{1}{2} &lt; q &lt; 1.</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles in $[0, 1]$.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Concentration parameter, $0 \le \rho \le 4/\pi^2$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Quantiles (angles in radians on $[0, 2\pi)$).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.triangular_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Random variates from the circular triangular distribution on <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
<p>Sampling uses <strong>inverse-transform</strong> with the closed-form quantile:
let <span class="arithmatex">\(U \sim \mathrm{Unif}(0,1)\)</span> and set <span class="arithmatex">\(\theta = \operatorname{PPF}(U;\rho)\)</span>, where</p>
<ul>
<li>For <span class="arithmatex">\(\rho = 0\)</span> (circular uniform):</li>
</ul>
<div class="arithmatex">\[
\theta = 2\pi U.
\]</div>
<ul>
<li>For <span class="arithmatex">\(\rho &gt; 0\)</span> (piecewise quadratic inverse):</li>
</ul>
<div class="arithmatex">\[
\theta =
\begin{cases}
    \dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}
    - \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,U}\right),
    &amp; 0 \le U \le \tfrac{1}{2}, \\[10pt]
    \pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(U-\tfrac{1}{2})}}
    {2\pi\rho},
    &amp; \tfrac{1}{2} &lt; U &lt; 1.
\end{cases}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration, <span class="arithmatex">\(0 \le \rho \le 4/\pi^2\)</span>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output shape. If <code>None</code> (default), return a single scalar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>(<span title="int">int</span>, <span title="numpy.random.Generator">Generator</span>, <span title="numpy.random.RandomState">RandomState</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG seed or generator. If <code>None</code>, use the distribution's internal RNG.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles in radians on <span class="arithmatex">\([0, 2\pi)\)</span>, with shape <code>size</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This is equivalent in law to R's <strong>circular</strong> <code>rtriangular</code> after
shifting its output by <span class="arithmatex">\(+\pi\)</span> modulo <span class="arithmatex">\(2\pi\)</span>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random variates from the circular triangular distribution on $[0, 2\pi)$.</span>

<span class="sd">    Sampling uses **inverse-transform** with the closed-form quantile:</span>
<span class="sd">    let $U \sim \mathrm{Unif}(0,1)$ and set $\theta = \operatorname{PPF}(U;\rho)$, where</span>

<span class="sd">    - For $\rho = 0$ (circular uniform):</span>

<span class="sd">    $$</span>
<span class="sd">    \theta = 2\pi U.</span>
<span class="sd">    $$</span>

<span class="sd">    - For $\rho &gt; 0$ (piecewise quadratic inverse):</span>

<span class="sd">    $$</span>
<span class="sd">    \theta =</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">        \dfrac{1}{2\rho}\!\left(\dfrac{4+\pi^2\rho}{\pi}</span>
<span class="sd">        - \sqrt{\left(\dfrac{4+\pi^2\rho}{\pi}\right)^{\!2} - 32\rho\,U}\right),</span>
<span class="sd">        &amp; 0 \le U \le \tfrac{1}{2}, \\[10pt]</span>
<span class="sd">        \pi + \dfrac{-\,(4-\pi^2\rho) + \sqrt{(4-\pi^2\rho)^{2} + 32\pi^{2}\rho\,(U-\tfrac{1}{2})}}</span>
<span class="sd">        {2\pi\rho},</span>
<span class="sd">        &amp; \tfrac{1}{2} &lt; U &lt; 1.</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rho : float, optional</span>
<span class="sd">        Concentration, $0 \le \rho \le 4/\pi^2$. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Output shape. If ``None`` (default), return a single scalar.</span>
<span class="sd">    random_state : int, numpy.random.Generator, numpy.random.RandomState, optional</span>
<span class="sd">        PRNG seed or generator. If ``None``, use the distribution&#39;s internal RNG.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Angles in radians on $[0, 2\pi)$, with shape ``size``.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is equivalent in law to R&#39;s **circular** `rtriangular` after</span>
<span class="sd">    shifting its output by $+\pi$ modulo $2\pi$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>
    <span class="k">if</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.triangular_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate the concentration parameter <span class="arithmatex">\(\rho\)</span> of the circular triangular law on <span class="arithmatex">\([0,2\pi)\)</span>.</p>


<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.triangular_gen.fit.mle">mle</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>maximize the log-likelihood. This solves the 1-D score equation
<span class="arithmatex">\(\sum_i \frac{c_i}{4+\rho\,c_i}=0\)</span> with <span class="arithmatex">\(c_i = 2\pi\,|\,\pi-x_i\,| - \pi^2\)</span>.
Unique solution in <span class="arithmatex">\([0, 4/\pi^2)\)</span> or at a boundary.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.triangular_gen.fit.moments :">moments :</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>closed-form <span class="arithmatex">\(\hat\rho = \max\{0, \min\{4/\pi^2,\ \overline{\cos x}\}\}\)</span>.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <span class="arithmatex">\([0, 2\pi)\)</span> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nonnegative sample weights. Broadcastable to <code>data</code>. Interpreted as frequencies.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="mle">mle</span>, <span title="moments">moments</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation method (see above).</p>
              </div>
            </td>
            <td>
                  <code>&#34;mle&#34;,&#34;moments&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a dict with diagnostics (loglik, se, n_effective, method).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rho_hat</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated concentration <span class="arithmatex">\(\hat\rho \in [0, 4/\pi^2]\)</span>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info</code></td>            <td>
                  <code>(<span title="dict">dict</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returned only if <code>return_info=True</code>. Contains keys:
{"loglik", "se", "n_effective", "method", "converged"}.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>For this distribution <span class="arithmatex">\(\mathbb{E}[\cos \Theta]=\rho\)</span>, so the method-of-moments
estimator is simply the (weighted) mean of <span class="arithmatex">\(\cos x\)</span> clipped to <span class="arithmatex">\([0,4/\pi^2]\)</span>.
The MLE solves a strictly monotone score equation, so bracketing root-finding
is robust and <span class="arithmatex">\(O(n)\)</span> per evaluation.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate the concentration parameter $\rho$ of the circular triangular law on $[0,2\pi)$.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    mle (default): </span>
<span class="sd">        maximize the log-likelihood. This solves the 1-D score equation</span>
<span class="sd">        $\sum_i \frac{c_i}{4+\rho\,c_i}=0$ with $c_i = 2\pi\,|\,\pi-x_i\,| - \pi^2$.</span>
<span class="sd">        Unique solution in $[0, 4/\pi^2)$ or at a boundary.</span>
<span class="sd">    moments :</span>
<span class="sd">        closed-form $\hat\rho = \max\{0, \min\{4/\pi^2,\ \overline{\cos x}\}\}$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to $[0, 2\pi)$ internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Nonnegative sample weights. Broadcastable to `data`. Interpreted as frequencies.</span>
<span class="sd">    method : {&quot;mle&quot;,&quot;moments&quot;}, optional</span>
<span class="sd">        Estimation method (see above).</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a dict with diagnostics (loglik, se, n_effective, method).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho_hat : float</span>
<span class="sd">        Estimated concentration $\hat\rho \in [0, 4/\pi^2]$.</span>
<span class="sd">    info : dict, optional</span>
<span class="sd">        Returned only if `return_info=True`. Contains keys:</span>
<span class="sd">        {&quot;loglik&quot;, &quot;se&quot;, &quot;n_effective&quot;, &quot;method&quot;, &quot;converged&quot;}.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For this distribution $\mathbb{E}[\cos \Theta]=\rho$, so the method-of-moments</span>
<span class="sd">    estimator is simply the (weighted) mean of $\cos x$ clipped to $[0,4/\pi^2]$.</span>
<span class="sd">    The MLE solves a strictly monotone score equation, so bracketing root-finding</span>
<span class="sd">    is robust and $O(n)$ per evaluation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;weights must be nonnegative&quot;</span><span class="p">)</span>
        <span class="c1"># broadcast</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Effective sample size for diagnostics</span>
    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;sum of weights must be positive&quot;</span><span class="p">)</span>
    <span class="n">w_norm</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">w_sum</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Kish effective n</span>

    <span class="c1"># Method-of-moments (always available; used as fallback/initial intuition)</span>
    <span class="n">r_bar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w_norm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_bar</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
        <span class="c1"># log-likelihood at MoM (for info only)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">w_sum</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="c1"># observed Fisher info for SE</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">info_obs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">rho_hat</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">info_obs</span><span class="p">))</span> <span class="k">if</span> <span class="n">info_obs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;se&quot;</span><span class="p">:</span> <span class="n">se</span><span class="p">,</span> <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">rho_hat</span>

    <span class="c1"># --- MLE via monotone root of the score ---</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>                 <span class="c1"># in [0, π]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>              <span class="c1"># in [-π^2, π^2]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">c</span><span class="p">))))</span>

    <span class="c1"># Bracket: score(ρ) is strictly decreasing on [0, ρ_max)</span>
    <span class="n">rho_lo</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">rho_hi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1e-12</span>

    <span class="n">s_lo</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">rho_lo</span><span class="p">)</span>  <span class="c1"># = (1/4) * sum w*c</span>
    <span class="k">if</span> <span class="n">s_lo</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>         <span class="c1"># likelihood decreasing at 0 → boundary optimum</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s_hi</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">rho_hi</span><span class="p">)</span>  <span class="c1"># tends negative if any y_i≈0</span>
        <span class="k">if</span> <span class="n">s_hi</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># all mass far from π (extreme case) → boundary at ρ_max</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_hi</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unique root inside (0, ρ_max)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">brentq</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">rho_lo</span><span class="p">,</span> <span class="n">rho_hi</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">256</span><span class="p">))</span>
            <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Diagnostics</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho_hat</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">-</span> <span class="n">w_sum</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">info_obs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">rho_hat</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">info_obs</span><span class="p">))</span> <span class="k">if</span> <span class="n">info_obs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">ll</span><span class="p">,</span> <span class="s2">&quot;se&quot;</span><span class="p">:</span> <span class="n">se</span><span class="p">,</span> <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="n">converged</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">rho_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.cardioid_gen" class="doc doc-heading">
            <code>cardioid_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Cardioid (cosine) Distribution</p>
<p><img alt="cardioid" src="../../images/circ-mod-cardioid.png" /></p>
<p>A cosine-modulated perturbation of the circular uniform law with support on
<code>[0, 2π)</code>. The mean direction <code>mu</code> controls location, while the mean
resultant length <code>rho</code> (bounded by 0.5) governs concentration. Closed-form
expressions are used for the PDF and CDF, and quantiles are obtained by
solving <code>F(theta; mu, rho) = q</code> with a safeguarded Halley--Newton iteration
shared by <code>ppf</code> and <code>rvs</code>.</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.cardioid_gen.pdf)" href="#pycircstat2.distributions.cardioid_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.cardioid_gen.cdf)" href="#pycircstat2.distributions.cardioid_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, mu, rho, *args, **kwargs) (pycircstat2.distributions.cardioid_gen.ppf)" href="#pycircstat2.distributions.cardioid_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(mu=None, rho=None, size=None, random_state=None) (pycircstat2.distributions.cardioid_gen.rvs)" href="#pycircstat2.distributions.cardioid_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates via inverse transform using the quantile solver.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False, optimizer='L-BFGS-B', **kwargs) (pycircstat2.distributions.cardioid_gen.fit)" href="#pycircstat2.distributions.cardioid_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Estimate <code>(mu, rho)</code> via method-of-moments or maximum likelihood.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Implementation based on Section 4.3.4 of Pewsey et al. (2014).</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">cardioid_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Cardioid (cosine) Distribution</span>

<span class="sd">    ![cardioid](../images/circ-mod-cardioid.png)</span>

<span class="sd">    A cosine-modulated perturbation of the circular uniform law with support on</span>
<span class="sd">    ``[0, 2π)``. The mean direction ``mu`` controls location, while the mean</span>
<span class="sd">    resultant length ``rho`` (bounded by 0.5) governs concentration. Closed-form</span>
<span class="sd">    expressions are used for the PDF and CDF, and quantiles are obtained by</span>
<span class="sd">    solving ``F(theta; mu, rho) = q`` with a safeguarded Halley--Newton iteration</span>
<span class="sd">    shared by ``ppf`` and ``rvs``.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, rho)</span>
<span class="sd">        Probability density function.</span>
<span class="sd">    cdf(x, mu, rho)</span>
<span class="sd">        Cumulative distribution function.</span>
<span class="sd">    ppf(q, mu, rho)</span>
<span class="sd">        Percent-point function (inverse CDF).</span>
<span class="sd">    rvs(mu, rho, size=None, random_state=None)</span>
<span class="sd">        Random variates via inverse transform using the quantile solver.</span>
<span class="sd">    fit(data, *args, **kwargs)</span>
<span class="sd">        Estimate ``(mu, rho)`` via method-of-moments or maximum likelihood.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implementation based on Section 4.3.4 of Pewsey et al. (2014).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Cardioid distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{1}{2\pi} \left(1 + 2\rho \cos(\theta - \mu)\right), \space \rho \in [0, 1/2]</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Mean resultant length, 0 &lt;= rho &lt;= 0.5.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Cardioid distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \frac{\theta + 2\rho (\sin(\mu) + \sin(\theta - \mu))}{2\pi}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Mean resultant length, 0 &lt;= rho &lt;= 0.5.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_solve_inverse_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">):</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">probs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">probs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">sin_mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">mu_val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">probs</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">two_pi</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">probs</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
            <span class="n">mask_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_one</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">result</span><span class="p">[</span><span class="n">mask_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">probs</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">tiny</span> <span class="o">=</span> <span class="mf">1e-14</span>
        <span class="n">use_halley</span> <span class="o">=</span> <span class="n">rho_val</span> <span class="o">&gt;</span> <span class="mf">0.25</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">6</span> <span class="k">if</span> <span class="n">use_halley</span> <span class="k">else</span> <span class="mi">3</span>

        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">theta</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin_mu</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">probs</span>

            <span class="n">converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">))</span> <span class="o">/</span> <span class="n">two_pi</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">))</span> <span class="o">/</span> <span class="n">two_pi</span>

            <span class="n">step_newton</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
                <span class="n">delta</span><span class="p">,</span>
                <span class="n">d1</span><span class="p">,</span>
                <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="n">where</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tiny</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">use_halley</span><span class="p">:</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">d2</span>
                <span class="n">halley_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tiny</span>
                <span class="n">step_halley</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
                    <span class="mf">2.0</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">d1</span><span class="p">,</span>
                    <span class="n">denom</span><span class="p">,</span>
                    <span class="n">out</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                    <span class="n">where</span><span class="o">=</span><span class="n">halley_valid</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">halley_valid</span><span class="p">,</span> <span class="n">step_halley</span><span class="p">,</span> <span class="n">step_newton</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step_newton</span>

            <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">converged</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">step</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">theta</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin_mu</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">probs</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">tol</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">remaining</span><span class="p">):</span>
            <span class="n">theta_shape</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">theta_flat</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">probs_flat</span> <span class="o">=</span> <span class="n">probs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">remaining_flat</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">probs_flat</span><span class="p">[</span><span class="n">remaining_flat</span><span class="p">]</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span>
                <span class="n">f_mid</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">mid</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">mid</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin_mu</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">two_pi</span>
                <span class="n">mask_low</span> <span class="o">=</span> <span class="n">f_mid</span> <span class="o">&lt;=</span> <span class="n">target</span>
                <span class="n">low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">low</span><span class="p">)</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">mid</span><span class="p">)</span>
            <span class="n">theta_flat</span><span class="p">[</span><span class="n">remaining_flat</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">theta_shape</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">two_pi</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">probs</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>

        <span class="n">mask_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_one</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rho` must lie in [0, 0.5].&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_solve_inverse_cdf</span><span class="p">(</span><span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">),</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">solved</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse CDF) of the Cardioid distribution.</span>

<span class="sd">        The quantile $\theta$ solves</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \frac{\theta + 2\rho\bigl(\sin\mu + \sin(\theta - \mu)\bigr)}{2\pi} = q,</span>
<span class="sd">        $$</span>

<span class="sd">        on the support $[0, 2\pi]$.  The implementation applies a</span>
<span class="sd">        Halley--Newton iteration with adaptive clipping and a final bisection</span>
<span class="sd">        safeguard, ensuring robustness for large $\rho$ and quantiles</span>
<span class="sd">        close to the boundary.  The same solver powers ``rvs``, so sampled</span>
<span class="sd">        variates and tabulated quantiles are numerically consistent.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate; finite values in ``[0, 1]`` are supported.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, ``0 &lt;= mu &lt;= 2*pi``.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Mean resultant length, ``0 &lt;= rho &lt;= 0.5``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Angles satisfying $F(\theta)=q$. Inputs outside ``[0, 1]`` are</span>
<span class="sd">            returned as ``nan``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rho_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cardioid parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rho` must lie in [0, 0.5].&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">else</span> <span class="n">samples</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solve_inverse_cdf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the Cardioid distribution.</span>

<span class="sd">        Each sample is obtained by inverse-transform sampling.  For a uniform</span>
<span class="sd">        draw $U \sim \mathcal{U}(0, 1)$, the angle $\Theta$</span>
<span class="sd">        satisfies</span>

<span class="sd">        $$</span>
<span class="sd">        \frac{\Theta + 2\rho\bigl(\sin\mu + \sin(\Theta - \mu)\bigr)}{2\pi} = U,</span>
<span class="sd">        $$</span>

<span class="sd">        and is computed with the safeguarded Halley--Newton solver described in</span>
<span class="sd">        ``ppf``.  When $\rho = 0$, the distribution degenerates to the</span>
<span class="sd">        circular uniform law and samples are drawn directly from ``[0, 2π)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : float, optional</span>
<span class="sd">            Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        rho : float, optional</span>
<span class="sd">            Mean resultant length, ``0 &lt;= rho &lt;= 0.5``. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">        random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">            Random number generator to use.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Random variates on ``[0, 2π)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

        <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate ``mu`` and ``rho`` for the cardioid distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights/frequencies broadcastable to ``data``.</span>
<span class="sd">        method : {\&quot;mle\&quot;, \&quot;moments\&quot;}, optional</span>
<span class="sd">            Estimation strategy. ``&quot;moments&quot;`` uses the first trigonometric</span>
<span class="sd">            moment, ``&quot;mle&quot;`` (default) maximises the weighted log-likelihood.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a diagnostic dictionary.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">            ``method=&quot;mle&quot;``.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">cos_term</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">denom</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">log_terms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_terms</span><span class="p">)</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">cos_term</span>
            <span class="n">mask_bad</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_bad</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">inv</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">denom</span>
            <span class="n">g_mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
            <span class="n">g_rho</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_rho</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;moments&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;mle&#39; or &#39;moments&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">_nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rho_mom</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
                <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
                <span class="n">rho_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">_nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
                    <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Degenerate start (rho≈0); returning boundary solution.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="n">_nll</span><span class="p">,</span>
                    <span class="n">init</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                    <span class="n">jac</span><span class="o">=</span><span class="n">_grad</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;cardioid.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                    <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                    <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                    <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                    <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cardioid_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Cardioid distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{1}{2\pi} \left(1 + 2\rho \cos(\theta - \mu)\right), \space \rho \in [0, 1/2]
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, 0 &lt;= rho &lt;= 0.5.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Cardioid distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{1}{2\pi} \left(1 + 2\rho \cos(\theta - \mu)\right), \space \rho \in [0, 1/2]</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Mean resultant length, 0 &lt;= rho &lt;= 0.5.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cardioid_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Cardioid distribution.</p>
<div class="arithmatex">\[
F(\theta) = \frac{\theta + 2\rho (\sin(\mu) + \sin(\theta - \mu))}{2\pi}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, 0 &lt;= rho &lt;= 0.5.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Cardioid distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \frac{\theta + 2\rho (\sin(\mu) + \sin(\theta - \mu))}{2\pi}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Mean resultant length, 0 &lt;= rho &lt;= 0.5.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cardioid_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse CDF) of the Cardioid distribution.</p>
<p>The quantile <span class="arithmatex">\(\theta\)</span> solves</p>
<div class="arithmatex">\[
F(\theta) = \frac{\theta + 2\rho\bigl(\sin\mu + \sin(\theta - \mu)\bigr)}{2\pi} = q,
\]</div>
<p>on the support <span class="arithmatex">\([0, 2\pi]\)</span>.  The implementation applies a
Halley--Newton iteration with adaptive clipping and a final bisection
safeguard, ensuring robustness for large <span class="arithmatex">\(\rho\)</span> and quantiles
close to the boundary.  The same solver powers <code>rvs</code>, so sampled
variates and tabulated quantiles are numerically consistent.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate; finite values in <code>[0, 1]</code> are supported.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <code>0 &lt;= mu &lt;= 2*pi</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, <code>0 &lt;= rho &lt;= 0.5</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles satisfying <span class="arithmatex">\(F(\theta)=q\)</span>. Inputs outside <code>[0, 1]</code> are
returned as <code>nan</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse CDF) of the Cardioid distribution.</span>

<span class="sd">    The quantile $\theta$ solves</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \frac{\theta + 2\rho\bigl(\sin\mu + \sin(\theta - \mu)\bigr)}{2\pi} = q,</span>
<span class="sd">    $$</span>

<span class="sd">    on the support $[0, 2\pi]$.  The implementation applies a</span>
<span class="sd">    Halley--Newton iteration with adaptive clipping and a final bisection</span>
<span class="sd">    safeguard, ensuring robustness for large $\rho$ and quantiles</span>
<span class="sd">    close to the boundary.  The same solver powers ``rvs``, so sampled</span>
<span class="sd">    variates and tabulated quantiles are numerically consistent.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate; finite values in ``[0, 1]`` are supported.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, ``0 &lt;= mu &lt;= 2*pi``.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Mean resultant length, ``0 &lt;= rho &lt;= 0.5``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Angles satisfying $F(\theta)=q$. Inputs outside ``[0, 1]`` are</span>
<span class="sd">        returned as ``nan``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cardioid_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the Cardioid distribution.</p>
<p>Each sample is obtained by inverse-transform sampling.  For a uniform
draw <span class="arithmatex">\(U \sim \mathcal{U}(0, 1)\)</span>, the angle <span class="arithmatex">\(\Theta\)</span>
satisfies</p>
<div class="arithmatex">\[
\frac{\Theta + 2\rho\bigl(\sin\mu + \sin(\Theta - \mu)\bigr)}{2\pi} = U,
\]</div>
<p>and is computed with the safeguarded Halley--Newton solver described in
<code>ppf</code>.  When <span class="arithmatex">\(\rho = 0\)</span>, the distribution degenerates to the
circular uniform law and samples are drawn directly from <code>[0, 2π)</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <code>0 &lt;= mu &lt;= 2*pi</code>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, <code>0 &lt;= rho &lt;= 0.5</code>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw. <code>None</code> (default) returns a scalar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>np.random.Generator, np.random.RandomState, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <code>[0, 2π)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the Cardioid distribution.</span>

<span class="sd">    Each sample is obtained by inverse-transform sampling.  For a uniform</span>
<span class="sd">    draw $U \sim \mathcal{U}(0, 1)$, the angle $\Theta$</span>
<span class="sd">    satisfies</span>

<span class="sd">    $$</span>
<span class="sd">    \frac{\Theta + 2\rho\bigl(\sin\mu + \sin(\Theta - \mu)\bigr)}{2\pi} = U,</span>
<span class="sd">    $$</span>

<span class="sd">    and is computed with the safeguarded Halley--Newton solver described in</span>
<span class="sd">    ``ppf``.  When $\rho = 0$, the distribution degenerates to the</span>
<span class="sd">    circular uniform law and samples are drawn directly from ``[0, 2π)``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float, optional</span>
<span class="sd">        Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    rho : float, optional</span>
<span class="sd">        Mean resultant length, ``0 &lt;= rho &lt;= 0.5``. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">    random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">        Random number generator to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Random variates on ``[0, 2π)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
    <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

    <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cardioid_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>mu</code> and <code>rho</code> for the cardioid distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <code>[0, 2π)</code> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights/frequencies broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="mle">mle</span>, <span title="moments">moments</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation strategy. <code>"moments"</code> uses the first trigonometric
moment, <code>"mle"</code> (default) maximises the weighted log-likelihood.</p>
              </div>
            </td>
            <td>
                  <code>&#34;mle&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a diagnostic dictionary.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser passed to <code>scipy.optimize.minimize</code> when
<code>method="mle"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ``mu`` and ``rho`` for the cardioid distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights/frequencies broadcastable to ``data``.</span>
<span class="sd">    method : {\&quot;mle\&quot;, \&quot;moments\&quot;}, optional</span>
<span class="sd">        Estimation strategy. ``&quot;moments&quot;`` uses the first trigonometric</span>
<span class="sd">        moment, ``&quot;mle&quot;`` (default) maximises the weighted log-likelihood.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a diagnostic dictionary.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">        ``method=&quot;mle&quot;``.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">cos_term</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">denom</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">log_terms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_terms</span><span class="p">)</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">cos_term</span>
        <span class="n">mask_bad</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_bad</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">g_mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
        <span class="n">g_rho</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_rho</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;moments&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;mle&#39; or &#39;moments&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">_nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rho_mom</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">_nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Degenerate start (rho≈0); returning boundary solution.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">_nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">jac</span><span class="o">=</span><span class="n">_grad</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;cardioid.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.cartwright_gen" class="doc doc-heading">
            <code>cartwright_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Cartwright's Power-of-Cosine Distribution</p>
<p><img alt="cartwright" src="../../images/circ-mod-cartwright.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, zeta, *args, **kwargs) (pycircstat2.distributions.cartwright_gen.pdf)" href="#pycircstat2.distributions.cartwright_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, zeta, *args, **kwargs) (pycircstat2.distributions.cartwright_gen.cdf)" href="#pycircstat2.distributions.cartwright_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, mu, zeta, *args, **kwargs) (pycircstat2.distributions.cartwright_gen.ppf)" href="#pycircstat2.distributions.cartwright_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function obtained by inverting the regularised incomplete beta.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(mu=None, zeta=None, size=None, random_state=None) (pycircstat2.distributions.cartwright_gen.rvs)" href="#pycircstat2.distributions.cartwright_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates via a Beta-to-angle transform consistent with the quantile.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False, optimizer='L-BFGS-B', **kwargs) (pycircstat2.distributions.cartwright_gen.fit)" href="#pycircstat2.distributions.cartwright_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Estimate <code>(mu, zeta)</code> using moments or maximum likelihood.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Implementation based on Section 4.3.5 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">cartwright_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cartwright&#39;s Power-of-Cosine Distribution</span>

<span class="sd">    ![cartwright](../images/circ-mod-cartwright.png)</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, zeta)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, zeta)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, mu, zeta)</span>
<span class="sd">        Percent-point function obtained by inverting the regularised incomplete beta.</span>

<span class="sd">    rvs(mu, zeta, size=None, random_state=None)</span>
<span class="sd">        Random variates via a Beta-to-angle transform consistent with the quantile.</span>

<span class="sd">    fit(data, *args, **kwargs)</span>
<span class="sd">        Estimate ``(mu, zeta)`` using moments or maximum likelihood.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Implementation based on Section 4.3.5 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">zeta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">zeta_arr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_moment_r</span><span class="p">(</span><span class="n">zeta</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`zeta` must be positive.&quot;</span><span class="p">)</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">z</span>
        <span class="n">log_term</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">log_term</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">log_term</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">inv</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">inv</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">log_term</span> <span class="o">+=</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">inv</span><span class="p">)</span>
        <span class="n">log_term</span> <span class="o">+=</span> <span class="n">gammaln</span><span class="p">(</span><span class="n">inv</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">log_term</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">log_term</span> <span class="o">-=</span> <span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_term</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span> <span class="k">else</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">zeta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">zeta</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">zeta</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">zeta</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Cartwright distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{2^{- 1+1/\zeta} \Gamma^2(1 + 1/\zeta)}{\pi \Gamma(1 + 2/\zeta)} (1 + \cos(\theta - \mu))^{1/\zeta}</span>
<span class="sd">        $$</span>

<span class="sd">        , where $\Gamma$ is the gamma function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        zeta : float</span>
<span class="sd">            Shape parameter, zeta &gt; 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_cartwright_cumulative</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">half_norm</span><span class="p">):</span>
        <span class="n">phi_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">scalar_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">phi_arr</span><span class="p">)</span>
        <span class="n">phi_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">phi_arr</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">phi_vec</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mask_lower</span> <span class="o">=</span> <span class="n">phi_vec</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_lower</span><span class="p">):</span>
            <span class="n">s_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi_vec</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s_small</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">=</span> <span class="n">half_norm</span> <span class="o">*</span> <span class="n">val</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">):</span>
            <span class="n">phi_ref</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">phi_vec</span><span class="p">[</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">]</span>
            <span class="n">s_large</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi_ref</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s_large</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">half_norm</span> <span class="o">*</span> <span class="n">val</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">phi_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">zeta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">zeta_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cartwright parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">zeta_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zeta_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">zeta_val</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`zeta` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">beta_term</span> <span class="o">=</span> <span class="n">beta_fn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">half_norm</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">))</span> <span class="o">*</span> <span class="n">beta_term</span>  <span class="c1"># equals 0.5</span>
        <span class="n">half_norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">half_norm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">phi_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">phi_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="n">H_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cartwright_cumulative</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_start</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">half_norm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">H_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cartwright_cumulative</span><span class="p">(</span><span class="n">phi_end</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">half_norm</span><span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">phi_end</span> <span class="o">&gt;=</span> <span class="n">phi_start</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">H_end</span> <span class="o">-</span> <span class="n">H_start</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">H_start</span> <span class="o">-</span> <span class="n">H_end</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">negative</span> <span class="o">=</span> <span class="n">cdf</span> <span class="o">&lt;</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">negative</span><span class="p">):</span>
            <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">negative</span><span class="p">,</span> <span class="n">cdf</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">cdf</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Cartwright distribution.</span>

<span class="sd">        The CDF is evaluated analytically via a beta-function series,</span>
<span class="sd">        exploiting the symmetry around the mean direction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        zeta : float</span>
<span class="sd">            Shape parameter, zeta &gt; 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">):</span>
        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">zeta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">zeta_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zeta_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">zeta_val</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`zeta` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">half_norm</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span><span class="p">))</span> <span class="o">*</span> <span class="n">beta_fn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">half_norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">half_norm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">phi_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">H_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cartwright_cumulative</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_start</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">half_norm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>

            <span class="c1"># Handle exact boundary quantiles explicitly</span>
            <span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="n">close_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">+</span> <span class="n">q_valid</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>

            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
            <span class="n">mask_lower</span> <span class="o">=</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="mf">0.5</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_lower</span><span class="p">):</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">/</span> <span class="n">half_norm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">betaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">phi</span><span class="p">[</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">):</span>
                <span class="n">s_upper</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">s_upper</span><span class="p">)</span> <span class="o">/</span> <span class="n">half_norm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">betaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">phi</span><span class="p">[</span><span class="o">~</span><span class="n">mask_lower</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

            <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_zero</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_zero</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">phi_start</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_one</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>

            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse CDF) of the Cartwright distribution.</span>

<span class="sd">        The quantile inversion exploits the beta integral governing the CDF.</span>
<span class="sd">        With</span>
<span class="sd">        $$</span>
<span class="sd">        t = \sin^2\!\left(\tfrac{1}{2}\phi\right), \qquad</span>
<span class="sd">        a = \tfrac{1}{2}, \qquad b = \tfrac{1}{\zeta} + \tfrac{1}{2},</span>
<span class="sd">        $$</span>
<span class="sd">        the cumulative distribution reduces to</span>
<span class="sd">        $$</span>
<span class="sd">        H(\phi) =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        \tfrac{1}{2} I_t(a, b), &amp; 0 \le \phi \le \pi, \\[6pt]</span>
<span class="sd">        1 - \tfrac{1}{2} I_t(a, b), &amp; \pi &lt; \phi &lt; 2\pi,</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>
<span class="sd">        where $I_t$ is the regularised incomplete beta function. The inverse</span>
<span class="sd">        quantile solves $H(\phi) = s$ via the inverse regularised incomplete</span>
<span class="sd">        beta, ``betaincinv``, yielding the exact $O(1)$ mapping used here and in</span>
<span class="sd">        ``rvs``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        zeta : float</span>
<span class="sd">            Shape parameter, zeta &gt; 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Angles corresponding to the given quantiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">zeta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zeta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">zeta_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cartwright parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">zeta_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zeta_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">zeta_val</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`zeta` must be positive.&quot;</span><span class="p">)</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

        <span class="n">beta_b</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_val</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">beta_b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">sqrt_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sqrt_t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="n">signs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">signs</span> <span class="o">*</span> <span class="n">angles</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">theta</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the Cartwright distribution.</span>

<span class="sd">        Sampling follows the same Beta-to-angle transform as the quantile</span>
<span class="sd">        function: draw $T \sim \mathrm{Beta}\!\left(\tfrac{1}{2},</span>
<span class="sd">        \tfrac{1}{\zeta} + \tfrac{1}{2}\right)$, map it via</span>
<span class="sd">        $\phi = 2\arcsin(\sqrt{T})$, then reflect $\phi$ with equal probability</span>
<span class="sd">        around $\mu$. This construction keeps ``rvs`` numerically consistent</span>
<span class="sd">        with ``ppf``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : float, optional</span>
<span class="sd">            Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        zeta : float, optional</span>
<span class="sd">            Shape parameter, ``zeta &gt; 0``. Supply explicitly or by freezing the</span>
<span class="sd">            distribution.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">        random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">            Random number generator to use.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Random variates on ``[0, 2π)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
        <span class="n">zeta_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;zeta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">zeta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">zeta</span>

        <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zeta_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;zeta&#39; must be provided.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">zeta_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate ``mu`` and ``zeta`` for the Cartwright distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights/frequencies broadcastable to ``data``.</span>
<span class="sd">        method : {&quot;mle&quot;, &quot;moments&quot;}, optional</span>
<span class="sd">            Estimation strategy. &quot;moments&quot; matches the first trigonometric</span>
<span class="sd">            moment, &quot;mle&quot; (default) maximises the weighted log-likelihood.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a diagnostic dictionary.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">            ``method=&quot;mle&quot;``.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_mom</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">sin_half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
        <span class="n">m_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_half</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">w_sum</span><span class="p">)</span>
        <span class="n">m_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">m_t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">m_t</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">zeta_mom</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">m_t</span><span class="p">)</span>
            <span class="n">zeta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">m_t</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">log_c</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">z</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
                <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">zeta_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="n">zeta_param</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">cos_term</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">sum_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">))</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">log_c</span><span class="p">(</span><span class="n">zeta_param</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span><span class="p">)</span> <span class="o">*</span> <span class="n">sum_log</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">zeta_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">cos_term</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">sum_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">))</span>
            <span class="n">grad_mu</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_term</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
            <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span>
            <span class="n">term</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">digamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">digamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">grad_zeta</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_log</span> <span class="o">-</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">term</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zeta_param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grad_mu</span><span class="p">,</span> <span class="n">grad_zeta</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;moments&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;mle&#39; or &#39;moments&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">zeta_hat</span> <span class="o">=</span> <span class="n">zeta_mom</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">zeta_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu_init</span> <span class="o">=</span> <span class="n">mu_mom</span>
            <span class="n">zeta_init</span> <span class="o">=</span> <span class="n">zeta_mom</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">zeta_mom</span><span class="p">)</span> <span class="k">else</span> <span class="mf">10.0</span>
            <span class="n">zeta_init</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">zeta_init</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">))</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_init</span><span class="p">,</span> <span class="n">zeta_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;cartwright.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">zeta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">zeta_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cartwright_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Cartwright distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{2^{- 1+1/\zeta} \Gamma^2(1 + 1/\zeta)}{\pi \Gamma(1 + 2/\zeta)} (1 + \cos(\theta - \mu))^{1/\zeta}
\]</div>
<p>, where <span class="arithmatex">\(\Gamma\)</span> is the gamma function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zeta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, zeta &gt; 0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Cartwright distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{2^{- 1+1/\zeta} \Gamma^2(1 + 1/\zeta)}{\pi \Gamma(1 + 2/\zeta)} (1 + \cos(\theta - \mu))^{1/\zeta}</span>
<span class="sd">    $$</span>

<span class="sd">    , where $\Gamma$ is the gamma function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    zeta : float</span>
<span class="sd">        Shape parameter, zeta &gt; 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cartwright_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Cartwright distribution.</p>
<p>The CDF is evaluated analytically via a beta-function series,
exploiting the symmetry around the mean direction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zeta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, zeta &gt; 0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Cartwright distribution.</span>

<span class="sd">    The CDF is evaluated analytically via a beta-function series,</span>
<span class="sd">    exploiting the symmetry around the mean direction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    zeta : float</span>
<span class="sd">        Shape parameter, zeta &gt; 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cartwright_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse CDF) of the Cartwright distribution.</p>
<p>The quantile inversion exploits the beta integral governing the CDF.
With
$$
t = \sin^2!\left(\tfrac{1}{2}\phi\right), \qquad
a = \tfrac{1}{2}, \qquad b = \tfrac{1}{\zeta} + \tfrac{1}{2},
$$
the cumulative distribution reduces to
$$
H(\phi) =
\begin{cases}
\tfrac{1}{2} I_t(a, b), &amp; 0 \le \phi \le \pi, \[6pt]
1 - \tfrac{1}{2} I_t(a, b), &amp; \pi &lt; \phi &lt; 2\pi,
\end{cases}
$$
where <span class="arithmatex">\(I_t\)</span> is the regularised incomplete beta function. The inverse
quantile solves <span class="arithmatex">\(H(\phi) = s\)</span> via the inverse regularised incomplete
beta, <code>betaincinv</code>, yielding the exact <span class="arithmatex">\(O(1)\)</span> mapping used here and in
<code>rvs</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate (0 &lt;= q &lt;= 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zeta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, zeta &gt; 0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles corresponding to the given quantiles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse CDF) of the Cartwright distribution.</span>

<span class="sd">    The quantile inversion exploits the beta integral governing the CDF.</span>
<span class="sd">    With</span>
<span class="sd">    $$</span>
<span class="sd">    t = \sin^2\!\left(\tfrac{1}{2}\phi\right), \qquad</span>
<span class="sd">    a = \tfrac{1}{2}, \qquad b = \tfrac{1}{\zeta} + \tfrac{1}{2},</span>
<span class="sd">    $$</span>
<span class="sd">    the cumulative distribution reduces to</span>
<span class="sd">    $$</span>
<span class="sd">    H(\phi) =</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \tfrac{1}{2} I_t(a, b), &amp; 0 \le \phi \le \pi, \\[6pt]</span>
<span class="sd">    1 - \tfrac{1}{2} I_t(a, b), &amp; \pi &lt; \phi &lt; 2\pi,</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>
<span class="sd">    where $I_t$ is the regularised incomplete beta function. The inverse</span>
<span class="sd">    quantile solves $H(\phi) = s$ via the inverse regularised incomplete</span>
<span class="sd">    beta, ``betaincinv``, yielding the exact $O(1)$ mapping used here and in</span>
<span class="sd">    ``rvs``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    zeta : float</span>
<span class="sd">        Shape parameter, zeta &gt; 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Angles corresponding to the given quantiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cartwright_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the Cartwright distribution.</p>
<p>Sampling follows the same Beta-to-angle transform as the quantile
function: draw <span class="arithmatex">\(T \sim \mathrm{Beta}\!\left(\tfrac{1}{2},
\tfrac{1}{\zeta} + \tfrac{1}{2}\right)\)</span>, map it via
<span class="arithmatex">\(\phi = 2\arcsin(\sqrt{T})\)</span>, then reflect <span class="arithmatex">\(\phi\)</span> with equal probability
around <span class="arithmatex">\(\mu\)</span>. This construction keeps <code>rvs</code> numerically consistent
with <code>ppf</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <code>0 &lt;= mu &lt;= 2*pi</code>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zeta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <code>zeta &gt; 0</code>. Supply explicitly or by freezing the
distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw. <code>None</code> (default) returns a scalar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>np.random.Generator, np.random.RandomState, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <code>[0, 2π)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the Cartwright distribution.</span>

<span class="sd">    Sampling follows the same Beta-to-angle transform as the quantile</span>
<span class="sd">    function: draw $T \sim \mathrm{Beta}\!\left(\tfrac{1}{2},</span>
<span class="sd">    \tfrac{1}{\zeta} + \tfrac{1}{2}\right)$, map it via</span>
<span class="sd">    $\phi = 2\arcsin(\sqrt{T})$, then reflect $\phi$ with equal probability</span>
<span class="sd">    around $\mu$. This construction keeps ``rvs`` numerically consistent</span>
<span class="sd">    with ``ppf``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float, optional</span>
<span class="sd">        Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    zeta : float, optional</span>
<span class="sd">        Shape parameter, ``zeta &gt; 0``. Supply explicitly or by freezing the</span>
<span class="sd">        distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">    random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">        Random number generator to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Random variates on ``[0, 2π)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
    <span class="n">zeta_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;zeta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">zeta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">zeta</span>

    <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zeta_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;zeta&#39; must be provided.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">zeta_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.cartwright_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>mu</code> and <code>zeta</code> for the Cartwright distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <code>[0, 2π)</code> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights/frequencies broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="mle">mle</span>, <span title="moments">moments</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation strategy. "moments" matches the first trigonometric
moment, "mle" (default) maximises the weighted log-likelihood.</p>
              </div>
            </td>
            <td>
                  <code>&#34;mle&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a diagnostic dictionary.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser passed to <code>scipy.optimize.minimize</code> when
<code>method="mle"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ``mu`` and ``zeta`` for the Cartwright distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights/frequencies broadcastable to ``data``.</span>
<span class="sd">    method : {&quot;mle&quot;, &quot;moments&quot;}, optional</span>
<span class="sd">        Estimation strategy. &quot;moments&quot; matches the first trigonometric</span>
<span class="sd">        moment, &quot;mle&quot; (default) maximises the weighted log-likelihood.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a diagnostic dictionary.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">        ``method=&quot;mle&quot;``.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_mom</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">sin_half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">m_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_half</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">w_sum</span><span class="p">)</span>
    <span class="n">m_t</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">m_t</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">m_t</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
        <span class="n">zeta_mom</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">m_t</span><span class="p">)</span>
        <span class="n">zeta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">m_t</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_c</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">z</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">zeta_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="n">zeta_param</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">cos_term</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sum_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">))</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">log_c</span><span class="p">(</span><span class="n">zeta_param</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span><span class="p">)</span> <span class="o">*</span> <span class="n">sum_log</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">ll</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">zeta_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">cos_term</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">sum_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">))</span>
        <span class="n">grad_mu</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_term</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">zeta_param</span>
        <span class="n">term</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">digamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">inv</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">digamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">inv</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">grad_zeta</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_log</span> <span class="o">-</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">term</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zeta_param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grad_mu</span><span class="p">,</span> <span class="n">grad_zeta</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span> <span class="s2">&quot;moments&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;mle&#39; or &#39;moments&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
        <span class="n">zeta_hat</span> <span class="o">=</span> <span class="n">zeta_mom</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">zeta_hat</span><span class="p">))),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mu_init</span> <span class="o">=</span> <span class="n">mu_mom</span>
        <span class="n">zeta_init</span> <span class="o">=</span> <span class="n">zeta_mom</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">zeta_mom</span><span class="p">)</span> <span class="k">else</span> <span class="mf">10.0</span>
        <span class="n">zeta_init</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">zeta_init</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">))</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_init</span><span class="p">,</span> <span class="n">zeta_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;cartwright.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">zeta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">zeta_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.wrapnorm_gen" class="doc doc-heading">
            <code>wrapnorm_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Wrapped Normal Distribution</p>
<p><img alt="wrapnorm" src="../../images/circ-mod-wrapnorm.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapnorm_gen.pdf)" href="#pycircstat2.distributions.wrapnorm_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapnorm_gen.cdf)" href="#pycircstat2.distributions.wrapnorm_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapnorm_gen.ppf)" href="#pycircstat2.distributions.wrapnorm_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(mu=None, rho=None, size=None, random_state=None) (pycircstat2.distributions.wrapnorm_gen.rvs)" href="#pycircstat2.distributions.wrapnorm_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False, optimizer='L-BFGS-B', **kwargs) (pycircstat2.distributions.wrapnorm_gen.fit)" href="#pycircstat2.distributions.wrapnorm_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Estimate <code>(mu, rho)</code> via method-of-moments or maximum likelihood.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <pre><code>from pycircstat2.distributions import wrapnorm
</code></pre>


<details class="note" open>
  <summary>Notes</summary>
  <p>Implementation based on Section 4.3.7 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">wrapnorm_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapped Normal Distribution</span>

<span class="sd">    ![wrapnorm](../images/circ-mod-wrapnorm.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, rho)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, rho)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, mu, rho)</span>
<span class="sd">        Percent-point function (inverse CDF).</span>

<span class="sd">    rvs(mu, rho, size=None, random_state=None)</span>
<span class="sd">        Random variates.</span>

<span class="sd">    fit(data, *args, **kwargs)</span>
<span class="sd">        Estimate ``(mu, rho)`` via method-of-moments or maximum likelihood.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```</span>
<span class="sd">    from pycircstat2.distributions import wrapnorm</span>
<span class="sd">    ```</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implementation based on Section 4.3.7 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_window_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="o">+</span> <span class="mi">2</span>
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">rho</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Wrapped Normal distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{1}{2\pi} \left(1 + 2\sum_{p=1}^{\infty} \rho^{p^2} \cos(p(\theta - \mu))\right)</span>
<span class="sd">        $$</span>

<span class="sd">        , here we approximate the infinite sum by summing the first 30 terms.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_wrapnorm_cdf_pdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="n">theta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">theta_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">theta_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">theta_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">inv_sigma</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">inv_sigma</span>
        <span class="n">z_ref0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_sigma</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z0</span><span class="p">)</span> <span class="o">-</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z_ref0</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">INV_SQRT_2PI</span> <span class="o">*</span> <span class="n">inv_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">max_contrib</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">max_iter</span> <span class="ow">and</span> <span class="n">max_contrib</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">k</span>

            <span class="n">z_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_sigma</span>
            <span class="n">z_pos_ref</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_sigma</span>
            <span class="n">delta_pos</span> <span class="o">=</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z_pos</span><span class="p">)</span> <span class="o">-</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z_pos_ref</span><span class="p">)</span>
            <span class="n">pdf</span> <span class="o">+=</span> <span class="n">INV_SQRT_2PI</span> <span class="o">*</span> <span class="n">inv_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z_pos</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">z_neg</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_sigma</span>
            <span class="n">z_neg_ref</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">inv_sigma</span>
            <span class="n">delta_neg</span> <span class="o">=</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z_neg</span><span class="p">)</span> <span class="o">-</span> <span class="n">ndtr</span><span class="p">(</span><span class="n">z_neg_ref</span><span class="p">)</span>
            <span class="n">pdf</span> <span class="o">+=</span> <span class="n">INV_SQRT_2PI</span> <span class="o">*</span> <span class="n">inv_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z_neg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">cdf</span> <span class="o">+=</span> <span class="n">delta_pos</span> <span class="o">+</span> <span class="n">delta_neg</span>
            <span class="n">max_contrib</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_pos</span><span class="p">))),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_neg</span><span class="p">))),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">max_contrib</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">theta_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">theta_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">pdf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rho_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrapnorm parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">uniform</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="n">two_pi</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">uniform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">uniform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">rho_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-15</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho_clipped</span><span class="p">)))</span>

        <span class="n">cdf_flat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapnorm_cdf_pdf</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cdf_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Wrapped Normal distribution.</span>

<span class="sd">        The CDF is evaluated via the wrapped normal series involving the</span>
<span class="sd">        standard normal distribution function.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \sum_{k=-\infty}^{\infty} \left[</span>
<span class="sd">            \Phi\left(\frac{\theta - \mu + 2\pi k}{\sigma}\right)</span>
<span class="sd">            - \Phi\left(\frac{-\mu + 2\pi k}{\sigma}\right)</span>
<span class="sd">        \right], \quad \sigma = \sqrt{-2\log \rho}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_finish</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">reshaped</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">reshaped</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">reshaped</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">close_zero</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">close_one</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">close_zero</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">close_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>

        <span class="n">interior</span> <span class="o">=</span> <span class="n">valid</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">close_zero</span> <span class="o">|</span> <span class="n">close_one</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">flat_interior</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">flat_interior</span>
            <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">rho_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-15</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho_clipped</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">sigma</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">q_sub</span> <span class="o">=</span> <span class="n">flat_interior</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_sub</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">normal_guess</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">ndtri</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q_sub</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">normal_guess</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">cdf_vals</span><span class="p">,</span> <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapnorm_cdf_pdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_sub</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">lower</span><span class="p">)</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">-</span> <span class="n">step</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">theta_next</span> <span class="o">&lt;=</span> <span class="n">lower</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">theta_next</span> <span class="o">&gt;=</span> <span class="n">upper</span><span class="p">),</span>
                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lower</span> <span class="o">+</span> <span class="n">upper</span><span class="p">),</span>
                <span class="n">theta_next</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">theta_next</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">theta_next</span>
            <span class="n">cdf_vals</span><span class="p">,</span> <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapnorm_cdf_pdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_sub</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">lower</span><span class="p">)</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="n">lower_b</span> <span class="o">=</span> <span class="n">lower</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">upper_b</span> <span class="o">=</span> <span class="n">upper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">theta_b</span> <span class="o">=</span> <span class="n">theta_curr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lower_b</span> <span class="o">+</span> <span class="n">upper_b</span><span class="p">)</span>
                <span class="n">mid_cdf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapnorm_cdf_pdf</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
                <span class="n">delta_mid</span> <span class="o">=</span> <span class="n">mid_cdf</span> <span class="o">-</span> <span class="n">q_sub</span>
                <span class="n">take_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mid</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                <span class="n">take_lower</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">take_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                <span class="n">upper_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_upper</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">upper_b</span><span class="p">)</span>
                <span class="n">lower_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_lower</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">lower_b</span><span class="p">)</span>
                <span class="n">theta_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">theta_b</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>
            <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lower_b</span> <span class="o">+</span> <span class="n">upper_b</span><span class="p">),</span> <span class="n">theta_b</span><span class="p">)</span>

        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="n">endpoint_mask</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">endpoint_mask</span><span class="p">):</span>
            <span class="n">endpoint_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">two_pi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">endpoint_mask</span><span class="p">,</span> <span class="n">endpoint_value</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_curr</span>
        <span class="k">return</span> <span class="n">_finish</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse CDF) of the Wrapped Normal distribution.</span>

<span class="sd">        The quantile is found by inverting the wrapped normal CDF using a</span>
<span class="sd">        safeguarded Newton iteration on $[0, 2\pi]$. At each step the algorithm</span>
<span class="sd">        evaluates the truncated unwrapped Gaussian series</span>
<span class="sd">        $$</span>
<span class="sd">        F(\theta)=\sum_{k=-\infty}^{\infty}</span>
<span class="sd">        \Bigl[\Phi\!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr)</span>
<span class="sd">        - \Phi\!\Bigl(\tfrac{-\mu+2\pi k}{\sigma}\Bigr)\Bigr],</span>
<span class="sd">        \qquad</span>
<span class="sd">        f(\theta)=\sum_{k=-\infty}^{\infty}</span>
<span class="sd">        \frac{1}{\sigma}\,\varphi\!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr),</span>
<span class="sd">        $$</span>
<span class="sd">        with $\sigma = \sqrt{-2\log\rho}$, using the CDF residual to update the</span>
<span class="sd">        bracket and the PDF as the local slope. A final bisection polish ensures</span>
<span class="sd">        robust convergence and keeps the quantile consistent with ``cdf`` and</span>
<span class="sd">        ``rvs``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Shape parameter, 0 &lt; rho &lt; 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Angles corresponding to the given quantiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rho_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrapnorm parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-15</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">else</span> <span class="n">samples</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho_val</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mu_val</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),),</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">wrapped</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the Wrapped Normal distribution.</span>

<span class="sd">        Samples are obtained by drawing from $N(\mu, \sigma^2)$ with</span>
<span class="sd">        $\sigma = \sqrt{-2\log\rho}$ and wrapping the result modulo $2\pi$.</span>
<span class="sd">        This matches the analytic mixture used in ``cdf`` and ``ppf``, keeping</span>
<span class="sd">        all three methods numerically consistent.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : float, optional</span>
<span class="sd">            Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        rho : float, optional</span>
<span class="sd">            Shape parameter, ``0 &lt; rho &lt; 1``. Supply explicitly or by freezing</span>
<span class="sd">            the distribution.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">        random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">            Random number generator to use.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Random variates on ``[0, 2π)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

        <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate ``mu`` and ``rho`` for the wrapped normal distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to ``data``.</span>
<span class="sd">        method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">            Estimation strategy. ``&quot;moments&quot;`` (aliases: &quot;analytical&quot;) returns</span>
<span class="sd">            the circular mean and resultant length. ``&quot;mle&quot;`` (alias:</span>
<span class="sd">            &quot;numerical&quot;) maximises the weighted log-likelihood via numerical</span>
<span class="sd">            optimisation.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">            ``method=&quot;mle&quot;``.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">logpdf_series</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span><span class="p">):</span>
            <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_param</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-8</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho_val</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">sigma</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_series_window_cache&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_series_window_cache</span> <span class="o">=</span> <span class="n">cache</span>

            <span class="n">mu_norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
            <span class="n">mu_bucket</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mu_norm</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="mi">512</span><span class="p">))</span> <span class="o">%</span> <span class="mi">512</span>
            <span class="n">rho_bucket</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">4095.0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">rho_val</span><span class="p">)</span> <span class="o">*</span> <span class="mf">64.0</span><span class="p">)))</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_bucket</span><span class="p">,</span> <span class="n">rho_bucket</span><span class="p">)</span>

            <span class="n">max_cap</span> <span class="o">=</span> <span class="mi">256</span>
            <span class="n">max_k</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">two_pi</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">tail_tol</span> <span class="o">=</span> <span class="mf">1e-10</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">max_k</span><span class="p">,</span> <span class="n">max_k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu_param</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">ks</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">exponents</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">diff</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">max_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponents</span> <span class="o">-</span> <span class="n">max_exp</span><span class="p">)</span>
                <span class="n">sum_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shifted</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">max_exp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_exp</span><span class="p">)</span>
                <span class="n">log_pdf</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>

                <span class="n">tail_contrib</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shifted</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">sum_exp</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="mf">1e-300</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">tail_contrib</span> <span class="o">&lt;=</span> <span class="n">tail_tol</span> <span class="ow">or</span> <span class="n">max_k</span> <span class="o">&gt;=</span> <span class="n">max_cap</span><span class="p">:</span>
                    <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_k</span>
                    <span class="k">return</span> <span class="n">log_pdf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="n">max_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_cap</span><span class="p">,</span> <span class="n">max_k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">log_pdf</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">logpdf_series</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
        <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">)]</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;wrapnorm.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapnorm_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Wrapped Normal distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{1}{2\pi} \left(1 + 2\sum_{p=1}^{\infty} \rho^{p^2} \cos(p(\theta - \mu))\right)
\]</div>
<p>, here we approximate the infinite sum by summing the first 30 terms.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, 0 &lt; rho &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Wrapped Normal distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{1}{2\pi} \left(1 + 2\sum_{p=1}^{\infty} \rho^{p^2} \cos(p(\theta - \mu))\right)</span>
<span class="sd">    $$</span>

<span class="sd">    , here we approximate the infinite sum by summing the first 30 terms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapnorm_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Wrapped Normal distribution.</p>
<p>The CDF is evaluated via the wrapped normal series involving the
standard normal distribution function.</p>
<div class="arithmatex">\[
F(\theta) = \sum_{k=-\infty}^{\infty} \left[
    \Phi\left(\frac{\theta - \mu + 2\pi k}{\sigma}\right)
    - \Phi\left(\frac{-\mu + 2\pi k}{\sigma}\right)
\right], \quad \sigma = \sqrt{-2\log \rho}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, 0 &lt; rho &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Wrapped Normal distribution.</span>

<span class="sd">    The CDF is evaluated via the wrapped normal series involving the</span>
<span class="sd">    standard normal distribution function.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \sum_{k=-\infty}^{\infty} \left[</span>
<span class="sd">        \Phi\left(\frac{\theta - \mu + 2\pi k}{\sigma}\right)</span>
<span class="sd">        - \Phi\left(\frac{-\mu + 2\pi k}{\sigma}\right)</span>
<span class="sd">    \right], \quad \sigma = \sqrt{-2\log \rho}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapnorm_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse CDF) of the Wrapped Normal distribution.</p>
<p>The quantile is found by inverting the wrapped normal CDF using a
safeguarded Newton iteration on <span class="arithmatex">\([0, 2\pi]\)</span>. At each step the algorithm
evaluates the truncated unwrapped Gaussian series
$$
F(\theta)=\sum_{k=-\infty}^{\infty}
\Bigl[\Phi!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr)
- \Phi!\Bigl(\tfrac{-\mu+2\pi k}{\sigma}\Bigr)\Bigr],
\qquad
f(\theta)=\sum_{k=-\infty}^{\infty}
\frac{1}{\sigma}\,\varphi!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr),
$$
with <span class="arithmatex">\(\sigma = \sqrt{-2\log\rho}\)</span>, using the CDF residual to update the
bracket and the PDF as the local slope. A final bisection polish ensures
robust convergence and keeps the quantile consistent with <code>cdf</code> and
<code>rvs</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate (0 &lt;= q &lt;= 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, 0 &lt; rho &lt; 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles corresponding to the given quantiles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse CDF) of the Wrapped Normal distribution.</span>

<span class="sd">    The quantile is found by inverting the wrapped normal CDF using a</span>
<span class="sd">    safeguarded Newton iteration on $[0, 2\pi]$. At each step the algorithm</span>
<span class="sd">    evaluates the truncated unwrapped Gaussian series</span>
<span class="sd">    $$</span>
<span class="sd">    F(\theta)=\sum_{k=-\infty}^{\infty}</span>
<span class="sd">    \Bigl[\Phi\!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr)</span>
<span class="sd">    - \Phi\!\Bigl(\tfrac{-\mu+2\pi k}{\sigma}\Bigr)\Bigr],</span>
<span class="sd">    \qquad</span>
<span class="sd">    f(\theta)=\sum_{k=-\infty}^{\infty}</span>
<span class="sd">    \frac{1}{\sigma}\,\varphi\!\Bigl(\tfrac{\theta-\mu+2\pi k}{\sigma}\Bigr),</span>
<span class="sd">    $$</span>
<span class="sd">    with $\sigma = \sqrt{-2\log\rho}$, using the CDF residual to update the</span>
<span class="sd">    bracket and the PDF as the local slope. A final bisection polish ensures</span>
<span class="sd">    robust convergence and keeps the quantile consistent with ``cdf`` and</span>
<span class="sd">    ``rvs``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Shape parameter, 0 &lt; rho &lt; 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Angles corresponding to the given quantiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapnorm_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the Wrapped Normal distribution.</p>
<p>Samples are obtained by drawing from <span class="arithmatex">\(N(\mu, \sigma^2)\)</span> with
<span class="arithmatex">\(\sigma = \sqrt{-2\log\rho}\)</span> and wrapping the result modulo <span class="arithmatex">\(2\pi\)</span>.
This matches the analytic mixture used in <code>cdf</code> and <code>ppf</code>, keeping
all three methods numerically consistent.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <code>0 &lt;= mu &lt;= 2*pi</code>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <code>0 &lt; rho &lt; 1</code>. Supply explicitly or by freezing
the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw. <code>None</code> (default) returns a scalar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>np.random.Generator, np.random.RandomState, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <code>[0, 2π)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the Wrapped Normal distribution.</span>

<span class="sd">    Samples are obtained by drawing from $N(\mu, \sigma^2)$ with</span>
<span class="sd">    $\sigma = \sqrt{-2\log\rho}$ and wrapping the result modulo $2\pi$.</span>
<span class="sd">    This matches the analytic mixture used in ``cdf`` and ``ppf``, keeping</span>
<span class="sd">    all three methods numerically consistent.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float, optional</span>
<span class="sd">        Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    rho : float, optional</span>
<span class="sd">        Shape parameter, ``0 &lt; rho &lt; 1``. Supply explicitly or by freezing</span>
<span class="sd">        the distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">    random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">        Random number generator to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Random variates on ``[0, 2π)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
    <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

    <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapnorm_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>mu</code> and <code>rho</code> for the wrapped normal distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <code>[0, 2π)</code> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="moments">moments</span>, <span title="mle">mle</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation strategy. <code>"moments"</code> (aliases: "analytical") returns
the circular mean and resultant length. <code>"mle"</code> (alias:
"numerical") maximises the weighted log-likelihood via numerical
optimisation.</p>
              </div>
            </td>
            <td>
                  <code>&#34;moments&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return a diagnostics dictionary alongside the estimates.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser passed to <code>scipy.optimize.minimize</code> when
<code>method="mle"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ``mu`` and ``rho`` for the wrapped normal distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to ``data``.</span>
<span class="sd">    method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">        Estimation strategy. ``&quot;moments&quot;`` (aliases: &quot;analytical&quot;) returns</span>
<span class="sd">        the circular mean and resultant length. ``&quot;mle&quot;`` (alias:</span>
<span class="sd">        &quot;numerical&quot;) maximises the weighted log-likelihood via numerical</span>
<span class="sd">        optimisation.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">        ``method=&quot;mle&quot;``.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logpdf_series</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span><span class="p">):</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_param</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-8</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho_val</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_series_window_cache&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_series_window_cache</span> <span class="o">=</span> <span class="n">cache</span>

        <span class="n">mu_norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
        <span class="n">mu_bucket</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mu_norm</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="mi">512</span><span class="p">))</span> <span class="o">%</span> <span class="mi">512</span>
        <span class="n">rho_bucket</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">4095.0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">rho_val</span><span class="p">)</span> <span class="o">*</span> <span class="mf">64.0</span><span class="p">)))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_bucket</span><span class="p">,</span> <span class="n">rho_bucket</span><span class="p">)</span>

        <span class="n">max_cap</span> <span class="o">=</span> <span class="mi">256</span>
        <span class="n">max_k</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">two_pi</span><span class="p">))</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">tail_tol</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">max_k</span><span class="p">,</span> <span class="n">max_k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu_param</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">ks</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">exponents</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">diff</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">max_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exponents</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponents</span> <span class="o">-</span> <span class="n">max_exp</span><span class="p">)</span>
            <span class="n">sum_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shifted</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">max_exp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_exp</span><span class="p">)</span>
            <span class="n">log_pdf</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>

            <span class="n">tail_contrib</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shifted</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">sum_exp</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="mf">1e-300</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">tail_contrib</span> <span class="o">&lt;=</span> <span class="n">tail_tol</span> <span class="ow">or</span> <span class="n">max_k</span> <span class="o">&gt;=</span> <span class="n">max_cap</span><span class="p">:</span>
                <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_k</span>
                <span class="k">return</span> <span class="n">log_pdf</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">max_k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_cap</span><span class="p">,</span> <span class="n">max_k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">log_pdf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">logpdf_series</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
    <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">)]</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;wrapnorm.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.wrapcauchy_gen" class="doc doc-heading">
            <code>wrapcauchy_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Wrapped Cauchy Distribution.</p>
<p><img alt="wrapcauchy" src="../../images/circ-mod-wrapcauchy.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapcauchy_gen.pdf)" href="#pycircstat2.distributions.wrapcauchy_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapcauchy_gen.cdf)" href="#pycircstat2.distributions.wrapcauchy_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, mu, rho, *args, **kwargs) (pycircstat2.distributions.wrapcauchy_gen.ppf)" href="#pycircstat2.distributions.wrapcauchy_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse CDF) via the Möbius mapping.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(mu=None, rho=None, size=None, random_state=None) (pycircstat2.distributions.wrapcauchy_gen.rvs)" href="#pycircstat2.distributions.wrapcauchy_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False, optimizer='L-BFGS-B', **kwargs) (pycircstat2.distributions.wrapcauchy_gen.fit)" href="#pycircstat2.distributions.wrapcauchy_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the distribution to the data and return the parameters (mu, rho).</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Implementation based on Section 4.3.6 of Pewsey et al. (2014).</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">wrapcauchy_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapped Cauchy Distribution.</span>

<span class="sd">    ![wrapcauchy](../images/circ-mod-wrapcauchy.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, rho)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, rho)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, mu, rho)</span>
<span class="sd">        Percent-point function (inverse CDF) via the Möbius mapping.</span>

<span class="sd">    rvs(mu, rho, size=None, random_state=None)</span>
<span class="sd">        Random variates.</span>

<span class="sd">    fit(data, method=&quot;analytical&quot;, *args, **kwargs)</span>
<span class="sd">        Fit the distribution to the data and return the parameters (mu, rho).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implementation based on Section 4.3.6 of Pewsey et al. (2014).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Wrapped Cauchy distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{1 - \rho^2}{2\pi(1 + \rho^2 - 2\rho \cos(\theta - \mu))}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="mf">1e-16</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logarithm of the probability density function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the log-PDF.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Mean resultant length, 0 &lt; rho &lt;= 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        logpdf_values : array_like</span>
<span class="sd">            Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrapcauchy parameters must be scalar-valued.&quot;</span><span class="p">)</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rho_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrapcauchy parameters must be scalar-valued.&quot;</span><span class="p">)</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-15</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_val</span><span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">base_phi</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi</span><span class="p">))</span>
        <span class="n">base_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">base_phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">base_phi</span><span class="p">))</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">angle</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">base_val</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">base_angle</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">cdf</span> <span class="o">-</span> <span class="n">base_val</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">diff</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">diff</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
        <span class="n">reshaped</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">reshaped</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">reshaped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Wrapped Cauchy distribution.</span>

<span class="sd">        The CDF is evaluated analytically via the wrapped Cauchy series.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the CDF.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            CDF evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_wrapcauchy_H</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="n">phi_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi_arr</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">phi_arr</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">angle</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="k">else</span> <span class="n">H</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_val</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rho` must lie in [0, 1).&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">lower_mask</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
        <span class="n">upper_mask</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">lower_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">upper_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">interior</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">lower_mask</span> <span class="o">|</span> <span class="n">upper_mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">q_int</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">&lt;=</span> <span class="mf">1e-15</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_int</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_val</span><span class="p">)</span>
        <span class="n">phi0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapcauchy_H</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">A</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">+</span> <span class="n">q_int</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-15</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">tan_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tan_alpha</span> <span class="o">/</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse CDF) of the Wrapped Cauchy distribution.</span>

<span class="sd">        The quantile is obtained by inverting the Möbius form of the CDF:</span>
<span class="sd">        $$</span>
<span class="sd">        \phi = 2 \arctan\!\left(\frac{\tan\left(\pi (s-\tfrac12)\right)}{A}\right),</span>
<span class="sd">        \qquad A=\frac{1+\rho}{1-\rho},</span>
<span class="sd">        $$</span>
<span class="sd">        where $s = (H(\phi_0) + q) \bmod 1$ and $\phi_0$ is the anchored angle</span>
<span class="sd">        at $x=0$. This matches the direct normalised CDF and keeps ``ppf`` in</span>
<span class="sd">        sync with ``cdf`` and the Möbius sampler used by ``rvs``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rho_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrapcauchy parameters must be scalar-valued.&quot;</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">rho_val</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">angle</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

        <span class="c1"># Möbius transform sampler: exact and numerically stable for rho&lt;1.</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">target_shape</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu_val</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span>
        <span class="n">tiny</span> <span class="o">=</span> <span class="mf">1e-15</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tiny</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">tiny</span><span class="p">,</span> <span class="n">denom</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">original_shape</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="c1"># Fallback to tangent sampler for rare near-pole cases.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
            <span class="n">fallback_u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_val</span><span class="p">)</span>
            <span class="n">tan_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">fallback_u</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">tan_term</span><span class="p">)</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">fallback</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="n">angles_flat</span> <span class="o">=</span> <span class="n">angles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mask_flat</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">angles_flat</span><span class="p">[</span><span class="n">mask_flat</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallback</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="n">angles_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">target_shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the Wrapped Cauchy distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : float, optional</span>
<span class="sd">            Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">            freezing the distribution.</span>
<span class="sd">        rho : float, optional</span>
<span class="sd">            Shape parameter, ``0 &lt;= rho &lt; 1``. Supply explicitly or by freezing</span>
<span class="sd">            the distribution.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">        random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">            Random number generator to use.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray or float</span>
<span class="sd">            Random variates on ``[0, 2π)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

        <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate ``mu`` and ``rho`` for the wrapped Cauchy distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to ``data``.</span>
<span class="sd">        method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">            Estimation strategy. ``&quot;moments&quot;`` (alias: &quot;analytical&quot;) returns the</span>
<span class="sd">            closed-form estimates based on the first trigonometric moment.</span>
<span class="sd">            ``&quot;mle&quot;`` (alias: &quot;numerical&quot;) maximises the weighted log-likelihood.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a diagnostic dictionary.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">            ``method=&quot;mle&quot;``.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">),</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">),</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>

            <span class="n">inv_denom</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">denom</span>
            <span class="n">g_mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv_denom</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
            <span class="n">g_rho</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">w_sum</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv_denom</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_rho</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
        <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">)]</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">))],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wrapcauchy.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Wrapped Cauchy distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{1 - \rho^2}{2\pi(1 + \rho^2 - 2\rho \cos(\theta - \mu))}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, 0 &lt; rho &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Wrapped Cauchy distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{1 - \rho^2}{2\pi(1 + \rho^2 - 2\rho \cos(\theta - \mu))}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.logpdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Logarithm of the probability density function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the log-PDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, 0 &lt; rho &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>logpdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logarithm of the probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logarithm of the probability density function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the log-PDF.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Mean resultant length, 0 &lt; rho &lt;= 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    logpdf_values : array_like</span>
<span class="sd">        Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Wrapped Cauchy distribution.</p>
<p>The CDF is evaluated analytically via the wrapped Cauchy series.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the CDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, 0 &lt; rho &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CDF evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Wrapped Cauchy distribution.</span>

<span class="sd">    The CDF is evaluated analytically via the wrapped Cauchy series.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the CDF.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Shape parameter, 0 &lt; rho &lt;= 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        CDF evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse CDF) of the Wrapped Cauchy distribution.</p>
<p>The quantile is obtained by inverting the Möbius form of the CDF:
$$
\phi = 2 \arctan!\left(\frac{\tan\left(\pi (s-\tfrac12)\right)}{A}\right),
\qquad A=\frac{1+\rho}{1-\rho},
$$
where <span class="arithmatex">\(s = (H(\phi_0) + q) \bmod 1\)</span> and <span class="arithmatex">\(\phi_0\)</span> is the anchored angle
at <span class="arithmatex">\(x=0\)</span>. This matches the direct normalised CDF and keeps <code>ppf</code> in
sync with <code>cdf</code> and the Möbius sampler used by <code>rvs</code>.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse CDF) of the Wrapped Cauchy distribution.</span>

<span class="sd">    The quantile is obtained by inverting the Möbius form of the CDF:</span>
<span class="sd">    $$</span>
<span class="sd">    \phi = 2 \arctan\!\left(\frac{\tan\left(\pi (s-\tfrac12)\right)}{A}\right),</span>
<span class="sd">    \qquad A=\frac{1+\rho}{1-\rho},</span>
<span class="sd">    $$</span>
<span class="sd">    where $s = (H(\phi_0) + q) \bmod 1$ and $\phi_0$ is the anchored angle</span>
<span class="sd">    at $x=0$. This matches the direct normalised CDF and keeps ``ppf`` in</span>
<span class="sd">    sync with ``cdf`` and the Möbius sampler used by ``rvs``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the Wrapped Cauchy distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <code>0 &lt;= mu &lt;= 2*pi</code>. Supply explicitly or by
freezing the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <code>0 &lt;= rho &lt; 1</code>. Supply explicitly or by freezing
the distribution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw. <code>None</code> (default) returns a scalar.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>np.random.Generator, np.random.RandomState, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <code>[0, 2π)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the Wrapped Cauchy distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float, optional</span>
<span class="sd">        Mean direction, ``0 &lt;= mu &lt;= 2*pi``. Supply explicitly or by</span>
<span class="sd">        freezing the distribution.</span>
<span class="sd">    rho : float, optional</span>
<span class="sd">        Shape parameter, ``0 &lt;= rho &lt; 1``. Supply explicitly or by freezing</span>
<span class="sd">        the distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Number of samples to draw. ``None`` (default) returns a scalar.</span>
<span class="sd">    random_state : np.random.Generator, np.random.RandomState, or None, optional</span>
<span class="sd">        Random number generator to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray or float</span>
<span class="sd">        Random variates on ``[0, 2π)``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mu</span>
    <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rho</span>

    <span class="k">if</span> <span class="n">mu_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rho_val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;rho&#39; must be provided.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapcauchy_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>mu</code> and <code>rho</code> for the wrapped Cauchy distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <code>[0, 2π)</code> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="moments">moments</span>, <span title="mle">mle</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation strategy. <code>"moments"</code> (alias: "analytical") returns the
closed-form estimates based on the first trigonometric moment.
<code>"mle"</code> (alias: "numerical") maximises the weighted log-likelihood.</p>
              </div>
            </td>
            <td>
                  <code>&#34;moments&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a diagnostic dictionary.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser passed to <code>scipy.optimize.minimize</code> when
<code>method="mle"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span>
<span class="normal">3223</span>
<span class="normal">3224</span>
<span class="normal">3225</span>
<span class="normal">3226</span>
<span class="normal">3227</span>
<span class="normal">3228</span>
<span class="normal">3229</span>
<span class="normal">3230</span>
<span class="normal">3231</span>
<span class="normal">3232</span>
<span class="normal">3233</span>
<span class="normal">3234</span>
<span class="normal">3235</span>
<span class="normal">3236</span>
<span class="normal">3237</span>
<span class="normal">3238</span>
<span class="normal">3239</span>
<span class="normal">3240</span>
<span class="normal">3241</span>
<span class="normal">3242</span>
<span class="normal">3243</span>
<span class="normal">3244</span>
<span class="normal">3245</span>
<span class="normal">3246</span>
<span class="normal">3247</span>
<span class="normal">3248</span>
<span class="normal">3249</span>
<span class="normal">3250</span>
<span class="normal">3251</span>
<span class="normal">3252</span>
<span class="normal">3253</span>
<span class="normal">3254</span>
<span class="normal">3255</span>
<span class="normal">3256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ``mu`` and ``rho`` for the wrapped Cauchy distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to ``data``.</span>
<span class="sd">    method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">        Estimation strategy. ``&quot;moments&quot;`` (alias: &quot;analytical&quot;) returns the</span>
<span class="sd">        closed-form estimates based on the first trigonometric moment.</span>
<span class="sd">        ``&quot;mle&quot;`` (alias: &quot;numerical&quot;) maximises the weighted log-likelihood.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a diagnostic dictionary.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">        ``method=&quot;mle&quot;``.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">rho_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">rho_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho_param</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">),</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">rho_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">),</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>

        <span class="n">inv_denom</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">g_mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv_denom</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
        <span class="n">g_rho</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">w_sum</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_param</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">inv_denom</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho_param</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_rho</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
    <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="n">rho_mom</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">))),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">)]</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">rho_mom</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-3</span><span class="p">))],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wrapcauchy.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.vonmises_gen" class="doc doc-heading">
            <code>vonmises_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Von Mises Distribution</p>
<p><img alt="vonmises" src="../../images/circ-mod-vonmises.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, kappa, *args, **kwargs) (pycircstat2.distributions.vonmises_gen.pdf)" href="#pycircstat2.distributions.vonmises_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, kappa, *args, **kwargs) (pycircstat2.distributions.vonmises_gen.cdf)" href="#pycircstat2.distributions.vonmises_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, mu, kappa, *args, **kwargs) (pycircstat2.distributions.vonmises_gen.ppf)" href="#pycircstat2.distributions.vonmises_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse of CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(size=None, random_state=None, *args, **kwargs) (pycircstat2.distributions.vonmises_gen.rvs)" href="#pycircstat2.distributions.vonmises_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', return_info=False, optimizer='L-BFGS-B', **kwargs) (pycircstat2.distributions.vonmises_gen.fit)" href="#pycircstat2.distributions.vonmises_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Fit the distribution to the data and return the parameters (mu, kappa).</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <pre><code>from pycircstat2.distributions import vonmises
</code></pre>


<details class="references" open>
  <summary>References</summary>
  <ul>
<li>Section 4.3.8 of Pewsey et al. (2014)</li>
</ul>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3262</span>
<span class="normal">3263</span>
<span class="normal">3264</span>
<span class="normal">3265</span>
<span class="normal">3266</span>
<span class="normal">3267</span>
<span class="normal">3268</span>
<span class="normal">3269</span>
<span class="normal">3270</span>
<span class="normal">3271</span>
<span class="normal">3272</span>
<span class="normal">3273</span>
<span class="normal">3274</span>
<span class="normal">3275</span>
<span class="normal">3276</span>
<span class="normal">3277</span>
<span class="normal">3278</span>
<span class="normal">3279</span>
<span class="normal">3280</span>
<span class="normal">3281</span>
<span class="normal">3282</span>
<span class="normal">3283</span>
<span class="normal">3284</span>
<span class="normal">3285</span>
<span class="normal">3286</span>
<span class="normal">3287</span>
<span class="normal">3288</span>
<span class="normal">3289</span>
<span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span>
<span class="normal">3304</span>
<span class="normal">3305</span>
<span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span>
<span class="normal">3427</span>
<span class="normal">3428</span>
<span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span>
<span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span>
<span class="normal">3532</span>
<span class="normal">3533</span>
<span class="normal">3534</span>
<span class="normal">3535</span>
<span class="normal">3536</span>
<span class="normal">3537</span>
<span class="normal">3538</span>
<span class="normal">3539</span>
<span class="normal">3540</span>
<span class="normal">3541</span>
<span class="normal">3542</span>
<span class="normal">3543</span>
<span class="normal">3544</span>
<span class="normal">3545</span>
<span class="normal">3546</span>
<span class="normal">3547</span>
<span class="normal">3548</span>
<span class="normal">3549</span>
<span class="normal">3550</span>
<span class="normal">3551</span>
<span class="normal">3552</span>
<span class="normal">3553</span>
<span class="normal">3554</span>
<span class="normal">3555</span>
<span class="normal">3556</span>
<span class="normal">3557</span>
<span class="normal">3558</span>
<span class="normal">3559</span>
<span class="normal">3560</span>
<span class="normal">3561</span>
<span class="normal">3562</span>
<span class="normal">3563</span>
<span class="normal">3564</span>
<span class="normal">3565</span>
<span class="normal">3566</span>
<span class="normal">3567</span>
<span class="normal">3568</span>
<span class="normal">3569</span>
<span class="normal">3570</span>
<span class="normal">3571</span>
<span class="normal">3572</span>
<span class="normal">3573</span>
<span class="normal">3574</span>
<span class="normal">3575</span>
<span class="normal">3576</span>
<span class="normal">3577</span>
<span class="normal">3578</span>
<span class="normal">3579</span>
<span class="normal">3580</span>
<span class="normal">3581</span>
<span class="normal">3582</span>
<span class="normal">3583</span>
<span class="normal">3584</span>
<span class="normal">3585</span>
<span class="normal">3586</span>
<span class="normal">3587</span>
<span class="normal">3588</span>
<span class="normal">3589</span>
<span class="normal">3590</span>
<span class="normal">3591</span>
<span class="normal">3592</span>
<span class="normal">3593</span>
<span class="normal">3594</span>
<span class="normal">3595</span>
<span class="normal">3596</span>
<span class="normal">3597</span>
<span class="normal">3598</span>
<span class="normal">3599</span>
<span class="normal">3600</span>
<span class="normal">3601</span>
<span class="normal">3602</span>
<span class="normal">3603</span>
<span class="normal">3604</span>
<span class="normal">3605</span>
<span class="normal">3606</span>
<span class="normal">3607</span>
<span class="normal">3608</span>
<span class="normal">3609</span>
<span class="normal">3610</span>
<span class="normal">3611</span>
<span class="normal">3612</span>
<span class="normal">3613</span>
<span class="normal">3614</span>
<span class="normal">3615</span>
<span class="normal">3616</span>
<span class="normal">3617</span>
<span class="normal">3618</span>
<span class="normal">3619</span>
<span class="normal">3620</span>
<span class="normal">3621</span>
<span class="normal">3622</span>
<span class="normal">3623</span>
<span class="normal">3624</span>
<span class="normal">3625</span>
<span class="normal">3626</span>
<span class="normal">3627</span>
<span class="normal">3628</span>
<span class="normal">3629</span>
<span class="normal">3630</span>
<span class="normal">3631</span>
<span class="normal">3632</span>
<span class="normal">3633</span>
<span class="normal">3634</span>
<span class="normal">3635</span>
<span class="normal">3636</span>
<span class="normal">3637</span>
<span class="normal">3638</span>
<span class="normal">3639</span>
<span class="normal">3640</span>
<span class="normal">3641</span>
<span class="normal">3642</span>
<span class="normal">3643</span>
<span class="normal">3644</span>
<span class="normal">3645</span>
<span class="normal">3646</span>
<span class="normal">3647</span>
<span class="normal">3648</span>
<span class="normal">3649</span>
<span class="normal">3650</span>
<span class="normal">3651</span>
<span class="normal">3652</span>
<span class="normal">3653</span>
<span class="normal">3654</span>
<span class="normal">3655</span>
<span class="normal">3656</span>
<span class="normal">3657</span>
<span class="normal">3658</span>
<span class="normal">3659</span>
<span class="normal">3660</span>
<span class="normal">3661</span>
<span class="normal">3662</span>
<span class="normal">3663</span>
<span class="normal">3664</span>
<span class="normal">3665</span>
<span class="normal">3666</span>
<span class="normal">3667</span>
<span class="normal">3668</span>
<span class="normal">3669</span>
<span class="normal">3670</span>
<span class="normal">3671</span>
<span class="normal">3672</span>
<span class="normal">3673</span>
<span class="normal">3674</span>
<span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span>
<span class="normal">3681</span>
<span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span>
<span class="normal">3688</span>
<span class="normal">3689</span>
<span class="normal">3690</span>
<span class="normal">3691</span>
<span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span>
<span class="normal">3702</span>
<span class="normal">3703</span>
<span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span>
<span class="normal">3714</span>
<span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span>
<span class="normal">3720</span>
<span class="normal">3721</span>
<span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span>
<span class="normal">3726</span>
<span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span>
<span class="normal">3740</span>
<span class="normal">3741</span>
<span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span>
<span class="normal">3751</span>
<span class="normal">3752</span>
<span class="normal">3753</span>
<span class="normal">3754</span>
<span class="normal">3755</span>
<span class="normal">3756</span>
<span class="normal">3757</span>
<span class="normal">3758</span>
<span class="normal">3759</span>
<span class="normal">3760</span>
<span class="normal">3761</span>
<span class="normal">3762</span>
<span class="normal">3763</span>
<span class="normal">3764</span>
<span class="normal">3765</span>
<span class="normal">3766</span>
<span class="normal">3767</span>
<span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span>
<span class="normal">3851</span>
<span class="normal">3852</span>
<span class="normal">3853</span>
<span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span>
<span class="normal">3869</span>
<span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span>
<span class="normal">3876</span>
<span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span>
<span class="normal">3880</span>
<span class="normal">3881</span>
<span class="normal">3882</span>
<span class="normal">3883</span>
<span class="normal">3884</span>
<span class="normal">3885</span>
<span class="normal">3886</span>
<span class="normal">3887</span>
<span class="normal">3888</span>
<span class="normal">3889</span>
<span class="normal">3890</span>
<span class="normal">3891</span>
<span class="normal">3892</span>
<span class="normal">3893</span>
<span class="normal">3894</span>
<span class="normal">3895</span>
<span class="normal">3896</span>
<span class="normal">3897</span>
<span class="normal">3898</span>
<span class="normal">3899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">vonmises_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Von Mises Distribution</span>

<span class="sd">    ![vonmises](../images/circ-mod-vonmises.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, kappa)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, kappa)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, mu, kappa)</span>
<span class="sd">        Percent-point function (inverse of CDF).</span>

<span class="sd">    rvs(mu, kappa, size=None, random_state=None)</span>
<span class="sd">        Random variates.</span>

<span class="sd">    fit(data, *args, **kwargs)</span>
<span class="sd">        Fit the distribution to the data and return the parameters (mu, kappa).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ```</span>
<span class="sd">    from pycircstat2.distributions import vonmises</span>
<span class="sd">    ```</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    - Section 4.3.8 of Pewsey et al. (2014)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_freeze_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Freeze the distribution with specific parameters.</span>

<span class="s2">    Parameters</span>
<span class="s2">    ----------</span>
<span class="s2">    mu : float</span>
<span class="s2">        The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="s2">    kappa : float</span>
<span class="s2">        The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="s2">    Returns</span>
<span class="s2">    -------</span>
<span class="s2">    rv_frozen : rv_frozen instance</span>
<span class="s2">        The frozen distribution instance with fixed parameters.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeze</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="fm">__call__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">_freeze_doc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">kappa_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Von Mises distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{e^{\kappa \cos(\theta - \mu)}}{2\pi I_0(\kappa)}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">        kappa : float</span>
<span class="sd">            The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logarithm of the probability density function of the Von Mises</span>
<span class="sd">        distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the logarithm of the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">        kappa : float</span>
<span class="sd">            The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        logpdf_values : array_like</span>
<span class="sd">            Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kappa_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">mu_arr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vonmises parameters must be broadcastable scalars.&quot;</span><span class="p">)</span>

        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kappa_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vonmises parameters must be broadcastable scalars.&quot;</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="n">uniform</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="n">two_pi</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">uniform</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">uniform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">denom</span> <span class="o">=</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="ow">or</span> <span class="n">denom</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_from_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">base_phi</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">term_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">term_base</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">max_terms</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_terms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">iv</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">denom</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">coeff</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">term</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
            <span class="n">term_sum</span> <span class="o">+=</span> <span class="n">term</span>
            <span class="n">term_base</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">base_phi</span><span class="p">)</span>

            <span class="n">max_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">term</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">max_term</span> <span class="o">&lt;</span> <span class="n">tol</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">converged</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_from_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

        <span class="n">cdf_raw</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">term_sum</span>
        <span class="n">base_val</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">base_phi</span> <span class="o">/</span> <span class="n">two_pi</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">term_base</span>

        <span class="n">forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf_raw</span> <span class="o">-</span> <span class="n">base_val</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">backward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">base_val</span> <span class="o">-</span> <span class="n">cdf_raw</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">phi</span> <span class="o">&gt;=</span> <span class="n">base_phi</span><span class="p">,</span> <span class="n">forward</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">backward</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Von Mises distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \frac{1}{2 \pi I_0(\kappa)}\int_{0}^{\theta} e^{\kappa \cos(\theta - \mu)} dx</span>
<span class="sd">        $$</span>

<span class="sd">        The CDF is evaluated via its Fourier-Bessel series expansion,</span>
<span class="sd">        $$</span>
<span class="sd">        F(\theta) = \frac{1}{2} + \frac{\theta - \mu}{2\pi}</span>
<span class="sd">        + \frac{1}{\pi}\sum_{n=1}^{\infty} \frac{I_n(\kappa)}{I_0(\kappa)\,n}</span>
<span class="sd">        \sin\bigl(n(\theta - \mu)\bigr),</span>
<span class="sd">        $$</span>
<span class="sd">        truncated adaptively for numerical stability and re-normalised to the</span>
<span class="sd">        $[0, 2\pi)$ support.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">        kappa : float</span>
<span class="sd">            The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kappa_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`kappa` must be non-negative.&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">lower_mask</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
        <span class="n">upper_mask</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">lower_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">result</span><span class="p">[</span><span class="n">upper_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">interior</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">lower_mask</span> <span class="o">|</span> <span class="n">upper_mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">q_int</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_int</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-15</span>
        <span class="n">q_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q_int</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">q_clipped</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="k">elif</span> <span class="n">kappa_val</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="n">normal_guess</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">ndtri</span><span class="p">(</span><span class="n">q_clipped</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span>
            <span class="n">normal_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">normal_guess</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="n">blend</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="mf">20.0</span> <span class="k">else</span> <span class="mf">0.8</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">blend</span> <span class="o">*</span> <span class="n">normal_guess</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">blend</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">)</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

        <span class="n">tol_cdf</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">tol_theta</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_curr</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">))</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_clipped</span>

            <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

            <span class="n">converged</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_theta</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&gt;</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">-</span> <span class="n">step</span>
            <span class="n">midpoint</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">theta_next</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">theta_next</span> <span class="o">&gt;=</span> <span class="n">H</span><span class="p">),</span> <span class="n">midpoint</span><span class="p">,</span> <span class="n">theta_next</span><span class="p">)</span>
            <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta_next</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
            <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">theta_next</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">-</span> <span class="n">q_clipped</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_theta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="n">theta_b</span> <span class="o">=</span> <span class="n">theta_curr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">L_b</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">H_b</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">)</span>
                <span class="n">mid_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">delta_mid</span> <span class="o">=</span> <span class="n">mid_vals</span> <span class="o">-</span> <span class="n">q_clipped</span>
                <span class="n">take_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mid</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                <span class="n">take_lower</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">take_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                <span class="n">H_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_upper</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">H_b</span><span class="p">)</span>
                <span class="n">L_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_lower</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">L_b</span><span class="p">)</span>
                <span class="n">theta_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">theta_b</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span>
            <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">),</span> <span class="n">theta_b</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (inverse of the CDF) of the Von Mises distribution.</span>

<span class="sd">        The quantile is obtained by inverting the analytic Fourier–Bessel series</span>
<span class="sd">        using a safeguarded Newton iteration with the exact von Mises PDF as the</span>
<span class="sd">        slope, followed by a bisection polish.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate.</span>
<span class="sd">        mu : float</span>
<span class="sd">            The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">        kappa : float</span>
<span class="sd">            The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Values at the given quantiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kappa_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mu_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mu_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">mu_arr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vonmises parameters must be broadcastable scalars.&quot;</span><span class="p">)</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kappa_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vonmises parameters must be broadcastable scalars.&quot;</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">kappa_val</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">kappa_val</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">target_shape</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">size</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">u1</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u1</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">kappa_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">u2</span> <span class="o">&lt;</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="ow">or</span> <span class="n">u2</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">c</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="n">u3</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">u3</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target_shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">target_shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int or tuple, optional</span>
<span class="sd">            Number of samples to generate.</span>
<span class="sd">        random_state : RandomState, optional</span>
<span class="sd">            Random number generator instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        samples : ndarray</span>
<span class="sd">            Random variates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if instance-level parameters are set</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Override instance parameters if provided in args/kwargs</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

        <span class="c1"># Ensure required parameters are provided</span>
        <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;kappa&#39; must be provided.&quot;</span><span class="p">)</span>

        <span class="c1"># Call the private _rvs method</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular mean of the Von Mises distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mean : float</span>
<span class="sd">            The circular mean direction (in radians), equal to `mu`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mu</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular median of the Von Mises distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        median : float</span>
<span class="sd">            The circular median direction (in radians), equal to `mu`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular variance of the Von Mises distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        variance : float</span>
<span class="sd">            The circular variance, derived from `kappa`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular standard deviation of the Von Mises distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        std : float</span>
<span class="sd">            The circular standard deviation, derived from `kappa`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Entropy of the Von Mises distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        entropy : float</span>
<span class="sd">            The entropy of the distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_nnlf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom negative log-likelihood function for the Von Mises distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>  <span class="c1"># Validate parameter range</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="c1"># Compute log-likelihood robustly</span>
        <span class="n">log_likelihood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

        <span class="c1"># Negative log-likelihood</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate ``mu`` and ``kappa`` for the von Mises distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to ``data``.</span>
<span class="sd">        method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">            Estimation strategy. ``&quot;moments&quot;`` (alias ``&quot;analytical&quot;``) returns</span>
<span class="sd">            the circular mean together with the standard approximation for</span>
<span class="sd">            ``kappa``. ``&quot;mle&quot;`` (alias ``&quot;numerical&quot;``) maximises the weighted</span>
<span class="sd">            log-likelihood using a bounded optimiser.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">            ``method=&quot;mle&quot;``.</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">r_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_mom</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
        <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r_mom</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
        <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_param</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">sum_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
            <span class="n">log_i0_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>
                <span class="o">-</span><span class="n">kappa_param</span> <span class="o">*</span> <span class="n">sum_cos</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_i0_val</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
            <span class="n">sum_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
            <span class="n">sum_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">)</span>
            <span class="n">g_mu</span> <span class="o">=</span> <span class="n">kappa_param</span> <span class="o">*</span> <span class="n">sum_sin</span>
            <span class="n">g_kappa</span> <span class="o">=</span> <span class="o">-</span><span class="n">sum_cos</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">ratio</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_kappa</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
            <span class="n">kappa_hat</span> <span class="o">=</span> <span class="n">kappa_mom</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">))),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)]</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;vonmises.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Von Mises distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{e^{\kappa \cos(\theta - \mu)}}{2\pi I_0(\kappa)}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The concentration parameter of the distribution (kappa &gt; 0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Von Mises distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{e^{\kappa \cos(\theta - \mu)}}{2\pi I_0(\kappa)}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">    kappa : float</span>
<span class="sd">        The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.logpdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Logarithm of the probability density function of the Von Mises
distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the logarithm of the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The concentration parameter of the distribution (kappa &gt; 0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>logpdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logarithm of the probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logarithm of the probability density function of the Von Mises</span>
<span class="sd">    distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the logarithm of the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">    kappa : float</span>
<span class="sd">        The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    logpdf_values : array_like</span>
<span class="sd">        Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Von Mises distribution.</p>
<div class="arithmatex">\[
F(\theta) = \frac{1}{2 \pi I_0(\kappa)}\int_{0}^{\theta} e^{\kappa \cos(\theta - \mu)} dx
\]</div>
<p>The CDF is evaluated via its Fourier-Bessel series expansion,
$$
F(\theta) = \frac{1}{2} + \frac{\theta - \mu}{2\pi}
+ \frac{1}{\pi}\sum_{n=1}^{\infty} \frac{I_n(\kappa)}{I_0(\kappa)\,n}
\sin\bigl(n(\theta - \mu)\bigr),
$$
truncated adaptively for numerical stability and re-normalised to the
<span class="arithmatex">\([0, 2\pi)\)</span> support.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The concentration parameter of the distribution (kappa &gt; 0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span>
<span class="normal">3467</span>
<span class="normal">3468</span>
<span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Von Mises distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \frac{1}{2 \pi I_0(\kappa)}\int_{0}^{\theta} e^{\kappa \cos(\theta - \mu)} dx</span>
<span class="sd">    $$</span>

<span class="sd">    The CDF is evaluated via its Fourier-Bessel series expansion,</span>
<span class="sd">    $$</span>
<span class="sd">    F(\theta) = \frac{1}{2} + \frac{\theta - \mu}{2\pi}</span>
<span class="sd">    + \frac{1}{\pi}\sum_{n=1}^{\infty} \frac{I_n(\kappa)}{I_0(\kappa)\,n}</span>
<span class="sd">    \sin\bigl(n(\theta - \mu)\bigr),</span>
<span class="sd">    $$</span>
<span class="sd">    truncated adaptively for numerical stability and re-normalised to the</span>
<span class="sd">    $[0, 2\pi)$ support.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">    kappa : float</span>
<span class="sd">        The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (inverse of the CDF) of the Von Mises distribution.</p>
<p>The quantile is obtained by inverting the analytic Fourier–Bessel series
using a safeguarded Newton iteration with the exact von Mises PDF as the
slope, followed by a bisection polish.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The concentration parameter of the distribution (kappa &gt; 0).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values at the given quantiles.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3583</span>
<span class="normal">3584</span>
<span class="normal">3585</span>
<span class="normal">3586</span>
<span class="normal">3587</span>
<span class="normal">3588</span>
<span class="normal">3589</span>
<span class="normal">3590</span>
<span class="normal">3591</span>
<span class="normal">3592</span>
<span class="normal">3593</span>
<span class="normal">3594</span>
<span class="normal">3595</span>
<span class="normal">3596</span>
<span class="normal">3597</span>
<span class="normal">3598</span>
<span class="normal">3599</span>
<span class="normal">3600</span>
<span class="normal">3601</span>
<span class="normal">3602</span>
<span class="normal">3603</span>
<span class="normal">3604</span>
<span class="normal">3605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (inverse of the CDF) of the Von Mises distribution.</span>

<span class="sd">    The quantile is obtained by inverting the analytic Fourier–Bessel series</span>
<span class="sd">    using a safeguarded Newton iteration with the exact von Mises PDF as the</span>
<span class="sd">    slope, followed by a bisection polish.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate.</span>
<span class="sd">    mu : float</span>
<span class="sd">        The mean direction of the distribution (0 &lt;= mu &lt;= 2*pi).</span>
<span class="sd">    kappa : float</span>
<span class="sd">        The concentration parameter of the distribution (kappa &gt; 0).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Values at the given quantiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to generate.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="RandomState">RandomState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator instance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>samples</code></td>            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3658</span>
<span class="normal">3659</span>
<span class="normal">3660</span>
<span class="normal">3661</span>
<span class="normal">3662</span>
<span class="normal">3663</span>
<span class="normal">3664</span>
<span class="normal">3665</span>
<span class="normal">3666</span>
<span class="normal">3667</span>
<span class="normal">3668</span>
<span class="normal">3669</span>
<span class="normal">3670</span>
<span class="normal">3671</span>
<span class="normal">3672</span>
<span class="normal">3673</span>
<span class="normal">3674</span>
<span class="normal">3675</span>
<span class="normal">3676</span>
<span class="normal">3677</span>
<span class="normal">3678</span>
<span class="normal">3679</span>
<span class="normal">3680</span>
<span class="normal">3681</span>
<span class="normal">3682</span>
<span class="normal">3683</span>
<span class="normal">3684</span>
<span class="normal">3685</span>
<span class="normal">3686</span>
<span class="normal">3687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : int or tuple, optional</span>
<span class="sd">        Number of samples to generate.</span>
<span class="sd">    random_state : RandomState, optional</span>
<span class="sd">        Random number generator instance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    samples : ndarray</span>
<span class="sd">        Random variates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if instance-level parameters are set</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Override instance parameters if provided in args/kwargs</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

    <span class="c1"># Ensure required parameters are provided</span>
    <span class="k">if</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">kappa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both &#39;mu&#39; and &#39;kappa&#39; must be provided.&quot;</span><span class="p">)</span>

    <span class="c1"># Call the private _rvs method</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular mean of the Von Mises distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>mean</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The circular mean direction (in radians), equal to <code>mu</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3692</span>
<span class="normal">3693</span>
<span class="normal">3694</span>
<span class="normal">3695</span>
<span class="normal">3696</span>
<span class="normal">3697</span>
<span class="normal">3698</span>
<span class="normal">3699</span>
<span class="normal">3700</span>
<span class="normal">3701</span>
<span class="normal">3702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular mean of the Von Mises distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mean : float</span>
<span class="sd">        The circular mean direction (in radians), equal to `mu`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mu</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.median" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">median</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular median of the Von Mises distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>median</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The circular median direction (in radians), equal to <code>mu</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3704</span>
<span class="normal">3705</span>
<span class="normal">3706</span>
<span class="normal">3707</span>
<span class="normal">3708</span>
<span class="normal">3709</span>
<span class="normal">3710</span>
<span class="normal">3711</span>
<span class="normal">3712</span>
<span class="normal">3713</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular median of the Von Mises distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    median : float</span>
<span class="sd">        The circular median direction (in radians), equal to `mu`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.var" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">var</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular variance of the Von Mises distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>variance</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The circular variance, derived from <code>kappa</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3715</span>
<span class="normal">3716</span>
<span class="normal">3717</span>
<span class="normal">3718</span>
<span class="normal">3719</span>
<span class="normal">3720</span>
<span class="normal">3721</span>
<span class="normal">3722</span>
<span class="normal">3723</span>
<span class="normal">3724</span>
<span class="normal">3725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular variance of the Von Mises distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    variance : float</span>
<span class="sd">        The circular variance, derived from `kappa`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.std" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">std</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Circular standard deviation of the Von Mises distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>std</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The circular standard deviation, derived from <code>kappa</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3727</span>
<span class="normal">3728</span>
<span class="normal">3729</span>
<span class="normal">3730</span>
<span class="normal">3731</span>
<span class="normal">3732</span>
<span class="normal">3733</span>
<span class="normal">3734</span>
<span class="normal">3735</span>
<span class="normal">3736</span>
<span class="normal">3737</span>
<span class="normal">3738</span>
<span class="normal">3739</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular standard deviation of the Von Mises distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    std : float</span>
<span class="sd">        The circular standard deviation, derived from `kappa`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.entropy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">entropy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Entropy of the Von Mises distribution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>entropy</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The entropy of the distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3741</span>
<span class="normal">3742</span>
<span class="normal">3743</span>
<span class="normal">3744</span>
<span class="normal">3745</span>
<span class="normal">3746</span>
<span class="normal">3747</span>
<span class="normal">3748</span>
<span class="normal">3749</span>
<span class="normal">3750</span>
<span class="normal">3751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entropy of the Von Mises distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entropy : float</span>
<span class="sd">        The entropy of the distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>mu</code> and <code>kappa</code> for the von Mises distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians). Values are wrapped to <code>[0, 2π)</code> internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="moments">moments</span>, <span title="mle">mle</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation strategy. <code>"moments"</code> (alias <code>"analytical"</code>) returns
the circular mean together with the standard approximation for
<code>kappa</code>. <code>"mle"</code> (alias <code>"numerical"</code>) maximises the weighted
log-likelihood using a bounded optimiser.</p>
              </div>
            </td>
            <td>
                  <code>&#34;moments&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return a diagnostics dictionary alongside the estimates.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser passed to <code>scipy.optimize.minimize</code> when
<code>method="mle"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3768</span>
<span class="normal">3769</span>
<span class="normal">3770</span>
<span class="normal">3771</span>
<span class="normal">3772</span>
<span class="normal">3773</span>
<span class="normal">3774</span>
<span class="normal">3775</span>
<span class="normal">3776</span>
<span class="normal">3777</span>
<span class="normal">3778</span>
<span class="normal">3779</span>
<span class="normal">3780</span>
<span class="normal">3781</span>
<span class="normal">3782</span>
<span class="normal">3783</span>
<span class="normal">3784</span>
<span class="normal">3785</span>
<span class="normal">3786</span>
<span class="normal">3787</span>
<span class="normal">3788</span>
<span class="normal">3789</span>
<span class="normal">3790</span>
<span class="normal">3791</span>
<span class="normal">3792</span>
<span class="normal">3793</span>
<span class="normal">3794</span>
<span class="normal">3795</span>
<span class="normal">3796</span>
<span class="normal">3797</span>
<span class="normal">3798</span>
<span class="normal">3799</span>
<span class="normal">3800</span>
<span class="normal">3801</span>
<span class="normal">3802</span>
<span class="normal">3803</span>
<span class="normal">3804</span>
<span class="normal">3805</span>
<span class="normal">3806</span>
<span class="normal">3807</span>
<span class="normal">3808</span>
<span class="normal">3809</span>
<span class="normal">3810</span>
<span class="normal">3811</span>
<span class="normal">3812</span>
<span class="normal">3813</span>
<span class="normal">3814</span>
<span class="normal">3815</span>
<span class="normal">3816</span>
<span class="normal">3817</span>
<span class="normal">3818</span>
<span class="normal">3819</span>
<span class="normal">3820</span>
<span class="normal">3821</span>
<span class="normal">3822</span>
<span class="normal">3823</span>
<span class="normal">3824</span>
<span class="normal">3825</span>
<span class="normal">3826</span>
<span class="normal">3827</span>
<span class="normal">3828</span>
<span class="normal">3829</span>
<span class="normal">3830</span>
<span class="normal">3831</span>
<span class="normal">3832</span>
<span class="normal">3833</span>
<span class="normal">3834</span>
<span class="normal">3835</span>
<span class="normal">3836</span>
<span class="normal">3837</span>
<span class="normal">3838</span>
<span class="normal">3839</span>
<span class="normal">3840</span>
<span class="normal">3841</span>
<span class="normal">3842</span>
<span class="normal">3843</span>
<span class="normal">3844</span>
<span class="normal">3845</span>
<span class="normal">3846</span>
<span class="normal">3847</span>
<span class="normal">3848</span>
<span class="normal">3849</span>
<span class="normal">3850</span>
<span class="normal">3851</span>
<span class="normal">3852</span>
<span class="normal">3853</span>
<span class="normal">3854</span>
<span class="normal">3855</span>
<span class="normal">3856</span>
<span class="normal">3857</span>
<span class="normal">3858</span>
<span class="normal">3859</span>
<span class="normal">3860</span>
<span class="normal">3861</span>
<span class="normal">3862</span>
<span class="normal">3863</span>
<span class="normal">3864</span>
<span class="normal">3865</span>
<span class="normal">3866</span>
<span class="normal">3867</span>
<span class="normal">3868</span>
<span class="normal">3869</span>
<span class="normal">3870</span>
<span class="normal">3871</span>
<span class="normal">3872</span>
<span class="normal">3873</span>
<span class="normal">3874</span>
<span class="normal">3875</span>
<span class="normal">3876</span>
<span class="normal">3877</span>
<span class="normal">3878</span>
<span class="normal">3879</span>
<span class="normal">3880</span>
<span class="normal">3881</span>
<span class="normal">3882</span>
<span class="normal">3883</span>
<span class="normal">3884</span>
<span class="normal">3885</span>
<span class="normal">3886</span>
<span class="normal">3887</span>
<span class="normal">3888</span>
<span class="normal">3889</span>
<span class="normal">3890</span>
<span class="normal">3891</span>
<span class="normal">3892</span>
<span class="normal">3893</span>
<span class="normal">3894</span>
<span class="normal">3895</span>
<span class="normal">3896</span>
<span class="normal">3897</span>
<span class="normal">3898</span>
<span class="normal">3899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate ``mu`` and ``kappa`` for the von Mises distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians). Values are wrapped to ``[0, 2π)`` internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to ``data``.</span>
<span class="sd">    method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">        Estimation strategy. ``&quot;moments&quot;`` (alias ``&quot;analytical&quot;``) returns</span>
<span class="sd">        the circular mean together with the standard approximation for</span>
<span class="sd">        ``kappa``. ``&quot;mle&quot;`` (alias ``&quot;numerical&quot;``) maximises the weighted</span>
<span class="sd">        log-likelihood using a bounded optimiser.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Optimiser passed to ``scipy.optimize.minimize`` when</span>
<span class="sd">        ``method=&quot;mle&quot;``.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to the optimiser.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r_mom</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">r_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_mom</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
    <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
    <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r_mom</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
    <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;algorithm&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;algorithm&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;moments&#39;, &#39;mle&#39;, &#39;analytical&#39;, &#39;numerical&#39;}.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_param</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">sum_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
        <span class="n">log_i0_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>
            <span class="o">-</span><span class="n">kappa_param</span> <span class="o">*</span> <span class="n">sum_cos</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_i0_val</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">cos_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">sin_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu_param</span><span class="p">)</span>
        <span class="n">sum_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin_term</span><span class="p">)</span>
        <span class="n">sum_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">cos_term</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">i1</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">)</span> <span class="o">/</span> <span class="n">i0</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">)</span>
        <span class="n">g_mu</span> <span class="o">=</span> <span class="n">kappa_param</span> <span class="o">*</span> <span class="n">sum_sin</span>
        <span class="n">g_kappa</span> <span class="o">=</span> <span class="o">-</span><span class="n">sum_cos</span> <span class="o">+</span> <span class="n">w_sum</span> <span class="o">*</span> <span class="n">ratio</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">g_mu</span><span class="p">,</span> <span class="n">g_kappa</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">)</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="n">kappa_mom</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">((</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">))),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)]</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">jac</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;vonmises.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;grad_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;jac&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.vonmises_flattopped_gen" class="doc doc-heading">
            <code>vonmises_flattopped_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Flat-topped von Mises Distribution</p>
<p>The Flat-topped von Mises distribution is a modification of the von Mises distribution
that allows for more flexible peak shapes, including flattened or sharper tops, depending
on the value of the shape parameter <span class="arithmatex">\(\nu\)</span>.</p>
<p><img alt="vonmises-ext" src="../../images/circ-mod-vonmises-flat-topped.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, kappa, nu, *args, **kwargs) (pycircstat2.distributions.vonmises_flattopped_gen.pdf)" href="#pycircstat2.distributions.vonmises_flattopped_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, kappa, nu, *args, **kwargs) (pycircstat2.distributions.vonmises_flattopped_gen.cdf)" href="#pycircstat2.distributions.vonmises_flattopped_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Parameters must be scalar; cached normalization tables are built per parameter set.
Implementation based on Section 4.3.10 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3905</span>
<span class="normal">3906</span>
<span class="normal">3907</span>
<span class="normal">3908</span>
<span class="normal">3909</span>
<span class="normal">3910</span>
<span class="normal">3911</span>
<span class="normal">3912</span>
<span class="normal">3913</span>
<span class="normal">3914</span>
<span class="normal">3915</span>
<span class="normal">3916</span>
<span class="normal">3917</span>
<span class="normal">3918</span>
<span class="normal">3919</span>
<span class="normal">3920</span>
<span class="normal">3921</span>
<span class="normal">3922</span>
<span class="normal">3923</span>
<span class="normal">3924</span>
<span class="normal">3925</span>
<span class="normal">3926</span>
<span class="normal">3927</span>
<span class="normal">3928</span>
<span class="normal">3929</span>
<span class="normal">3930</span>
<span class="normal">3931</span>
<span class="normal">3932</span>
<span class="normal">3933</span>
<span class="normal">3934</span>
<span class="normal">3935</span>
<span class="normal">3936</span>
<span class="normal">3937</span>
<span class="normal">3938</span>
<span class="normal">3939</span>
<span class="normal">3940</span>
<span class="normal">3941</span>
<span class="normal">3942</span>
<span class="normal">3943</span>
<span class="normal">3944</span>
<span class="normal">3945</span>
<span class="normal">3946</span>
<span class="normal">3947</span>
<span class="normal">3948</span>
<span class="normal">3949</span>
<span class="normal">3950</span>
<span class="normal">3951</span>
<span class="normal">3952</span>
<span class="normal">3953</span>
<span class="normal">3954</span>
<span class="normal">3955</span>
<span class="normal">3956</span>
<span class="normal">3957</span>
<span class="normal">3958</span>
<span class="normal">3959</span>
<span class="normal">3960</span>
<span class="normal">3961</span>
<span class="normal">3962</span>
<span class="normal">3963</span>
<span class="normal">3964</span>
<span class="normal">3965</span>
<span class="normal">3966</span>
<span class="normal">3967</span>
<span class="normal">3968</span>
<span class="normal">3969</span>
<span class="normal">3970</span>
<span class="normal">3971</span>
<span class="normal">3972</span>
<span class="normal">3973</span>
<span class="normal">3974</span>
<span class="normal">3975</span>
<span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span>
<span class="normal">4021</span>
<span class="normal">4022</span>
<span class="normal">4023</span>
<span class="normal">4024</span>
<span class="normal">4025</span>
<span class="normal">4026</span>
<span class="normal">4027</span>
<span class="normal">4028</span>
<span class="normal">4029</span>
<span class="normal">4030</span>
<span class="normal">4031</span>
<span class="normal">4032</span>
<span class="normal">4033</span>
<span class="normal">4034</span>
<span class="normal">4035</span>
<span class="normal">4036</span>
<span class="normal">4037</span>
<span class="normal">4038</span>
<span class="normal">4039</span>
<span class="normal">4040</span>
<span class="normal">4041</span>
<span class="normal">4042</span>
<span class="normal">4043</span>
<span class="normal">4044</span>
<span class="normal">4045</span>
<span class="normal">4046</span>
<span class="normal">4047</span>
<span class="normal">4048</span>
<span class="normal">4049</span>
<span class="normal">4050</span>
<span class="normal">4051</span>
<span class="normal">4052</span>
<span class="normal">4053</span>
<span class="normal">4054</span>
<span class="normal">4055</span>
<span class="normal">4056</span>
<span class="normal">4057</span>
<span class="normal">4058</span>
<span class="normal">4059</span>
<span class="normal">4060</span>
<span class="normal">4061</span>
<span class="normal">4062</span>
<span class="normal">4063</span>
<span class="normal">4064</span>
<span class="normal">4065</span>
<span class="normal">4066</span>
<span class="normal">4067</span>
<span class="normal">4068</span>
<span class="normal">4069</span>
<span class="normal">4070</span>
<span class="normal">4071</span>
<span class="normal">4072</span>
<span class="normal">4073</span>
<span class="normal">4074</span>
<span class="normal">4075</span>
<span class="normal">4076</span>
<span class="normal">4077</span>
<span class="normal">4078</span>
<span class="normal">4079</span>
<span class="normal">4080</span>
<span class="normal">4081</span>
<span class="normal">4082</span>
<span class="normal">4083</span>
<span class="normal">4084</span>
<span class="normal">4085</span>
<span class="normal">4086</span>
<span class="normal">4087</span>
<span class="normal">4088</span>
<span class="normal">4089</span>
<span class="normal">4090</span>
<span class="normal">4091</span>
<span class="normal">4092</span>
<span class="normal">4093</span>
<span class="normal">4094</span>
<span class="normal">4095</span>
<span class="normal">4096</span>
<span class="normal">4097</span>
<span class="normal">4098</span>
<span class="normal">4099</span>
<span class="normal">4100</span>
<span class="normal">4101</span>
<span class="normal">4102</span>
<span class="normal">4103</span>
<span class="normal">4104</span>
<span class="normal">4105</span>
<span class="normal">4106</span>
<span class="normal">4107</span>
<span class="normal">4108</span>
<span class="normal">4109</span>
<span class="normal">4110</span>
<span class="normal">4111</span>
<span class="normal">4112</span>
<span class="normal">4113</span>
<span class="normal">4114</span>
<span class="normal">4115</span>
<span class="normal">4116</span>
<span class="normal">4117</span>
<span class="normal">4118</span>
<span class="normal">4119</span>
<span class="normal">4120</span>
<span class="normal">4121</span>
<span class="normal">4122</span>
<span class="normal">4123</span>
<span class="normal">4124</span>
<span class="normal">4125</span>
<span class="normal">4126</span>
<span class="normal">4127</span>
<span class="normal">4128</span>
<span class="normal">4129</span>
<span class="normal">4130</span>
<span class="normal">4131</span>
<span class="normal">4132</span>
<span class="normal">4133</span>
<span class="normal">4134</span>
<span class="normal">4135</span>
<span class="normal">4136</span>
<span class="normal">4137</span>
<span class="normal">4138</span>
<span class="normal">4139</span>
<span class="normal">4140</span>
<span class="normal">4141</span>
<span class="normal">4142</span>
<span class="normal">4143</span>
<span class="normal">4144</span>
<span class="normal">4145</span>
<span class="normal">4146</span>
<span class="normal">4147</span>
<span class="normal">4148</span>
<span class="normal">4149</span>
<span class="normal">4150</span>
<span class="normal">4151</span>
<span class="normal">4152</span>
<span class="normal">4153</span>
<span class="normal">4154</span>
<span class="normal">4155</span>
<span class="normal">4156</span>
<span class="normal">4157</span>
<span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span>
<span class="normal">4161</span>
<span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span>
<span class="normal">4169</span>
<span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span>
<span class="normal">4175</span>
<span class="normal">4176</span>
<span class="normal">4177</span>
<span class="normal">4178</span>
<span class="normal">4179</span>
<span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span>
<span class="normal">4183</span>
<span class="normal">4184</span>
<span class="normal">4185</span>
<span class="normal">4186</span>
<span class="normal">4187</span>
<span class="normal">4188</span>
<span class="normal">4189</span>
<span class="normal">4190</span>
<span class="normal">4191</span>
<span class="normal">4192</span>
<span class="normal">4193</span>
<span class="normal">4194</span>
<span class="normal">4195</span>
<span class="normal">4196</span>
<span class="normal">4197</span>
<span class="normal">4198</span>
<span class="normal">4199</span>
<span class="normal">4200</span>
<span class="normal">4201</span>
<span class="normal">4202</span>
<span class="normal">4203</span>
<span class="normal">4204</span>
<span class="normal">4205</span>
<span class="normal">4206</span>
<span class="normal">4207</span>
<span class="normal">4208</span>
<span class="normal">4209</span>
<span class="normal">4210</span>
<span class="normal">4211</span>
<span class="normal">4212</span>
<span class="normal">4213</span>
<span class="normal">4214</span>
<span class="normal">4215</span>
<span class="normal">4216</span>
<span class="normal">4217</span>
<span class="normal">4218</span>
<span class="normal">4219</span>
<span class="normal">4220</span>
<span class="normal">4221</span>
<span class="normal">4222</span>
<span class="normal">4223</span>
<span class="normal">4224</span>
<span class="normal">4225</span>
<span class="normal">4226</span>
<span class="normal">4227</span>
<span class="normal">4228</span>
<span class="normal">4229</span>
<span class="normal">4230</span>
<span class="normal">4231</span>
<span class="normal">4232</span>
<span class="normal">4233</span>
<span class="normal">4234</span>
<span class="normal">4235</span>
<span class="normal">4236</span>
<span class="normal">4237</span>
<span class="normal">4238</span>
<span class="normal">4239</span>
<span class="normal">4240</span>
<span class="normal">4241</span>
<span class="normal">4242</span>
<span class="normal">4243</span>
<span class="normal">4244</span>
<span class="normal">4245</span>
<span class="normal">4246</span>
<span class="normal">4247</span>
<span class="normal">4248</span>
<span class="normal">4249</span>
<span class="normal">4250</span>
<span class="normal">4251</span>
<span class="normal">4252</span>
<span class="normal">4253</span>
<span class="normal">4254</span>
<span class="normal">4255</span>
<span class="normal">4256</span>
<span class="normal">4257</span>
<span class="normal">4258</span>
<span class="normal">4259</span>
<span class="normal">4260</span>
<span class="normal">4261</span>
<span class="normal">4262</span>
<span class="normal">4263</span>
<span class="normal">4264</span>
<span class="normal">4265</span>
<span class="normal">4266</span>
<span class="normal">4267</span>
<span class="normal">4268</span>
<span class="normal">4269</span>
<span class="normal">4270</span>
<span class="normal">4271</span>
<span class="normal">4272</span>
<span class="normal">4273</span>
<span class="normal">4274</span>
<span class="normal">4275</span>
<span class="normal">4276</span>
<span class="normal">4277</span>
<span class="normal">4278</span>
<span class="normal">4279</span>
<span class="normal">4280</span>
<span class="normal">4281</span>
<span class="normal">4282</span>
<span class="normal">4283</span>
<span class="normal">4284</span>
<span class="normal">4285</span>
<span class="normal">4286</span>
<span class="normal">4287</span>
<span class="normal">4288</span>
<span class="normal">4289</span>
<span class="normal">4290</span>
<span class="normal">4291</span>
<span class="normal">4292</span>
<span class="normal">4293</span>
<span class="normal">4294</span>
<span class="normal">4295</span>
<span class="normal">4296</span>
<span class="normal">4297</span>
<span class="normal">4298</span>
<span class="normal">4299</span>
<span class="normal">4300</span>
<span class="normal">4301</span>
<span class="normal">4302</span>
<span class="normal">4303</span>
<span class="normal">4304</span>
<span class="normal">4305</span>
<span class="normal">4306</span>
<span class="normal">4307</span>
<span class="normal">4308</span>
<span class="normal">4309</span>
<span class="normal">4310</span>
<span class="normal">4311</span>
<span class="normal">4312</span>
<span class="normal">4313</span>
<span class="normal">4314</span>
<span class="normal">4315</span>
<span class="normal">4316</span>
<span class="normal">4317</span>
<span class="normal">4318</span>
<span class="normal">4319</span>
<span class="normal">4320</span>
<span class="normal">4321</span>
<span class="normal">4322</span>
<span class="normal">4323</span>
<span class="normal">4324</span>
<span class="normal">4325</span>
<span class="normal">4326</span>
<span class="normal">4327</span>
<span class="normal">4328</span>
<span class="normal">4329</span>
<span class="normal">4330</span>
<span class="normal">4331</span>
<span class="normal">4332</span>
<span class="normal">4333</span>
<span class="normal">4334</span>
<span class="normal">4335</span>
<span class="normal">4336</span>
<span class="normal">4337</span>
<span class="normal">4338</span>
<span class="normal">4339</span>
<span class="normal">4340</span>
<span class="normal">4341</span>
<span class="normal">4342</span>
<span class="normal">4343</span>
<span class="normal">4344</span>
<span class="normal">4345</span>
<span class="normal">4346</span>
<span class="normal">4347</span>
<span class="normal">4348</span>
<span class="normal">4349</span>
<span class="normal">4350</span>
<span class="normal">4351</span>
<span class="normal">4352</span>
<span class="normal">4353</span>
<span class="normal">4354</span>
<span class="normal">4355</span>
<span class="normal">4356</span>
<span class="normal">4357</span>
<span class="normal">4358</span>
<span class="normal">4359</span>
<span class="normal">4360</span>
<span class="normal">4361</span>
<span class="normal">4362</span>
<span class="normal">4363</span>
<span class="normal">4364</span>
<span class="normal">4365</span>
<span class="normal">4366</span>
<span class="normal">4367</span>
<span class="normal">4368</span>
<span class="normal">4369</span>
<span class="normal">4370</span>
<span class="normal">4371</span>
<span class="normal">4372</span>
<span class="normal">4373</span>
<span class="normal">4374</span>
<span class="normal">4375</span>
<span class="normal">4376</span>
<span class="normal">4377</span>
<span class="normal">4378</span>
<span class="normal">4379</span>
<span class="normal">4380</span>
<span class="normal">4381</span>
<span class="normal">4382</span>
<span class="normal">4383</span>
<span class="normal">4384</span>
<span class="normal">4385</span>
<span class="normal">4386</span>
<span class="normal">4387</span>
<span class="normal">4388</span>
<span class="normal">4389</span>
<span class="normal">4390</span>
<span class="normal">4391</span>
<span class="normal">4392</span>
<span class="normal">4393</span>
<span class="normal">4394</span>
<span class="normal">4395</span>
<span class="normal">4396</span>
<span class="normal">4397</span>
<span class="normal">4398</span>
<span class="normal">4399</span>
<span class="normal">4400</span>
<span class="normal">4401</span>
<span class="normal">4402</span>
<span class="normal">4403</span>
<span class="normal">4404</span>
<span class="normal">4405</span>
<span class="normal">4406</span>
<span class="normal">4407</span>
<span class="normal">4408</span>
<span class="normal">4409</span>
<span class="normal">4410</span>
<span class="normal">4411</span>
<span class="normal">4412</span>
<span class="normal">4413</span>
<span class="normal">4414</span>
<span class="normal">4415</span>
<span class="normal">4416</span>
<span class="normal">4417</span>
<span class="normal">4418</span>
<span class="normal">4419</span>
<span class="normal">4420</span>
<span class="normal">4421</span>
<span class="normal">4422</span>
<span class="normal">4423</span>
<span class="normal">4424</span>
<span class="normal">4425</span>
<span class="normal">4426</span>
<span class="normal">4427</span>
<span class="normal">4428</span>
<span class="normal">4429</span>
<span class="normal">4430</span>
<span class="normal">4431</span>
<span class="normal">4432</span>
<span class="normal">4433</span>
<span class="normal">4434</span>
<span class="normal">4435</span>
<span class="normal">4436</span>
<span class="normal">4437</span>
<span class="normal">4438</span>
<span class="normal">4439</span>
<span class="normal">4440</span>
<span class="normal">4441</span>
<span class="normal">4442</span>
<span class="normal">4443</span>
<span class="normal">4444</span>
<span class="normal">4445</span>
<span class="normal">4446</span>
<span class="normal">4447</span>
<span class="normal">4448</span>
<span class="normal">4449</span>
<span class="normal">4450</span>
<span class="normal">4451</span>
<span class="normal">4452</span>
<span class="normal">4453</span>
<span class="normal">4454</span>
<span class="normal">4455</span>
<span class="normal">4456</span>
<span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span>
<span class="normal">4461</span>
<span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span>
<span class="normal">4472</span>
<span class="normal">4473</span>
<span class="normal">4474</span>
<span class="normal">4475</span>
<span class="normal">4476</span>
<span class="normal">4477</span>
<span class="normal">4478</span>
<span class="normal">4479</span>
<span class="normal">4480</span>
<span class="normal">4481</span>
<span class="normal">4482</span>
<span class="normal">4483</span>
<span class="normal">4484</span>
<span class="normal">4485</span>
<span class="normal">4486</span>
<span class="normal">4487</span>
<span class="normal">4488</span>
<span class="normal">4489</span>
<span class="normal">4490</span>
<span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span>
<span class="normal">4501</span>
<span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span>
<span class="normal">4541</span>
<span class="normal">4542</span>
<span class="normal">4543</span>
<span class="normal">4544</span>
<span class="normal">4545</span>
<span class="normal">4546</span>
<span class="normal">4547</span>
<span class="normal">4548</span>
<span class="normal">4549</span>
<span class="normal">4550</span>
<span class="normal">4551</span>
<span class="normal">4552</span>
<span class="normal">4553</span>
<span class="normal">4554</span>
<span class="normal">4555</span>
<span class="normal">4556</span>
<span class="normal">4557</span>
<span class="normal">4558</span>
<span class="normal">4559</span>
<span class="normal">4560</span>
<span class="normal">4561</span>
<span class="normal">4562</span>
<span class="normal">4563</span>
<span class="normal">4564</span>
<span class="normal">4565</span>
<span class="normal">4566</span>
<span class="normal">4567</span>
<span class="normal">4568</span>
<span class="normal">4569</span>
<span class="normal">4570</span>
<span class="normal">4571</span>
<span class="normal">4572</span>
<span class="normal">4573</span>
<span class="normal">4574</span>
<span class="normal">4575</span>
<span class="normal">4576</span>
<span class="normal">4577</span>
<span class="normal">4578</span>
<span class="normal">4579</span>
<span class="normal">4580</span>
<span class="normal">4581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">vonmises_flattopped_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Flat-topped von Mises Distribution</span>

<span class="sd">    The Flat-topped von Mises distribution is a modification of the von Mises distribution</span>
<span class="sd">    that allows for more flexible peak shapes, including flattened or sharper tops, depending</span>
<span class="sd">    on the value of the shape parameter $\nu$.</span>

<span class="sd">    ![vonmises-ext](../images/circ-mod-vonmises-flat-topped.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, kappa, nu)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, kappa, nu)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Parameters must be scalar; cached normalization tables are built per parameter set.</span>
<span class="sd">    Implementation based on Section 4.3.10 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_table_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">mu_arr</span><span class="p">,</span> <span class="n">kappa_arr</span><span class="p">,</span> <span class="n">nu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_clear_normalization_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_table_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">x_arr</span> <span class="o">-</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">nu_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">log_kernel</span> <span class="o">+</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;log_normalizer&quot;</span><span class="p">]</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_pdf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;normalizer&quot;</span><span class="p">]</span>  <span class="c1"># retain attribute for existing code paths</span>
        <span class="k">return</span> <span class="n">pdf_vals</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Flat-topped von Mises distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = c \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu)))</span>
<span class="sd">        $$</span>

<span class="sd">        , where `c` is the normalizing constant:</span>

<span class="sd">        $$</span>
<span class="sd">        c = \frac{1}{\int_{-\pi}^{\pi} \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu))) d\theta}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Location parameter, $0 \leq \mu \leq 2\pi$. This is the mean direction when $\nu = 0$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$. Higher values indicate a sharper peak around $\mu$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \leq \nu \leq 1$. Controls the flattening or sharpening of the peak:</span>
<span class="sd">            - $\nu &gt; 0$: sharper peaks.</span>
<span class="sd">            - $\nu &lt; 0$: flatter peaks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Values of the probability density function at the specified points.</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The normalization constant $c$ is computed numerically, as the integral generally</span>
<span class="sd">        does not have a closed-form solution.</span>
<span class="sd">        - Special cases:</span>
<span class="sd">            - When $\nu = 0$, the distribution reduces to the standard von Mises distribution.</span>
<span class="sd">            - When $\kappa = 0$, the distribution becomes uniform on $[0, 2\pi)$.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="n">two_pi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">phi_start</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">](</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">](</span><span class="n">phi_start</span><span class="p">))</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">H</span> <span class="o">&lt;</span> <span class="n">H_start</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">H_start</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="n">H_start</span><span class="p">)</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cdf_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">mask_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_upper</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">result</span><span class="p">[</span><span class="n">mask_upper</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">q_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span> <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">shaped</span>

        <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
        <span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="n">close_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_valid</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_zero</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_zero</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_one</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
            <span class="n">phi_grid</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
            <span class="n">cdf_grid</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span>
            <span class="n">cdf_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">]</span>
            <span class="n">inv_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;inv_cdf_interp&quot;</span><span class="p">]</span>

            <span class="n">phi_start</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_interp</span><span class="p">(</span><span class="n">phi_start</span><span class="p">))</span>

            <span class="c1"># Prepare bracket indices for each quantile</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">+</span> <span class="n">q_valid</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>
            <span class="n">phi_guess</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_interp</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inv_interp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">cdf_grid</span><span class="p">,</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">phi_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">phi_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">q_val</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">phi0</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">phi_guess</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">close_zero</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                    <span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">close_one</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                    <span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
                    <span class="k">continue</span>

                <span class="n">i_hi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cdf_grid</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">phi_lo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">[</span><span class="n">i_hi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">phi_hi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">[</span><span class="n">i_hi</span><span class="p">])</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_VMFT_NEWTON_MAXITER</span><span class="p">):</span>
                    <span class="n">H_phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_interp</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
                    <span class="n">residual</span> <span class="o">=</span> <span class="n">H_phi</span> <span class="o">-</span> <span class="n">target</span>
                    <span class="n">derivative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                        <span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">nu_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">+</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;log_normalizer&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">derivative</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">derivative</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_VMFT_NEWTON_TOL</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phi_hi</span> <span class="o">-</span> <span class="n">phi_lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_VMFT_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">phi_hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">phi_hi</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">phi_lo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

                    <span class="n">step</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">/</span> <span class="n">derivative</span>
                    <span class="n">phi_candidate</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">-</span> <span class="n">step</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">phi_candidate</span><span class="p">)</span> <span class="ow">or</span> <span class="n">phi_candidate</span> <span class="o">&lt;=</span> <span class="n">phi_lo</span> <span class="ow">or</span> <span class="n">phi_candidate</span> <span class="o">&gt;=</span> <span class="n">phi_hi</span><span class="p">:</span>
                        <span class="n">phi_candidate</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi_lo</span> <span class="o">+</span> <span class="n">phi_hi</span><span class="p">)</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">phi_candidate</span><span class="p">,</span> <span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">))</span>

                <span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_val</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shaped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (quantile) of the flat-topped von Mises distribution.</span>

<span class="sd">        Quantiles are computed by reusing the cached cumulative table described in</span>
<span class="sd">        `cdf`. Starting from the monotone inverse of the tabulated primitive</span>
<span class="sd">        $H_{\kappa,\nu}$, the implementation applies up to</span>
<span class="sd">        :data:`_VMFT_NEWTON_MAXITER` safeguarded Newton steps with derivative</span>
<span class="sd">        $f(\theta) = \exp[\kappa \cos(\phi + \nu \sin \phi)]/Z$ to achieve</span>
<span class="sd">        machine-precision agreement (dual stopping on residual and bracket width).</span>
<span class="sd">        Boundary quantiles default to the support endpoints $0$ and $2\pi$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">        mu : float</span>
<span class="sd">            Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \ge 0$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \le \nu \le 1$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Angles corresponding to the probabilities in `q`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`mu`, `kappa`, and `nu` must be finite scalars.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`size` must describe a non-negative number of samples.&quot;</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">empty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span> <span class="k">if</span> <span class="n">empty</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">empty</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">samples</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
        <span class="n">sampler_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_sampler_params</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
        <span class="n">kappa_env</span> <span class="o">=</span> <span class="n">sampler_params</span><span class="p">[</span><span class="s2">&quot;kappa_env&quot;</span><span class="p">]</span>
        <span class="n">log_env_norm</span> <span class="o">=</span> <span class="n">sampler_params</span><span class="p">[</span><span class="s2">&quot;log_env_norm&quot;</span><span class="p">]</span>
        <span class="n">log_multiplier</span> <span class="o">=</span> <span class="n">sampler_params</span><span class="p">[</span><span class="s2">&quot;log_multiplier&quot;</span><span class="p">]</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">batch_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">total</span><span class="p">,</span> <span class="mi">4096</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">filled</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">batch_base</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span><span class="p">)</span> <span class="k">if</span> <span class="n">filled</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">batch_base</span>
            <span class="n">proposals</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">vonmises</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_env</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">proposals</span> <span class="o">-</span> <span class="n">mu_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">log_target</span> <span class="o">=</span> <span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">nu_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">+</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;log_normalizer&quot;</span><span class="p">]</span>
            <span class="n">log_env</span> <span class="o">=</span> <span class="n">kappa_env</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">log_env_norm</span>
            <span class="n">log_accept</span> <span class="o">=</span> <span class="n">log_target</span> <span class="o">-</span> <span class="n">log_env</span> <span class="o">-</span> <span class="n">log_multiplier</span>

            <span class="n">accept_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">batch</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">log_accept</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">accept_mask</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">accepted</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">accept_mask</span><span class="p">]</span>
            <span class="n">take</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">accepted</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span><span class="p">)</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">filled</span> <span class="p">:</span> <span class="n">filled</span> <span class="o">+</span> <span class="n">take</span><span class="p">]</span> <span class="o">=</span> <span class="n">accepted</span><span class="p">[:</span><span class="n">take</span><span class="p">]</span>
            <span class="n">filled</span> <span class="o">+=</span> <span class="n">take</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">samples</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the flat-topped von Mises distribution.</span>

<span class="sd">        Sampling uses an acceptance–rejection scheme with a curvature-matched</span>
<span class="sd">        von Mises envelope. Writing $\phi = \theta - \mu$ and matching the</span>
<span class="sd">        curvature at the mode yields a proposal concentration</span>
<span class="sd">        $\kappa_e = \kappa(1+\nu)^2$ (clipped to a small positive value). The</span>
<span class="sd">        envelope constant $M \ge \sup_\phi f(\phi)/g(\phi)$ is precomputed on</span>
<span class="sd">        the same spectral grid used for `cdf`, so once calibrated the</span>
<span class="sd">        sampler draws each variate with a single von Mises proposal followed by</span>
<span class="sd">        a scalar acceptance test.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu : float</span>
<span class="sd">            Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \ge 0$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \le \nu \le 1$.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Output shape.</span>
<span class="sd">        random_state : {None, int, np.random.Generator}, optional</span>
<span class="sd">            Random number generator specification.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rvs : array_like</span>
<span class="sd">            Random variates on $[0, 2\pi)$.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">),</span>
        <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate $(\mu, \kappa, \nu)$ from circular data.</span>

<span class="sd">        The default ``method=&#39;mle&#39;`` maximises the weighted log-likelihood</span>

<span class="sd">        $$</span>
<span class="sd">        \ell(\mu, \kappa, \nu) = \sum_i w_i</span>
<span class="sd">        \left[</span>
<span class="sd">            \kappa \cos(\phi_i + \nu \sin \phi_i) - \log Z(\kappa, \nu)</span>
<span class="sd">        \right],\quad</span>
<span class="sd">        \phi_i = (\theta_i - \mu) \bmod 2\pi,</span>
<span class="sd">        $$</span>

<span class="sd">        where $Z$ is the normalising constant reused from the cached spectral</span>
<span class="sd">        table. The routine initialises $(\mu, \kappa)$ from the first trigonometric</span>
<span class="sd">        moment and profiles a small grid for $\nu$ before bounded optimisation</span>
<span class="sd">        (default L-BFGS-B) with $\kappa \in$ ``kappa_bounds`` and</span>
<span class="sd">        $\nu \in$ ``nu_bounds``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample of angles.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to ``data``.</span>
<span class="sd">        method : {&#39;mle&#39;, &#39;moments&#39;}, default &#39;mle&#39;</span>
<span class="sd">            Estimation method. ``&#39;moments&#39;`` returns the circular mean,</span>
<span class="sd">            ``circ_kappa``, and $\nu=0$.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            SciPy optimiser to use when ``method=&#39;mle&#39;``.</span>
<span class="sd">        options : dict, optional</span>
<span class="sd">            Optimiser options forwarded to :func:`scipy.optimize.minimize`.</span>
<span class="sd">        nu_grid : array_like, optional</span>
<span class="sd">            Candidate $\nu$ values for initial profiling. Defaults to a small grid</span>
<span class="sd">            spanning ``nu_bounds``.</span>
<span class="sd">        kappa_bounds : tuple, optional</span>
<span class="sd">            Lower/upper bounds for $\kappa$ during optimisation.</span>
<span class="sd">        nu_bounds : tuple, optional</span>
<span class="sd">            Lower/upper bounds for $\nu$ during optimisation.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a dictionary with optimisation diagnostics.</span>
<span class="sd">        **minimize_kwargs :</span>
<span class="sd">            Additional keyword arguments passed to :func:`scipy.optimize.minimize`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params : tuple</span>
<span class="sd">            Estimated parameters ``(mu, kappa, nu)``.</span>
<span class="sd">        info : dict, optional</span>
<span class="sd">            Returned when ``return_info=True`` with fields such as ``loglik``,</span>
<span class="sd">            ``n_effective`` and ``converged``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>

        <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
        <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">nu_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.9</span><span class="p">))</span>
            <span class="n">upper_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">))</span>
            <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower_nu</span><span class="p">,</span> <span class="n">upper_nu</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nu_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">nu_param</span> <span class="o">=</span> <span class="n">params</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">mu_param</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;=</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="n">mu_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_arr</span> <span class="o">-</span> <span class="n">mu_wrapped</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="k">if</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
                <span class="n">log_pdf</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">two_pi</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_param</span><span class="p">))</span>

            <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">nu_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">log_kernel</span> <span class="o">+</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;log_normalizer&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">log_pdf</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">(</span><span class="n">estimates</span><span class="p">)),</span>
                    <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39;}.&quot;</span><span class="p">)</span>

        <span class="n">best_nu</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">nu_grid</span><span class="p">))):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
                <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
                <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the flat-topped von Mises distribution.</span>

<span class="sd">        Let $\phi = (\theta - \mu) \bmod 2\pi$ re-centred onto $[-\pi, \pi]$ and</span>
<span class="sd">        $g_{\kappa,\nu}(\phi) = \exp\!\bigl[\kappa \cos(\phi + \nu \sin \phi)\bigr]$.</span>
<span class="sd">        The normalised primitive</span>
<span class="sd">        $$</span>
<span class="sd">        H_{\kappa,\nu}(\phi) = \frac{1}{Z} \int_{-\pi}^{\phi} g_{\kappa,\nu}(t)\,dt,</span>
<span class="sd">        \qquad Z = \int_{-\pi}^{\pi} g_{\kappa,\nu}(t)\,dt,</span>
<span class="sd">        $$</span>
<span class="sd">        is approximated with spectral accuracy by a trapezoidal rule on an</span>
<span class="sd">        equispaced grid (size selected from $O(\sqrt{\kappa})$). The CDF on</span>
<span class="sd">        $[0, 2\pi)$ then follows from $F(\theta) = H_{\kappa,\nu}(\phi) -</span>
<span class="sd">        H_{\kappa,\nu}(\phi_0)$ with $\phi_0 = ((-\mu) \bmod 2\pi) - \pi$. The</span>
<span class="sd">        precomputed cumulative grid is cached per $(\kappa, \nu)$, so repeated</span>
<span class="sd">        evaluations are $O(1)$ once the table is built.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \ge 0$ (capped internally at</span>
<span class="sd">            :data:`_VMFT_KAPPA_UPPER` for numerical stability).</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \le \nu \le 1$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative probabilities corresponding to `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_vmft_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grid_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">_vmft_grid_size</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
        <span class="n">grid_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">grid_int</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_table_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">_vmft_build_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">grid_int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_table_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_vmft_sampler_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_sampler_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="n">kappa_env</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">_VMFT_ENV_MIN_KAPPA</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>

        <span class="n">log_env_norm</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa_env</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">kappa_env</span>
        <span class="p">)</span>
        <span class="n">log_env_pdf</span> <span class="o">=</span> <span class="n">kappa_env</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">log_env_norm</span>
        <span class="n">log_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">log_env_pdf</span>
        <span class="n">log_multiplier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_ratio</span><span class="p">))</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_multiplier</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">5e-12</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;kappa_env&quot;</span><span class="p">:</span> <span class="n">kappa_env</span><span class="p">,</span>
            <span class="s2">&quot;log_env_norm&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">log_env_norm</span><span class="p">),</span>
            <span class="s2">&quot;log_multiplier&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)),</span>
            <span class="s2">&quot;multiplier&quot;</span><span class="p">:</span> <span class="n">multiplier</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vmft_sampler_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">return</span> <span class="n">params</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_flattopped_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Flat-topped von Mises distribution.</p>
<div class="arithmatex">\[
f(\theta) = c \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu)))
\]</div>
<p>, where <code>c</code> is the normalizing constant:</p>
<div class="arithmatex">\[
c = \frac{1}{\int_{-\pi}^{\pi} \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu))) d\theta}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the PDF, defined on the interval <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location parameter, <span class="arithmatex">\(0 \leq \mu \leq 2\pi\)</span>. This is the mean direction when <span class="arithmatex">\(\nu = 0\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>. Higher values indicate a sharper peak around <span class="arithmatex">\(\mu\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \leq \nu \leq 1\)</span>. Controls the flattening or sharpening of the peak:
- <span class="arithmatex">\(\nu &gt; 0\)</span>: sharper peaks.
- <span class="arithmatex">\(\nu &lt; 0\)</span>: flatter peaks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the probability density function at the specified points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The normalization constant <span class="arithmatex">\(c\)</span> is computed numerically, as the integral generally
does not have a closed-form solution.</li>
<li>Special cases:<ul>
<li>When <span class="arithmatex">\(\nu = 0\)</span>, the distribution reduces to the standard von Mises distribution.</li>
<li>When <span class="arithmatex">\(\kappa = 0\)</span>, the distribution becomes uniform on <span class="arithmatex">\([0, 2\pi)\)</span>.</li>
</ul>
</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3976</span>
<span class="normal">3977</span>
<span class="normal">3978</span>
<span class="normal">3979</span>
<span class="normal">3980</span>
<span class="normal">3981</span>
<span class="normal">3982</span>
<span class="normal">3983</span>
<span class="normal">3984</span>
<span class="normal">3985</span>
<span class="normal">3986</span>
<span class="normal">3987</span>
<span class="normal">3988</span>
<span class="normal">3989</span>
<span class="normal">3990</span>
<span class="normal">3991</span>
<span class="normal">3992</span>
<span class="normal">3993</span>
<span class="normal">3994</span>
<span class="normal">3995</span>
<span class="normal">3996</span>
<span class="normal">3997</span>
<span class="normal">3998</span>
<span class="normal">3999</span>
<span class="normal">4000</span>
<span class="normal">4001</span>
<span class="normal">4002</span>
<span class="normal">4003</span>
<span class="normal">4004</span>
<span class="normal">4005</span>
<span class="normal">4006</span>
<span class="normal">4007</span>
<span class="normal">4008</span>
<span class="normal">4009</span>
<span class="normal">4010</span>
<span class="normal">4011</span>
<span class="normal">4012</span>
<span class="normal">4013</span>
<span class="normal">4014</span>
<span class="normal">4015</span>
<span class="normal">4016</span>
<span class="normal">4017</span>
<span class="normal">4018</span>
<span class="normal">4019</span>
<span class="normal">4020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Flat-topped von Mises distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = c \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu)))</span>
<span class="sd">    $$</span>

<span class="sd">    , where `c` is the normalizing constant:</span>

<span class="sd">    $$</span>
<span class="sd">    c = \frac{1}{\int_{-\pi}^{\pi} \exp(\kappa \cos(\theta - \mu + \nu \sin(\theta - \mu))) d\theta}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Location parameter, $0 \leq \mu \leq 2\pi$. This is the mean direction when $\nu = 0$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$. Higher values indicate a sharper peak around $\mu$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \leq \nu \leq 1$. Controls the flattening or sharpening of the peak:</span>
<span class="sd">        - $\nu &gt; 0$: sharper peaks.</span>
<span class="sd">        - $\nu &lt; 0$: flatter peaks.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Values of the probability density function at the specified points.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The normalization constant $c$ is computed numerically, as the integral generally</span>
<span class="sd">    does not have a closed-form solution.</span>
<span class="sd">    - Special cases:</span>
<span class="sd">        - When $\nu = 0$, the distribution reduces to the standard von Mises distribution.</span>
<span class="sd">        - When $\kappa = 0$, the distribution becomes uniform on $[0, 2\pi)$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">))</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_flattopped_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (quantile) of the flat-topped von Mises distribution.</p>
<p>Quantiles are computed by reusing the cached cumulative table described in
<code>cdf</code>. Starting from the monotone inverse of the tabulated primitive
<span class="arithmatex">\(H_{\kappa,\nu}\)</span>, the implementation applies up to
:data:<code>_VMFT_NEWTON_MAXITER</code> safeguarded Newton steps with derivative
<span class="arithmatex">\(f(\theta) = \exp[\kappa \cos(\phi + \nu \sin \phi)]/Z\)</span> to achieve
machine-precision agreement (dual stopping on residual and bracket width).
Boundary quantiles default to the support endpoints <span class="arithmatex">\(0\)</span> and <span class="arithmatex">\(2\pi\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate (0 &lt;= q &lt;= 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location parameter, <span class="arithmatex">\(0 \le \mu \le 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \ge 0\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \le \nu \le 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles corresponding to the probabilities in <code>q</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4158</span>
<span class="normal">4159</span>
<span class="normal">4160</span>
<span class="normal">4161</span>
<span class="normal">4162</span>
<span class="normal">4163</span>
<span class="normal">4164</span>
<span class="normal">4165</span>
<span class="normal">4166</span>
<span class="normal">4167</span>
<span class="normal">4168</span>
<span class="normal">4169</span>
<span class="normal">4170</span>
<span class="normal">4171</span>
<span class="normal">4172</span>
<span class="normal">4173</span>
<span class="normal">4174</span>
<span class="normal">4175</span>
<span class="normal">4176</span>
<span class="normal">4177</span>
<span class="normal">4178</span>
<span class="normal">4179</span>
<span class="normal">4180</span>
<span class="normal">4181</span>
<span class="normal">4182</span>
<span class="normal">4183</span>
<span class="normal">4184</span>
<span class="normal">4185</span>
<span class="normal">4186</span>
<span class="normal">4187</span>
<span class="normal">4188</span>
<span class="normal">4189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (quantile) of the flat-topped von Mises distribution.</span>

<span class="sd">    Quantiles are computed by reusing the cached cumulative table described in</span>
<span class="sd">    `cdf`. Starting from the monotone inverse of the tabulated primitive</span>
<span class="sd">    $H_{\kappa,\nu}$, the implementation applies up to</span>
<span class="sd">    :data:`_VMFT_NEWTON_MAXITER` safeguarded Newton steps with derivative</span>
<span class="sd">    $f(\theta) = \exp[\kappa \cos(\phi + \nu \sin \phi)]/Z$ to achieve</span>
<span class="sd">    machine-precision agreement (dual stopping on residual and bracket width).</span>
<span class="sd">    Boundary quantiles default to the support endpoints $0$ and $2\pi$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">    mu : float</span>
<span class="sd">        Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \ge 0$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \le \nu \le 1$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Angles corresponding to the probabilities in `q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_flattopped_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the flat-topped von Mises distribution.</p>
<p>Sampling uses an acceptance–rejection scheme with a curvature-matched
von Mises envelope. Writing <span class="arithmatex">\(\phi = \theta - \mu\)</span> and matching the
curvature at the mode yields a proposal concentration
<span class="arithmatex">\(\kappa_e = \kappa(1+\nu)^2\)</span> (clipped to a small positive value). The
envelope constant <span class="arithmatex">\(M \ge \sup_\phi f(\phi)/g(\phi)\)</span> is precomputed on
the same spectral grid used for <code>cdf</code>, so once calibrated the
sampler draws each variate with a single von Mises proposal followed by
a scalar acceptance test.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location parameter, <span class="arithmatex">\(0 \le \mu \le 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \ge 0\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \le \nu \le 1\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output shape.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>(None, <span title="int">int</span>, <span title="numpy.random.Generator">Generator</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator specification.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rvs</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4258</span>
<span class="normal">4259</span>
<span class="normal">4260</span>
<span class="normal">4261</span>
<span class="normal">4262</span>
<span class="normal">4263</span>
<span class="normal">4264</span>
<span class="normal">4265</span>
<span class="normal">4266</span>
<span class="normal">4267</span>
<span class="normal">4268</span>
<span class="normal">4269</span>
<span class="normal">4270</span>
<span class="normal">4271</span>
<span class="normal">4272</span>
<span class="normal">4273</span>
<span class="normal">4274</span>
<span class="normal">4275</span>
<span class="normal">4276</span>
<span class="normal">4277</span>
<span class="normal">4278</span>
<span class="normal">4279</span>
<span class="normal">4280</span>
<span class="normal">4281</span>
<span class="normal">4282</span>
<span class="normal">4283</span>
<span class="normal">4284</span>
<span class="normal">4285</span>
<span class="normal">4286</span>
<span class="normal">4287</span>
<span class="normal">4288</span>
<span class="normal">4289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the flat-topped von Mises distribution.</span>

<span class="sd">    Sampling uses an acceptance–rejection scheme with a curvature-matched</span>
<span class="sd">    von Mises envelope. Writing $\phi = \theta - \mu$ and matching the</span>
<span class="sd">    curvature at the mode yields a proposal concentration</span>
<span class="sd">    $\kappa_e = \kappa(1+\nu)^2$ (clipped to a small positive value). The</span>
<span class="sd">    envelope constant $M \ge \sup_\phi f(\phi)/g(\phi)$ is precomputed on</span>
<span class="sd">    the same spectral grid used for `cdf`, so once calibrated the</span>
<span class="sd">    sampler draws each variate with a single von Mises proposal followed by</span>
<span class="sd">    a scalar acceptance test.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \ge 0$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \le \nu \le 1$.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Output shape.</span>
<span class="sd">    random_state : {None, int, np.random.Generator}, optional</span>
<span class="sd">        Random number generator specification.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rvs : array_like</span>
<span class="sd">        Random variates on $[0, 2\pi)$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_flattopped_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">),</span> <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <span class="arithmatex">\((\mu, \kappa, \nu)\)</span> from circular data.</p>
<p>The default <code>method='mle'</code> maximises the weighted log-likelihood</p>
<div class="arithmatex">\[
\ell(\mu, \kappa, \nu) = \sum_i w_i
\left[
    \kappa \cos(\phi_i + \nu \sin \phi_i) - \log Z(\kappa, \nu)
\right],\quad
\phi_i = (\theta_i - \mu) \bmod 2\pi,
\]</div>
<p>where <span class="arithmatex">\(Z\)</span> is the normalising constant reused from the cached spectral
table. The routine initialises <span class="arithmatex">\((\mu, \kappa)\)</span> from the first trigonometric
moment and profiles a small grid for <span class="arithmatex">\(\nu\)</span> before bounded optimisation
(default L-BFGS-B) with <span class="arithmatex">\(\kappa \in\)</span> <code>kappa_bounds</code> and
<span class="arithmatex">\(\nu \in\)</span> <code>nu_bounds</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample of angles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="mle">mle</span>, <span title="moments">moments</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation method. <code>'moments'</code> returns the circular mean,
<code>circ_kappa</code>, and <span class="arithmatex">\(\nu=0\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;mle&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SciPy optimiser to use when <code>method='mle'</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser options forwarded to :func:<code>scipy.optimize.minimize</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu_grid</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Candidate <span class="arithmatex">\(\nu\)</span> values for initial profiling. Defaults to a small grid
spanning <code>nu_bounds</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lower/upper bounds for <span class="arithmatex">\(\kappa\)</span> during optimisation.</p>
              </div>
            </td>
            <td>
                  <code>(1e-06, <span title="pycircstat2.distributions._VMFT_KAPPA_UPPER">_VMFT_KAPPA_UPPER</span>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lower/upper bounds for <span class="arithmatex">\(\nu\)</span> during optimisation.</p>
              </div>
            </td>
            <td>
                  <code>(-0.99, 0.99)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a dictionary with optimisation diagnostics.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**minimize_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to :func:<code>scipy.optimize.minimize</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated parameters <code>(mu, kappa, nu)</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info</code></td>            <td>
                  <code>(<span title="dict">dict</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returned when <code>return_info=True</code> with fields such as <code>loglik</code>,
<code>n_effective</code> and <code>converged</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4291</span>
<span class="normal">4292</span>
<span class="normal">4293</span>
<span class="normal">4294</span>
<span class="normal">4295</span>
<span class="normal">4296</span>
<span class="normal">4297</span>
<span class="normal">4298</span>
<span class="normal">4299</span>
<span class="normal">4300</span>
<span class="normal">4301</span>
<span class="normal">4302</span>
<span class="normal">4303</span>
<span class="normal">4304</span>
<span class="normal">4305</span>
<span class="normal">4306</span>
<span class="normal">4307</span>
<span class="normal">4308</span>
<span class="normal">4309</span>
<span class="normal">4310</span>
<span class="normal">4311</span>
<span class="normal">4312</span>
<span class="normal">4313</span>
<span class="normal">4314</span>
<span class="normal">4315</span>
<span class="normal">4316</span>
<span class="normal">4317</span>
<span class="normal">4318</span>
<span class="normal">4319</span>
<span class="normal">4320</span>
<span class="normal">4321</span>
<span class="normal">4322</span>
<span class="normal">4323</span>
<span class="normal">4324</span>
<span class="normal">4325</span>
<span class="normal">4326</span>
<span class="normal">4327</span>
<span class="normal">4328</span>
<span class="normal">4329</span>
<span class="normal">4330</span>
<span class="normal">4331</span>
<span class="normal">4332</span>
<span class="normal">4333</span>
<span class="normal">4334</span>
<span class="normal">4335</span>
<span class="normal">4336</span>
<span class="normal">4337</span>
<span class="normal">4338</span>
<span class="normal">4339</span>
<span class="normal">4340</span>
<span class="normal">4341</span>
<span class="normal">4342</span>
<span class="normal">4343</span>
<span class="normal">4344</span>
<span class="normal">4345</span>
<span class="normal">4346</span>
<span class="normal">4347</span>
<span class="normal">4348</span>
<span class="normal">4349</span>
<span class="normal">4350</span>
<span class="normal">4351</span>
<span class="normal">4352</span>
<span class="normal">4353</span>
<span class="normal">4354</span>
<span class="normal">4355</span>
<span class="normal">4356</span>
<span class="normal">4357</span>
<span class="normal">4358</span>
<span class="normal">4359</span>
<span class="normal">4360</span>
<span class="normal">4361</span>
<span class="normal">4362</span>
<span class="normal">4363</span>
<span class="normal">4364</span>
<span class="normal">4365</span>
<span class="normal">4366</span>
<span class="normal">4367</span>
<span class="normal">4368</span>
<span class="normal">4369</span>
<span class="normal">4370</span>
<span class="normal">4371</span>
<span class="normal">4372</span>
<span class="normal">4373</span>
<span class="normal">4374</span>
<span class="normal">4375</span>
<span class="normal">4376</span>
<span class="normal">4377</span>
<span class="normal">4378</span>
<span class="normal">4379</span>
<span class="normal">4380</span>
<span class="normal">4381</span>
<span class="normal">4382</span>
<span class="normal">4383</span>
<span class="normal">4384</span>
<span class="normal">4385</span>
<span class="normal">4386</span>
<span class="normal">4387</span>
<span class="normal">4388</span>
<span class="normal">4389</span>
<span class="normal">4390</span>
<span class="normal">4391</span>
<span class="normal">4392</span>
<span class="normal">4393</span>
<span class="normal">4394</span>
<span class="normal">4395</span>
<span class="normal">4396</span>
<span class="normal">4397</span>
<span class="normal">4398</span>
<span class="normal">4399</span>
<span class="normal">4400</span>
<span class="normal">4401</span>
<span class="normal">4402</span>
<span class="normal">4403</span>
<span class="normal">4404</span>
<span class="normal">4405</span>
<span class="normal">4406</span>
<span class="normal">4407</span>
<span class="normal">4408</span>
<span class="normal">4409</span>
<span class="normal">4410</span>
<span class="normal">4411</span>
<span class="normal">4412</span>
<span class="normal">4413</span>
<span class="normal">4414</span>
<span class="normal">4415</span>
<span class="normal">4416</span>
<span class="normal">4417</span>
<span class="normal">4418</span>
<span class="normal">4419</span>
<span class="normal">4420</span>
<span class="normal">4421</span>
<span class="normal">4422</span>
<span class="normal">4423</span>
<span class="normal">4424</span>
<span class="normal">4425</span>
<span class="normal">4426</span>
<span class="normal">4427</span>
<span class="normal">4428</span>
<span class="normal">4429</span>
<span class="normal">4430</span>
<span class="normal">4431</span>
<span class="normal">4432</span>
<span class="normal">4433</span>
<span class="normal">4434</span>
<span class="normal">4435</span>
<span class="normal">4436</span>
<span class="normal">4437</span>
<span class="normal">4438</span>
<span class="normal">4439</span>
<span class="normal">4440</span>
<span class="normal">4441</span>
<span class="normal">4442</span>
<span class="normal">4443</span>
<span class="normal">4444</span>
<span class="normal">4445</span>
<span class="normal">4446</span>
<span class="normal">4447</span>
<span class="normal">4448</span>
<span class="normal">4449</span>
<span class="normal">4450</span>
<span class="normal">4451</span>
<span class="normal">4452</span>
<span class="normal">4453</span>
<span class="normal">4454</span>
<span class="normal">4455</span>
<span class="normal">4456</span>
<span class="normal">4457</span>
<span class="normal">4458</span>
<span class="normal">4459</span>
<span class="normal">4460</span>
<span class="normal">4461</span>
<span class="normal">4462</span>
<span class="normal">4463</span>
<span class="normal">4464</span>
<span class="normal">4465</span>
<span class="normal">4466</span>
<span class="normal">4467</span>
<span class="normal">4468</span>
<span class="normal">4469</span>
<span class="normal">4470</span>
<span class="normal">4471</span>
<span class="normal">4472</span>
<span class="normal">4473</span>
<span class="normal">4474</span>
<span class="normal">4475</span>
<span class="normal">4476</span>
<span class="normal">4477</span>
<span class="normal">4478</span>
<span class="normal">4479</span>
<span class="normal">4480</span>
<span class="normal">4481</span>
<span class="normal">4482</span>
<span class="normal">4483</span>
<span class="normal">4484</span>
<span class="normal">4485</span>
<span class="normal">4486</span>
<span class="normal">4487</span>
<span class="normal">4488</span>
<span class="normal">4489</span>
<span class="normal">4490</span>
<span class="normal">4491</span>
<span class="normal">4492</span>
<span class="normal">4493</span>
<span class="normal">4494</span>
<span class="normal">4495</span>
<span class="normal">4496</span>
<span class="normal">4497</span>
<span class="normal">4498</span>
<span class="normal">4499</span>
<span class="normal">4500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">_VMFT_KAPPA_UPPER</span><span class="p">),</span>
    <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate $(\mu, \kappa, \nu)$ from circular data.</span>

<span class="sd">    The default ``method=&#39;mle&#39;`` maximises the weighted log-likelihood</span>

<span class="sd">    $$</span>
<span class="sd">    \ell(\mu, \kappa, \nu) = \sum_i w_i</span>
<span class="sd">    \left[</span>
<span class="sd">        \kappa \cos(\phi_i + \nu \sin \phi_i) - \log Z(\kappa, \nu)</span>
<span class="sd">    \right],\quad</span>
<span class="sd">    \phi_i = (\theta_i - \mu) \bmod 2\pi,</span>
<span class="sd">    $$</span>

<span class="sd">    where $Z$ is the normalising constant reused from the cached spectral</span>
<span class="sd">    table. The routine initialises $(\mu, \kappa)$ from the first trigonometric</span>
<span class="sd">    moment and profiles a small grid for $\nu$ before bounded optimisation</span>
<span class="sd">    (default L-BFGS-B) with $\kappa \in$ ``kappa_bounds`` and</span>
<span class="sd">    $\nu \in$ ``nu_bounds``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample of angles.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to ``data``.</span>
<span class="sd">    method : {&#39;mle&#39;, &#39;moments&#39;}, default &#39;mle&#39;</span>
<span class="sd">        Estimation method. ``&#39;moments&#39;`` returns the circular mean,</span>
<span class="sd">        ``circ_kappa``, and $\nu=0$.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        SciPy optimiser to use when ``method=&#39;mle&#39;``.</span>
<span class="sd">    options : dict, optional</span>
<span class="sd">        Optimiser options forwarded to :func:`scipy.optimize.minimize`.</span>
<span class="sd">    nu_grid : array_like, optional</span>
<span class="sd">        Candidate $\nu$ values for initial profiling. Defaults to a small grid</span>
<span class="sd">        spanning ``nu_bounds``.</span>
<span class="sd">    kappa_bounds : tuple, optional</span>
<span class="sd">        Lower/upper bounds for $\kappa$ during optimisation.</span>
<span class="sd">    nu_bounds : tuple, optional</span>
<span class="sd">        Lower/upper bounds for $\nu$ during optimisation.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a dictionary with optimisation diagnostics.</span>
<span class="sd">    **minimize_kwargs :</span>
<span class="sd">        Additional keyword arguments passed to :func:`scipy.optimize.minimize`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : tuple</span>
<span class="sd">        Estimated parameters ``(mu, kappa, nu)``.</span>
<span class="sd">    info : dict, optional</span>
<span class="sd">        Returned when ``return_info=True`` with fields such as ``loglik``,</span>
<span class="sd">        ``n_effective`` and ``converged``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>

    <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
    <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">nu_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lower_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.9</span><span class="p">))</span>
        <span class="n">upper_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.9</span><span class="p">))</span>
        <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lower_nu</span><span class="p">,</span> <span class="n">upper_nu</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nu_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">nu_param</span> <span class="o">=</span> <span class="n">params</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">mu_param</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;=</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="n">mu_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_arr</span> <span class="o">-</span> <span class="n">mu_wrapped</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">_VMFT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">two_pi</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_vmft_table</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_param</span><span class="p">))</span>

        <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">nu_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">log_kernel</span> <span class="o">+</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;log_normalizer&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">log_pdf</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">nll</span><span class="p">(</span><span class="n">estimates</span><span class="p">)),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39;}.&quot;</span><span class="p">)</span>

    <span class="n">best_nu</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">nu_grid</span><span class="p">))):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">best_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="p">]</span>

    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">nll</span><span class="p">,</span>
        <span class="n">init</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
        <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
            <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
        <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
        <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
        <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
        <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.vonmises_flattopped_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the flat-topped von Mises distribution.</p>
<p>Let <span class="arithmatex">\(\phi = (\theta - \mu) \bmod 2\pi\)</span> re-centred onto <span class="arithmatex">\([-\pi, \pi]\)</span> and
<span class="arithmatex">\(g_{\kappa,\nu}(\phi) = \exp\!\bigl[\kappa \cos(\phi + \nu \sin \phi)\bigr]\)</span>.
The normalised primitive
$$
H_{\kappa,\nu}(\phi) = \frac{1}{Z} \int_{-\pi}^{\phi} g_{\kappa,\nu}(t)\,dt,
\qquad Z = \int_{-\pi}^{\pi} g_{\kappa,\nu}(t)\,dt,
$$
is approximated with spectral accuracy by a trapezoidal rule on an
equispaced grid (size selected from <span class="arithmatex">\(O(\sqrt{\kappa})\)</span>). The CDF on
<span class="arithmatex">\([0, 2\pi)\)</span> then follows from <span class="arithmatex">\(F(\theta) = H_{\kappa,\nu}(\phi) -
H_{\kappa,\nu}(\phi_0)\)</span> with <span class="arithmatex">\(\phi_0 = ((-\mu) \bmod 2\pi) - \pi\)</span>. The
precomputed cumulative grid is cached per <span class="arithmatex">\((\kappa, \nu)\)</span>, so repeated
evaluations are <span class="arithmatex">\(O(1)\)</span> once the table is built.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location parameter, <span class="arithmatex">\(0 \le \mu \le 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \ge 0\)</span> (capped internally at
:data:<code>_VMFT_KAPPA_UPPER</code> for numerical stability).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \le \nu \le 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative probabilities corresponding to <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4502</span>
<span class="normal">4503</span>
<span class="normal">4504</span>
<span class="normal">4505</span>
<span class="normal">4506</span>
<span class="normal">4507</span>
<span class="normal">4508</span>
<span class="normal">4509</span>
<span class="normal">4510</span>
<span class="normal">4511</span>
<span class="normal">4512</span>
<span class="normal">4513</span>
<span class="normal">4514</span>
<span class="normal">4515</span>
<span class="normal">4516</span>
<span class="normal">4517</span>
<span class="normal">4518</span>
<span class="normal">4519</span>
<span class="normal">4520</span>
<span class="normal">4521</span>
<span class="normal">4522</span>
<span class="normal">4523</span>
<span class="normal">4524</span>
<span class="normal">4525</span>
<span class="normal">4526</span>
<span class="normal">4527</span>
<span class="normal">4528</span>
<span class="normal">4529</span>
<span class="normal">4530</span>
<span class="normal">4531</span>
<span class="normal">4532</span>
<span class="normal">4533</span>
<span class="normal">4534</span>
<span class="normal">4535</span>
<span class="normal">4536</span>
<span class="normal">4537</span>
<span class="normal">4538</span>
<span class="normal">4539</span>
<span class="normal">4540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the flat-topped von Mises distribution.</span>

<span class="sd">    Let $\phi = (\theta - \mu) \bmod 2\pi$ re-centred onto $[-\pi, \pi]$ and</span>
<span class="sd">    $g_{\kappa,\nu}(\phi) = \exp\!\bigl[\kappa \cos(\phi + \nu \sin \phi)\bigr]$.</span>
<span class="sd">    The normalised primitive</span>
<span class="sd">    $$</span>
<span class="sd">    H_{\kappa,\nu}(\phi) = \frac{1}{Z} \int_{-\pi}^{\phi} g_{\kappa,\nu}(t)\,dt,</span>
<span class="sd">    \qquad Z = \int_{-\pi}^{\pi} g_{\kappa,\nu}(t)\,dt,</span>
<span class="sd">    $$</span>
<span class="sd">    is approximated with spectral accuracy by a trapezoidal rule on an</span>
<span class="sd">    equispaced grid (size selected from $O(\sqrt{\kappa})$). The CDF on</span>
<span class="sd">    $[0, 2\pi)$ then follows from $F(\theta) = H_{\kappa,\nu}(\phi) -</span>
<span class="sd">    H_{\kappa,\nu}(\phi_0)$ with $\phi_0 = ((-\mu) \bmod 2\pi) - \pi$. The</span>
<span class="sd">    precomputed cumulative grid is cached per $(\kappa, \nu)$, so repeated</span>
<span class="sd">    evaluations are $O(1)$ once the table is built.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Location parameter, $0 \le \mu \le 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \ge 0$ (capped internally at</span>
<span class="sd">        :data:`_VMFT_KAPPA_UPPER` for numerical stability).</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \le \nu \le 1$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative probabilities corresponding to `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_vmft_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.jonespewsey_gen" class="doc doc-heading">
            <code>jonespewsey_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Jones-Pewsey Distribution</p>
<p><img alt="jonespewsey" src="../../images/circ-mod-jonespewsey.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, kappa, psi, *args, **kwargs) (pycircstat2.distributions.jonespewsey_gen.pdf)" href="#pycircstat2.distributions.jonespewsey_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, kappa, psi, *args, **kwargs) (pycircstat2.distributions.jonespewsey_gen.cdf)" href="#pycircstat2.distributions.jonespewsey_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Parameters must be scalar; cached normalisation tables are built per parameter set.
Implementation based on Section 4.3.9 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4678</span>
<span class="normal">4679</span>
<span class="normal">4680</span>
<span class="normal">4681</span>
<span class="normal">4682</span>
<span class="normal">4683</span>
<span class="normal">4684</span>
<span class="normal">4685</span>
<span class="normal">4686</span>
<span class="normal">4687</span>
<span class="normal">4688</span>
<span class="normal">4689</span>
<span class="normal">4690</span>
<span class="normal">4691</span>
<span class="normal">4692</span>
<span class="normal">4693</span>
<span class="normal">4694</span>
<span class="normal">4695</span>
<span class="normal">4696</span>
<span class="normal">4697</span>
<span class="normal">4698</span>
<span class="normal">4699</span>
<span class="normal">4700</span>
<span class="normal">4701</span>
<span class="normal">4702</span>
<span class="normal">4703</span>
<span class="normal">4704</span>
<span class="normal">4705</span>
<span class="normal">4706</span>
<span class="normal">4707</span>
<span class="normal">4708</span>
<span class="normal">4709</span>
<span class="normal">4710</span>
<span class="normal">4711</span>
<span class="normal">4712</span>
<span class="normal">4713</span>
<span class="normal">4714</span>
<span class="normal">4715</span>
<span class="normal">4716</span>
<span class="normal">4717</span>
<span class="normal">4718</span>
<span class="normal">4719</span>
<span class="normal">4720</span>
<span class="normal">4721</span>
<span class="normal">4722</span>
<span class="normal">4723</span>
<span class="normal">4724</span>
<span class="normal">4725</span>
<span class="normal">4726</span>
<span class="normal">4727</span>
<span class="normal">4728</span>
<span class="normal">4729</span>
<span class="normal">4730</span>
<span class="normal">4731</span>
<span class="normal">4732</span>
<span class="normal">4733</span>
<span class="normal">4734</span>
<span class="normal">4735</span>
<span class="normal">4736</span>
<span class="normal">4737</span>
<span class="normal">4738</span>
<span class="normal">4739</span>
<span class="normal">4740</span>
<span class="normal">4741</span>
<span class="normal">4742</span>
<span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span>
<span class="normal">4759</span>
<span class="normal">4760</span>
<span class="normal">4761</span>
<span class="normal">4762</span>
<span class="normal">4763</span>
<span class="normal">4764</span>
<span class="normal">4765</span>
<span class="normal">4766</span>
<span class="normal">4767</span>
<span class="normal">4768</span>
<span class="normal">4769</span>
<span class="normal">4770</span>
<span class="normal">4771</span>
<span class="normal">4772</span>
<span class="normal">4773</span>
<span class="normal">4774</span>
<span class="normal">4775</span>
<span class="normal">4776</span>
<span class="normal">4777</span>
<span class="normal">4778</span>
<span class="normal">4779</span>
<span class="normal">4780</span>
<span class="normal">4781</span>
<span class="normal">4782</span>
<span class="normal">4783</span>
<span class="normal">4784</span>
<span class="normal">4785</span>
<span class="normal">4786</span>
<span class="normal">4787</span>
<span class="normal">4788</span>
<span class="normal">4789</span>
<span class="normal">4790</span>
<span class="normal">4791</span>
<span class="normal">4792</span>
<span class="normal">4793</span>
<span class="normal">4794</span>
<span class="normal">4795</span>
<span class="normal">4796</span>
<span class="normal">4797</span>
<span class="normal">4798</span>
<span class="normal">4799</span>
<span class="normal">4800</span>
<span class="normal">4801</span>
<span class="normal">4802</span>
<span class="normal">4803</span>
<span class="normal">4804</span>
<span class="normal">4805</span>
<span class="normal">4806</span>
<span class="normal">4807</span>
<span class="normal">4808</span>
<span class="normal">4809</span>
<span class="normal">4810</span>
<span class="normal">4811</span>
<span class="normal">4812</span>
<span class="normal">4813</span>
<span class="normal">4814</span>
<span class="normal">4815</span>
<span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span>
<span class="normal">4820</span>
<span class="normal">4821</span>
<span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span>
<span class="normal">4825</span>
<span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span>
<span class="normal">4830</span>
<span class="normal">4831</span>
<span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span>
<span class="normal">4836</span>
<span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span>
<span class="normal">4845</span>
<span class="normal">4846</span>
<span class="normal">4847</span>
<span class="normal">4848</span>
<span class="normal">4849</span>
<span class="normal">4850</span>
<span class="normal">4851</span>
<span class="normal">4852</span>
<span class="normal">4853</span>
<span class="normal">4854</span>
<span class="normal">4855</span>
<span class="normal">4856</span>
<span class="normal">4857</span>
<span class="normal">4858</span>
<span class="normal">4859</span>
<span class="normal">4860</span>
<span class="normal">4861</span>
<span class="normal">4862</span>
<span class="normal">4863</span>
<span class="normal">4864</span>
<span class="normal">4865</span>
<span class="normal">4866</span>
<span class="normal">4867</span>
<span class="normal">4868</span>
<span class="normal">4869</span>
<span class="normal">4870</span>
<span class="normal">4871</span>
<span class="normal">4872</span>
<span class="normal">4873</span>
<span class="normal">4874</span>
<span class="normal">4875</span>
<span class="normal">4876</span>
<span class="normal">4877</span>
<span class="normal">4878</span>
<span class="normal">4879</span>
<span class="normal">4880</span>
<span class="normal">4881</span>
<span class="normal">4882</span>
<span class="normal">4883</span>
<span class="normal">4884</span>
<span class="normal">4885</span>
<span class="normal">4886</span>
<span class="normal">4887</span>
<span class="normal">4888</span>
<span class="normal">4889</span>
<span class="normal">4890</span>
<span class="normal">4891</span>
<span class="normal">4892</span>
<span class="normal">4893</span>
<span class="normal">4894</span>
<span class="normal">4895</span>
<span class="normal">4896</span>
<span class="normal">4897</span>
<span class="normal">4898</span>
<span class="normal">4899</span>
<span class="normal">4900</span>
<span class="normal">4901</span>
<span class="normal">4902</span>
<span class="normal">4903</span>
<span class="normal">4904</span>
<span class="normal">4905</span>
<span class="normal">4906</span>
<span class="normal">4907</span>
<span class="normal">4908</span>
<span class="normal">4909</span>
<span class="normal">4910</span>
<span class="normal">4911</span>
<span class="normal">4912</span>
<span class="normal">4913</span>
<span class="normal">4914</span>
<span class="normal">4915</span>
<span class="normal">4916</span>
<span class="normal">4917</span>
<span class="normal">4918</span>
<span class="normal">4919</span>
<span class="normal">4920</span>
<span class="normal">4921</span>
<span class="normal">4922</span>
<span class="normal">4923</span>
<span class="normal">4924</span>
<span class="normal">4925</span>
<span class="normal">4926</span>
<span class="normal">4927</span>
<span class="normal">4928</span>
<span class="normal">4929</span>
<span class="normal">4930</span>
<span class="normal">4931</span>
<span class="normal">4932</span>
<span class="normal">4933</span>
<span class="normal">4934</span>
<span class="normal">4935</span>
<span class="normal">4936</span>
<span class="normal">4937</span>
<span class="normal">4938</span>
<span class="normal">4939</span>
<span class="normal">4940</span>
<span class="normal">4941</span>
<span class="normal">4942</span>
<span class="normal">4943</span>
<span class="normal">4944</span>
<span class="normal">4945</span>
<span class="normal">4946</span>
<span class="normal">4947</span>
<span class="normal">4948</span>
<span class="normal">4949</span>
<span class="normal">4950</span>
<span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span>
<span class="normal">4974</span>
<span class="normal">4975</span>
<span class="normal">4976</span>
<span class="normal">4977</span>
<span class="normal">4978</span>
<span class="normal">4979</span>
<span class="normal">4980</span>
<span class="normal">4981</span>
<span class="normal">4982</span>
<span class="normal">4983</span>
<span class="normal">4984</span>
<span class="normal">4985</span>
<span class="normal">4986</span>
<span class="normal">4987</span>
<span class="normal">4988</span>
<span class="normal">4989</span>
<span class="normal">4990</span>
<span class="normal">4991</span>
<span class="normal">4992</span>
<span class="normal">4993</span>
<span class="normal">4994</span>
<span class="normal">4995</span>
<span class="normal">4996</span>
<span class="normal">4997</span>
<span class="normal">4998</span>
<span class="normal">4999</span>
<span class="normal">5000</span>
<span class="normal">5001</span>
<span class="normal">5002</span>
<span class="normal">5003</span>
<span class="normal">5004</span>
<span class="normal">5005</span>
<span class="normal">5006</span>
<span class="normal">5007</span>
<span class="normal">5008</span>
<span class="normal">5009</span>
<span class="normal">5010</span>
<span class="normal">5011</span>
<span class="normal">5012</span>
<span class="normal">5013</span>
<span class="normal">5014</span>
<span class="normal">5015</span>
<span class="normal">5016</span>
<span class="normal">5017</span>
<span class="normal">5018</span>
<span class="normal">5019</span>
<span class="normal">5020</span>
<span class="normal">5021</span>
<span class="normal">5022</span>
<span class="normal">5023</span>
<span class="normal">5024</span>
<span class="normal">5025</span>
<span class="normal">5026</span>
<span class="normal">5027</span>
<span class="normal">5028</span>
<span class="normal">5029</span>
<span class="normal">5030</span>
<span class="normal">5031</span>
<span class="normal">5032</span>
<span class="normal">5033</span>
<span class="normal">5034</span>
<span class="normal">5035</span>
<span class="normal">5036</span>
<span class="normal">5037</span>
<span class="normal">5038</span>
<span class="normal">5039</span>
<span class="normal">5040</span>
<span class="normal">5041</span>
<span class="normal">5042</span>
<span class="normal">5043</span>
<span class="normal">5044</span>
<span class="normal">5045</span>
<span class="normal">5046</span>
<span class="normal">5047</span>
<span class="normal">5048</span>
<span class="normal">5049</span>
<span class="normal">5050</span>
<span class="normal">5051</span>
<span class="normal">5052</span>
<span class="normal">5053</span>
<span class="normal">5054</span>
<span class="normal">5055</span>
<span class="normal">5056</span>
<span class="normal">5057</span>
<span class="normal">5058</span>
<span class="normal">5059</span>
<span class="normal">5060</span>
<span class="normal">5061</span>
<span class="normal">5062</span>
<span class="normal">5063</span>
<span class="normal">5064</span>
<span class="normal">5065</span>
<span class="normal">5066</span>
<span class="normal">5067</span>
<span class="normal">5068</span>
<span class="normal">5069</span>
<span class="normal">5070</span>
<span class="normal">5071</span>
<span class="normal">5072</span>
<span class="normal">5073</span>
<span class="normal">5074</span>
<span class="normal">5075</span>
<span class="normal">5076</span>
<span class="normal">5077</span>
<span class="normal">5078</span>
<span class="normal">5079</span>
<span class="normal">5080</span>
<span class="normal">5081</span>
<span class="normal">5082</span>
<span class="normal">5083</span>
<span class="normal">5084</span>
<span class="normal">5085</span>
<span class="normal">5086</span>
<span class="normal">5087</span>
<span class="normal">5088</span>
<span class="normal">5089</span>
<span class="normal">5090</span>
<span class="normal">5091</span>
<span class="normal">5092</span>
<span class="normal">5093</span>
<span class="normal">5094</span>
<span class="normal">5095</span>
<span class="normal">5096</span>
<span class="normal">5097</span>
<span class="normal">5098</span>
<span class="normal">5099</span>
<span class="normal">5100</span>
<span class="normal">5101</span>
<span class="normal">5102</span>
<span class="normal">5103</span>
<span class="normal">5104</span>
<span class="normal">5105</span>
<span class="normal">5106</span>
<span class="normal">5107</span>
<span class="normal">5108</span>
<span class="normal">5109</span>
<span class="normal">5110</span>
<span class="normal">5111</span>
<span class="normal">5112</span>
<span class="normal">5113</span>
<span class="normal">5114</span>
<span class="normal">5115</span>
<span class="normal">5116</span>
<span class="normal">5117</span>
<span class="normal">5118</span>
<span class="normal">5119</span>
<span class="normal">5120</span>
<span class="normal">5121</span>
<span class="normal">5122</span>
<span class="normal">5123</span>
<span class="normal">5124</span>
<span class="normal">5125</span>
<span class="normal">5126</span>
<span class="normal">5127</span>
<span class="normal">5128</span>
<span class="normal">5129</span>
<span class="normal">5130</span>
<span class="normal">5131</span>
<span class="normal">5132</span>
<span class="normal">5133</span>
<span class="normal">5134</span>
<span class="normal">5135</span>
<span class="normal">5136</span>
<span class="normal">5137</span>
<span class="normal">5138</span>
<span class="normal">5139</span>
<span class="normal">5140</span>
<span class="normal">5141</span>
<span class="normal">5142</span>
<span class="normal">5143</span>
<span class="normal">5144</span>
<span class="normal">5145</span>
<span class="normal">5146</span>
<span class="normal">5147</span>
<span class="normal">5148</span>
<span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span>
<span class="normal">5155</span>
<span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span>
<span class="normal">5174</span>
<span class="normal">5175</span>
<span class="normal">5176</span>
<span class="normal">5177</span>
<span class="normal">5178</span>
<span class="normal">5179</span>
<span class="normal">5180</span>
<span class="normal">5181</span>
<span class="normal">5182</span>
<span class="normal">5183</span>
<span class="normal">5184</span>
<span class="normal">5185</span>
<span class="normal">5186</span>
<span class="normal">5187</span>
<span class="normal">5188</span>
<span class="normal">5189</span>
<span class="normal">5190</span>
<span class="normal">5191</span>
<span class="normal">5192</span>
<span class="normal">5193</span>
<span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span>
<span class="normal">5209</span>
<span class="normal">5210</span>
<span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span>
<span class="normal">5234</span>
<span class="normal">5235</span>
<span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span>
<span class="normal">5255</span>
<span class="normal">5256</span>
<span class="normal">5257</span>
<span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span>
<span class="normal">5278</span>
<span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span>
<span class="normal">5284</span>
<span class="normal">5285</span>
<span class="normal">5286</span>
<span class="normal">5287</span>
<span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">jonespewsey_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Jones-Pewsey Distribution</span>

<span class="sd">    ![jonespewsey](../images/circ-mod-jonespewsey.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, kappa, psi)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, mu, kappa, psi)</span>
<span class="sd">        Cumulative distribution function.</span>


<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Parameters must be scalar; cached normalisation tables are built per parameter set.</span>
<span class="sd">    Implementation based on Section 4.3.9 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="n">mu_arr</span><span class="p">,</span> <span class="n">kappa_arr</span><span class="p">,</span> <span class="n">psi_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">psi_arr</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">kappa_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_scalar</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">psi_scalar</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">kappa_scalar</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">normalizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_normalizer</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">_c_jonespewsey</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">),</span>
            <span class="n">mu</span><span class="p">,</span>
            <span class="n">kappa_scalar</span><span class="p">,</span>
            <span class="n">psi_scalar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">normalizer</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_scalar</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">normalizer</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa_scalar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">normalizer</span> <span class="o">*</span> <span class="n">_kernel_jonespewsey</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Jones-Pewsey distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = c(\kappa, \psi)</span>
<span class="sd">        \Big(\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \mu)\Big)^{1/\psi},</span>
<span class="sd">        $$</span>

<span class="sd">        where ``c(\kappa, \psi)`` is the normalizing constant, evaluated numerically with</span>
<span class="sd">        stable special-case reductions:</span>

<span class="sd">            - ``c = 1 / (2\pi)`` when ``\kappa`` is effectively zero (uniform limit).</span>
<span class="sd">            - ``c = 1 / (2\pi I_0(\kappa))`` as ``\psi \to 0`` (von Mises limit).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, kappa &gt;= 0.</span>
<span class="sd">        psi : float</span>
<span class="sd">            Shape parameter, -∞ &lt;= psi &lt;= ∞.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">two_pi</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jp_get_series</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive fallback</span>
            <span class="n">cdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_from_pdf</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cdf_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">phi_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">mu_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">phi_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">mu_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jp_series_cumulative</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_start</span><span class="p">]),</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">H_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jp_series_cumulative</span><span class="p">(</span><span class="n">phi_end</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">phi_end</span> <span class="o">&gt;=</span> <span class="n">phi_start</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">H_end</span> <span class="o">-</span> <span class="n">H_start</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">-</span> <span class="n">H_end</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Jones--Pewsey distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        F(\theta)=\frac{\theta-\mu}{2\pi}+\frac{1}{\pi}</span>
<span class="sd">        \sum_{n\ge 1}\frac{\alpha_n(\kappa,\psi)}{n}</span>
<span class="sd">        \sin\bigl(n(\theta-\mu)\bigr),</span>
<span class="sd">        $$</span>
<span class="sd">        where the cosine moments $\alpha_n$ are evaluated through the</span>
<span class="sd">        associated Legendre expression reported by Jones &amp; Pewsey (2005).</span>
<span class="sd">        Coefficients are cached per parameter set and the routine falls back to</span>
<span class="sd">        numerical quadrature only when the series becomes unstable,</span>
<span class="sd">        reproducing the von Mises limit as $\psi \to 0$ and the uniform limit</span>
<span class="sd">        as $\kappa \to 0$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Evaluation points (radians), automatically wrapped onto [0, 2π).</span>
<span class="sd">        mu, kappa, psi : float</span>
<span class="sd">            Jones--Pewsey location, concentration, and shape parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            CDF values matching the shape of x.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>

            <span class="n">boundary_lo</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
            <span class="n">boundary_hi</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
            <span class="n">interior</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_lo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_hi</span><span class="p">)</span>
            <span class="n">theta_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>

            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
                <span class="n">q_int</span> <span class="o">=</span> <span class="n">q_valid</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-15</span>
                <span class="n">q_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q_int</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span><span class="p">:</span>
                    <span class="n">vm</span> <span class="o">=</span> <span class="n">vonmises</span><span class="p">(</span><span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_val</span><span class="p">)</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">vm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q_clipped</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">)</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
                    <span class="n">tol_cdf</span> <span class="o">=</span> <span class="mf">1e-12</span>
                    <span class="n">tol_theta</span> <span class="o">=</span> <span class="mf">1e-10</span>
                    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">8</span>

                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
                        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
                        <span class="p">)</span>
                        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
                        <span class="p">)</span>
                        <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_clipped</span>

                        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
                        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

                        <span class="n">converged</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_theta</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
                            <span class="k">break</span>

                        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">-</span> <span class="n">step</span>
                        <span class="n">midpoint</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">theta_next</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">theta_next</span> <span class="o">&gt;=</span> <span class="n">H</span><span class="p">),</span>
                            <span class="n">midpoint</span><span class="p">,</span>
                            <span class="n">theta_next</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">theta_next</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

                    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="n">q_clipped</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_theta</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                        <span class="n">theta_b</span> <span class="o">=</span> <span class="n">theta_curr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">L_b</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">H_b</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                                <span class="k">break</span>
                            <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">cdf_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">delta_mid</span> <span class="o">=</span> <span class="n">cdf_mid</span> <span class="o">-</span> <span class="n">q_clipped</span>
                            <span class="n">take_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mid</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">take_lower</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">take_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">H_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_upper</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">L_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_lower</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">L_b</span><span class="p">)</span>
                            <span class="n">theta_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">theta_b</span><span class="p">)</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">),</span> <span class="n">theta_b</span><span class="p">)</span>

                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_curr</span>

            <span class="n">result_vals</span> <span class="o">=</span> <span class="n">theta_vals</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_vals</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quantile function of the Jones--Pewsey law.</span>

<span class="sd">        The inverse CDF is obtained by a safeguarded Newton iteration that uses</span>
<span class="sd">        the series-based CDF as the residual and the fully normalised PDF as the</span>
<span class="sd">        slope.  Bracketing and bisection polishing guarantee convergence on the</span>
<span class="sd">        circular interval [0, 2π] while the implementation switches to the</span>
<span class="sd">        closed-form von Mises or uniform solutions in their respective limits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Probabilities in [0, 1].</span>
<span class="sd">        mu, kappa, psi : float</span>
<span class="sd">            Jones--Pewsey parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Quantiles with the same shape as q.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="s2">&quot;mu&quot;</span><span class="p">)</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">))</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size_tuple</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

        <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jp_sampler_envelope</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">filled</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span>
            <span class="n">proposals</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span>
                <span class="n">mu</span><span class="o">=</span><span class="n">mu_val</span><span class="p">,</span>
                <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_env</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">target_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">proposals</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">)</span>
            <span class="n">proposal_vals</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">proposals</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_env</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">proposal_vals</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">target_vals</span> <span class="o">/</span> <span class="p">(</span><span class="n">envelope_const</span> <span class="o">*</span> <span class="n">proposal_vals</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">)</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="n">u</span>
            <span class="n">n_accept</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">filled</span><span class="p">:</span><span class="n">filled</span> <span class="o">+</span> <span class="n">n_accept</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">accept</span><span class="p">][:</span><span class="n">n_accept</span><span class="p">]</span>
                <span class="n">filled</span> <span class="o">+=</span> <span class="n">n_accept</span>

        <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the Jones-Pewsey distribution.</span>

<span class="sd">        A von Mises envelope is tuned to the target density via local curvature</span>
<span class="sd">        matching and a grid-based optimisation, yielding an acceptance-rejection</span>
<span class="sd">        sampler that is both exact and efficient across the parameter space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mu, kappa, psi : float</span>
<span class="sd">            Jones-Pewsey parameters.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Output shape.  When omitted a single draw is returned.</span>
<span class="sd">        random_state : numpy.random.Generator or compatible seed, optional</span>
<span class="sd">            Source of randomness.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            Sample(s) wrapped to [0, 2π).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_jp_sampler_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">psi</span><span class="p">))</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="n">kappa_env</span> <span class="o">=</span> <span class="n">_jp_effective_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="n">phi_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu</span> <span class="o">+</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">target_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta_grid</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="n">log_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">target_vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span> <span class="o">=</span> <span class="n">_optimize_vonmises_envelope</span><span class="p">(</span>
            <span class="n">theta_grid</span><span class="p">,</span>
            <span class="n">log_target</span><span class="p">,</span>
            <span class="n">mu</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">kappa_env</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_jp_get_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">max_harmonics</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">psi</span><span class="p">))</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_size</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span>
        <span class="n">harmonics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_harmonics</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">cos_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">harmonics</span><span class="p">,</span> <span class="n">phi</span><span class="p">))</span>
        <span class="n">cos_coeffs</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">cos_matrix</span> <span class="o">@</span> <span class="n">pdf_vals</span>
        <span class="n">cos_coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">cos_coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cos_coeffs</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">n_idx</span> <span class="o">=</span> <span class="n">harmonics</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">cos_coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">n_idx</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">contributions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coeffs</span> <span class="o">/</span> <span class="n">n_idx</span><span class="p">)</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">5e-12</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">contributions</span> <span class="o">&gt;</span> <span class="n">tol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="n">n_used</span> <span class="o">=</span> <span class="n">n_idx</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeffs_used</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">n_used</span> <span class="o">=</span> <span class="n">n_idx</span><span class="p">[:</span><span class="n">last</span><span class="p">]</span>
            <span class="n">coeffs_used</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[:</span><span class="n">last</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_used</span><span class="p">,</span> <span class="n">coeffs_used</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_jp_series_cumulative</span><span class="p">(</span><span class="n">phi_values</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">phi_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">phi_flat</span> <span class="o">=</span> <span class="n">phi_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">phi_flat</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_idx</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">sin_terms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">phi_flat</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sin_terms</span> <span class="o">@</span> <span class="p">(</span><span class="n">coeffs</span> <span class="o">/</span> <span class="n">n_idx</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">phi_values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_jp_series_skew_integral</span><span class="p">(</span><span class="n">phi_values</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">):</span>
        <span class="n">phi_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">phi_flat</span> <span class="o">=</span> <span class="n">phi_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_flat</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_idx</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">n_arr</span> <span class="o">=</span> <span class="n">n_idx</span>
            <span class="n">coeff_arr</span> <span class="o">=</span> <span class="n">coeffs</span>
            <span class="n">contributions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">phi_flat</span><span class="p">)</span>

            <span class="n">mask_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">n_arr</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_one</span><span class="p">):</span>
                <span class="n">coeff_one</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeff_arr</span><span class="p">[</span><span class="n">mask_one</span><span class="p">]))</span>
                <span class="n">contributions</span> <span class="o">+=</span> <span class="n">coeff_one</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi_flat</span><span class="p">))</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>

            <span class="n">mask_other</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask_one</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_other</span><span class="p">):</span>
                <span class="n">n_other</span> <span class="o">=</span> <span class="n">n_arr</span><span class="p">[</span><span class="n">mask_other</span><span class="p">]</span>
                <span class="n">coeff_other</span> <span class="o">=</span> <span class="n">coeff_arr</span><span class="p">[</span><span class="n">mask_other</span><span class="p">]</span>
                <span class="n">phi_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">phi_flat</span><span class="p">,</span> <span class="n">n_other</span><span class="p">)</span>
                <span class="n">term_plus</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_matrix</span> <span class="o">+</span> <span class="n">phi_flat</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_other</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">term_minus</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_matrix</span> <span class="o">-</span> <span class="n">phi_flat</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_other</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">contributions</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">term_plus</span> <span class="o">-</span> <span class="n">term_minus</span><span class="p">)</span> <span class="o">@</span> <span class="n">coeff_other</span>

            <span class="n">base</span> <span class="o">+=</span> <span class="n">contributions</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">base</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">phi_values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate Jones--Pewsey parameters from data.</span>

<span class="sd">        A moment-based start is built from the sample circular mean</span>
<span class="sd">        μ̂ and resultant length r₁ with the usual von Mises</span>
<span class="sd">        approximation for κ.  The shape parameter ψ is seeded</span>
<span class="sd">        by scanning a coarse grid and the three parameters are then refined via</span>
<span class="sd">        constrained maximum likelihood:</span>

<span class="sd">        ```</span>
<span class="sd">        ℓ(μ, κ, ψ) = Σᵢ wᵢ log( c(κ, ψ) K_JP(θᵢ − μ; κ, ψ) ).</span>
<span class="sd">        ```</span>

<span class="sd">        The normalising constant c is evaluated using the associated</span>
<span class="sd">        Legendre function whenever stable, with numerical quadrature as a</span>
<span class="sd">        fallback.  Set method=&quot;moments&quot; to skip the optimisation and</span>
<span class="sd">        return the analytic seed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample angles (radians), wrapped internally.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to data.</span>
<span class="sd">        method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">            Whether to return the analytic seed or run the numerical MLE.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">        psi_bounds, kappa_bounds : tuple, optional</span>
<span class="sd">            Parameter bounds used by the optimiser.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            Name of the ``scipy.optimize.minimize`` method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple or (tuple, dict)</span>
<span class="sd">            Estimated parameters (mu, kappa, psi) and, optionally,</span>
<span class="sd">            optimisation diagnostics when return_info is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
            <span class="n">mu_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
        <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span> <span class="o">=</span> <span class="n">psi_bounds</span>
        <span class="n">psi_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_low</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_high</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">mu_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

        <span class="n">psi_init</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">psi_grid</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">candidate</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">psi_init</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
        <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;moments&#39; or &#39;mle&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">),</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">best_score</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">,</span> <span class="n">psi_bounds</span><span class="p">]</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;jonespewsey.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">final_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>
            <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">final_nll</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
                <span class="s2">&quot;initial&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Jones-Pewsey distribution.</p>
<div class="arithmatex">\[
f(\theta) = c(\kappa, \psi)
\Big(\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \mu)\Big)^{1/\psi},
\]</div>
<p>where <code>c(\kappa, \psi)</code> is the normalizing constant, evaluated numerically with
stable special-case reductions:</p>
<pre><code>- ``c = 1 / (2\pi)`` when ``\kappa`` is effectively zero (uniform limit).
- ``c = 1 / (2\pi I_0(\kappa))`` as ``\psi \to 0`` (von Mises limit).
</code></pre>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, 0 &lt;= mu &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, kappa &gt;= 0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, -∞ &lt;= psi &lt;= ∞.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4743</span>
<span class="normal">4744</span>
<span class="normal">4745</span>
<span class="normal">4746</span>
<span class="normal">4747</span>
<span class="normal">4748</span>
<span class="normal">4749</span>
<span class="normal">4750</span>
<span class="normal">4751</span>
<span class="normal">4752</span>
<span class="normal">4753</span>
<span class="normal">4754</span>
<span class="normal">4755</span>
<span class="normal">4756</span>
<span class="normal">4757</span>
<span class="normal">4758</span>
<span class="normal">4759</span>
<span class="normal">4760</span>
<span class="normal">4761</span>
<span class="normal">4762</span>
<span class="normal">4763</span>
<span class="normal">4764</span>
<span class="normal">4765</span>
<span class="normal">4766</span>
<span class="normal">4767</span>
<span class="normal">4768</span>
<span class="normal">4769</span>
<span class="normal">4770</span>
<span class="normal">4771</span>
<span class="normal">4772</span>
<span class="normal">4773</span>
<span class="normal">4774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Jones-Pewsey distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = c(\kappa, \psi)</span>
<span class="sd">    \Big(\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \mu)\Big)^{1/\psi},</span>
<span class="sd">    $$</span>

<span class="sd">    where ``c(\kappa, \psi)`` is the normalizing constant, evaluated numerically with</span>
<span class="sd">    stable special-case reductions:</span>

<span class="sd">        - ``c = 1 / (2\pi)`` when ``\kappa`` is effectively zero (uniform limit).</span>
<span class="sd">        - ``c = 1 / (2\pi I_0(\kappa))`` as ``\psi \to 0`` (von Mises limit).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, 0 &lt;= mu &lt;= 2*pi.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, kappa &gt;= 0.</span>
<span class="sd">    psi : float</span>
<span class="sd">        Shape parameter, -∞ &lt;= psi &lt;= ∞.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Jones--Pewsey distribution.</p>
<p>$$
F(\theta)=\frac{\theta-\mu}{2\pi}+\frac{1}{\pi}
\sum_{n\ge 1}\frac{\alpha_n(\kappa,\psi)}{n}
\sin\bigl(n(\theta-\mu)\bigr),
$$
where the cosine moments <span class="arithmatex">\(\alpha_n\)</span> are evaluated through the
associated Legendre expression reported by Jones &amp; Pewsey (2005).
Coefficients are cached per parameter set and the routine falls back to
numerical quadrature only when the series becomes unstable,
reproducing the von Mises limit as <span class="arithmatex">\(\psi \to 0\)</span> and the uniform limit
as <span class="arithmatex">\(\kappa \to 0\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaluation points (radians), automatically wrapped onto [0, 2π).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey location, concentration, and shape parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey location, concentration, and shape parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey location, concentration, and shape parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CDF values matching the shape of x.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4816</span>
<span class="normal">4817</span>
<span class="normal">4818</span>
<span class="normal">4819</span>
<span class="normal">4820</span>
<span class="normal">4821</span>
<span class="normal">4822</span>
<span class="normal">4823</span>
<span class="normal">4824</span>
<span class="normal">4825</span>
<span class="normal">4826</span>
<span class="normal">4827</span>
<span class="normal">4828</span>
<span class="normal">4829</span>
<span class="normal">4830</span>
<span class="normal">4831</span>
<span class="normal">4832</span>
<span class="normal">4833</span>
<span class="normal">4834</span>
<span class="normal">4835</span>
<span class="normal">4836</span>
<span class="normal">4837</span>
<span class="normal">4838</span>
<span class="normal">4839</span>
<span class="normal">4840</span>
<span class="normal">4841</span>
<span class="normal">4842</span>
<span class="normal">4843</span>
<span class="normal">4844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Jones--Pewsey distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    F(\theta)=\frac{\theta-\mu}{2\pi}+\frac{1}{\pi}</span>
<span class="sd">    \sum_{n\ge 1}\frac{\alpha_n(\kappa,\psi)}{n}</span>
<span class="sd">    \sin\bigl(n(\theta-\mu)\bigr),</span>
<span class="sd">    $$</span>
<span class="sd">    where the cosine moments $\alpha_n$ are evaluated through the</span>
<span class="sd">    associated Legendre expression reported by Jones &amp; Pewsey (2005).</span>
<span class="sd">    Coefficients are cached per parameter set and the routine falls back to</span>
<span class="sd">    numerical quadrature only when the series becomes unstable,</span>
<span class="sd">    reproducing the von Mises limit as $\psi \to 0$ and the uniform limit</span>
<span class="sd">    as $\kappa \to 0$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Evaluation points (radians), automatically wrapped onto [0, 2π).</span>
<span class="sd">    mu, kappa, psi : float</span>
<span class="sd">        Jones--Pewsey location, concentration, and shape parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        CDF values matching the shape of x.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Quantile function of the Jones--Pewsey law.</p>
<p>The inverse CDF is obtained by a safeguarded Newton iteration that uses
the series-based CDF as the residual and the fully normalised PDF as the
slope.  Bracketing and bisection polishing guarantee convergence on the
circular interval [0, 2π] while the implementation switches to the
closed-form von Mises or uniform solutions in their respective limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probabilities in [0, 1].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones--Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles with the same shape as q.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4951</span>
<span class="normal">4952</span>
<span class="normal">4953</span>
<span class="normal">4954</span>
<span class="normal">4955</span>
<span class="normal">4956</span>
<span class="normal">4957</span>
<span class="normal">4958</span>
<span class="normal">4959</span>
<span class="normal">4960</span>
<span class="normal">4961</span>
<span class="normal">4962</span>
<span class="normal">4963</span>
<span class="normal">4964</span>
<span class="normal">4965</span>
<span class="normal">4966</span>
<span class="normal">4967</span>
<span class="normal">4968</span>
<span class="normal">4969</span>
<span class="normal">4970</span>
<span class="normal">4971</span>
<span class="normal">4972</span>
<span class="normal">4973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantile function of the Jones--Pewsey law.</span>

<span class="sd">    The inverse CDF is obtained by a safeguarded Newton iteration that uses</span>
<span class="sd">    the series-based CDF as the residual and the fully normalised PDF as the</span>
<span class="sd">    slope.  Bracketing and bisection polishing guarantee convergence on the</span>
<span class="sd">    circular interval [0, 2π] while the implementation switches to the</span>
<span class="sd">    closed-form von Mises or uniform solutions in their respective limits.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Probabilities in [0, 1].</span>
<span class="sd">    mu, kappa, psi : float</span>
<span class="sd">        Jones--Pewsey parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        Quantiles with the same shape as q.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the Jones-Pewsey distribution.</p>
<p>A von Mises envelope is tuned to the target density via local curvature
matching and a grid-based optimisation, yielding an acceptance-rejection
sampler that is both exact and efficient across the parameter space.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones-Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones-Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Jones-Pewsey parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output shape.  When omitted a single draw is returned.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>numpy.random.Generator or compatible seed</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of randomness.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample(s) wrapped to [0, 2π).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5025</span>
<span class="normal">5026</span>
<span class="normal">5027</span>
<span class="normal">5028</span>
<span class="normal">5029</span>
<span class="normal">5030</span>
<span class="normal">5031</span>
<span class="normal">5032</span>
<span class="normal">5033</span>
<span class="normal">5034</span>
<span class="normal">5035</span>
<span class="normal">5036</span>
<span class="normal">5037</span>
<span class="normal">5038</span>
<span class="normal">5039</span>
<span class="normal">5040</span>
<span class="normal">5041</span>
<span class="normal">5042</span>
<span class="normal">5043</span>
<span class="normal">5044</span>
<span class="normal">5045</span>
<span class="normal">5046</span>
<span class="normal">5047</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the Jones-Pewsey distribution.</span>

<span class="sd">    A von Mises envelope is tuned to the target density via local curvature</span>
<span class="sd">    matching and a grid-based optimisation, yielding an acceptance-rejection</span>
<span class="sd">    sampler that is both exact and efficient across the parameter space.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu, kappa, psi : float</span>
<span class="sd">        Jones-Pewsey parameters.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Output shape.  When omitted a single draw is returned.</span>
<span class="sd">    random_state : numpy.random.Generator or compatible seed, optional</span>
<span class="sd">        Source of randomness.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        Sample(s) wrapped to [0, 2π).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate Jones--Pewsey parameters from data.</p>
<p>A moment-based start is built from the sample circular mean
μ̂ and resultant length r₁ with the usual von Mises
approximation for κ.  The shape parameter ψ is seeded
by scanning a coarse grid and the three parameters are then refined via
constrained maximum likelihood:</p>
<pre><code>ℓ(μ, κ, ψ) = Σᵢ wᵢ log( c(κ, ψ) K_JP(θᵢ − μ; κ, ψ) ).
</code></pre>
<p>The normalising constant c is evaluated using the associated
Legendre function whenever stable, with numerical quadrature as a
fallback.  Set method="moments" to skip the optimisation and
return the analytic seed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample angles (radians), wrapped internally.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="moments">moments</span>, <span title="mle">mle</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return the analytic seed or run the numerical MLE.</p>
              </div>
            </td>
            <td>
                  <code>&#34;moments&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True return a diagnostics dictionary alongside the estimates.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds used by the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>(-4.0, 4.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds used by the optimiser.</p>
              </div>
            </td>
            <td>
                  <code>(-4.0, 4.0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the <code>scipy.optimize.minimize</code> method.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span> or (<span title="tuple">tuple</span>, <span title="dict">dict</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated parameters (mu, kappa, psi) and, optionally,
optimisation diagnostics when return_info is True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5148</span>
<span class="normal">5149</span>
<span class="normal">5150</span>
<span class="normal">5151</span>
<span class="normal">5152</span>
<span class="normal">5153</span>
<span class="normal">5154</span>
<span class="normal">5155</span>
<span class="normal">5156</span>
<span class="normal">5157</span>
<span class="normal">5158</span>
<span class="normal">5159</span>
<span class="normal">5160</span>
<span class="normal">5161</span>
<span class="normal">5162</span>
<span class="normal">5163</span>
<span class="normal">5164</span>
<span class="normal">5165</span>
<span class="normal">5166</span>
<span class="normal">5167</span>
<span class="normal">5168</span>
<span class="normal">5169</span>
<span class="normal">5170</span>
<span class="normal">5171</span>
<span class="normal">5172</span>
<span class="normal">5173</span>
<span class="normal">5174</span>
<span class="normal">5175</span>
<span class="normal">5176</span>
<span class="normal">5177</span>
<span class="normal">5178</span>
<span class="normal">5179</span>
<span class="normal">5180</span>
<span class="normal">5181</span>
<span class="normal">5182</span>
<span class="normal">5183</span>
<span class="normal">5184</span>
<span class="normal">5185</span>
<span class="normal">5186</span>
<span class="normal">5187</span>
<span class="normal">5188</span>
<span class="normal">5189</span>
<span class="normal">5190</span>
<span class="normal">5191</span>
<span class="normal">5192</span>
<span class="normal">5193</span>
<span class="normal">5194</span>
<span class="normal">5195</span>
<span class="normal">5196</span>
<span class="normal">5197</span>
<span class="normal">5198</span>
<span class="normal">5199</span>
<span class="normal">5200</span>
<span class="normal">5201</span>
<span class="normal">5202</span>
<span class="normal">5203</span>
<span class="normal">5204</span>
<span class="normal">5205</span>
<span class="normal">5206</span>
<span class="normal">5207</span>
<span class="normal">5208</span>
<span class="normal">5209</span>
<span class="normal">5210</span>
<span class="normal">5211</span>
<span class="normal">5212</span>
<span class="normal">5213</span>
<span class="normal">5214</span>
<span class="normal">5215</span>
<span class="normal">5216</span>
<span class="normal">5217</span>
<span class="normal">5218</span>
<span class="normal">5219</span>
<span class="normal">5220</span>
<span class="normal">5221</span>
<span class="normal">5222</span>
<span class="normal">5223</span>
<span class="normal">5224</span>
<span class="normal">5225</span>
<span class="normal">5226</span>
<span class="normal">5227</span>
<span class="normal">5228</span>
<span class="normal">5229</span>
<span class="normal">5230</span>
<span class="normal">5231</span>
<span class="normal">5232</span>
<span class="normal">5233</span>
<span class="normal">5234</span>
<span class="normal">5235</span>
<span class="normal">5236</span>
<span class="normal">5237</span>
<span class="normal">5238</span>
<span class="normal">5239</span>
<span class="normal">5240</span>
<span class="normal">5241</span>
<span class="normal">5242</span>
<span class="normal">5243</span>
<span class="normal">5244</span>
<span class="normal">5245</span>
<span class="normal">5246</span>
<span class="normal">5247</span>
<span class="normal">5248</span>
<span class="normal">5249</span>
<span class="normal">5250</span>
<span class="normal">5251</span>
<span class="normal">5252</span>
<span class="normal">5253</span>
<span class="normal">5254</span>
<span class="normal">5255</span>
<span class="normal">5256</span>
<span class="normal">5257</span>
<span class="normal">5258</span>
<span class="normal">5259</span>
<span class="normal">5260</span>
<span class="normal">5261</span>
<span class="normal">5262</span>
<span class="normal">5263</span>
<span class="normal">5264</span>
<span class="normal">5265</span>
<span class="normal">5266</span>
<span class="normal">5267</span>
<span class="normal">5268</span>
<span class="normal">5269</span>
<span class="normal">5270</span>
<span class="normal">5271</span>
<span class="normal">5272</span>
<span class="normal">5273</span>
<span class="normal">5274</span>
<span class="normal">5275</span>
<span class="normal">5276</span>
<span class="normal">5277</span>
<span class="normal">5278</span>
<span class="normal">5279</span>
<span class="normal">5280</span>
<span class="normal">5281</span>
<span class="normal">5282</span>
<span class="normal">5283</span>
<span class="normal">5284</span>
<span class="normal">5285</span>
<span class="normal">5286</span>
<span class="normal">5287</span>
<span class="normal">5288</span>
<span class="normal">5289</span>
<span class="normal">5290</span>
<span class="normal">5291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
    <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate Jones--Pewsey parameters from data.</span>

<span class="sd">    A moment-based start is built from the sample circular mean</span>
<span class="sd">    μ̂ and resultant length r₁ with the usual von Mises</span>
<span class="sd">    approximation for κ.  The shape parameter ψ is seeded</span>
<span class="sd">    by scanning a coarse grid and the three parameters are then refined via</span>
<span class="sd">    constrained maximum likelihood:</span>

<span class="sd">    ```</span>
<span class="sd">    ℓ(μ, κ, ψ) = Σᵢ wᵢ log( c(κ, ψ) K_JP(θᵢ − μ; κ, ψ) ).</span>
<span class="sd">    ```</span>

<span class="sd">    The normalising constant c is evaluated using the associated</span>
<span class="sd">    Legendre function whenever stable, with numerical quadrature as a</span>
<span class="sd">    fallback.  Set method=&quot;moments&quot; to skip the optimisation and</span>
<span class="sd">    return the analytic seed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample angles (radians), wrapped internally.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to data.</span>
<span class="sd">    method : {&quot;moments&quot;, &quot;mle&quot;}, optional</span>
<span class="sd">        Whether to return the analytic seed or run the numerical MLE.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True return a diagnostics dictionary alongside the estimates.</span>
<span class="sd">    psi_bounds, kappa_bounds : tuple, optional</span>
<span class="sd">        Parameter bounds used by the optimiser.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        Name of the ``scipy.optimize.minimize`` method.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple or (tuple, dict)</span>
<span class="sd">        Estimated parameters (mu, kappa, psi) and, optionally,</span>
<span class="sd">        optimisation diagnostics when return_info is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">mu_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">):</span>
        <span class="n">mu_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">mu_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
    <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
    <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span> <span class="o">=</span> <span class="n">psi_bounds</span>
    <span class="n">psi_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_low</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_high</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">mu_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">mu_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

    <span class="n">psi_init</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">psi_grid</span><span class="p">:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">candidate</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">psi_init</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;analytical&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;numerical&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
    <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;moments&#39; or &#39;mle&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="n">mu_mom</span><span class="p">),</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">best_score</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">,</span> <span class="n">psi_bounds</span><span class="p">]</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;jonespewsey.fit(method=&#39;mle&#39;) failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">final_nll</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">final_nll</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="s2">&quot;initial&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mu_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.jonespewsey_sineskewed_gen" class="doc doc-heading">
            <code>jonespewsey_sineskewed_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Sine-Skewed Jones-Pewsey Distribution</p>
<p>The Sine-Skewed Jones-Pewsey distribution is a circular distribution defined on <span class="arithmatex">\([0, 2\pi)\)</span>
that extends the Jones-Pewsey family by incorporating a sine-based skewness adjustment.</p>
<p><img alt="jonespewsey-sineskewed" src="../../images/circ-mod-jonespewsey-sineskewed.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, xi, kappa, psi, lmbd, *args, **kwargs) (pycircstat2.distributions.jonespewsey_sineskewed_gen.pdf)" href="#pycircstat2.distributions.jonespewsey_sineskewed_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, xi, kappa, psi, lmbd, *args, **kwargs) (pycircstat2.distributions.jonespewsey_sineskewed_gen.cdf)" href="#pycircstat2.distributions.jonespewsey_sineskewed_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Parameters must be scalar; cached normalisation tables are built per parameter set.
Implementation based on Section 4.3.11 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5467</span>
<span class="normal">5468</span>
<span class="normal">5469</span>
<span class="normal">5470</span>
<span class="normal">5471</span>
<span class="normal">5472</span>
<span class="normal">5473</span>
<span class="normal">5474</span>
<span class="normal">5475</span>
<span class="normal">5476</span>
<span class="normal">5477</span>
<span class="normal">5478</span>
<span class="normal">5479</span>
<span class="normal">5480</span>
<span class="normal">5481</span>
<span class="normal">5482</span>
<span class="normal">5483</span>
<span class="normal">5484</span>
<span class="normal">5485</span>
<span class="normal">5486</span>
<span class="normal">5487</span>
<span class="normal">5488</span>
<span class="normal">5489</span>
<span class="normal">5490</span>
<span class="normal">5491</span>
<span class="normal">5492</span>
<span class="normal">5493</span>
<span class="normal">5494</span>
<span class="normal">5495</span>
<span class="normal">5496</span>
<span class="normal">5497</span>
<span class="normal">5498</span>
<span class="normal">5499</span>
<span class="normal">5500</span>
<span class="normal">5501</span>
<span class="normal">5502</span>
<span class="normal">5503</span>
<span class="normal">5504</span>
<span class="normal">5505</span>
<span class="normal">5506</span>
<span class="normal">5507</span>
<span class="normal">5508</span>
<span class="normal">5509</span>
<span class="normal">5510</span>
<span class="normal">5511</span>
<span class="normal">5512</span>
<span class="normal">5513</span>
<span class="normal">5514</span>
<span class="normal">5515</span>
<span class="normal">5516</span>
<span class="normal">5517</span>
<span class="normal">5518</span>
<span class="normal">5519</span>
<span class="normal">5520</span>
<span class="normal">5521</span>
<span class="normal">5522</span>
<span class="normal">5523</span>
<span class="normal">5524</span>
<span class="normal">5525</span>
<span class="normal">5526</span>
<span class="normal">5527</span>
<span class="normal">5528</span>
<span class="normal">5529</span>
<span class="normal">5530</span>
<span class="normal">5531</span>
<span class="normal">5532</span>
<span class="normal">5533</span>
<span class="normal">5534</span>
<span class="normal">5535</span>
<span class="normal">5536</span>
<span class="normal">5537</span>
<span class="normal">5538</span>
<span class="normal">5539</span>
<span class="normal">5540</span>
<span class="normal">5541</span>
<span class="normal">5542</span>
<span class="normal">5543</span>
<span class="normal">5544</span>
<span class="normal">5545</span>
<span class="normal">5546</span>
<span class="normal">5547</span>
<span class="normal">5548</span>
<span class="normal">5549</span>
<span class="normal">5550</span>
<span class="normal">5551</span>
<span class="normal">5552</span>
<span class="normal">5553</span>
<span class="normal">5554</span>
<span class="normal">5555</span>
<span class="normal">5556</span>
<span class="normal">5557</span>
<span class="normal">5558</span>
<span class="normal">5559</span>
<span class="normal">5560</span>
<span class="normal">5561</span>
<span class="normal">5562</span>
<span class="normal">5563</span>
<span class="normal">5564</span>
<span class="normal">5565</span>
<span class="normal">5566</span>
<span class="normal">5567</span>
<span class="normal">5568</span>
<span class="normal">5569</span>
<span class="normal">5570</span>
<span class="normal">5571</span>
<span class="normal">5572</span>
<span class="normal">5573</span>
<span class="normal">5574</span>
<span class="normal">5575</span>
<span class="normal">5576</span>
<span class="normal">5577</span>
<span class="normal">5578</span>
<span class="normal">5579</span>
<span class="normal">5580</span>
<span class="normal">5581</span>
<span class="normal">5582</span>
<span class="normal">5583</span>
<span class="normal">5584</span>
<span class="normal">5585</span>
<span class="normal">5586</span>
<span class="normal">5587</span>
<span class="normal">5588</span>
<span class="normal">5589</span>
<span class="normal">5590</span>
<span class="normal">5591</span>
<span class="normal">5592</span>
<span class="normal">5593</span>
<span class="normal">5594</span>
<span class="normal">5595</span>
<span class="normal">5596</span>
<span class="normal">5597</span>
<span class="normal">5598</span>
<span class="normal">5599</span>
<span class="normal">5600</span>
<span class="normal">5601</span>
<span class="normal">5602</span>
<span class="normal">5603</span>
<span class="normal">5604</span>
<span class="normal">5605</span>
<span class="normal">5606</span>
<span class="normal">5607</span>
<span class="normal">5608</span>
<span class="normal">5609</span>
<span class="normal">5610</span>
<span class="normal">5611</span>
<span class="normal">5612</span>
<span class="normal">5613</span>
<span class="normal">5614</span>
<span class="normal">5615</span>
<span class="normal">5616</span>
<span class="normal">5617</span>
<span class="normal">5618</span>
<span class="normal">5619</span>
<span class="normal">5620</span>
<span class="normal">5621</span>
<span class="normal">5622</span>
<span class="normal">5623</span>
<span class="normal">5624</span>
<span class="normal">5625</span>
<span class="normal">5626</span>
<span class="normal">5627</span>
<span class="normal">5628</span>
<span class="normal">5629</span>
<span class="normal">5630</span>
<span class="normal">5631</span>
<span class="normal">5632</span>
<span class="normal">5633</span>
<span class="normal">5634</span>
<span class="normal">5635</span>
<span class="normal">5636</span>
<span class="normal">5637</span>
<span class="normal">5638</span>
<span class="normal">5639</span>
<span class="normal">5640</span>
<span class="normal">5641</span>
<span class="normal">5642</span>
<span class="normal">5643</span>
<span class="normal">5644</span>
<span class="normal">5645</span>
<span class="normal">5646</span>
<span class="normal">5647</span>
<span class="normal">5648</span>
<span class="normal">5649</span>
<span class="normal">5650</span>
<span class="normal">5651</span>
<span class="normal">5652</span>
<span class="normal">5653</span>
<span class="normal">5654</span>
<span class="normal">5655</span>
<span class="normal">5656</span>
<span class="normal">5657</span>
<span class="normal">5658</span>
<span class="normal">5659</span>
<span class="normal">5660</span>
<span class="normal">5661</span>
<span class="normal">5662</span>
<span class="normal">5663</span>
<span class="normal">5664</span>
<span class="normal">5665</span>
<span class="normal">5666</span>
<span class="normal">5667</span>
<span class="normal">5668</span>
<span class="normal">5669</span>
<span class="normal">5670</span>
<span class="normal">5671</span>
<span class="normal">5672</span>
<span class="normal">5673</span>
<span class="normal">5674</span>
<span class="normal">5675</span>
<span class="normal">5676</span>
<span class="normal">5677</span>
<span class="normal">5678</span>
<span class="normal">5679</span>
<span class="normal">5680</span>
<span class="normal">5681</span>
<span class="normal">5682</span>
<span class="normal">5683</span>
<span class="normal">5684</span>
<span class="normal">5685</span>
<span class="normal">5686</span>
<span class="normal">5687</span>
<span class="normal">5688</span>
<span class="normal">5689</span>
<span class="normal">5690</span>
<span class="normal">5691</span>
<span class="normal">5692</span>
<span class="normal">5693</span>
<span class="normal">5694</span>
<span class="normal">5695</span>
<span class="normal">5696</span>
<span class="normal">5697</span>
<span class="normal">5698</span>
<span class="normal">5699</span>
<span class="normal">5700</span>
<span class="normal">5701</span>
<span class="normal">5702</span>
<span class="normal">5703</span>
<span class="normal">5704</span>
<span class="normal">5705</span>
<span class="normal">5706</span>
<span class="normal">5707</span>
<span class="normal">5708</span>
<span class="normal">5709</span>
<span class="normal">5710</span>
<span class="normal">5711</span>
<span class="normal">5712</span>
<span class="normal">5713</span>
<span class="normal">5714</span>
<span class="normal">5715</span>
<span class="normal">5716</span>
<span class="normal">5717</span>
<span class="normal">5718</span>
<span class="normal">5719</span>
<span class="normal">5720</span>
<span class="normal">5721</span>
<span class="normal">5722</span>
<span class="normal">5723</span>
<span class="normal">5724</span>
<span class="normal">5725</span>
<span class="normal">5726</span>
<span class="normal">5727</span>
<span class="normal">5728</span>
<span class="normal">5729</span>
<span class="normal">5730</span>
<span class="normal">5731</span>
<span class="normal">5732</span>
<span class="normal">5733</span>
<span class="normal">5734</span>
<span class="normal">5735</span>
<span class="normal">5736</span>
<span class="normal">5737</span>
<span class="normal">5738</span>
<span class="normal">5739</span>
<span class="normal">5740</span>
<span class="normal">5741</span>
<span class="normal">5742</span>
<span class="normal">5743</span>
<span class="normal">5744</span>
<span class="normal">5745</span>
<span class="normal">5746</span>
<span class="normal">5747</span>
<span class="normal">5748</span>
<span class="normal">5749</span>
<span class="normal">5750</span>
<span class="normal">5751</span>
<span class="normal">5752</span>
<span class="normal">5753</span>
<span class="normal">5754</span>
<span class="normal">5755</span>
<span class="normal">5756</span>
<span class="normal">5757</span>
<span class="normal">5758</span>
<span class="normal">5759</span>
<span class="normal">5760</span>
<span class="normal">5761</span>
<span class="normal">5762</span>
<span class="normal">5763</span>
<span class="normal">5764</span>
<span class="normal">5765</span>
<span class="normal">5766</span>
<span class="normal">5767</span>
<span class="normal">5768</span>
<span class="normal">5769</span>
<span class="normal">5770</span>
<span class="normal">5771</span>
<span class="normal">5772</span>
<span class="normal">5773</span>
<span class="normal">5774</span>
<span class="normal">5775</span>
<span class="normal">5776</span>
<span class="normal">5777</span>
<span class="normal">5778</span>
<span class="normal">5779</span>
<span class="normal">5780</span>
<span class="normal">5781</span>
<span class="normal">5782</span>
<span class="normal">5783</span>
<span class="normal">5784</span>
<span class="normal">5785</span>
<span class="normal">5786</span>
<span class="normal">5787</span>
<span class="normal">5788</span>
<span class="normal">5789</span>
<span class="normal">5790</span>
<span class="normal">5791</span>
<span class="normal">5792</span>
<span class="normal">5793</span>
<span class="normal">5794</span>
<span class="normal">5795</span>
<span class="normal">5796</span>
<span class="normal">5797</span>
<span class="normal">5798</span>
<span class="normal">5799</span>
<span class="normal">5800</span>
<span class="normal">5801</span>
<span class="normal">5802</span>
<span class="normal">5803</span>
<span class="normal">5804</span>
<span class="normal">5805</span>
<span class="normal">5806</span>
<span class="normal">5807</span>
<span class="normal">5808</span>
<span class="normal">5809</span>
<span class="normal">5810</span>
<span class="normal">5811</span>
<span class="normal">5812</span>
<span class="normal">5813</span>
<span class="normal">5814</span>
<span class="normal">5815</span>
<span class="normal">5816</span>
<span class="normal">5817</span>
<span class="normal">5818</span>
<span class="normal">5819</span>
<span class="normal">5820</span>
<span class="normal">5821</span>
<span class="normal">5822</span>
<span class="normal">5823</span>
<span class="normal">5824</span>
<span class="normal">5825</span>
<span class="normal">5826</span>
<span class="normal">5827</span>
<span class="normal">5828</span>
<span class="normal">5829</span>
<span class="normal">5830</span>
<span class="normal">5831</span>
<span class="normal">5832</span>
<span class="normal">5833</span>
<span class="normal">5834</span>
<span class="normal">5835</span>
<span class="normal">5836</span>
<span class="normal">5837</span>
<span class="normal">5838</span>
<span class="normal">5839</span>
<span class="normal">5840</span>
<span class="normal">5841</span>
<span class="normal">5842</span>
<span class="normal">5843</span>
<span class="normal">5844</span>
<span class="normal">5845</span>
<span class="normal">5846</span>
<span class="normal">5847</span>
<span class="normal">5848</span>
<span class="normal">5849</span>
<span class="normal">5850</span>
<span class="normal">5851</span>
<span class="normal">5852</span>
<span class="normal">5853</span>
<span class="normal">5854</span>
<span class="normal">5855</span>
<span class="normal">5856</span>
<span class="normal">5857</span>
<span class="normal">5858</span>
<span class="normal">5859</span>
<span class="normal">5860</span>
<span class="normal">5861</span>
<span class="normal">5862</span>
<span class="normal">5863</span>
<span class="normal">5864</span>
<span class="normal">5865</span>
<span class="normal">5866</span>
<span class="normal">5867</span>
<span class="normal">5868</span>
<span class="normal">5869</span>
<span class="normal">5870</span>
<span class="normal">5871</span>
<span class="normal">5872</span>
<span class="normal">5873</span>
<span class="normal">5874</span>
<span class="normal">5875</span>
<span class="normal">5876</span>
<span class="normal">5877</span>
<span class="normal">5878</span>
<span class="normal">5879</span>
<span class="normal">5880</span>
<span class="normal">5881</span>
<span class="normal">5882</span>
<span class="normal">5883</span>
<span class="normal">5884</span>
<span class="normal">5885</span>
<span class="normal">5886</span>
<span class="normal">5887</span>
<span class="normal">5888</span>
<span class="normal">5889</span>
<span class="normal">5890</span>
<span class="normal">5891</span>
<span class="normal">5892</span>
<span class="normal">5893</span>
<span class="normal">5894</span>
<span class="normal">5895</span>
<span class="normal">5896</span>
<span class="normal">5897</span>
<span class="normal">5898</span>
<span class="normal">5899</span>
<span class="normal">5900</span>
<span class="normal">5901</span>
<span class="normal">5902</span>
<span class="normal">5903</span>
<span class="normal">5904</span>
<span class="normal">5905</span>
<span class="normal">5906</span>
<span class="normal">5907</span>
<span class="normal">5908</span>
<span class="normal">5909</span>
<span class="normal">5910</span>
<span class="normal">5911</span>
<span class="normal">5912</span>
<span class="normal">5913</span>
<span class="normal">5914</span>
<span class="normal">5915</span>
<span class="normal">5916</span>
<span class="normal">5917</span>
<span class="normal">5918</span>
<span class="normal">5919</span>
<span class="normal">5920</span>
<span class="normal">5921</span>
<span class="normal">5922</span>
<span class="normal">5923</span>
<span class="normal">5924</span>
<span class="normal">5925</span>
<span class="normal">5926</span>
<span class="normal">5927</span>
<span class="normal">5928</span>
<span class="normal">5929</span>
<span class="normal">5930</span>
<span class="normal">5931</span>
<span class="normal">5932</span>
<span class="normal">5933</span>
<span class="normal">5934</span>
<span class="normal">5935</span>
<span class="normal">5936</span>
<span class="normal">5937</span>
<span class="normal">5938</span>
<span class="normal">5939</span>
<span class="normal">5940</span>
<span class="normal">5941</span>
<span class="normal">5942</span>
<span class="normal">5943</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">jonespewsey_sineskewed_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sine-Skewed Jones-Pewsey Distribution</span>

<span class="sd">    The Sine-Skewed Jones-Pewsey distribution is a circular distribution defined on $[0, 2\pi)$</span>
<span class="sd">    that extends the Jones-Pewsey family by incorporating a sine-based skewness adjustment.</span>

<span class="sd">    ![jonespewsey-sineskewed](../images/circ-mod-jonespewsey-sineskewed.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, xi, kappa, psi, lmbd)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, xi, kappa, psi, lmbd)</span>
<span class="sd">        Cumulative distribution function.</span>


<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Parameters must be scalar; cached normalisation tables are built per parameter set.</span>
<span class="sd">    Implementation based on Section 4.3.11 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">xi_arr</span><span class="p">,</span> <span class="n">kappa_arr</span><span class="p">,</span> <span class="n">psi_arr</span><span class="p">,</span> <span class="n">lmbd_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">psi_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lmbd_arr</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lmbd_arr</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">xi_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">lmbd_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">kappa_scalar</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd_scalar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi_scalar</span><span class="p">))</span>

        <span class="n">normalizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_normalizer</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">_c_jonespewsey</span><span class="p">(</span><span class="n">xi_scalar</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">),</span>
            <span class="n">xi_scalar</span><span class="p">,</span>
            <span class="n">kappa_scalar</span><span class="p">,</span>
            <span class="n">psi_scalar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">normalizer</span>

        <span class="n">base</span> <span class="o">=</span> <span class="n">_kernel_jonespewsey</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_scalar</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalizer</span> <span class="o">*</span> <span class="n">base</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd_scalar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi_scalar</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Sine-Skewed Jones-Pewsey distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = c(\kappa,\psi)\Bigl(\cosh(\kappa\psi)+</span>
<span class="sd">        \sinh(\kappa\psi)\cos(\theta-\xi)\Bigr)^{1/\psi}</span>
<span class="sd">        \bigl(1+\lambda \sin(\theta-\xi)\bigr).</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter (generally not the mean), 0 &lt;= ξ &lt;= 2*pi.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, κ &gt;= 0. Higher values indicate a sharper peak.</span>
<span class="sd">        psi : float</span>
<span class="sd">            Shape parameter, -∞ &lt;= ψ &lt;= ∞. When ψ=-1, the distribution reduces to the wrapped Cauchy,</span>
<span class="sd">            when ψ=0, von Mises, and when ψ=1, cardioid.</span>
<span class="sd">        lmbd : float</span>
<span class="sd">            Skewness parameter, -1 &lt; λ &lt; 1. Controls the asymmetry introduced by the sine-skewing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values: float</span>
<span class="sd">            Values of the probability density function at the specified points.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">xi_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">/</span> <span class="n">two_pi</span>
            <span class="n">skew</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">cdf</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">lmbd_val</span> <span class="o">*</span> <span class="n">skew</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="n">psi_val</span><span class="p">)</span>

        <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">_jp_get_series</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">)</span>

        <span class="n">phi_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">xi_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">phi_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">xi_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jonespewsey</span><span class="o">.</span><span class="n">_jp_series_cumulative</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_start</span><span class="p">]),</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">H_end</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">_jp_series_cumulative</span><span class="p">(</span><span class="n">phi_end</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">J_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jonespewsey</span><span class="o">.</span><span class="n">_jp_series_skew_integral</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">phi_start</span><span class="p">]),</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">J_end</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">_jp_series_skew_integral</span><span class="p">(</span><span class="n">phi_end</span><span class="p">,</span> <span class="n">n_idx</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">J_start</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">J_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">H_end</span><span class="p">)</span>

        <span class="n">base_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">phi_end</span> <span class="o">&gt;=</span> <span class="n">phi_start</span><span class="p">,</span>
            <span class="n">H_end</span> <span class="o">-</span> <span class="n">H_start</span><span class="p">,</span>
            <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">-</span> <span class="n">H_end</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">skew_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">phi_end</span> <span class="o">&gt;=</span> <span class="n">phi_start</span><span class="p">,</span>
            <span class="n">J_end</span> <span class="o">-</span> <span class="n">J_start</span><span class="p">,</span>
            <span class="o">-</span><span class="p">(</span><span class="n">J_start</span> <span class="o">-</span> <span class="n">J_end</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">base_cdf</span> <span class="o">+</span> <span class="n">lmbd_val</span> <span class="o">*</span> <span class="n">skew_cdf</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the sine-skewed Jones--Pewsey law.</span>

<span class="sd">        No closed form is available; the implementation integrates the PDF on</span>
<span class="sd">        [0, 2π) using adaptive quadrature, honouring the symmetric JP and</span>
<span class="sd">        uniform limits when ``lambda`` or ``kappa`` approach zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
            <span class="n">boundary_lo</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
            <span class="n">boundary_hi</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
            <span class="n">interior</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_lo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_hi</span><span class="p">)</span>
            <span class="n">theta_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
                <span class="n">q_int</span> <span class="o">=</span> <span class="n">q_valid</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-15</span>
                <span class="n">q_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q_int</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                        <span class="n">q_clipped</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="n">psi_val</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">)</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
                    <span class="n">tol_cdf</span> <span class="o">=</span> <span class="mf">1e-12</span>
                    <span class="n">tol_theta</span> <span class="o">=</span> <span class="mf">1e-10</span>
                    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">8</span>

                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
                        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_clipped</span>
                        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
                        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

                        <span class="n">converged</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_theta</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
                            <span class="k">break</span>

                        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">-</span> <span class="n">step</span>
                        <span class="n">midpoint</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">theta_next</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">theta_next</span> <span class="o">&gt;=</span> <span class="n">H</span><span class="p">),</span>
                            <span class="n">midpoint</span><span class="p">,</span>
                            <span class="n">theta_next</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">theta_next</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

                    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="n">q_clipped</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_theta</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                        <span class="n">theta_b</span> <span class="o">=</span> <span class="n">theta_curr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">L_b</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">H_b</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                                <span class="k">break</span>
                            <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">cdf_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">delta_mid</span> <span class="o">=</span> <span class="n">cdf_mid</span> <span class="o">-</span> <span class="n">q_clipped</span>
                            <span class="n">take_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mid</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">take_lower</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">take_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">H_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_upper</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">L_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_lower</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">L_b</span><span class="p">)</span>
                            <span class="n">theta_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">theta_b</span><span class="p">)</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">),</span> <span class="n">theta_b</span><span class="p">)</span>

                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_curr</span>

            <span class="n">result_vals</span> <span class="o">=</span> <span class="n">theta_vals</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_vals</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quantile function of the sine-skewed Jones--Pewsey distribution.</span>

<span class="sd">        The solver mirrors the symmetric JP inverse CDF while reusing the</span>
<span class="sd">        skew-aware CDF so that round-trip accuracy is preserved even for large</span>
<span class="sd">        skewness.  Uniform and purely symmetric edge cases are delegated to the</span>
<span class="sd">        corresponding closed forms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;|lmbd| must be &lt; 1 for sine-skewed Jones-Pewsey.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">))</span>

        <span class="n">base_dist</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="p">(</span><span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="n">psi_val</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">)</span>
        <span class="n">weights_max</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">filled</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span>
            <span class="n">proposals</span> <span class="o">=</span> <span class="n">base_dist</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">accept_prob</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">proposals</span> <span class="o">-</span> <span class="n">xi_val</span><span class="p">))</span> <span class="o">/</span> <span class="n">weights_max</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">)</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="n">accept_prob</span>
            <span class="n">n_accept</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">filled</span><span class="p">:</span><span class="n">filled</span> <span class="o">+</span> <span class="n">n_accept</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">accept</span><span class="p">][:</span><span class="n">n_accept</span><span class="p">]</span>
                <span class="n">filled</span> <span class="o">+=</span> <span class="n">n_accept</span>

        <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the sine-skewed Jones--Pewsey distribution.</span>

<span class="sd">        Sampling follows the acceptance-rejection construction of Abe &amp; Pewsey</span>
<span class="sd">        (2011): draw from the symmetric JP base and accept with probability</span>
<span class="sd">        $$\frac{1 + \lambda \sin\phi}{1 + |\lambda|}.$$  This scheme is exact,</span>
<span class="sd">        automatically respects the skew symmetry, and retains the base</span>
<span class="sd">        sampler&#39;s efficiency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;two-step&quot;</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">refine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
        <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate sine-skewed JP parameters via a two-step maximum likelihood fit.</span>

<span class="sd">        1. Fit the symmetric JP base (xi, kappa, psi) using the MLE routine.</span>
<span class="sd">        2. Maximise the weighted log term sum log(1 + lambda sin(theta_i - xi)).</span>
<span class="sd">        3. Optionally refine all four parameters jointly (set refine=True).</span>

<span class="sd">        The acceptance-rejection sampler used for the skewed density makes the</span>
<span class="sd">        likelihood well behaved across |lambda| &lt; 1, while moment starts ensure</span>
<span class="sd">        stability near the uniform limit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">base_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">base_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">base_kwargs</span><span class="p">)</span>
        <span class="n">base_estimates</span><span class="p">,</span> <span class="n">base_info</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="n">psi_bounds</span><span class="o">=</span><span class="n">psi_bounds</span><span class="p">,</span>
            <span class="n">kappa_bounds</span><span class="o">=</span><span class="n">kappa_bounds</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">base_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span> <span class="o">=</span> <span class="n">base_estimates</span>

        <span class="n">lam_low</span><span class="p">,</span> <span class="n">lam_high</span> <span class="o">=</span> <span class="n">lmbd_bounds</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">lambda_nll</span><span class="p">(</span><span class="n">lmbd</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lam_low</span> <span class="o">&lt;</span> <span class="n">lmbd</span> <span class="o">&lt;</span> <span class="n">lam_high</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi_hat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>

        <span class="n">lambda_result</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
            <span class="n">lambda_nll</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">lmbd_bounds</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bounded&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lambda_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to estimate skewness parameter `lmbd`.&quot;</span><span class="p">)</span>
        <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lambda_result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lam_low</span><span class="p">,</span> <span class="n">lam_high</span><span class="p">))</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;twostep&quot;</span><span class="p">:</span> <span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;two_step&quot;</span><span class="p">:</span> <span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
        <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;two-step&#39; or &#39;mle&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
            <span class="n">refine</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="n">base_info</span><span class="p">,</span>
            <span class="s2">&quot;lambda_opt&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lambda_result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lambda_result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lambda_result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">kappa_bounds</span><span class="p">,</span>
                <span class="n">psi_bounds</span><span class="p">,</span>
                <span class="n">lmbd_bounds</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">total_nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">lmbd_param</span> <span class="o">=</span> <span class="n">params</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lmbd_param</span> <span class="o">&lt;</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">lmbd_param</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

            <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">total_nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Sine-skewed JP fit refinement failed: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;refinement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">final_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
        <span class="n">loglik</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">final_pdf</span><span class="p">)))</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">loglik</span><span class="p">,</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method_key</span><span class="p">,</span>
                    <span class="s2">&quot;estimates&quot;</span><span class="p">:</span> <span class="n">estimates</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_sineskewed_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Sine-Skewed Jones-Pewsey distribution.</p>
<div class="arithmatex">\[
f(\theta) = c(\kappa,\psi)\Bigl(\cosh(\kappa\psi)+
\sinh(\kappa\psi)\cos(\theta-\xi)\Bigr)^{1/\psi}
\bigl(1+\lambda \sin(\theta-\xi)\bigr).
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter (generally not the mean), 0 &lt;= ξ &lt;= 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, κ &gt;= 0. Higher values indicate a sharper peak.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, -∞ &lt;= ψ &lt;= ∞. When ψ=-1, the distribution reduces to the wrapped Cauchy,
when ψ=0, von Mises, and when ψ=1, cardioid.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, -1 &lt; λ &lt; 1. Controls the asymmetry introduced by the sine-skewing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the probability density function at the specified points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5529</span>
<span class="normal">5530</span>
<span class="normal">5531</span>
<span class="normal">5532</span>
<span class="normal">5533</span>
<span class="normal">5534</span>
<span class="normal">5535</span>
<span class="normal">5536</span>
<span class="normal">5537</span>
<span class="normal">5538</span>
<span class="normal">5539</span>
<span class="normal">5540</span>
<span class="normal">5541</span>
<span class="normal">5542</span>
<span class="normal">5543</span>
<span class="normal">5544</span>
<span class="normal">5545</span>
<span class="normal">5546</span>
<span class="normal">5547</span>
<span class="normal">5548</span>
<span class="normal">5549</span>
<span class="normal">5550</span>
<span class="normal">5551</span>
<span class="normal">5552</span>
<span class="normal">5553</span>
<span class="normal">5554</span>
<span class="normal">5555</span>
<span class="normal">5556</span>
<span class="normal">5557</span>
<span class="normal">5558</span>
<span class="normal">5559</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Sine-Skewed Jones-Pewsey distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = c(\kappa,\psi)\Bigl(\cosh(\kappa\psi)+</span>
<span class="sd">    \sinh(\kappa\psi)\cos(\theta-\xi)\Bigr)^{1/\psi}</span>
<span class="sd">    \bigl(1+\lambda \sin(\theta-\xi)\bigr).</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter (generally not the mean), 0 &lt;= ξ &lt;= 2*pi.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, κ &gt;= 0. Higher values indicate a sharper peak.</span>
<span class="sd">    psi : float</span>
<span class="sd">        Shape parameter, -∞ &lt;= ψ &lt;= ∞. When ψ=-1, the distribution reduces to the wrapped Cauchy,</span>
<span class="sd">        when ψ=0, von Mises, and when ψ=1, cardioid.</span>
<span class="sd">    lmbd : float</span>
<span class="sd">        Skewness parameter, -1 &lt; λ &lt; 1. Controls the asymmetry introduced by the sine-skewing.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values: float</span>
<span class="sd">        Values of the probability density function at the specified points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_sineskewed_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the sine-skewed Jones--Pewsey law.</p>
<p>No closed form is available; the implementation integrates the PDF on
[0, 2π) using adaptive quadrature, honouring the symmetric JP and
uniform limits when <code>lambda</code> or <code>kappa</code> approach zero.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5615</span>
<span class="normal">5616</span>
<span class="normal">5617</span>
<span class="normal">5618</span>
<span class="normal">5619</span>
<span class="normal">5620</span>
<span class="normal">5621</span>
<span class="normal">5622</span>
<span class="normal">5623</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the sine-skewed Jones--Pewsey law.</span>

<span class="sd">    No closed form is available; the implementation integrates the PDF on</span>
<span class="sd">    [0, 2π) using adaptive quadrature, honouring the symmetric JP and</span>
<span class="sd">    uniform limits when ``lambda`` or ``kappa`` approach zero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_sineskewed_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Quantile function of the sine-skewed Jones--Pewsey distribution.</p>
<p>The solver mirrors the symmetric JP inverse CDF while reusing the
skew-aware CDF so that round-trip accuracy is preserved even for large
skewness.  Uniform and purely symmetric edge cases are delegated to the
corresponding closed forms.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5731</span>
<span class="normal">5732</span>
<span class="normal">5733</span>
<span class="normal">5734</span>
<span class="normal">5735</span>
<span class="normal">5736</span>
<span class="normal">5737</span>
<span class="normal">5738</span>
<span class="normal">5739</span>
<span class="normal">5740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantile function of the sine-skewed Jones--Pewsey distribution.</span>

<span class="sd">    The solver mirrors the symmetric JP inverse CDF while reusing the</span>
<span class="sd">    skew-aware CDF so that round-trip accuracy is preserved even for large</span>
<span class="sd">    skewness.  Uniform and purely symmetric edge cases are delegated to the</span>
<span class="sd">    corresponding closed forms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_sineskewed_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the sine-skewed Jones--Pewsey distribution.</p>
<p>Sampling follows the acceptance-rejection construction of Abe &amp; Pewsey
(2011): draw from the symmetric JP base and accept with probability
<span class="arithmatex">\(<span class="arithmatex">\(\frac{1 + \lambda \sin\phi}{1 + |\lambda|}.\)</span>\)</span>  This scheme is exact,
automatically respects the skew symmetry, and retains the base
sampler's efficiency.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5781</span>
<span class="normal">5782</span>
<span class="normal">5783</span>
<span class="normal">5784</span>
<span class="normal">5785</span>
<span class="normal">5786</span>
<span class="normal">5787</span>
<span class="normal">5788</span>
<span class="normal">5789</span>
<span class="normal">5790</span>
<span class="normal">5791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the sine-skewed Jones--Pewsey distribution.</span>

<span class="sd">    Sampling follows the acceptance-rejection construction of Abe &amp; Pewsey</span>
<span class="sd">    (2011): draw from the symmetric JP base and accept with probability</span>
<span class="sd">    $$\frac{1 + \lambda \sin\phi}{1 + |\lambda|}.$$  This scheme is exact,</span>
<span class="sd">    automatically respects the skew symmetry, and retains the base</span>
<span class="sd">    sampler&#39;s efficiency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_sineskewed_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;two-step&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">refine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate sine-skewed JP parameters via a two-step maximum likelihood fit.</p>
<ol>
<li>Fit the symmetric JP base (xi, kappa, psi) using the MLE routine.</li>
<li>Maximise the weighted log term sum log(1 + lambda sin(theta_i - xi)).</li>
<li>Optionally refine all four parameters jointly (set refine=True).</li>
</ol>
<p>The acceptance-rejection sampler used for the skewed density makes the
likelihood well behaved across |lambda| &lt; 1, while moment starts ensure
stability near the uniform limit.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5793</span>
<span class="normal">5794</span>
<span class="normal">5795</span>
<span class="normal">5796</span>
<span class="normal">5797</span>
<span class="normal">5798</span>
<span class="normal">5799</span>
<span class="normal">5800</span>
<span class="normal">5801</span>
<span class="normal">5802</span>
<span class="normal">5803</span>
<span class="normal">5804</span>
<span class="normal">5805</span>
<span class="normal">5806</span>
<span class="normal">5807</span>
<span class="normal">5808</span>
<span class="normal">5809</span>
<span class="normal">5810</span>
<span class="normal">5811</span>
<span class="normal">5812</span>
<span class="normal">5813</span>
<span class="normal">5814</span>
<span class="normal">5815</span>
<span class="normal">5816</span>
<span class="normal">5817</span>
<span class="normal">5818</span>
<span class="normal">5819</span>
<span class="normal">5820</span>
<span class="normal">5821</span>
<span class="normal">5822</span>
<span class="normal">5823</span>
<span class="normal">5824</span>
<span class="normal">5825</span>
<span class="normal">5826</span>
<span class="normal">5827</span>
<span class="normal">5828</span>
<span class="normal">5829</span>
<span class="normal">5830</span>
<span class="normal">5831</span>
<span class="normal">5832</span>
<span class="normal">5833</span>
<span class="normal">5834</span>
<span class="normal">5835</span>
<span class="normal">5836</span>
<span class="normal">5837</span>
<span class="normal">5838</span>
<span class="normal">5839</span>
<span class="normal">5840</span>
<span class="normal">5841</span>
<span class="normal">5842</span>
<span class="normal">5843</span>
<span class="normal">5844</span>
<span class="normal">5845</span>
<span class="normal">5846</span>
<span class="normal">5847</span>
<span class="normal">5848</span>
<span class="normal">5849</span>
<span class="normal">5850</span>
<span class="normal">5851</span>
<span class="normal">5852</span>
<span class="normal">5853</span>
<span class="normal">5854</span>
<span class="normal">5855</span>
<span class="normal">5856</span>
<span class="normal">5857</span>
<span class="normal">5858</span>
<span class="normal">5859</span>
<span class="normal">5860</span>
<span class="normal">5861</span>
<span class="normal">5862</span>
<span class="normal">5863</span>
<span class="normal">5864</span>
<span class="normal">5865</span>
<span class="normal">5866</span>
<span class="normal">5867</span>
<span class="normal">5868</span>
<span class="normal">5869</span>
<span class="normal">5870</span>
<span class="normal">5871</span>
<span class="normal">5872</span>
<span class="normal">5873</span>
<span class="normal">5874</span>
<span class="normal">5875</span>
<span class="normal">5876</span>
<span class="normal">5877</span>
<span class="normal">5878</span>
<span class="normal">5879</span>
<span class="normal">5880</span>
<span class="normal">5881</span>
<span class="normal">5882</span>
<span class="normal">5883</span>
<span class="normal">5884</span>
<span class="normal">5885</span>
<span class="normal">5886</span>
<span class="normal">5887</span>
<span class="normal">5888</span>
<span class="normal">5889</span>
<span class="normal">5890</span>
<span class="normal">5891</span>
<span class="normal">5892</span>
<span class="normal">5893</span>
<span class="normal">5894</span>
<span class="normal">5895</span>
<span class="normal">5896</span>
<span class="normal">5897</span>
<span class="normal">5898</span>
<span class="normal">5899</span>
<span class="normal">5900</span>
<span class="normal">5901</span>
<span class="normal">5902</span>
<span class="normal">5903</span>
<span class="normal">5904</span>
<span class="normal">5905</span>
<span class="normal">5906</span>
<span class="normal">5907</span>
<span class="normal">5908</span>
<span class="normal">5909</span>
<span class="normal">5910</span>
<span class="normal">5911</span>
<span class="normal">5912</span>
<span class="normal">5913</span>
<span class="normal">5914</span>
<span class="normal">5915</span>
<span class="normal">5916</span>
<span class="normal">5917</span>
<span class="normal">5918</span>
<span class="normal">5919</span>
<span class="normal">5920</span>
<span class="normal">5921</span>
<span class="normal">5922</span>
<span class="normal">5923</span>
<span class="normal">5924</span>
<span class="normal">5925</span>
<span class="normal">5926</span>
<span class="normal">5927</span>
<span class="normal">5928</span>
<span class="normal">5929</span>
<span class="normal">5930</span>
<span class="normal">5931</span>
<span class="normal">5932</span>
<span class="normal">5933</span>
<span class="normal">5934</span>
<span class="normal">5935</span>
<span class="normal">5936</span>
<span class="normal">5937</span>
<span class="normal">5938</span>
<span class="normal">5939</span>
<span class="normal">5940</span>
<span class="normal">5941</span>
<span class="normal">5942</span>
<span class="normal">5943</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;two-step&quot;</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="n">refine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
    <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
    <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate sine-skewed JP parameters via a two-step maximum likelihood fit.</span>

<span class="sd">    1. Fit the symmetric JP base (xi, kappa, psi) using the MLE routine.</span>
<span class="sd">    2. Maximise the weighted log term sum log(1 + lambda sin(theta_i - xi)).</span>
<span class="sd">    3. Optionally refine all four parameters jointly (set refine=True).</span>

<span class="sd">    The acceptance-rejection sampler used for the skewed density makes the</span>
<span class="sd">    likelihood well behaved across |lambda| &lt; 1, while moment starts ensure</span>
<span class="sd">    stability near the uniform limit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">base_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">base_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">base_kwargs</span><span class="p">)</span>
    <span class="n">base_estimates</span><span class="p">,</span> <span class="n">base_info</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="o">=</span><span class="n">psi_bounds</span><span class="p">,</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="n">kappa_bounds</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">base_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span> <span class="o">=</span> <span class="n">base_estimates</span>

    <span class="n">lam_low</span><span class="p">,</span> <span class="n">lam_high</span> <span class="o">=</span> <span class="n">lmbd_bounds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">lambda_nll</span><span class="p">(</span><span class="n">lmbd</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lam_low</span> <span class="o">&lt;</span> <span class="n">lmbd</span> <span class="o">&lt;</span> <span class="n">lam_high</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>

    <span class="n">lambda_result</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span>
        <span class="n">lambda_nll</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">lmbd_bounds</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bounded&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lambda_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to estimate skewness parameter `lmbd`.&quot;</span><span class="p">)</span>
    <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lambda_result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">lam_low</span><span class="p">,</span> <span class="n">lam_high</span><span class="p">))</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;twostep&quot;</span><span class="p">:</span> <span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;two_step&quot;</span><span class="p">:</span> <span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">}</span>
    <span class="n">method_key</span> <span class="o">=</span> <span class="n">alias</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method_key</span><span class="p">,</span> <span class="n">method_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">method_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;two-step&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be either &#39;two-step&#39; or &#39;mle&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method_key</span> <span class="o">==</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="n">base_info</span><span class="p">,</span>
        <span class="s2">&quot;lambda_opt&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lambda_result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lambda_result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">lambda_result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="n">kappa_bounds</span><span class="p">,</span>
            <span class="n">psi_bounds</span><span class="p">,</span>
            <span class="n">lmbd_bounds</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">total_nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">lmbd_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lmbd_param</span> <span class="o">&lt;</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">lmbd_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">total_nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Sine-skewed JP fit refinement failed: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">psi_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;refinement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">final_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
    <span class="n">loglik</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">final_pdf</span><span class="p">)))</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">loglik</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method_key</span><span class="p">,</span>
                <span class="s2">&quot;estimates&quot;</span><span class="p">:</span> <span class="n">estimates</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.jonespewsey_asym_gen" class="doc doc-heading">
            <code>jonespewsey_asym_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Asymmetric Extended Jones-Pewsey Distribution</p>
<p>This distribution is an extension of the Jones-Pewsey family, incorporating asymmetry
through a secondary parameter <span class="arithmatex">\(\nu\)</span>. It is defined on the circular domain <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
<p><img alt="jonespewsey-asymext" src="../../images/circ-mod-jonespewsey-asym.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, xi, kappa, psi, nu, *args, **kwargs) (pycircstat2.distributions.jonespewsey_asym_gen.pdf)" href="#pycircstat2.distributions.jonespewsey_asym_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, xi, kappa, psi, nu, *args, **kwargs) (pycircstat2.distributions.jonespewsey_asym_gen.cdf)" href="#pycircstat2.distributions.jonespewsey_asym_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Parameters must be scalar; cached normalisation tables are built per parameter set.
Implementation from 4.3.12 of Pewsey et al. (2014)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5953</span>
<span class="normal">5954</span>
<span class="normal">5955</span>
<span class="normal">5956</span>
<span class="normal">5957</span>
<span class="normal">5958</span>
<span class="normal">5959</span>
<span class="normal">5960</span>
<span class="normal">5961</span>
<span class="normal">5962</span>
<span class="normal">5963</span>
<span class="normal">5964</span>
<span class="normal">5965</span>
<span class="normal">5966</span>
<span class="normal">5967</span>
<span class="normal">5968</span>
<span class="normal">5969</span>
<span class="normal">5970</span>
<span class="normal">5971</span>
<span class="normal">5972</span>
<span class="normal">5973</span>
<span class="normal">5974</span>
<span class="normal">5975</span>
<span class="normal">5976</span>
<span class="normal">5977</span>
<span class="normal">5978</span>
<span class="normal">5979</span>
<span class="normal">5980</span>
<span class="normal">5981</span>
<span class="normal">5982</span>
<span class="normal">5983</span>
<span class="normal">5984</span>
<span class="normal">5985</span>
<span class="normal">5986</span>
<span class="normal">5987</span>
<span class="normal">5988</span>
<span class="normal">5989</span>
<span class="normal">5990</span>
<span class="normal">5991</span>
<span class="normal">5992</span>
<span class="normal">5993</span>
<span class="normal">5994</span>
<span class="normal">5995</span>
<span class="normal">5996</span>
<span class="normal">5997</span>
<span class="normal">5998</span>
<span class="normal">5999</span>
<span class="normal">6000</span>
<span class="normal">6001</span>
<span class="normal">6002</span>
<span class="normal">6003</span>
<span class="normal">6004</span>
<span class="normal">6005</span>
<span class="normal">6006</span>
<span class="normal">6007</span>
<span class="normal">6008</span>
<span class="normal">6009</span>
<span class="normal">6010</span>
<span class="normal">6011</span>
<span class="normal">6012</span>
<span class="normal">6013</span>
<span class="normal">6014</span>
<span class="normal">6015</span>
<span class="normal">6016</span>
<span class="normal">6017</span>
<span class="normal">6018</span>
<span class="normal">6019</span>
<span class="normal">6020</span>
<span class="normal">6021</span>
<span class="normal">6022</span>
<span class="normal">6023</span>
<span class="normal">6024</span>
<span class="normal">6025</span>
<span class="normal">6026</span>
<span class="normal">6027</span>
<span class="normal">6028</span>
<span class="normal">6029</span>
<span class="normal">6030</span>
<span class="normal">6031</span>
<span class="normal">6032</span>
<span class="normal">6033</span>
<span class="normal">6034</span>
<span class="normal">6035</span>
<span class="normal">6036</span>
<span class="normal">6037</span>
<span class="normal">6038</span>
<span class="normal">6039</span>
<span class="normal">6040</span>
<span class="normal">6041</span>
<span class="normal">6042</span>
<span class="normal">6043</span>
<span class="normal">6044</span>
<span class="normal">6045</span>
<span class="normal">6046</span>
<span class="normal">6047</span>
<span class="normal">6048</span>
<span class="normal">6049</span>
<span class="normal">6050</span>
<span class="normal">6051</span>
<span class="normal">6052</span>
<span class="normal">6053</span>
<span class="normal">6054</span>
<span class="normal">6055</span>
<span class="normal">6056</span>
<span class="normal">6057</span>
<span class="normal">6058</span>
<span class="normal">6059</span>
<span class="normal">6060</span>
<span class="normal">6061</span>
<span class="normal">6062</span>
<span class="normal">6063</span>
<span class="normal">6064</span>
<span class="normal">6065</span>
<span class="normal">6066</span>
<span class="normal">6067</span>
<span class="normal">6068</span>
<span class="normal">6069</span>
<span class="normal">6070</span>
<span class="normal">6071</span>
<span class="normal">6072</span>
<span class="normal">6073</span>
<span class="normal">6074</span>
<span class="normal">6075</span>
<span class="normal">6076</span>
<span class="normal">6077</span>
<span class="normal">6078</span>
<span class="normal">6079</span>
<span class="normal">6080</span>
<span class="normal">6081</span>
<span class="normal">6082</span>
<span class="normal">6083</span>
<span class="normal">6084</span>
<span class="normal">6085</span>
<span class="normal">6086</span>
<span class="normal">6087</span>
<span class="normal">6088</span>
<span class="normal">6089</span>
<span class="normal">6090</span>
<span class="normal">6091</span>
<span class="normal">6092</span>
<span class="normal">6093</span>
<span class="normal">6094</span>
<span class="normal">6095</span>
<span class="normal">6096</span>
<span class="normal">6097</span>
<span class="normal">6098</span>
<span class="normal">6099</span>
<span class="normal">6100</span>
<span class="normal">6101</span>
<span class="normal">6102</span>
<span class="normal">6103</span>
<span class="normal">6104</span>
<span class="normal">6105</span>
<span class="normal">6106</span>
<span class="normal">6107</span>
<span class="normal">6108</span>
<span class="normal">6109</span>
<span class="normal">6110</span>
<span class="normal">6111</span>
<span class="normal">6112</span>
<span class="normal">6113</span>
<span class="normal">6114</span>
<span class="normal">6115</span>
<span class="normal">6116</span>
<span class="normal">6117</span>
<span class="normal">6118</span>
<span class="normal">6119</span>
<span class="normal">6120</span>
<span class="normal">6121</span>
<span class="normal">6122</span>
<span class="normal">6123</span>
<span class="normal">6124</span>
<span class="normal">6125</span>
<span class="normal">6126</span>
<span class="normal">6127</span>
<span class="normal">6128</span>
<span class="normal">6129</span>
<span class="normal">6130</span>
<span class="normal">6131</span>
<span class="normal">6132</span>
<span class="normal">6133</span>
<span class="normal">6134</span>
<span class="normal">6135</span>
<span class="normal">6136</span>
<span class="normal">6137</span>
<span class="normal">6138</span>
<span class="normal">6139</span>
<span class="normal">6140</span>
<span class="normal">6141</span>
<span class="normal">6142</span>
<span class="normal">6143</span>
<span class="normal">6144</span>
<span class="normal">6145</span>
<span class="normal">6146</span>
<span class="normal">6147</span>
<span class="normal">6148</span>
<span class="normal">6149</span>
<span class="normal">6150</span>
<span class="normal">6151</span>
<span class="normal">6152</span>
<span class="normal">6153</span>
<span class="normal">6154</span>
<span class="normal">6155</span>
<span class="normal">6156</span>
<span class="normal">6157</span>
<span class="normal">6158</span>
<span class="normal">6159</span>
<span class="normal">6160</span>
<span class="normal">6161</span>
<span class="normal">6162</span>
<span class="normal">6163</span>
<span class="normal">6164</span>
<span class="normal">6165</span>
<span class="normal">6166</span>
<span class="normal">6167</span>
<span class="normal">6168</span>
<span class="normal">6169</span>
<span class="normal">6170</span>
<span class="normal">6171</span>
<span class="normal">6172</span>
<span class="normal">6173</span>
<span class="normal">6174</span>
<span class="normal">6175</span>
<span class="normal">6176</span>
<span class="normal">6177</span>
<span class="normal">6178</span>
<span class="normal">6179</span>
<span class="normal">6180</span>
<span class="normal">6181</span>
<span class="normal">6182</span>
<span class="normal">6183</span>
<span class="normal">6184</span>
<span class="normal">6185</span>
<span class="normal">6186</span>
<span class="normal">6187</span>
<span class="normal">6188</span>
<span class="normal">6189</span>
<span class="normal">6190</span>
<span class="normal">6191</span>
<span class="normal">6192</span>
<span class="normal">6193</span>
<span class="normal">6194</span>
<span class="normal">6195</span>
<span class="normal">6196</span>
<span class="normal">6197</span>
<span class="normal">6198</span>
<span class="normal">6199</span>
<span class="normal">6200</span>
<span class="normal">6201</span>
<span class="normal">6202</span>
<span class="normal">6203</span>
<span class="normal">6204</span>
<span class="normal">6205</span>
<span class="normal">6206</span>
<span class="normal">6207</span>
<span class="normal">6208</span>
<span class="normal">6209</span>
<span class="normal">6210</span>
<span class="normal">6211</span>
<span class="normal">6212</span>
<span class="normal">6213</span>
<span class="normal">6214</span>
<span class="normal">6215</span>
<span class="normal">6216</span>
<span class="normal">6217</span>
<span class="normal">6218</span>
<span class="normal">6219</span>
<span class="normal">6220</span>
<span class="normal">6221</span>
<span class="normal">6222</span>
<span class="normal">6223</span>
<span class="normal">6224</span>
<span class="normal">6225</span>
<span class="normal">6226</span>
<span class="normal">6227</span>
<span class="normal">6228</span>
<span class="normal">6229</span>
<span class="normal">6230</span>
<span class="normal">6231</span>
<span class="normal">6232</span>
<span class="normal">6233</span>
<span class="normal">6234</span>
<span class="normal">6235</span>
<span class="normal">6236</span>
<span class="normal">6237</span>
<span class="normal">6238</span>
<span class="normal">6239</span>
<span class="normal">6240</span>
<span class="normal">6241</span>
<span class="normal">6242</span>
<span class="normal">6243</span>
<span class="normal">6244</span>
<span class="normal">6245</span>
<span class="normal">6246</span>
<span class="normal">6247</span>
<span class="normal">6248</span>
<span class="normal">6249</span>
<span class="normal">6250</span>
<span class="normal">6251</span>
<span class="normal">6252</span>
<span class="normal">6253</span>
<span class="normal">6254</span>
<span class="normal">6255</span>
<span class="normal">6256</span>
<span class="normal">6257</span>
<span class="normal">6258</span>
<span class="normal">6259</span>
<span class="normal">6260</span>
<span class="normal">6261</span>
<span class="normal">6262</span>
<span class="normal">6263</span>
<span class="normal">6264</span>
<span class="normal">6265</span>
<span class="normal">6266</span>
<span class="normal">6267</span>
<span class="normal">6268</span>
<span class="normal">6269</span>
<span class="normal">6270</span>
<span class="normal">6271</span>
<span class="normal">6272</span>
<span class="normal">6273</span>
<span class="normal">6274</span>
<span class="normal">6275</span>
<span class="normal">6276</span>
<span class="normal">6277</span>
<span class="normal">6278</span>
<span class="normal">6279</span>
<span class="normal">6280</span>
<span class="normal">6281</span>
<span class="normal">6282</span>
<span class="normal">6283</span>
<span class="normal">6284</span>
<span class="normal">6285</span>
<span class="normal">6286</span>
<span class="normal">6287</span>
<span class="normal">6288</span>
<span class="normal">6289</span>
<span class="normal">6290</span>
<span class="normal">6291</span>
<span class="normal">6292</span>
<span class="normal">6293</span>
<span class="normal">6294</span>
<span class="normal">6295</span>
<span class="normal">6296</span>
<span class="normal">6297</span>
<span class="normal">6298</span>
<span class="normal">6299</span>
<span class="normal">6300</span>
<span class="normal">6301</span>
<span class="normal">6302</span>
<span class="normal">6303</span>
<span class="normal">6304</span>
<span class="normal">6305</span>
<span class="normal">6306</span>
<span class="normal">6307</span>
<span class="normal">6308</span>
<span class="normal">6309</span>
<span class="normal">6310</span>
<span class="normal">6311</span>
<span class="normal">6312</span>
<span class="normal">6313</span>
<span class="normal">6314</span>
<span class="normal">6315</span>
<span class="normal">6316</span>
<span class="normal">6317</span>
<span class="normal">6318</span>
<span class="normal">6319</span>
<span class="normal">6320</span>
<span class="normal">6321</span>
<span class="normal">6322</span>
<span class="normal">6323</span>
<span class="normal">6324</span>
<span class="normal">6325</span>
<span class="normal">6326</span>
<span class="normal">6327</span>
<span class="normal">6328</span>
<span class="normal">6329</span>
<span class="normal">6330</span>
<span class="normal">6331</span>
<span class="normal">6332</span>
<span class="normal">6333</span>
<span class="normal">6334</span>
<span class="normal">6335</span>
<span class="normal">6336</span>
<span class="normal">6337</span>
<span class="normal">6338</span>
<span class="normal">6339</span>
<span class="normal">6340</span>
<span class="normal">6341</span>
<span class="normal">6342</span>
<span class="normal">6343</span>
<span class="normal">6344</span>
<span class="normal">6345</span>
<span class="normal">6346</span>
<span class="normal">6347</span>
<span class="normal">6348</span>
<span class="normal">6349</span>
<span class="normal">6350</span>
<span class="normal">6351</span>
<span class="normal">6352</span>
<span class="normal">6353</span>
<span class="normal">6354</span>
<span class="normal">6355</span>
<span class="normal">6356</span>
<span class="normal">6357</span>
<span class="normal">6358</span>
<span class="normal">6359</span>
<span class="normal">6360</span>
<span class="normal">6361</span>
<span class="normal">6362</span>
<span class="normal">6363</span>
<span class="normal">6364</span>
<span class="normal">6365</span>
<span class="normal">6366</span>
<span class="normal">6367</span>
<span class="normal">6368</span>
<span class="normal">6369</span>
<span class="normal">6370</span>
<span class="normal">6371</span>
<span class="normal">6372</span>
<span class="normal">6373</span>
<span class="normal">6374</span>
<span class="normal">6375</span>
<span class="normal">6376</span>
<span class="normal">6377</span>
<span class="normal">6378</span>
<span class="normal">6379</span>
<span class="normal">6380</span>
<span class="normal">6381</span>
<span class="normal">6382</span>
<span class="normal">6383</span>
<span class="normal">6384</span>
<span class="normal">6385</span>
<span class="normal">6386</span>
<span class="normal">6387</span>
<span class="normal">6388</span>
<span class="normal">6389</span>
<span class="normal">6390</span>
<span class="normal">6391</span>
<span class="normal">6392</span>
<span class="normal">6393</span>
<span class="normal">6394</span>
<span class="normal">6395</span>
<span class="normal">6396</span>
<span class="normal">6397</span>
<span class="normal">6398</span>
<span class="normal">6399</span>
<span class="normal">6400</span>
<span class="normal">6401</span>
<span class="normal">6402</span>
<span class="normal">6403</span>
<span class="normal">6404</span>
<span class="normal">6405</span>
<span class="normal">6406</span>
<span class="normal">6407</span>
<span class="normal">6408</span>
<span class="normal">6409</span>
<span class="normal">6410</span>
<span class="normal">6411</span>
<span class="normal">6412</span>
<span class="normal">6413</span>
<span class="normal">6414</span>
<span class="normal">6415</span>
<span class="normal">6416</span>
<span class="normal">6417</span>
<span class="normal">6418</span>
<span class="normal">6419</span>
<span class="normal">6420</span>
<span class="normal">6421</span>
<span class="normal">6422</span>
<span class="normal">6423</span>
<span class="normal">6424</span>
<span class="normal">6425</span>
<span class="normal">6426</span>
<span class="normal">6427</span>
<span class="normal">6428</span>
<span class="normal">6429</span>
<span class="normal">6430</span>
<span class="normal">6431</span>
<span class="normal">6432</span>
<span class="normal">6433</span>
<span class="normal">6434</span>
<span class="normal">6435</span>
<span class="normal">6436</span>
<span class="normal">6437</span>
<span class="normal">6438</span>
<span class="normal">6439</span>
<span class="normal">6440</span>
<span class="normal">6441</span>
<span class="normal">6442</span>
<span class="normal">6443</span>
<span class="normal">6444</span>
<span class="normal">6445</span>
<span class="normal">6446</span>
<span class="normal">6447</span>
<span class="normal">6448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">jonespewsey_asym_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Asymmetric Extended Jones-Pewsey Distribution</span>

<span class="sd">    This distribution is an extension of the Jones-Pewsey family, incorporating asymmetry</span>
<span class="sd">    through a secondary parameter $\nu$. It is defined on the circular domain $[0, 2\pi)$.</span>

<span class="sd">    ![jonespewsey-asymext](../images/circ-mod-jonespewsey-asym.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, xi, kappa, psi, nu)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, xi, kappa, psi, nu)</span>
<span class="sd">        Cumulative distribution function.</span>


<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Parameters must be scalar; cached normalisation tables are built per parameter set.</span>
<span class="sd">    Implementation from 4.3.12 of Pewsey et al. (2014)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_table_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">xi_arr</span><span class="p">,</span> <span class="n">kappa_arr</span><span class="p">,</span> <span class="n">psi_arr</span><span class="p">,</span> <span class="n">nu_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">psi_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">xi_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">nu_scalar</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">kappa_scalar</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_normalizer</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">_c_jonespewsey_asym</span><span class="p">(</span><span class="n">xi_scalar</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">,</span> <span class="n">nu_scalar</span><span class="p">),</span>
            <span class="n">xi_scalar</span><span class="p">,</span>
            <span class="n">kappa_scalar</span><span class="p">,</span>
            <span class="n">psi_scalar</span><span class="p">,</span>
            <span class="n">nu_scalar</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">_kernel_jonespewsey_asym</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_scalar</span><span class="p">,</span> <span class="n">kappa_scalar</span><span class="p">,</span> <span class="n">psi_scalar</span><span class="p">,</span> <span class="n">nu_scalar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm</span> <span class="o">*</span> <span class="n">base</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function (PDF) of the Asymmetric Extended Jones-Pewsey distribution.</span>

<span class="sd">        The PDF is given by:</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{k(\theta; \xi, \kappa, \psi, \nu)}{c}</span>
<span class="sd">        $$</span>

<span class="sd">        where $k(\theta; \xi, \kappa, \psi, \nu)$ is the kernel function defined as:</span>

<span class="sd">        $$</span>
<span class="sd">        k(\theta; \xi, \kappa, \psi, \nu) =</span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        \exp\left(\kappa \cos(\theta - \xi + \nu \cos(\theta - \xi))\right) &amp; \text{if } \psi = 0 \\</span>
<span class="sd">        \left[\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \xi + \nu \cos(\theta - \xi))\right]^{1/\psi} &amp; \text{if } \psi \neq 0</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>

<span class="sd">        and $c$ is the normalization constant:</span>

<span class="sd">        $$</span>
<span class="sd">        c = \int_{-\pi}^{\pi} k(\theta; \xi, \kappa, \psi, \nu) \, d\theta</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter, $0 \leq \xi \leq 2\pi$. This typically represents the mode of the distribution.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$. Higher values result in a sharper peak around $\xi$.</span>
<span class="sd">        psi : float</span>
<span class="sd">            Shape parameter, $-\infty \leq \psi \leq \infty$. When $\psi = 0$, the distribution reduces to a simpler von Mises-like form.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Asymmetry parameter, $0 \leq \nu &lt; 1$. Introduces skewness in the circular distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Values of the probability density function at the specified points.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The normalization constant $c$ is computed numerically using integration.</span>
<span class="sd">        - Special cases:</span>
<span class="sd">            - When $\psi = 0$, the kernel simplifies to the von Mises-like asymmetric form.</span>
<span class="sd">            - When $\kappa = 0$, the distribution becomes uniform on $[0, 2\pi)$.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nu_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="n">psi_val</span><span class="p">)</span>

        <span class="n">phi_start</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">xi_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
        <span class="n">phi_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">flat</span> <span class="o">-</span> <span class="n">xi_val</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="n">phi_grid</span><span class="p">,</span> <span class="n">cdf_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asym_cdf_table</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>

        <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">phi_start</span><span class="p">,</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="n">cdf_grid</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="n">H_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">phi_end</span><span class="p">,</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="n">cdf_grid</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="n">cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">phi_end</span> <span class="o">&gt;=</span> <span class="n">phi_start</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">H_end</span> <span class="o">-</span> <span class="n">H_start</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">-</span> <span class="n">H_end</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cdf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the argument-warped JP family.</span>

<span class="sd">        The asymmetric transformation phi -&gt; phi + nu cos(phi) is handled by</span>
<span class="sd">        precomputing a high-resolution trapezoidal cumulative table for each</span>
<span class="sd">        parameter set.  Interpolation of this table gives fast evaluations while</span>
<span class="sd">        preserving the limiting cases (nu -&gt; 0 reduces to the symmetric JP CDF).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
            <span class="n">boundary_lo</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
            <span class="n">boundary_hi</span> <span class="o">=</span> <span class="n">q_valid</span> <span class="o">&gt;=</span> <span class="mf">1.0</span>
            <span class="n">interior</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_lo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">boundary_hi</span><span class="p">)</span>
            <span class="n">theta_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">theta_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interior</span><span class="p">):</span>
                <span class="n">q_int</span> <span class="o">=</span> <span class="n">q_valid</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span>
                <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-15</span>
                <span class="n">q_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">q_int</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span> <span class="ow">and</span> <span class="n">nu_val</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_clipped</span>
                    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">)</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
                    <span class="n">tol_cdf</span> <span class="o">=</span> <span class="mf">1e-12</span>
                    <span class="n">tol_theta</span> <span class="o">=</span> <span class="mf">1e-10</span>
                    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">8</span>

                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
                        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">),</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">delta</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">q_clipped</span>
                        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
                        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_curr</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

                        <span class="n">converged</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol_theta</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
                            <span class="k">break</span>

                        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">theta_curr</span> <span class="o">-</span> <span class="n">step</span>
                        <span class="n">midpoint</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span>
                        <span class="n">theta_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">theta_next</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">theta_next</span> <span class="o">&gt;=</span> <span class="n">H</span><span class="p">),</span>
                            <span class="n">midpoint</span><span class="p">,</span>
                            <span class="n">theta_next</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">theta_next</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>

                    <span class="n">residual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_curr</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">),</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="n">q_clipped</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_theta</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                        <span class="n">theta_b</span> <span class="o">=</span> <span class="n">theta_curr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">L_b</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">H_b</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                                <span class="k">break</span>
                            <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">cdf_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="n">delta_mid</span> <span class="o">=</span> <span class="n">cdf_mid</span> <span class="o">-</span> <span class="n">q_clipped</span>
                            <span class="n">take_upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mid</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">take_lower</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">take_upper</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
                            <span class="n">H_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_upper</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">H_b</span><span class="p">)</span>
                            <span class="n">L_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">take_lower</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">L_b</span><span class="p">)</span>
                            <span class="n">theta_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">theta_b</span><span class="p">)</span>
                            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">delta_mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol_cdf</span><span class="p">)</span>
                        <span class="n">theta_curr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">L_b</span> <span class="o">+</span> <span class="n">H_b</span><span class="p">),</span> <span class="n">theta_b</span><span class="p">)</span>

                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">interior</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_curr</span>

            <span class="n">result_vals</span> <span class="o">=</span> <span class="n">theta_vals</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_lo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">result_vals</span><span class="p">[</span><span class="n">boundary_hi</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_vals</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quantile function of the asymmetric Jones--Pewsey distribution.</span>

<span class="sd">        Quantiles are obtained by the same safeguarded Newton iteration as in</span>
<span class="sd">        the symmetric case, with the warp-aware CDF supplying residuals.  When</span>
<span class="sd">        nu is effectively zero the method delegates to the symmetric JP solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">psi_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="s2">&quot;psi&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_jp_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">nu_val</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`nu` must lie in [0, 1).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">))</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;</span> <span class="n">_JP_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">psi_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">_JP_PSI_TOL</span> <span class="ow">and</span> <span class="n">nu_val</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size_tuple</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

        <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asym_sampler_envelope</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">filled</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span>
            <span class="n">proposals</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span>
                <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span>
                <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_env</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">target_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">proposals</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">psi_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">)</span>
            <span class="n">proposal_vals</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">proposals</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_env</span><span class="p">)</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">proposal_vals</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">target_vals</span> <span class="o">/</span> <span class="p">(</span><span class="n">envelope_const</span> <span class="o">*</span> <span class="n">proposal_vals</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">remaining</span><span class="p">)</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="n">u</span>
            <span class="n">n_accept</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">filled</span><span class="p">:</span><span class="n">filled</span> <span class="o">+</span> <span class="n">n_accept</span><span class="p">]</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">accept</span><span class="p">][:</span><span class="n">n_accept</span><span class="p">]</span>
                <span class="n">filled</span> <span class="o">+=</span> <span class="n">n_accept</span>

        <span class="k">return</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size_tuple</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the asymmetric Jones--Pewsey distribution.</span>

<span class="sd">        Sampling uses a curvature-matched von Mises envelope tuned via the</span>
<span class="sd">        optimisation helper, providing an exact acceptance-rejection scheme that</span>
<span class="sd">        works well across nu in [0, 1).  Uniform and symmetric limits are</span>
<span class="sd">        handled explicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_asym_sampler_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">))</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="n">kappa_env</span> <span class="o">=</span> <span class="n">_jp_effective_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
        <span class="n">phi_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">theta_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">target_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta_grid</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="n">log_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">target_vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span> <span class="o">=</span> <span class="n">_optimize_vonmises_envelope</span><span class="p">(</span>
            <span class="n">theta_grid</span><span class="p">,</span>
            <span class="n">log_target</span><span class="p">,</span>
            <span class="n">xi</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">kappa_env</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sampler_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kappa_env</span><span class="p">,</span> <span class="n">envelope_const</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_asym_cdf_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_size</span><span class="p">))</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_table_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="n">phi_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span>
        <span class="n">trap</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">pdf_vals</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">*</span> <span class="n">delta</span>
        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">)</span>
        <span class="n">cdf_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cdf_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">trap</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">cdf_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="ow">or</span> <span class="n">total</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">cdf_vals</span> <span class="o">/=</span> <span class="n">total</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi_grid</span><span class="p">,</span> <span class="n">cdf_vals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cdf_table_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
        <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate asymmetric JP parameters by maximum likelihood.</span>

<span class="sd">        The symmetric JP fit supplies starting values for (xi, kappa, psi) with</span>
<span class="sd">        nu initialised at zero.  The full four-parameter log-likelihood is then</span>
<span class="sd">        optimised under simple bounds, re-using the cached normalising constant</span>
<span class="sd">        and envelope machinery developed for the JP core.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">base_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">base_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">base_kwargs</span><span class="p">)</span>
        <span class="n">init_estimates</span><span class="p">,</span> <span class="n">base_info</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="n">psi_bounds</span><span class="o">=</span><span class="n">psi_bounds</span><span class="p">,</span>
            <span class="n">kappa_bounds</span><span class="o">=</span><span class="n">kappa_bounds</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">base_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xi_init</span><span class="p">,</span> <span class="n">kappa_init</span><span class="p">,</span> <span class="n">psi_init</span> <span class="o">=</span> <span class="n">init_estimates</span>
        <span class="n">nu_init</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">kappa_low</span><span class="p">,</span> <span class="n">kappa_high</span> <span class="o">=</span> <span class="n">kappa_bounds</span>
        <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span> <span class="o">=</span> <span class="n">psi_bounds</span>
        <span class="n">nu_low</span><span class="p">,</span> <span class="n">nu_high</span> <span class="o">=</span> <span class="n">nu_bounds</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">nu_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_low</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_high</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_low</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_high</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_low</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;</span> <span class="n">nu_high</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">nu_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_init</span><span class="p">,</span> <span class="n">kappa_init</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">,</span> <span class="n">nu_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="n">kappa_bounds</span><span class="p">,</span>
            <span class="n">psi_bounds</span><span class="p">,</span>
            <span class="n">nu_bounds</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;jonespewsey_asym.fit failed: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_low</span><span class="p">,</span> <span class="n">kappa_high</span><span class="p">))</span>
        <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span><span class="p">))</span>
        <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">nu_low</span><span class="p">,</span> <span class="n">nu_high</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

        <span class="n">final_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
        <span class="n">loglik</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">final_pdf</span><span class="p">)))</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="n">base_info</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">loglik</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_asym_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function (PDF) of the Asymmetric Extended Jones-Pewsey distribution.</p>
<p>The PDF is given by:</p>
<div class="arithmatex">\[
f(\theta) = \frac{k(\theta; \xi, \kappa, \psi, \nu)}{c}
\]</div>
<p>where <span class="arithmatex">\(k(\theta; \xi, \kappa, \psi, \nu)\)</span> is the kernel function defined as:</p>
<div class="arithmatex">\[
k(\theta; \xi, \kappa, \psi, \nu) =
\begin{cases}
\exp\left(\kappa \cos(\theta - \xi + \nu \cos(\theta - \xi))\right) &amp; \text{if } \psi = 0 \\
\left[\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \xi + \nu \cos(\theta - \xi))\right]^{1/\psi} &amp; \text{if } \psi \neq 0
\end{cases}
\]</div>
<p>and <span class="arithmatex">\(c\)</span> is the normalization constant:</p>
<div class="arithmatex">\[
c = \int_{-\pi}^{\pi} k(\theta; \xi, \kappa, \psi, \nu) \, d\theta
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the PDF, defined on the interval <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter, <span class="arithmatex">\(0 \leq \xi \leq 2\pi\)</span>. This typically represents the mode of the distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>. Higher values result in a sharper peak around <span class="arithmatex">\(\xi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>psi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-\infty \leq \psi \leq \infty\)</span>. When <span class="arithmatex">\(\psi = 0\)</span>, the distribution reduces to a simpler von Mises-like form.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Asymmetry parameter, <span class="arithmatex">\(0 \leq \nu &lt; 1\)</span>. Introduces skewness in the circular distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the probability density function at the specified points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The normalization constant <span class="arithmatex">\(c\)</span> is computed numerically using integration.</li>
<li>Special cases:<ul>
<li>When <span class="arithmatex">\(\psi = 0\)</span>, the kernel simplifies to the von Mises-like asymmetric form.</li>
<li>When <span class="arithmatex">\(\kappa = 0\)</span>, the distribution becomes uniform on <span class="arithmatex">\([0, 2\pi)\)</span>.</li>
</ul>
</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6020</span>
<span class="normal">6021</span>
<span class="normal">6022</span>
<span class="normal">6023</span>
<span class="normal">6024</span>
<span class="normal">6025</span>
<span class="normal">6026</span>
<span class="normal">6027</span>
<span class="normal">6028</span>
<span class="normal">6029</span>
<span class="normal">6030</span>
<span class="normal">6031</span>
<span class="normal">6032</span>
<span class="normal">6033</span>
<span class="normal">6034</span>
<span class="normal">6035</span>
<span class="normal">6036</span>
<span class="normal">6037</span>
<span class="normal">6038</span>
<span class="normal">6039</span>
<span class="normal">6040</span>
<span class="normal">6041</span>
<span class="normal">6042</span>
<span class="normal">6043</span>
<span class="normal">6044</span>
<span class="normal">6045</span>
<span class="normal">6046</span>
<span class="normal">6047</span>
<span class="normal">6048</span>
<span class="normal">6049</span>
<span class="normal">6050</span>
<span class="normal">6051</span>
<span class="normal">6052</span>
<span class="normal">6053</span>
<span class="normal">6054</span>
<span class="normal">6055</span>
<span class="normal">6056</span>
<span class="normal">6057</span>
<span class="normal">6058</span>
<span class="normal">6059</span>
<span class="normal">6060</span>
<span class="normal">6061</span>
<span class="normal">6062</span>
<span class="normal">6063</span>
<span class="normal">6064</span>
<span class="normal">6065</span>
<span class="normal">6066</span>
<span class="normal">6067</span>
<span class="normal">6068</span>
<span class="normal">6069</span>
<span class="normal">6070</span>
<span class="normal">6071</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function (PDF) of the Asymmetric Extended Jones-Pewsey distribution.</span>

<span class="sd">    The PDF is given by:</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{k(\theta; \xi, \kappa, \psi, \nu)}{c}</span>
<span class="sd">    $$</span>

<span class="sd">    where $k(\theta; \xi, \kappa, \psi, \nu)$ is the kernel function defined as:</span>

<span class="sd">    $$</span>
<span class="sd">    k(\theta; \xi, \kappa, \psi, \nu) =</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \exp\left(\kappa \cos(\theta - \xi + \nu \cos(\theta - \xi))\right) &amp; \text{if } \psi = 0 \\</span>
<span class="sd">    \left[\cosh(\kappa \psi) + \sinh(\kappa \psi) \cos(\theta - \xi + \nu \cos(\theta - \xi))\right]^{1/\psi} &amp; \text{if } \psi \neq 0</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    and $c$ is the normalization constant:</span>

<span class="sd">    $$</span>
<span class="sd">    c = \int_{-\pi}^{\pi} k(\theta; \xi, \kappa, \psi, \nu) \, d\theta</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter, $0 \leq \xi \leq 2\pi$. This typically represents the mode of the distribution.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$. Higher values result in a sharper peak around $\xi$.</span>
<span class="sd">    psi : float</span>
<span class="sd">        Shape parameter, $-\infty \leq \psi \leq \infty$. When $\psi = 0$, the distribution reduces to a simpler von Mises-like form.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Asymmetry parameter, $0 \leq \nu &lt; 1$. Introduces skewness in the circular distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Values of the probability density function at the specified points.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The normalization constant $c$ is computed numerically using integration.</span>
<span class="sd">    - Special cases:</span>
<span class="sd">        - When $\psi = 0$, the kernel simplifies to the von Mises-like asymmetric form.</span>
<span class="sd">        - When $\kappa = 0$, the distribution becomes uniform on $[0, 2\pi)$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_asym_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the argument-warped JP family.</p>
<p>The asymmetric transformation phi -&gt; phi + nu cos(phi) is handled by
precomputing a high-resolution trapezoidal cumulative table for each
parameter set.  Interpolation of this table gives fast evaluations while
preserving the limiting cases (nu -&gt; 0 reduces to the symmetric JP CDF).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6106</span>
<span class="normal">6107</span>
<span class="normal">6108</span>
<span class="normal">6109</span>
<span class="normal">6110</span>
<span class="normal">6111</span>
<span class="normal">6112</span>
<span class="normal">6113</span>
<span class="normal">6114</span>
<span class="normal">6115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the argument-warped JP family.</span>

<span class="sd">    The asymmetric transformation phi -&gt; phi + nu cos(phi) is handled by</span>
<span class="sd">    precomputing a high-resolution trapezoidal cumulative table for each</span>
<span class="sd">    parameter set.  Interpolation of this table gives fast evaluations while</span>
<span class="sd">    preserving the limiting cases (nu -&gt; 0 reduces to the symmetric JP CDF).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_asym_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Quantile function of the asymmetric Jones--Pewsey distribution.</p>
<p>Quantiles are obtained by the same safeguarded Newton iteration as in
the symmetric case, with the warp-aware CDF supplying residuals.  When
nu is effectively zero the method delegates to the symmetric JP solver.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6219</span>
<span class="normal">6220</span>
<span class="normal">6221</span>
<span class="normal">6222</span>
<span class="normal">6223</span>
<span class="normal">6224</span>
<span class="normal">6225</span>
<span class="normal">6226</span>
<span class="normal">6227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantile function of the asymmetric Jones--Pewsey distribution.</span>

<span class="sd">    Quantiles are obtained by the same safeguarded Newton iteration as in</span>
<span class="sd">    the symmetric case, with the warp-aware CDF supplying residuals.  When</span>
<span class="sd">    nu is effectively zero the method delegates to the symmetric JP solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_asym_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the asymmetric Jones--Pewsey distribution.</p>
<p>Sampling uses a curvature-matched von Mises envelope tuned via the
optimisation helper, providing an exact acceptance-rejection scheme that
works well across nu in [0, 1).  Uniform and symmetric limits are
handled explicitly.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6282</span>
<span class="normal">6283</span>
<span class="normal">6284</span>
<span class="normal">6285</span>
<span class="normal">6286</span>
<span class="normal">6287</span>
<span class="normal">6288</span>
<span class="normal">6289</span>
<span class="normal">6290</span>
<span class="normal">6291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the asymmetric Jones--Pewsey distribution.</span>

<span class="sd">    Sampling uses a curvature-matched von Mises envelope tuned via the</span>
<span class="sd">    optimisation helper, providing an exact acceptance-rejection scheme that</span>
<span class="sd">    works well across nu in [0, 1).  Uniform and symmetric limits are</span>
<span class="sd">    handled explicitly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.jonespewsey_asym_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate asymmetric JP parameters by maximum likelihood.</p>
<p>The symmetric JP fit supplies starting values for (xi, kappa, psi) with
nu initialised at zero.  The full four-parameter log-likelihood is then
optimised under simple bounds, re-using the cached normalising constant
and envelope machinery developed for the JP core.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6341</span>
<span class="normal">6342</span>
<span class="normal">6343</span>
<span class="normal">6344</span>
<span class="normal">6345</span>
<span class="normal">6346</span>
<span class="normal">6347</span>
<span class="normal">6348</span>
<span class="normal">6349</span>
<span class="normal">6350</span>
<span class="normal">6351</span>
<span class="normal">6352</span>
<span class="normal">6353</span>
<span class="normal">6354</span>
<span class="normal">6355</span>
<span class="normal">6356</span>
<span class="normal">6357</span>
<span class="normal">6358</span>
<span class="normal">6359</span>
<span class="normal">6360</span>
<span class="normal">6361</span>
<span class="normal">6362</span>
<span class="normal">6363</span>
<span class="normal">6364</span>
<span class="normal">6365</span>
<span class="normal">6366</span>
<span class="normal">6367</span>
<span class="normal">6368</span>
<span class="normal">6369</span>
<span class="normal">6370</span>
<span class="normal">6371</span>
<span class="normal">6372</span>
<span class="normal">6373</span>
<span class="normal">6374</span>
<span class="normal">6375</span>
<span class="normal">6376</span>
<span class="normal">6377</span>
<span class="normal">6378</span>
<span class="normal">6379</span>
<span class="normal">6380</span>
<span class="normal">6381</span>
<span class="normal">6382</span>
<span class="normal">6383</span>
<span class="normal">6384</span>
<span class="normal">6385</span>
<span class="normal">6386</span>
<span class="normal">6387</span>
<span class="normal">6388</span>
<span class="normal">6389</span>
<span class="normal">6390</span>
<span class="normal">6391</span>
<span class="normal">6392</span>
<span class="normal">6393</span>
<span class="normal">6394</span>
<span class="normal">6395</span>
<span class="normal">6396</span>
<span class="normal">6397</span>
<span class="normal">6398</span>
<span class="normal">6399</span>
<span class="normal">6400</span>
<span class="normal">6401</span>
<span class="normal">6402</span>
<span class="normal">6403</span>
<span class="normal">6404</span>
<span class="normal">6405</span>
<span class="normal">6406</span>
<span class="normal">6407</span>
<span class="normal">6408</span>
<span class="normal">6409</span>
<span class="normal">6410</span>
<span class="normal">6411</span>
<span class="normal">6412</span>
<span class="normal">6413</span>
<span class="normal">6414</span>
<span class="normal">6415</span>
<span class="normal">6416</span>
<span class="normal">6417</span>
<span class="normal">6418</span>
<span class="normal">6419</span>
<span class="normal">6420</span>
<span class="normal">6421</span>
<span class="normal">6422</span>
<span class="normal">6423</span>
<span class="normal">6424</span>
<span class="normal">6425</span>
<span class="normal">6426</span>
<span class="normal">6427</span>
<span class="normal">6428</span>
<span class="normal">6429</span>
<span class="normal">6430</span>
<span class="normal">6431</span>
<span class="normal">6432</span>
<span class="normal">6433</span>
<span class="normal">6434</span>
<span class="normal">6435</span>
<span class="normal">6436</span>
<span class="normal">6437</span>
<span class="normal">6438</span>
<span class="normal">6439</span>
<span class="normal">6440</span>
<span class="normal">6441</span>
<span class="normal">6442</span>
<span class="normal">6443</span>
<span class="normal">6444</span>
<span class="normal">6445</span>
<span class="normal">6446</span>
<span class="normal">6447</span>
<span class="normal">6448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="n">psi_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
    <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">),</span>
    <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">base_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate asymmetric JP parameters by maximum likelihood.</span>

<span class="sd">    The symmetric JP fit supplies starting values for (xi, kappa, psi) with</span>
<span class="sd">    nu initialised at zero.  The full four-parameter log-likelihood is then</span>
<span class="sd">    optimised under simple bounds, re-using the cached normalising constant</span>
<span class="sd">    and envelope machinery developed for the JP core.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">base_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">base_kwargs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">base_kwargs</span><span class="p">)</span>
    <span class="n">init_estimates</span><span class="p">,</span> <span class="n">base_info</span> <span class="o">=</span> <span class="n">jonespewsey</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="o">=</span><span class="n">psi_bounds</span><span class="p">,</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="n">kappa_bounds</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">base_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">xi_init</span><span class="p">,</span> <span class="n">kappa_init</span><span class="p">,</span> <span class="n">psi_init</span> <span class="o">=</span> <span class="n">init_estimates</span>
    <span class="n">nu_init</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">kappa_low</span><span class="p">,</span> <span class="n">kappa_high</span> <span class="o">=</span> <span class="n">kappa_bounds</span>
    <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span> <span class="o">=</span> <span class="n">psi_bounds</span>
    <span class="n">nu_low</span><span class="p">,</span> <span class="n">nu_high</span> <span class="o">=</span> <span class="n">nu_bounds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">nu_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_low</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_high</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">psi_low</span> <span class="o">&lt;=</span> <span class="n">psi_param</span> <span class="o">&lt;=</span> <span class="n">psi_high</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_low</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;</span> <span class="n">nu_high</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_wrapped</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">psi_param</span><span class="p">,</span> <span class="n">nu_param</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_init</span><span class="p">,</span> <span class="n">kappa_init</span><span class="p">,</span> <span class="n">psi_init</span><span class="p">,</span> <span class="n">nu_init</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="n">kappa_bounds</span><span class="p">,</span>
        <span class="n">psi_bounds</span><span class="p">,</span>
        <span class="n">nu_bounds</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">nll</span><span class="p">,</span>
        <span class="n">init</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;jonespewsey_asym.fit failed: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_low</span><span class="p">,</span> <span class="n">kappa_high</span><span class="p">))</span>
    <span class="n">psi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">psi_low</span><span class="p">,</span> <span class="n">psi_high</span><span class="p">))</span>
    <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">nu_low</span><span class="p">,</span> <span class="n">nu_high</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

    <span class="n">final_pdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
    <span class="n">loglik</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">final_pdf</span><span class="p">)))</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">psi_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="n">base_info</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="n">loglik</span><span class="p">,</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">nit</span><span class="p">,</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_eff</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.inverse_batschelet_gen" class="doc doc-heading">
            <code>inverse_batschelet_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Inverse Batschelet Distribution</p>
<p><img alt="inverse-batschelet" src="../../images/circ-mod-inverse-batschelet.png" /></p>
<p>The inverse Batschelet family (Pewsey, Neuhaüser &amp; Ruxton, 2014, §4.3.13)
extends the von Mises distribution by applying two inverse angular warps:
a "peakedness" transform controlled by <span class="arithmatex">\(\nu\)</span>, and an inverse
Batschelet skew transform governed by <span class="arithmatex">\(\lambda\)</span>. The resulting density on
<span class="arithmatex">\([0, 2\pi)\)</span> takes the form</p>
<div class="arithmatex">\[
f(\theta) = c(\kappa, \lambda)
\exp\left[\kappa \cos\left(a\,t_\nu^{-1}(\varphi) + b\,s_\lambda^{-1}\bigl(t_\nu^{-1}(\varphi)\bigr)\right)\right],
\]</div>
<p>where <span class="arithmatex">\(\varphi = (\theta - \xi) \bmod 2\pi - \pi\)</span>,
<span class="arithmatex">\(a = \tfrac{1 - \lambda}{1 + \lambda}\)</span>,
<span class="arithmatex">\(b = \tfrac{2\lambda}{1 + \lambda}\)</span>, and the normalising constant
<span class="arithmatex">\(c(\kappa, \lambda)\)</span> depends only on <span class="arithmatex">\(\kappa\)</span> and <span class="arithmatex">\(\lambda\)</span>.
Setting <span class="arithmatex">\(\nu = \lambda = 0\)</span> recovers the von Mises distribution, while
<span class="arithmatex">\(\kappa \to 0\)</span> yields the circular uniform law. Parameters must be scalar;
cached normalisation tables are built per parameter set.</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, xi, kappa, nu, lmbd, *args, **kwargs) (pycircstat2.distributions.inverse_batschelet_gen.pdf)" href="#pycircstat2.distributions.inverse_batschelet_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, xi, kappa, nu, lmbd, *args, **kwargs) (pycircstat2.distributions.inverse_batschelet_gen.cdf)" href="#pycircstat2.distributions.inverse_batschelet_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="ppf(q, xi, kappa, nu, lmbd, *args, **kwargs) (pycircstat2.distributions.inverse_batschelet_gen.ppf)" href="#pycircstat2.distributions.inverse_batschelet_gen.ppf">ppf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Percent-point function (inverse CDF).</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(xi=None, kappa=None, nu=None, lmbd=None, size=None, random_state=None) (pycircstat2.distributions.inverse_batschelet_gen.rvs)" href="#pycircstat2.distributions.inverse_batschelet_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates via von Mises acceptance–rejection.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', optimizer='L-BFGS-B', options=None, nu_grid=None, lmbd_grid=None, kappa_bounds=(1e-06, _INVBAT_KAPPA_UPPER), nu_bounds=(-0.99, 0.99), lmbd_bounds=(-0.99, 0.99), return_info=False, **minimize_kwargs) (pycircstat2.distributions.inverse_batschelet_gen.fit)" href="#pycircstat2.distributions.inverse_batschelet_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Moments or maximum-likelihood parameter estimation.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6476</span>
<span class="normal">6477</span>
<span class="normal">6478</span>
<span class="normal">6479</span>
<span class="normal">6480</span>
<span class="normal">6481</span>
<span class="normal">6482</span>
<span class="normal">6483</span>
<span class="normal">6484</span>
<span class="normal">6485</span>
<span class="normal">6486</span>
<span class="normal">6487</span>
<span class="normal">6488</span>
<span class="normal">6489</span>
<span class="normal">6490</span>
<span class="normal">6491</span>
<span class="normal">6492</span>
<span class="normal">6493</span>
<span class="normal">6494</span>
<span class="normal">6495</span>
<span class="normal">6496</span>
<span class="normal">6497</span>
<span class="normal">6498</span>
<span class="normal">6499</span>
<span class="normal">6500</span>
<span class="normal">6501</span>
<span class="normal">6502</span>
<span class="normal">6503</span>
<span class="normal">6504</span>
<span class="normal">6505</span>
<span class="normal">6506</span>
<span class="normal">6507</span>
<span class="normal">6508</span>
<span class="normal">6509</span>
<span class="normal">6510</span>
<span class="normal">6511</span>
<span class="normal">6512</span>
<span class="normal">6513</span>
<span class="normal">6514</span>
<span class="normal">6515</span>
<span class="normal">6516</span>
<span class="normal">6517</span>
<span class="normal">6518</span>
<span class="normal">6519</span>
<span class="normal">6520</span>
<span class="normal">6521</span>
<span class="normal">6522</span>
<span class="normal">6523</span>
<span class="normal">6524</span>
<span class="normal">6525</span>
<span class="normal">6526</span>
<span class="normal">6527</span>
<span class="normal">6528</span>
<span class="normal">6529</span>
<span class="normal">6530</span>
<span class="normal">6531</span>
<span class="normal">6532</span>
<span class="normal">6533</span>
<span class="normal">6534</span>
<span class="normal">6535</span>
<span class="normal">6536</span>
<span class="normal">6537</span>
<span class="normal">6538</span>
<span class="normal">6539</span>
<span class="normal">6540</span>
<span class="normal">6541</span>
<span class="normal">6542</span>
<span class="normal">6543</span>
<span class="normal">6544</span>
<span class="normal">6545</span>
<span class="normal">6546</span>
<span class="normal">6547</span>
<span class="normal">6548</span>
<span class="normal">6549</span>
<span class="normal">6550</span>
<span class="normal">6551</span>
<span class="normal">6552</span>
<span class="normal">6553</span>
<span class="normal">6554</span>
<span class="normal">6555</span>
<span class="normal">6556</span>
<span class="normal">6557</span>
<span class="normal">6558</span>
<span class="normal">6559</span>
<span class="normal">6560</span>
<span class="normal">6561</span>
<span class="normal">6562</span>
<span class="normal">6563</span>
<span class="normal">6564</span>
<span class="normal">6565</span>
<span class="normal">6566</span>
<span class="normal">6567</span>
<span class="normal">6568</span>
<span class="normal">6569</span>
<span class="normal">6570</span>
<span class="normal">6571</span>
<span class="normal">6572</span>
<span class="normal">6573</span>
<span class="normal">6574</span>
<span class="normal">6575</span>
<span class="normal">6576</span>
<span class="normal">6577</span>
<span class="normal">6578</span>
<span class="normal">6579</span>
<span class="normal">6580</span>
<span class="normal">6581</span>
<span class="normal">6582</span>
<span class="normal">6583</span>
<span class="normal">6584</span>
<span class="normal">6585</span>
<span class="normal">6586</span>
<span class="normal">6587</span>
<span class="normal">6588</span>
<span class="normal">6589</span>
<span class="normal">6590</span>
<span class="normal">6591</span>
<span class="normal">6592</span>
<span class="normal">6593</span>
<span class="normal">6594</span>
<span class="normal">6595</span>
<span class="normal">6596</span>
<span class="normal">6597</span>
<span class="normal">6598</span>
<span class="normal">6599</span>
<span class="normal">6600</span>
<span class="normal">6601</span>
<span class="normal">6602</span>
<span class="normal">6603</span>
<span class="normal">6604</span>
<span class="normal">6605</span>
<span class="normal">6606</span>
<span class="normal">6607</span>
<span class="normal">6608</span>
<span class="normal">6609</span>
<span class="normal">6610</span>
<span class="normal">6611</span>
<span class="normal">6612</span>
<span class="normal">6613</span>
<span class="normal">6614</span>
<span class="normal">6615</span>
<span class="normal">6616</span>
<span class="normal">6617</span>
<span class="normal">6618</span>
<span class="normal">6619</span>
<span class="normal">6620</span>
<span class="normal">6621</span>
<span class="normal">6622</span>
<span class="normal">6623</span>
<span class="normal">6624</span>
<span class="normal">6625</span>
<span class="normal">6626</span>
<span class="normal">6627</span>
<span class="normal">6628</span>
<span class="normal">6629</span>
<span class="normal">6630</span>
<span class="normal">6631</span>
<span class="normal">6632</span>
<span class="normal">6633</span>
<span class="normal">6634</span>
<span class="normal">6635</span>
<span class="normal">6636</span>
<span class="normal">6637</span>
<span class="normal">6638</span>
<span class="normal">6639</span>
<span class="normal">6640</span>
<span class="normal">6641</span>
<span class="normal">6642</span>
<span class="normal">6643</span>
<span class="normal">6644</span>
<span class="normal">6645</span>
<span class="normal">6646</span>
<span class="normal">6647</span>
<span class="normal">6648</span>
<span class="normal">6649</span>
<span class="normal">6650</span>
<span class="normal">6651</span>
<span class="normal">6652</span>
<span class="normal">6653</span>
<span class="normal">6654</span>
<span class="normal">6655</span>
<span class="normal">6656</span>
<span class="normal">6657</span>
<span class="normal">6658</span>
<span class="normal">6659</span>
<span class="normal">6660</span>
<span class="normal">6661</span>
<span class="normal">6662</span>
<span class="normal">6663</span>
<span class="normal">6664</span>
<span class="normal">6665</span>
<span class="normal">6666</span>
<span class="normal">6667</span>
<span class="normal">6668</span>
<span class="normal">6669</span>
<span class="normal">6670</span>
<span class="normal">6671</span>
<span class="normal">6672</span>
<span class="normal">6673</span>
<span class="normal">6674</span>
<span class="normal">6675</span>
<span class="normal">6676</span>
<span class="normal">6677</span>
<span class="normal">6678</span>
<span class="normal">6679</span>
<span class="normal">6680</span>
<span class="normal">6681</span>
<span class="normal">6682</span>
<span class="normal">6683</span>
<span class="normal">6684</span>
<span class="normal">6685</span>
<span class="normal">6686</span>
<span class="normal">6687</span>
<span class="normal">6688</span>
<span class="normal">6689</span>
<span class="normal">6690</span>
<span class="normal">6691</span>
<span class="normal">6692</span>
<span class="normal">6693</span>
<span class="normal">6694</span>
<span class="normal">6695</span>
<span class="normal">6696</span>
<span class="normal">6697</span>
<span class="normal">6698</span>
<span class="normal">6699</span>
<span class="normal">6700</span>
<span class="normal">6701</span>
<span class="normal">6702</span>
<span class="normal">6703</span>
<span class="normal">6704</span>
<span class="normal">6705</span>
<span class="normal">6706</span>
<span class="normal">6707</span>
<span class="normal">6708</span>
<span class="normal">6709</span>
<span class="normal">6710</span>
<span class="normal">6711</span>
<span class="normal">6712</span>
<span class="normal">6713</span>
<span class="normal">6714</span>
<span class="normal">6715</span>
<span class="normal">6716</span>
<span class="normal">6717</span>
<span class="normal">6718</span>
<span class="normal">6719</span>
<span class="normal">6720</span>
<span class="normal">6721</span>
<span class="normal">6722</span>
<span class="normal">6723</span>
<span class="normal">6724</span>
<span class="normal">6725</span>
<span class="normal">6726</span>
<span class="normal">6727</span>
<span class="normal">6728</span>
<span class="normal">6729</span>
<span class="normal">6730</span>
<span class="normal">6731</span>
<span class="normal">6732</span>
<span class="normal">6733</span>
<span class="normal">6734</span>
<span class="normal">6735</span>
<span class="normal">6736</span>
<span class="normal">6737</span>
<span class="normal">6738</span>
<span class="normal">6739</span>
<span class="normal">6740</span>
<span class="normal">6741</span>
<span class="normal">6742</span>
<span class="normal">6743</span>
<span class="normal">6744</span>
<span class="normal">6745</span>
<span class="normal">6746</span>
<span class="normal">6747</span>
<span class="normal">6748</span>
<span class="normal">6749</span>
<span class="normal">6750</span>
<span class="normal">6751</span>
<span class="normal">6752</span>
<span class="normal">6753</span>
<span class="normal">6754</span>
<span class="normal">6755</span>
<span class="normal">6756</span>
<span class="normal">6757</span>
<span class="normal">6758</span>
<span class="normal">6759</span>
<span class="normal">6760</span>
<span class="normal">6761</span>
<span class="normal">6762</span>
<span class="normal">6763</span>
<span class="normal">6764</span>
<span class="normal">6765</span>
<span class="normal">6766</span>
<span class="normal">6767</span>
<span class="normal">6768</span>
<span class="normal">6769</span>
<span class="normal">6770</span>
<span class="normal">6771</span>
<span class="normal">6772</span>
<span class="normal">6773</span>
<span class="normal">6774</span>
<span class="normal">6775</span>
<span class="normal">6776</span>
<span class="normal">6777</span>
<span class="normal">6778</span>
<span class="normal">6779</span>
<span class="normal">6780</span>
<span class="normal">6781</span>
<span class="normal">6782</span>
<span class="normal">6783</span>
<span class="normal">6784</span>
<span class="normal">6785</span>
<span class="normal">6786</span>
<span class="normal">6787</span>
<span class="normal">6788</span>
<span class="normal">6789</span>
<span class="normal">6790</span>
<span class="normal">6791</span>
<span class="normal">6792</span>
<span class="normal">6793</span>
<span class="normal">6794</span>
<span class="normal">6795</span>
<span class="normal">6796</span>
<span class="normal">6797</span>
<span class="normal">6798</span>
<span class="normal">6799</span>
<span class="normal">6800</span>
<span class="normal">6801</span>
<span class="normal">6802</span>
<span class="normal">6803</span>
<span class="normal">6804</span>
<span class="normal">6805</span>
<span class="normal">6806</span>
<span class="normal">6807</span>
<span class="normal">6808</span>
<span class="normal">6809</span>
<span class="normal">6810</span>
<span class="normal">6811</span>
<span class="normal">6812</span>
<span class="normal">6813</span>
<span class="normal">6814</span>
<span class="normal">6815</span>
<span class="normal">6816</span>
<span class="normal">6817</span>
<span class="normal">6818</span>
<span class="normal">6819</span>
<span class="normal">6820</span>
<span class="normal">6821</span>
<span class="normal">6822</span>
<span class="normal">6823</span>
<span class="normal">6824</span>
<span class="normal">6825</span>
<span class="normal">6826</span>
<span class="normal">6827</span>
<span class="normal">6828</span>
<span class="normal">6829</span>
<span class="normal">6830</span>
<span class="normal">6831</span>
<span class="normal">6832</span>
<span class="normal">6833</span>
<span class="normal">6834</span>
<span class="normal">6835</span>
<span class="normal">6836</span>
<span class="normal">6837</span>
<span class="normal">6838</span>
<span class="normal">6839</span>
<span class="normal">6840</span>
<span class="normal">6841</span>
<span class="normal">6842</span>
<span class="normal">6843</span>
<span class="normal">6844</span>
<span class="normal">6845</span>
<span class="normal">6846</span>
<span class="normal">6847</span>
<span class="normal">6848</span>
<span class="normal">6849</span>
<span class="normal">6850</span>
<span class="normal">6851</span>
<span class="normal">6852</span>
<span class="normal">6853</span>
<span class="normal">6854</span>
<span class="normal">6855</span>
<span class="normal">6856</span>
<span class="normal">6857</span>
<span class="normal">6858</span>
<span class="normal">6859</span>
<span class="normal">6860</span>
<span class="normal">6861</span>
<span class="normal">6862</span>
<span class="normal">6863</span>
<span class="normal">6864</span>
<span class="normal">6865</span>
<span class="normal">6866</span>
<span class="normal">6867</span>
<span class="normal">6868</span>
<span class="normal">6869</span>
<span class="normal">6870</span>
<span class="normal">6871</span>
<span class="normal">6872</span>
<span class="normal">6873</span>
<span class="normal">6874</span>
<span class="normal">6875</span>
<span class="normal">6876</span>
<span class="normal">6877</span>
<span class="normal">6878</span>
<span class="normal">6879</span>
<span class="normal">6880</span>
<span class="normal">6881</span>
<span class="normal">6882</span>
<span class="normal">6883</span>
<span class="normal">6884</span>
<span class="normal">6885</span>
<span class="normal">6886</span>
<span class="normal">6887</span>
<span class="normal">6888</span>
<span class="normal">6889</span>
<span class="normal">6890</span>
<span class="normal">6891</span>
<span class="normal">6892</span>
<span class="normal">6893</span>
<span class="normal">6894</span>
<span class="normal">6895</span>
<span class="normal">6896</span>
<span class="normal">6897</span>
<span class="normal">6898</span>
<span class="normal">6899</span>
<span class="normal">6900</span>
<span class="normal">6901</span>
<span class="normal">6902</span>
<span class="normal">6903</span>
<span class="normal">6904</span>
<span class="normal">6905</span>
<span class="normal">6906</span>
<span class="normal">6907</span>
<span class="normal">6908</span>
<span class="normal">6909</span>
<span class="normal">6910</span>
<span class="normal">6911</span>
<span class="normal">6912</span>
<span class="normal">6913</span>
<span class="normal">6914</span>
<span class="normal">6915</span>
<span class="normal">6916</span>
<span class="normal">6917</span>
<span class="normal">6918</span>
<span class="normal">6919</span>
<span class="normal">6920</span>
<span class="normal">6921</span>
<span class="normal">6922</span>
<span class="normal">6923</span>
<span class="normal">6924</span>
<span class="normal">6925</span>
<span class="normal">6926</span>
<span class="normal">6927</span>
<span class="normal">6928</span>
<span class="normal">6929</span>
<span class="normal">6930</span>
<span class="normal">6931</span>
<span class="normal">6932</span>
<span class="normal">6933</span>
<span class="normal">6934</span>
<span class="normal">6935</span>
<span class="normal">6936</span>
<span class="normal">6937</span>
<span class="normal">6938</span>
<span class="normal">6939</span>
<span class="normal">6940</span>
<span class="normal">6941</span>
<span class="normal">6942</span>
<span class="normal">6943</span>
<span class="normal">6944</span>
<span class="normal">6945</span>
<span class="normal">6946</span>
<span class="normal">6947</span>
<span class="normal">6948</span>
<span class="normal">6949</span>
<span class="normal">6950</span>
<span class="normal">6951</span>
<span class="normal">6952</span>
<span class="normal">6953</span>
<span class="normal">6954</span>
<span class="normal">6955</span>
<span class="normal">6956</span>
<span class="normal">6957</span>
<span class="normal">6958</span>
<span class="normal">6959</span>
<span class="normal">6960</span>
<span class="normal">6961</span>
<span class="normal">6962</span>
<span class="normal">6963</span>
<span class="normal">6964</span>
<span class="normal">6965</span>
<span class="normal">6966</span>
<span class="normal">6967</span>
<span class="normal">6968</span>
<span class="normal">6969</span>
<span class="normal">6970</span>
<span class="normal">6971</span>
<span class="normal">6972</span>
<span class="normal">6973</span>
<span class="normal">6974</span>
<span class="normal">6975</span>
<span class="normal">6976</span>
<span class="normal">6977</span>
<span class="normal">6978</span>
<span class="normal">6979</span>
<span class="normal">6980</span>
<span class="normal">6981</span>
<span class="normal">6982</span>
<span class="normal">6983</span>
<span class="normal">6984</span>
<span class="normal">6985</span>
<span class="normal">6986</span>
<span class="normal">6987</span>
<span class="normal">6988</span>
<span class="normal">6989</span>
<span class="normal">6990</span>
<span class="normal">6991</span>
<span class="normal">6992</span>
<span class="normal">6993</span>
<span class="normal">6994</span>
<span class="normal">6995</span>
<span class="normal">6996</span>
<span class="normal">6997</span>
<span class="normal">6998</span>
<span class="normal">6999</span>
<span class="normal">7000</span>
<span class="normal">7001</span>
<span class="normal">7002</span>
<span class="normal">7003</span>
<span class="normal">7004</span>
<span class="normal">7005</span>
<span class="normal">7006</span>
<span class="normal">7007</span>
<span class="normal">7008</span>
<span class="normal">7009</span>
<span class="normal">7010</span>
<span class="normal">7011</span>
<span class="normal">7012</span>
<span class="normal">7013</span>
<span class="normal">7014</span>
<span class="normal">7015</span>
<span class="normal">7016</span>
<span class="normal">7017</span>
<span class="normal">7018</span>
<span class="normal">7019</span>
<span class="normal">7020</span>
<span class="normal">7021</span>
<span class="normal">7022</span>
<span class="normal">7023</span>
<span class="normal">7024</span>
<span class="normal">7025</span>
<span class="normal">7026</span>
<span class="normal">7027</span>
<span class="normal">7028</span>
<span class="normal">7029</span>
<span class="normal">7030</span>
<span class="normal">7031</span>
<span class="normal">7032</span>
<span class="normal">7033</span>
<span class="normal">7034</span>
<span class="normal">7035</span>
<span class="normal">7036</span>
<span class="normal">7037</span>
<span class="normal">7038</span>
<span class="normal">7039</span>
<span class="normal">7040</span>
<span class="normal">7041</span>
<span class="normal">7042</span>
<span class="normal">7043</span>
<span class="normal">7044</span>
<span class="normal">7045</span>
<span class="normal">7046</span>
<span class="normal">7047</span>
<span class="normal">7048</span>
<span class="normal">7049</span>
<span class="normal">7050</span>
<span class="normal">7051</span>
<span class="normal">7052</span>
<span class="normal">7053</span>
<span class="normal">7054</span>
<span class="normal">7055</span>
<span class="normal">7056</span>
<span class="normal">7057</span>
<span class="normal">7058</span>
<span class="normal">7059</span>
<span class="normal">7060</span>
<span class="normal">7061</span>
<span class="normal">7062</span>
<span class="normal">7063</span>
<span class="normal">7064</span>
<span class="normal">7065</span>
<span class="normal">7066</span>
<span class="normal">7067</span>
<span class="normal">7068</span>
<span class="normal">7069</span>
<span class="normal">7070</span>
<span class="normal">7071</span>
<span class="normal">7072</span>
<span class="normal">7073</span>
<span class="normal">7074</span>
<span class="normal">7075</span>
<span class="normal">7076</span>
<span class="normal">7077</span>
<span class="normal">7078</span>
<span class="normal">7079</span>
<span class="normal">7080</span>
<span class="normal">7081</span>
<span class="normal">7082</span>
<span class="normal">7083</span>
<span class="normal">7084</span>
<span class="normal">7085</span>
<span class="normal">7086</span>
<span class="normal">7087</span>
<span class="normal">7088</span>
<span class="normal">7089</span>
<span class="normal">7090</span>
<span class="normal">7091</span>
<span class="normal">7092</span>
<span class="normal">7093</span>
<span class="normal">7094</span>
<span class="normal">7095</span>
<span class="normal">7096</span>
<span class="normal">7097</span>
<span class="normal">7098</span>
<span class="normal">7099</span>
<span class="normal">7100</span>
<span class="normal">7101</span>
<span class="normal">7102</span>
<span class="normal">7103</span>
<span class="normal">7104</span>
<span class="normal">7105</span>
<span class="normal">7106</span>
<span class="normal">7107</span>
<span class="normal">7108</span>
<span class="normal">7109</span>
<span class="normal">7110</span>
<span class="normal">7111</span>
<span class="normal">7112</span>
<span class="normal">7113</span>
<span class="normal">7114</span>
<span class="normal">7115</span>
<span class="normal">7116</span>
<span class="normal">7117</span>
<span class="normal">7118</span>
<span class="normal">7119</span>
<span class="normal">7120</span>
<span class="normal">7121</span>
<span class="normal">7122</span>
<span class="normal">7123</span>
<span class="normal">7124</span>
<span class="normal">7125</span>
<span class="normal">7126</span>
<span class="normal">7127</span>
<span class="normal">7128</span>
<span class="normal">7129</span>
<span class="normal">7130</span>
<span class="normal">7131</span>
<span class="normal">7132</span>
<span class="normal">7133</span>
<span class="normal">7134</span>
<span class="normal">7135</span>
<span class="normal">7136</span>
<span class="normal">7137</span>
<span class="normal">7138</span>
<span class="normal">7139</span>
<span class="normal">7140</span>
<span class="normal">7141</span>
<span class="normal">7142</span>
<span class="normal">7143</span>
<span class="normal">7144</span>
<span class="normal">7145</span>
<span class="normal">7146</span>
<span class="normal">7147</span>
<span class="normal">7148</span>
<span class="normal">7149</span>
<span class="normal">7150</span>
<span class="normal">7151</span>
<span class="normal">7152</span>
<span class="normal">7153</span>
<span class="normal">7154</span>
<span class="normal">7155</span>
<span class="normal">7156</span>
<span class="normal">7157</span>
<span class="normal">7158</span>
<span class="normal">7159</span>
<span class="normal">7160</span>
<span class="normal">7161</span>
<span class="normal">7162</span>
<span class="normal">7163</span>
<span class="normal">7164</span>
<span class="normal">7165</span>
<span class="normal">7166</span>
<span class="normal">7167</span>
<span class="normal">7168</span>
<span class="normal">7169</span>
<span class="normal">7170</span>
<span class="normal">7171</span>
<span class="normal">7172</span>
<span class="normal">7173</span>
<span class="normal">7174</span>
<span class="normal">7175</span>
<span class="normal">7176</span>
<span class="normal">7177</span>
<span class="normal">7178</span>
<span class="normal">7179</span>
<span class="normal">7180</span>
<span class="normal">7181</span>
<span class="normal">7182</span>
<span class="normal">7183</span>
<span class="normal">7184</span>
<span class="normal">7185</span>
<span class="normal">7186</span>
<span class="normal">7187</span>
<span class="normal">7188</span>
<span class="normal">7189</span>
<span class="normal">7190</span>
<span class="normal">7191</span>
<span class="normal">7192</span>
<span class="normal">7193</span>
<span class="normal">7194</span>
<span class="normal">7195</span>
<span class="normal">7196</span>
<span class="normal">7197</span>
<span class="normal">7198</span>
<span class="normal">7199</span>
<span class="normal">7200</span>
<span class="normal">7201</span>
<span class="normal">7202</span>
<span class="normal">7203</span>
<span class="normal">7204</span>
<span class="normal">7205</span>
<span class="normal">7206</span>
<span class="normal">7207</span>
<span class="normal">7208</span>
<span class="normal">7209</span>
<span class="normal">7210</span>
<span class="normal">7211</span>
<span class="normal">7212</span>
<span class="normal">7213</span>
<span class="normal">7214</span>
<span class="normal">7215</span>
<span class="normal">7216</span>
<span class="normal">7217</span>
<span class="normal">7218</span>
<span class="normal">7219</span>
<span class="normal">7220</span>
<span class="normal">7221</span>
<span class="normal">7222</span>
<span class="normal">7223</span>
<span class="normal">7224</span>
<span class="normal">7225</span>
<span class="normal">7226</span>
<span class="normal">7227</span>
<span class="normal">7228</span>
<span class="normal">7229</span>
<span class="normal">7230</span>
<span class="normal">7231</span>
<span class="normal">7232</span>
<span class="normal">7233</span>
<span class="normal">7234</span>
<span class="normal">7235</span>
<span class="normal">7236</span>
<span class="normal">7237</span>
<span class="normal">7238</span>
<span class="normal">7239</span>
<span class="normal">7240</span>
<span class="normal">7241</span>
<span class="normal">7242</span>
<span class="normal">7243</span>
<span class="normal">7244</span>
<span class="normal">7245</span>
<span class="normal">7246</span>
<span class="normal">7247</span>
<span class="normal">7248</span>
<span class="normal">7249</span>
<span class="normal">7250</span>
<span class="normal">7251</span>
<span class="normal">7252</span>
<span class="normal">7253</span>
<span class="normal">7254</span>
<span class="normal">7255</span>
<span class="normal">7256</span>
<span class="normal">7257</span>
<span class="normal">7258</span>
<span class="normal">7259</span>
<span class="normal">7260</span>
<span class="normal">7261</span>
<span class="normal">7262</span>
<span class="normal">7263</span>
<span class="normal">7264</span>
<span class="normal">7265</span>
<span class="normal">7266</span>
<span class="normal">7267</span>
<span class="normal">7268</span>
<span class="normal">7269</span>
<span class="normal">7270</span>
<span class="normal">7271</span>
<span class="normal">7272</span>
<span class="normal">7273</span>
<span class="normal">7274</span>
<span class="normal">7275</span>
<span class="normal">7276</span>
<span class="normal">7277</span>
<span class="normal">7278</span>
<span class="normal">7279</span>
<span class="normal">7280</span>
<span class="normal">7281</span>
<span class="normal">7282</span>
<span class="normal">7283</span>
<span class="normal">7284</span>
<span class="normal">7285</span>
<span class="normal">7286</span>
<span class="normal">7287</span>
<span class="normal">7288</span>
<span class="normal">7289</span>
<span class="normal">7290</span>
<span class="normal">7291</span>
<span class="normal">7292</span>
<span class="normal">7293</span>
<span class="normal">7294</span>
<span class="normal">7295</span>
<span class="normal">7296</span>
<span class="normal">7297</span>
<span class="normal">7298</span>
<span class="normal">7299</span>
<span class="normal">7300</span>
<span class="normal">7301</span>
<span class="normal">7302</span>
<span class="normal">7303</span>
<span class="normal">7304</span>
<span class="normal">7305</span>
<span class="normal">7306</span>
<span class="normal">7307</span>
<span class="normal">7308</span>
<span class="normal">7309</span>
<span class="normal">7310</span>
<span class="normal">7311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">inverse_batschelet_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Inverse Batschelet Distribution</span>

<span class="sd">    ![inverse-batschelet](../images/circ-mod-inverse-batschelet.png)</span>

<span class="sd">    The inverse Batschelet family (Pewsey, Neuhaüser &amp; Ruxton, 2014, §4.3.13)</span>
<span class="sd">    extends the von Mises distribution by applying two inverse angular warps:</span>
<span class="sd">    a &quot;peakedness&quot; transform controlled by $\nu$, and an inverse</span>
<span class="sd">    Batschelet skew transform governed by $\lambda$. The resulting density on</span>
<span class="sd">    $[0, 2\pi)$ takes the form</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = c(\kappa, \lambda)</span>
<span class="sd">    \exp\left[\kappa \cos\left(a\,t_\nu^{-1}(\varphi) + b\,s_\lambda^{-1}\bigl(t_\nu^{-1}(\varphi)\bigr)\right)\right],</span>
<span class="sd">    $$</span>

<span class="sd">    where $\varphi = (\theta - \xi) \bmod 2\pi - \pi$,</span>
<span class="sd">    $a = \tfrac{1 - \lambda}{1 + \lambda}$,</span>
<span class="sd">    $b = \tfrac{2\lambda}{1 + \lambda}$, and the normalising constant</span>
<span class="sd">    $c(\kappa, \lambda)$ depends only on $\kappa$ and $\lambda$.</span>
<span class="sd">    Setting $\nu = \lambda = 0$ recovers the von Mises distribution, while</span>
<span class="sd">    $\kappa \to 0$ yields the circular uniform law. Parameters must be scalar;</span>
<span class="sd">    cached normalisation tables are built per parameter set.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, xi, kappa, nu, lmbd)</span>
<span class="sd">        Probability density function.</span>

<span class="sd">    cdf(x, xi, kappa, nu, lmbd)</span>
<span class="sd">        Cumulative distribution function.</span>

<span class="sd">    ppf(q, xi, kappa, nu, lmbd)</span>
<span class="sd">        Percent-point function (inverse CDF).</span>

<span class="sd">    rvs(xi, kappa, nu, lmbd, size=None, random_state=None)</span>
<span class="sd">        Random variates via von Mises acceptance–rejection.</span>

<span class="sd">    fit(data, *, method=&#39;mle&#39;, ...)</span>
<span class="sd">        Moments or maximum-likelihood parameter estimation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_table_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_clear_normalization_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_table_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_sampler_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">xi_arr</span><span class="p">,</span> <span class="n">kappa_arr</span><span class="p">,</span> <span class="n">nu_arr</span><span class="p">,</span> <span class="n">lmbd_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">xi_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">kappa_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_arr</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">nu_arr</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lmbd_arr</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lmbd_arr</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">scalar_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="k">if</span> <span class="n">scalar_input</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xi_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">scalar_input</span> <span class="k">else</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">scalar_input</span> <span class="k">else</span> <span class="n">result</span>

        <span class="n">normalizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_normalizer</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">_c_invbatschelet</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">),</span>
            <span class="n">kappa_val</span><span class="p">,</span>
            <span class="n">lmbd_val</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">normalizer</span><span class="p">)</span> <span class="ow">or</span> <span class="n">normalizer</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">normalizer</span> <span class="o">=</span> <span class="n">_c_invbatschelet_numeric</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="n">_INVBAT_NUMERIC_GRID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">normalizer</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="n">_tnu</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">)</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="n">_slmbdinv</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">):</span>
            <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">con1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lmbd_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd_val</span><span class="p">)</span>
            <span class="n">con2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">lmbd_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd_val</span><span class="p">)</span>
            <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">con1</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">+</span> <span class="n">con2</span> <span class="o">*</span> <span class="n">skew</span><span class="p">)</span>

        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">normalizer</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_kernel</span><span class="p">)</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">pdf_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pdf_vals</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function (PDF) of the inverse Batschelet distribution.</span>

<span class="sd">        Let</span>

<span class="sd">        - $\varphi = ((\theta - \xi + \pi) \bmod 2\pi) - \pi$,</span>
<span class="sd">        - $t_\nu^{-1}(\varphi)$ solve $y - \nu (1 + \cos y) = \varphi$,</span>
<span class="sd">        - $s_\lambda^{-1}(\cdot)$ solve $u - \tfrac{1 + \lambda}{2} \sin u = \cdot$,</span>

<span class="sd">        and set</span>
<span class="sd">        $\phi^\star = t_\nu^{-1}(\varphi)$,</span>
<span class="sd">        $u^\star = s_\lambda^{-1}(\phi^\star)$,</span>
<span class="sd">        $a = \tfrac{1 - \lambda}{1 + \lambda}$,</span>
<span class="sd">        $b = \tfrac{2 \lambda}{1 + \lambda}$.</span>
<span class="sd">        The inverse Batschelet density is</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = c(\kappa, \lambda)</span>
<span class="sd">        \exp\bigl[\kappa \cos\bigl(a\,\phi^\star + b\,u^\star\bigr)\bigr],</span>
<span class="sd">        $$</span>

<span class="sd">        where $c(\kappa,\lambda)$ is the normalising constant (independent of</span>
<span class="sd">        $\xi$ and $\nu$). For $\kappa \rightarrow 0$ the distribution reduces to</span>
<span class="sd">        the circular uniform density $1/(2\pi)$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$. Higher values result in sharper peaks around $\xi$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \leq \nu \leq 1$. Controls asymmetry through angular transformation.</span>
<span class="sd">        lmbd : float</span>
<span class="sd">            Skewness parameter, $-1 \leq \lambda \leq 1$. Controls the degree of skewness in the distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Values of the probability density function at the specified points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xi_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="n">two_pi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">flat</span> <span class="o">-</span> <span class="n">xi_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">phi_start</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">xi_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">](</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">](</span><span class="n">phi_start</span><span class="p">))</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">H</span> <span class="o">-</span> <span class="n">H_start</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diff</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">wrapped</span><span class="p">),</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">cdf_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">mask_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask_upper</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">value</span><span class="p">[</span><span class="n">mask_upper</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the inverse Batschelet distribution.</span>

<span class="sd">        The implementation precomputes the normalised primitive on a periodic grid</span>
<span class="sd">        in the centred angle $\varphi = (\theta - \xi) \bmod 2\pi - \pi$. For each</span>
<span class="sd">        grid node, the inverse peakedness transform $t_\nu^{-1}$ and inverse</span>
<span class="sd">        Batschelet skew $s_\lambda^{-1}$ are evaluated, and the resulting kernel is</span>
<span class="sd">        accumulated via a trapezoidal rule. The cumulative table is cached per</span>
<span class="sd">        parameter triple $(\kappa, \nu, \lambda)$, enabling $O(1)$ queries after the</span>
<span class="sd">        initial $O(N)$ precomputation. The limit $\kappa \to 0$ reduces to the</span>
<span class="sd">        circular uniform CDF $\theta / (2\pi)$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">        lmbd : float</span>
<span class="sd">            Skewness parameter, $-1 \leq \lambda \leq 1$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative probabilities corresponding to `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span> <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">shaped</span>

        <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
        <span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="n">close_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">two_pi</span> <span class="o">*</span> <span class="n">q_valid</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_zero</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_zero</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">close_one</span><span class="p">):</span>
                <span class="n">theta</span><span class="p">[</span><span class="n">close_one</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>
            <span class="n">phi_grid</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
            <span class="n">cdf_grid</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf&quot;</span><span class="p">]</span>
            <span class="n">cdf_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;cdf_interp&quot;</span><span class="p">]</span>
            <span class="n">inv_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;inv_cdf_interp&quot;</span><span class="p">]</span>
            <span class="n">pdf_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf_interp&quot;</span><span class="p">]</span>

            <span class="n">phi_start</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">xi_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">H_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_interp</span><span class="p">(</span><span class="n">phi_start</span><span class="p">))</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_start</span> <span class="o">+</span> <span class="n">q_valid</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>

            <span class="n">phi_candidates</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">inv_interp</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inv_interp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">cdf_grid</span><span class="p">,</span> <span class="n">phi_grid</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">phi_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">phi_grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>

            <span class="n">theta_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">phi0</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">phi_candidates</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">close_zero</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">close_one</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                    <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
                    <span class="k">continue</span>

                <span class="n">i_hi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cdf_grid</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">phi_lo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">[</span><span class="n">i_hi</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">phi_hi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">phi_grid</span><span class="p">[</span><span class="n">i_hi</span><span class="p">])</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">phi0</span><span class="p">,</span> <span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_INVBAT_NEWTON_MAXITER</span><span class="p">):</span>
                    <span class="n">H_phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_interp</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
                    <span class="n">residual</span> <span class="o">=</span> <span class="n">H_phi</span> <span class="o">-</span> <span class="n">target</span>
                    <span class="n">pdf_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pdf_interp</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
                    <span class="n">pdf_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pdf_val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_NEWTON_TOL</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phi_hi</span> <span class="o">-</span> <span class="n">phi_lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">phi_hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">phi_hi</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">phi_lo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

                    <span class="n">step</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">/</span> <span class="n">pdf_val</span>
                    <span class="n">phi_candidate</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">-</span> <span class="n">step</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">phi_candidate</span><span class="p">)</span> <span class="ow">or</span> <span class="n">phi_candidate</span> <span class="o">&lt;=</span> <span class="n">phi_lo</span> <span class="ow">or</span> <span class="n">phi_candidate</span> <span class="o">&gt;=</span> <span class="n">phi_hi</span><span class="p">:</span>
                        <span class="n">phi_candidate</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi_lo</span> <span class="o">+</span> <span class="n">phi_hi</span><span class="p">)</span>
                    <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">phi_candidate</span><span class="p">,</span> <span class="n">phi_lo</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">))</span>

                <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_val</span> <span class="o">+</span> <span class="n">phi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

            <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_vals</span>

        <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shaped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percent-point function (quantile) of the inverse Batschelet distribution.</span>

<span class="sd">        Quantiles are obtained by inverting the cached cumulative table described in</span>
<span class="sd">        `cdf`. A monotone initial guess supplied by the table inverse is refined</span>
<span class="sd">        with safeguarded Newton steps that leverage the tabulated density, while</span>
<span class="sd">        preserving a bracketing interval. For $\kappa \rightarrow 0$, the quantile</span>
<span class="sd">        reduces to the linear uniform mapping $2\pi q$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">        lmbd : float</span>
<span class="sd">            Skewness parameter, $-1 \leq \lambda \leq 1$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ppf_values : array_like</span>
<span class="sd">            Angles corresponding to the probabilities in `q`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_invbat_sampler_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd</span><span class="p">))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_sampler_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">]</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf&quot;</span><span class="p">]</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">idx0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">idx0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">idx0</span> <span class="o">==</span> <span class="n">phi</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idx0</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">idx0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="n">idx0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">idx0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="n">idx0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">h1</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">h2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">curvature</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">log_pdf</span><span class="p">[</span><span class="n">idx0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">[</span><span class="n">idx0</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">log_pdf</span><span class="p">[</span><span class="n">idx0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">h1</span> <span class="o">+</span> <span class="n">h2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">curvature</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>

        <span class="n">kappa_env</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">curvature</span><span class="p">,</span> <span class="n">_INVBAT_ENV_MIN_KAPPA</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">log_vm_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa_env</span><span class="p">))</span> <span class="o">+</span> <span class="n">kappa_env</span>
        <span class="n">log_ratio</span> <span class="o">=</span> <span class="n">log_pdf</span> <span class="o">+</span> <span class="n">log_vm_norm</span> <span class="o">-</span> <span class="n">kappa_env</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">log_multiplier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_ratio</span><span class="p">))</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_multiplier</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.02</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;kappa_env&quot;</span><span class="p">:</span> <span class="n">kappa_env</span><span class="p">,</span>
            <span class="s2">&quot;log_vm_norm&quot;</span><span class="p">:</span> <span class="n">log_vm_norm</span><span class="p">,</span>
            <span class="s2">&quot;log_multiplier&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">multiplier</span><span class="p">),</span>
            <span class="s2">&quot;multiplier&quot;</span><span class="p">:</span> <span class="n">multiplier</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_sampler_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xi_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">nu_val</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lmbd_val</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`xi`, `kappa`, `nu`, and `lmbd` must be finite scalars.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`size` must describe a non-negative number of samples.&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">empty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span> <span class="k">if</span> <span class="n">empty</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">empty</span>

        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">samples</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>
        <span class="n">sampler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_sampler_params</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>
        <span class="n">kappa_env</span> <span class="o">=</span> <span class="n">sampler</span><span class="p">[</span><span class="s2">&quot;kappa_env&quot;</span><span class="p">]</span>
        <span class="n">log_vm_norm</span> <span class="o">=</span> <span class="n">sampler</span><span class="p">[</span><span class="s2">&quot;log_vm_norm&quot;</span><span class="p">]</span>
        <span class="n">log_multiplier</span> <span class="o">=</span> <span class="n">sampler</span><span class="p">[</span><span class="s2">&quot;log_multiplier&quot;</span><span class="p">]</span>
        <span class="n">pdf_interp</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf_interp&quot;</span><span class="p">]</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">batch_base</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">total</span><span class="p">,</span> <span class="mi">4096</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">filled</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">batch_base</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span><span class="p">)</span> <span class="k">if</span> <span class="n">filled</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">batch_base</span>
            <span class="n">proposals</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">vonmises</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_env</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">batch</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">proposals</span> <span class="o">-</span> <span class="n">xi_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_interp</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">log_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)</span>
            <span class="n">log_env</span> <span class="o">=</span> <span class="n">kappa_env</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">log_vm_norm</span>
            <span class="n">log_accept</span> <span class="o">=</span> <span class="n">log_target</span> <span class="o">-</span> <span class="n">log_env</span> <span class="o">-</span> <span class="n">log_multiplier</span>

            <span class="n">accept_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">batch</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">log_accept</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">accept_mask</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">accepted</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">accept_mask</span><span class="p">]</span>
            <span class="n">take</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">accepted</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">filled</span><span class="p">)</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">filled</span> <span class="p">:</span> <span class="n">filled</span> <span class="o">+</span> <span class="n">take</span><span class="p">]</span> <span class="o">=</span> <span class="n">accepted</span><span class="p">[:</span><span class="n">take</span><span class="p">]</span>
            <span class="n">filled</span> <span class="o">+=</span> <span class="n">take</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">)</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">samples</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lmbd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw random variates from the inverse Batschelet distribution.</span>

<span class="sd">        Sampling proceeds by acceptance--rejection with a von Mises envelope whose</span>
<span class="sd">        concentration is matched to the curvature of the inverse Batschelet kernel at</span>
<span class="sd">        the mode. Envelope constants are calibrated on the cached spectral grid used</span>
<span class="sd">        for `cdf`, so repeated sampling calls with the same parameters are fast</span>
<span class="sd">        and stable across the entire parameter range.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xi : float</span>
<span class="sd">            Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">        kappa : float</span>
<span class="sd">            Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">        nu : float</span>
<span class="sd">            Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">        lmbd : float</span>
<span class="sd">            Skewness parameter, $-1 \leq \lambda \leq 1$.</span>
<span class="sd">        size : int or tuple of ints, optional</span>
<span class="sd">            Desired output shape.</span>
<span class="sd">        random_state : {None, int, np.random.Generator}, optional</span>
<span class="sd">            Random number generator specification.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rvs : array_like</span>
<span class="sd">            Random variates on $[0, 2\pi)$ sampled from the inverse Batschelet</span>
<span class="sd">            distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">lmbd_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">),</span>
        <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate $(\xi, \kappa, \nu, \lambda)$ from circular data.</span>

<span class="sd">        ``method=&#39;mle&#39;`` maximises the weighted log-likelihood using the cached</span>
<span class="sd">        spectral tables for the pdf and normalising constant. ``method=&#39;moments&#39;``</span>
<span class="sd">        returns the circular mean, ``circ_kappa`` estimate, and sets $(\nu, \lambda)</span>
<span class="sd">        = (0, 0)$.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Sample of angles.</span>
<span class="sd">        weights : array_like, optional</span>
<span class="sd">            Non-negative weights broadcastable to ``data``.</span>
<span class="sd">        method : {&#39;mle&#39;, &#39;moments&#39;}, default &#39;mle&#39;</span>
<span class="sd">            Estimation method.</span>
<span class="sd">        optimizer : str, optional</span>
<span class="sd">            SciPy optimiser for maximum likelihood.</span>
<span class="sd">        options : dict, optional</span>
<span class="sd">            Optimiser options forwarded to :func:`scipy.optimize.minimize`.</span>
<span class="sd">        nu_grid : array_like, optional</span>
<span class="sd">            Candidate $</span>
<span class="sd">            u$ values for profiling the starting point.</span>
<span class="sd">        lmbd_grid : array_like, optional</span>
<span class="sd">            Candidate $</span>
<span class="sd">            u$ values for $</span>
<span class="sd">            lambda$ profiling.</span>
<span class="sd">        kappa_bounds, nu_bounds, lmbd_bounds : tuple, optional</span>
<span class="sd">            Parameter bounds enforced during optimisation.</span>
<span class="sd">        return_info : bool, optional</span>
<span class="sd">            If True, also return a dictionary with optimisation diagnostics.</span>
<span class="sd">        **minimize_kwargs :</span>
<span class="sd">            Additional keyword arguments forwarded to</span>
<span class="sd">            :func:`scipy.optimize.minimize`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        params : tuple</span>
<span class="sd">            Estimated parameters ``(xi, kappa, nu, lmbd)``.</span>
<span class="sd">        info : dict, optional</span>
<span class="sd">            Returned when ``return_info=True`` with optimisation diagnostics.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">xi_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xi_mom</span><span class="p">):</span>
            <span class="n">xi_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">xi_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
        <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="k">if</span> <span class="n">kappa_mom</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39; }.&quot;</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">nu_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nu_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lmbd_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lmbd_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lmbd_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lmbd_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">nu_param</span><span class="p">,</span> <span class="n">lmbd_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">xi_param</span> <span class="o">&lt;=</span> <span class="n">two_pi</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;=</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lmbd_param</span> <span class="o">&lt;=</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
                <span class="n">log_pdf</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">two_pi</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_param</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_arr</span> <span class="o">-</span> <span class="n">xi_wrapped</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf_interp&quot;</span><span class="p">](</span><span class="n">phi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

        <span class="n">best_nu</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">best_lmbd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">,</span> <span class="n">best_lmbd</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">nu_candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">nu_grid</span><span class="p">))):</span>
            <span class="k">for</span> <span class="n">lmbd_candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">lmbd_grid</span><span class="p">))):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_candidate</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_candidate</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                    <span class="n">best_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_candidate</span><span class="p">)</span>
                    <span class="n">best_lmbd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_candidate</span><span class="p">)</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">,</span> <span class="n">best_lmbd</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">),</span>
            <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
                <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
                <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_invbat_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
        <span class="n">nu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">lmbd_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kappa_val</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">cdf_interp</span> <span class="o">=</span> <span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pdf_interp</span> <span class="o">=</span> <span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">pdf_vals</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span>
                <span class="s2">&quot;pdf&quot;</span><span class="p">:</span> <span class="n">pdf_vals</span><span class="p">,</span>
                <span class="s2">&quot;cdf&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="s2">&quot;cdf_interp&quot;</span><span class="p">:</span> <span class="n">cdf_interp</span><span class="p">,</span>
                <span class="s2">&quot;pdf_interp&quot;</span><span class="p">:</span> <span class="n">pdf_interp</span><span class="p">,</span>
                <span class="s2">&quot;inv_cdf_interp&quot;</span><span class="p">:</span> <span class="n">PchipInterpolator</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">phi</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;log_normalizer&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">grid_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_size</span> <span class="o">=</span> <span class="n">_invbat_grid_size</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">)</span>
        <span class="n">grid_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="n">grid_int</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_table_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_invbat_table</span><span class="p">(</span><span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="n">grid_int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_invbat_table_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_invbat_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">):</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">phi_star</span> <span class="o">=</span> <span class="n">_tnu</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="n">_slmbdinv</span><span class="p">(</span><span class="n">phi_star</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">_INVBAT_LMBDA_TOL</span><span class="p">):</span>
            <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_star</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_star</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">con1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lmbd</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd</span><span class="p">)</span>
            <span class="n">con2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">lmbd</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lmbd</span><span class="p">)</span>
            <span class="n">log_kernel</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">con1</span> <span class="o">*</span> <span class="n">phi_star</span> <span class="o">+</span> <span class="n">con2</span> <span class="o">*</span> <span class="n">skew</span><span class="p">)</span>

        <span class="n">normalizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cached_normalizer</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">_c_invbatschelet</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">),</span>
            <span class="n">kappa</span><span class="p">,</span>
            <span class="n">lmbd</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">normalizer</span><span class="p">)</span> <span class="ow">or</span> <span class="n">normalizer</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">normalizer</span> <span class="o">=</span> <span class="n">_c_invbatschelet_numeric</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="n">_INVBAT_NUMERIC_GRID</span><span class="p">)</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_normalization_cache</span><span class="p">()</span>
            <span class="n">cache</span><span class="p">[(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)]</span> <span class="o">=</span> <span class="n">normalizer</span>

        <span class="n">log_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">normalizer</span><span class="p">)</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">log_norm</span> <span class="o">+</span> <span class="n">log_kernel</span>
        <span class="n">log_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">log_pdf</span><span class="p">,</span> <span class="o">-</span><span class="mf">745.0</span><span class="p">,</span> <span class="mf">700.0</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_pdf</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">grid_size</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">pdf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span> <span class="ow">or</span> <span class="n">mass</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">log_norm</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mass</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">5e-10</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">mass</span>
            <span class="n">pdf</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="n">log_norm</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_normalization_cache</span><span class="p">()</span>
            <span class="n">cache</span><span class="p">[(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_norm</span><span class="p">)</span>

        <span class="n">avg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">pdf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">avg</span><span class="p">)))</span> <span class="o">*</span> <span class="n">step</span>
        <span class="n">cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cumulative</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">cumulative</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">cdf_interp</span> <span class="o">=</span> <span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">unique_vals</span><span class="p">,</span> <span class="n">unique_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cumulative</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">inv_cdf_interp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">phi</span><span class="p">[</span><span class="n">unique_idx</span><span class="p">],</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">unique_vals</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">2</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="n">pdf_interp</span> <span class="o">=</span> <span class="n">PchipInterpolator</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">extrapolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;phi&quot;</span><span class="p">:</span> <span class="n">phi</span><span class="p">,</span>
            <span class="s2">&quot;pdf&quot;</span><span class="p">:</span> <span class="n">pdf</span><span class="p">,</span>
            <span class="s2">&quot;cdf&quot;</span><span class="p">:</span> <span class="n">cumulative</span><span class="p">,</span>
            <span class="s2">&quot;cdf_interp&quot;</span><span class="p">:</span> <span class="n">cdf_interp</span><span class="p">,</span>
            <span class="s2">&quot;pdf_interp&quot;</span><span class="p">:</span> <span class="n">pdf_interp</span><span class="p">,</span>
            <span class="s2">&quot;inv_cdf_interp&quot;</span><span class="p">:</span> <span class="n">inv_cdf_interp</span><span class="p">,</span>
            <span class="s2">&quot;log_normalizer&quot;</span><span class="p">:</span> <span class="n">log_norm</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.inverse_batschelet_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function (PDF) of the inverse Batschelet distribution.</p>
<p>Let</p>
<ul>
<li><span class="arithmatex">\(\varphi = ((\theta - \xi + \pi) \bmod 2\pi) - \pi\)</span>,</li>
<li><span class="arithmatex">\(t_\nu^{-1}(\varphi)\)</span> solve <span class="arithmatex">\(y - \nu (1 + \cos y) = \varphi\)</span>,</li>
<li><span class="arithmatex">\(s_\lambda^{-1}(\cdot)\)</span> solve <span class="arithmatex">\(u - \tfrac{1 + \lambda}{2} \sin u = \cdot\)</span>,</li>
</ul>
<p>and set
<span class="arithmatex">\(\phi^\star = t_\nu^{-1}(\varphi)\)</span>,
<span class="arithmatex">\(u^\star = s_\lambda^{-1}(\phi^\star)\)</span>,
<span class="arithmatex">\(a = \tfrac{1 - \lambda}{1 + \lambda}\)</span>,
<span class="arithmatex">\(b = \tfrac{2 \lambda}{1 + \lambda}\)</span>.
The inverse Batschelet density is</p>
<div class="arithmatex">\[
f(\theta) = c(\kappa, \lambda)
\exp\bigl[\kappa \cos\bigl(a\,\phi^\star + b\,u^\star\bigr)\bigr],
\]</div>
<p>where <span class="arithmatex">\(c(\kappa,\lambda)\)</span> is the normalising constant (independent of
<span class="arithmatex">\(\xi\)</span> and <span class="arithmatex">\(\nu\)</span>). For <span class="arithmatex">\(\kappa \rightarrow 0\)</span> the distribution reduces to
the circular uniform density <span class="arithmatex">\(1/(2\pi)\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the PDF, defined on the interval <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter, <span class="arithmatex">\(0 \leq \xi \leq 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>. Higher values result in sharper peaks around <span class="arithmatex">\(\xi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \leq \nu \leq 1\)</span>. Controls asymmetry through angular transformation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, <span class="arithmatex">\(-1 \leq \lambda \leq 1\)</span>. Controls the degree of skewness in the distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the probability density function at the specified points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6598</span>
<span class="normal">6599</span>
<span class="normal">6600</span>
<span class="normal">6601</span>
<span class="normal">6602</span>
<span class="normal">6603</span>
<span class="normal">6604</span>
<span class="normal">6605</span>
<span class="normal">6606</span>
<span class="normal">6607</span>
<span class="normal">6608</span>
<span class="normal">6609</span>
<span class="normal">6610</span>
<span class="normal">6611</span>
<span class="normal">6612</span>
<span class="normal">6613</span>
<span class="normal">6614</span>
<span class="normal">6615</span>
<span class="normal">6616</span>
<span class="normal">6617</span>
<span class="normal">6618</span>
<span class="normal">6619</span>
<span class="normal">6620</span>
<span class="normal">6621</span>
<span class="normal">6622</span>
<span class="normal">6623</span>
<span class="normal">6624</span>
<span class="normal">6625</span>
<span class="normal">6626</span>
<span class="normal">6627</span>
<span class="normal">6628</span>
<span class="normal">6629</span>
<span class="normal">6630</span>
<span class="normal">6631</span>
<span class="normal">6632</span>
<span class="normal">6633</span>
<span class="normal">6634</span>
<span class="normal">6635</span>
<span class="normal">6636</span>
<span class="normal">6637</span>
<span class="normal">6638</span>
<span class="normal">6639</span>
<span class="normal">6640</span>
<span class="normal">6641</span>
<span class="normal">6642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function (PDF) of the inverse Batschelet distribution.</span>

<span class="sd">    Let</span>

<span class="sd">    - $\varphi = ((\theta - \xi + \pi) \bmod 2\pi) - \pi$,</span>
<span class="sd">    - $t_\nu^{-1}(\varphi)$ solve $y - \nu (1 + \cos y) = \varphi$,</span>
<span class="sd">    - $s_\lambda^{-1}(\cdot)$ solve $u - \tfrac{1 + \lambda}{2} \sin u = \cdot$,</span>

<span class="sd">    and set</span>
<span class="sd">    $\phi^\star = t_\nu^{-1}(\varphi)$,</span>
<span class="sd">    $u^\star = s_\lambda^{-1}(\phi^\star)$,</span>
<span class="sd">    $a = \tfrac{1 - \lambda}{1 + \lambda}$,</span>
<span class="sd">    $b = \tfrac{2 \lambda}{1 + \lambda}$.</span>
<span class="sd">    The inverse Batschelet density is</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = c(\kappa, \lambda)</span>
<span class="sd">    \exp\bigl[\kappa \cos\bigl(a\,\phi^\star + b\,u^\star\bigr)\bigr],</span>
<span class="sd">    $$</span>

<span class="sd">    where $c(\kappa,\lambda)$ is the normalising constant (independent of</span>
<span class="sd">    $\xi$ and $\nu$). For $\kappa \rightarrow 0$ the distribution reduces to</span>
<span class="sd">    the circular uniform density $1/(2\pi)$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$. Higher values result in sharper peaks around $\xi$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \leq \nu \leq 1$. Controls asymmetry through angular transformation.</span>
<span class="sd">    lmbd : float</span>
<span class="sd">        Skewness parameter, $-1 \leq \lambda \leq 1$. Controls the degree of skewness in the distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Values of the probability density function at the specified points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.inverse_batschelet_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the inverse Batschelet distribution.</p>
<p>The implementation precomputes the normalised primitive on a periodic grid
in the centred angle <span class="arithmatex">\(\varphi = (\theta - \xi) \bmod 2\pi - \pi\)</span>. For each
grid node, the inverse peakedness transform <span class="arithmatex">\(t_\nu^{-1}\)</span> and inverse
Batschelet skew <span class="arithmatex">\(s_\lambda^{-1}\)</span> are evaluated, and the resulting kernel is
accumulated via a trapezoidal rule. The cumulative table is cached per
parameter triple <span class="arithmatex">\((\kappa, \nu, \lambda)\)</span>, enabling <span class="arithmatex">\(O(1)\)</span> queries after the
initial <span class="arithmatex">\(O(N)\)</span> precomputation. The limit <span class="arithmatex">\(\kappa \to 0\)</span> reduces to the
circular uniform CDF <span class="arithmatex">\(\theta / (2\pi)\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter, <span class="arithmatex">\(0 \leq \xi \leq 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \leq \nu \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, <span class="arithmatex">\(-1 \leq \lambda \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative probabilities corresponding to <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6691</span>
<span class="normal">6692</span>
<span class="normal">6693</span>
<span class="normal">6694</span>
<span class="normal">6695</span>
<span class="normal">6696</span>
<span class="normal">6697</span>
<span class="normal">6698</span>
<span class="normal">6699</span>
<span class="normal">6700</span>
<span class="normal">6701</span>
<span class="normal">6702</span>
<span class="normal">6703</span>
<span class="normal">6704</span>
<span class="normal">6705</span>
<span class="normal">6706</span>
<span class="normal">6707</span>
<span class="normal">6708</span>
<span class="normal">6709</span>
<span class="normal">6710</span>
<span class="normal">6711</span>
<span class="normal">6712</span>
<span class="normal">6713</span>
<span class="normal">6714</span>
<span class="normal">6715</span>
<span class="normal">6716</span>
<span class="normal">6717</span>
<span class="normal">6718</span>
<span class="normal">6719</span>
<span class="normal">6720</span>
<span class="normal">6721</span>
<span class="normal">6722</span>
<span class="normal">6723</span>
<span class="normal">6724</span>
<span class="normal">6725</span>
<span class="normal">6726</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the inverse Batschelet distribution.</span>

<span class="sd">    The implementation precomputes the normalised primitive on a periodic grid</span>
<span class="sd">    in the centred angle $\varphi = (\theta - \xi) \bmod 2\pi - \pi$. For each</span>
<span class="sd">    grid node, the inverse peakedness transform $t_\nu^{-1}$ and inverse</span>
<span class="sd">    Batschelet skew $s_\lambda^{-1}$ are evaluated, and the resulting kernel is</span>
<span class="sd">    accumulated via a trapezoidal rule. The cumulative table is cached per</span>
<span class="sd">    parameter triple $(\kappa, \nu, \lambda)$, enabling $O(1)$ queries after the</span>
<span class="sd">    initial $O(N)$ precomputation. The limit $\kappa \to 0$ reduces to the</span>
<span class="sd">    circular uniform CDF $\theta / (2\pi)$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">    lmbd : float</span>
<span class="sd">        Skewness parameter, $-1 \leq \lambda \leq 1$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative probabilities corresponding to `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.inverse_batschelet_gen.ppf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Percent-point function (quantile) of the inverse Batschelet distribution.</p>
<p>Quantiles are obtained by inverting the cached cumulative table described in
<code>cdf</code>. A monotone initial guess supplied by the table inverse is refined
with safeguarded Newton steps that leverage the tabulated density, while
preserving a bracketing interval. For <span class="arithmatex">\(\kappa \rightarrow 0\)</span>, the quantile
reduces to the linear uniform mapping <span class="arithmatex">\(2\pi q\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Quantiles to evaluate (0 &lt;= q &lt;= 1).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter, <span class="arithmatex">\(0 \leq \xi \leq 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \leq \nu \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, <span class="arithmatex">\(-1 \leq \lambda \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ppf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angles corresponding to the probabilities in <code>q</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6819</span>
<span class="normal">6820</span>
<span class="normal">6821</span>
<span class="normal">6822</span>
<span class="normal">6823</span>
<span class="normal">6824</span>
<span class="normal">6825</span>
<span class="normal">6826</span>
<span class="normal">6827</span>
<span class="normal">6828</span>
<span class="normal">6829</span>
<span class="normal">6830</span>
<span class="normal">6831</span>
<span class="normal">6832</span>
<span class="normal">6833</span>
<span class="normal">6834</span>
<span class="normal">6835</span>
<span class="normal">6836</span>
<span class="normal">6837</span>
<span class="normal">6838</span>
<span class="normal">6839</span>
<span class="normal">6840</span>
<span class="normal">6841</span>
<span class="normal">6842</span>
<span class="normal">6843</span>
<span class="normal">6844</span>
<span class="normal">6845</span>
<span class="normal">6846</span>
<span class="normal">6847</span>
<span class="normal">6848</span>
<span class="normal">6849</span>
<span class="normal">6850</span>
<span class="normal">6851</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">lmbd</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Percent-point function (quantile) of the inverse Batschelet distribution.</span>

<span class="sd">    Quantiles are obtained by inverting the cached cumulative table described in</span>
<span class="sd">    `cdf`. A monotone initial guess supplied by the table inverse is refined</span>
<span class="sd">    with safeguarded Newton steps that leverage the tabulated density, while</span>
<span class="sd">    preserving a bracketing interval. For $\kappa \rightarrow 0$, the quantile</span>
<span class="sd">    reduces to the linear uniform mapping $2\pi q$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array_like</span>
<span class="sd">        Quantiles to evaluate (0 &lt;= q &lt;= 1).</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">    lmbd : float</span>
<span class="sd">        Skewness parameter, $-1 \leq \lambda \leq 1$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ppf_values : array_like</span>
<span class="sd">        Angles corresponding to the probabilities in `q`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">))</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.inverse_batschelet_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">xi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lmbd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the inverse Batschelet distribution.</p>
<p>Sampling proceeds by acceptance--rejection with a von Mises envelope whose
concentration is matched to the curvature of the inverse Batschelet kernel at
the mode. Envelope constants are calibrated on the cached spectral grid used
for <code>cdf</code>, so repeated sampling calls with the same parameters are fast
and stable across the entire parameter range.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xi</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction parameter, <span class="arithmatex">\(0 \leq \xi \leq 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Concentration parameter, <span class="arithmatex">\(\kappa \geq 0\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shape parameter, <span class="arithmatex">\(-1 \leq \nu \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, <span class="arithmatex">\(-1 \leq \lambda \leq 1\)</span>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code>int or tuple of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired output shape.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code>(None, <span title="int">int</span>, <span title="numpy.random.Generator">Generator</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random number generator specification.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rvs</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random variates on <span class="arithmatex">\([0, 2\pi)\)</span> sampled from the inverse Batschelet
distribution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">6971</span>
<span class="normal">6972</span>
<span class="normal">6973</span>
<span class="normal">6974</span>
<span class="normal">6975</span>
<span class="normal">6976</span>
<span class="normal">6977</span>
<span class="normal">6978</span>
<span class="normal">6979</span>
<span class="normal">6980</span>
<span class="normal">6981</span>
<span class="normal">6982</span>
<span class="normal">6983</span>
<span class="normal">6984</span>
<span class="normal">6985</span>
<span class="normal">6986</span>
<span class="normal">6987</span>
<span class="normal">6988</span>
<span class="normal">6989</span>
<span class="normal">6990</span>
<span class="normal">6991</span>
<span class="normal">6992</span>
<span class="normal">6993</span>
<span class="normal">6994</span>
<span class="normal">6995</span>
<span class="normal">6996</span>
<span class="normal">6997</span>
<span class="normal">6998</span>
<span class="normal">6999</span>
<span class="normal">7000</span>
<span class="normal">7001</span>
<span class="normal">7002</span>
<span class="normal">7003</span>
<span class="normal">7004</span>
<span class="normal">7005</span>
<span class="normal">7006</span>
<span class="normal">7007</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lmbd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw random variates from the inverse Batschelet distribution.</span>

<span class="sd">    Sampling proceeds by acceptance--rejection with a von Mises envelope whose</span>
<span class="sd">    concentration is matched to the curvature of the inverse Batschelet kernel at</span>
<span class="sd">    the mode. Envelope constants are calibrated on the cached spectral grid used</span>
<span class="sd">    for `cdf`, so repeated sampling calls with the same parameters are fast</span>
<span class="sd">    and stable across the entire parameter range.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : float</span>
<span class="sd">        Direction parameter, $0 \leq \xi \leq 2\pi$.</span>
<span class="sd">    kappa : float</span>
<span class="sd">        Concentration parameter, $\kappa \geq 0$.</span>
<span class="sd">    nu : float</span>
<span class="sd">        Shape parameter, $-1 \leq \nu \leq 1$.</span>
<span class="sd">    lmbd : float</span>
<span class="sd">        Skewness parameter, $-1 \leq \lambda \leq 1$.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        Desired output shape.</span>
<span class="sd">    random_state : {None, int, np.random.Generator}, optional</span>
<span class="sd">        Random number generator specification.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rvs : array_like</span>
<span class="sd">        Random variates on $[0, 2\pi)$ sampled from the inverse Batschelet</span>
<span class="sd">        distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xi_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">)</span>
    <span class="n">kappa_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
    <span class="n">nu_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="s2">&quot;nu&quot;</span><span class="p">)</span>
    <span class="n">lmbd_val</span> <span class="o">=</span> <span class="n">_invbat_ensure_scalar</span><span class="p">(</span><span class="n">lmbd</span><span class="p">,</span> <span class="s2">&quot;lmbd&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">xi_val</span><span class="p">,</span> <span class="n">kappa_val</span><span class="p">,</span> <span class="n">nu_val</span><span class="p">,</span> <span class="n">lmbd_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.inverse_batschelet_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lmbd_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">),</span> <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <span class="arithmatex">\((\xi, \kappa, \nu, \lambda)\)</span> from circular data.</p>
<p><code>method='mle'</code> maximises the weighted log-likelihood using the cached
spectral tables for the pdf and normalising constant. <code>method='moments'</code>
returns the circular mean, <code>circ_kappa</code> estimate, and sets <span class="arithmatex">\((\nu, \lambda)
= (0, 0)\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sample of angles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-negative weights broadcastable to <code>data</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>(<span title="mle">mle</span>, <span title="moments">moments</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation method.</p>
              </div>
            </td>
            <td>
                  <code>&#39;mle&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SciPy optimiser for maximum likelihood.</p>
              </div>
            </td>
            <td>
                  <code>&#39;L-BFGS-B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>options</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimiser options forwarded to :func:<code>scipy.optimize.minimize</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu_grid</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Candidate $
u$ values for profiling the starting point.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd_grid</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Candidate $
u$ values for $
lambda$ profiling.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kappa_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds enforced during optimisation.</p>
              </div>
            </td>
            <td>
                  <code>(1e-06, <span title="pycircstat2.distributions._INVBAT_KAPPA_UPPER">_INVBAT_KAPPA_UPPER</span>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nu_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds enforced during optimisation.</p>
              </div>
            </td>
            <td>
                  <code>(1e-06, <span title="pycircstat2.distributions._INVBAT_KAPPA_UPPER">_INVBAT_KAPPA_UPPER</span>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lmbd_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter bounds enforced during optimisation.</p>
              </div>
            </td>
            <td>
                  <code>(1e-06, <span title="pycircstat2.distributions._INVBAT_KAPPA_UPPER">_INVBAT_KAPPA_UPPER</span>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_info</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, also return a dictionary with optimisation diagnostics.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**minimize_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments forwarded to
:func:<code>scipy.optimize.minimize</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>params</code></td>            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated parameters <code>(xi, kappa, nu, lmbd)</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>info</code></td>            <td>
                  <code>(<span title="dict">dict</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returned when <code>return_info=True</code> with optimisation diagnostics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7009</span>
<span class="normal">7010</span>
<span class="normal">7011</span>
<span class="normal">7012</span>
<span class="normal">7013</span>
<span class="normal">7014</span>
<span class="normal">7015</span>
<span class="normal">7016</span>
<span class="normal">7017</span>
<span class="normal">7018</span>
<span class="normal">7019</span>
<span class="normal">7020</span>
<span class="normal">7021</span>
<span class="normal">7022</span>
<span class="normal">7023</span>
<span class="normal">7024</span>
<span class="normal">7025</span>
<span class="normal">7026</span>
<span class="normal">7027</span>
<span class="normal">7028</span>
<span class="normal">7029</span>
<span class="normal">7030</span>
<span class="normal">7031</span>
<span class="normal">7032</span>
<span class="normal">7033</span>
<span class="normal">7034</span>
<span class="normal">7035</span>
<span class="normal">7036</span>
<span class="normal">7037</span>
<span class="normal">7038</span>
<span class="normal">7039</span>
<span class="normal">7040</span>
<span class="normal">7041</span>
<span class="normal">7042</span>
<span class="normal">7043</span>
<span class="normal">7044</span>
<span class="normal">7045</span>
<span class="normal">7046</span>
<span class="normal">7047</span>
<span class="normal">7048</span>
<span class="normal">7049</span>
<span class="normal">7050</span>
<span class="normal">7051</span>
<span class="normal">7052</span>
<span class="normal">7053</span>
<span class="normal">7054</span>
<span class="normal">7055</span>
<span class="normal">7056</span>
<span class="normal">7057</span>
<span class="normal">7058</span>
<span class="normal">7059</span>
<span class="normal">7060</span>
<span class="normal">7061</span>
<span class="normal">7062</span>
<span class="normal">7063</span>
<span class="normal">7064</span>
<span class="normal">7065</span>
<span class="normal">7066</span>
<span class="normal">7067</span>
<span class="normal">7068</span>
<span class="normal">7069</span>
<span class="normal">7070</span>
<span class="normal">7071</span>
<span class="normal">7072</span>
<span class="normal">7073</span>
<span class="normal">7074</span>
<span class="normal">7075</span>
<span class="normal">7076</span>
<span class="normal">7077</span>
<span class="normal">7078</span>
<span class="normal">7079</span>
<span class="normal">7080</span>
<span class="normal">7081</span>
<span class="normal">7082</span>
<span class="normal">7083</span>
<span class="normal">7084</span>
<span class="normal">7085</span>
<span class="normal">7086</span>
<span class="normal">7087</span>
<span class="normal">7088</span>
<span class="normal">7089</span>
<span class="normal">7090</span>
<span class="normal">7091</span>
<span class="normal">7092</span>
<span class="normal">7093</span>
<span class="normal">7094</span>
<span class="normal">7095</span>
<span class="normal">7096</span>
<span class="normal">7097</span>
<span class="normal">7098</span>
<span class="normal">7099</span>
<span class="normal">7100</span>
<span class="normal">7101</span>
<span class="normal">7102</span>
<span class="normal">7103</span>
<span class="normal">7104</span>
<span class="normal">7105</span>
<span class="normal">7106</span>
<span class="normal">7107</span>
<span class="normal">7108</span>
<span class="normal">7109</span>
<span class="normal">7110</span>
<span class="normal">7111</span>
<span class="normal">7112</span>
<span class="normal">7113</span>
<span class="normal">7114</span>
<span class="normal">7115</span>
<span class="normal">7116</span>
<span class="normal">7117</span>
<span class="normal">7118</span>
<span class="normal">7119</span>
<span class="normal">7120</span>
<span class="normal">7121</span>
<span class="normal">7122</span>
<span class="normal">7123</span>
<span class="normal">7124</span>
<span class="normal">7125</span>
<span class="normal">7126</span>
<span class="normal">7127</span>
<span class="normal">7128</span>
<span class="normal">7129</span>
<span class="normal">7130</span>
<span class="normal">7131</span>
<span class="normal">7132</span>
<span class="normal">7133</span>
<span class="normal">7134</span>
<span class="normal">7135</span>
<span class="normal">7136</span>
<span class="normal">7137</span>
<span class="normal">7138</span>
<span class="normal">7139</span>
<span class="normal">7140</span>
<span class="normal">7141</span>
<span class="normal">7142</span>
<span class="normal">7143</span>
<span class="normal">7144</span>
<span class="normal">7145</span>
<span class="normal">7146</span>
<span class="normal">7147</span>
<span class="normal">7148</span>
<span class="normal">7149</span>
<span class="normal">7150</span>
<span class="normal">7151</span>
<span class="normal">7152</span>
<span class="normal">7153</span>
<span class="normal">7154</span>
<span class="normal">7155</span>
<span class="normal">7156</span>
<span class="normal">7157</span>
<span class="normal">7158</span>
<span class="normal">7159</span>
<span class="normal">7160</span>
<span class="normal">7161</span>
<span class="normal">7162</span>
<span class="normal">7163</span>
<span class="normal">7164</span>
<span class="normal">7165</span>
<span class="normal">7166</span>
<span class="normal">7167</span>
<span class="normal">7168</span>
<span class="normal">7169</span>
<span class="normal">7170</span>
<span class="normal">7171</span>
<span class="normal">7172</span>
<span class="normal">7173</span>
<span class="normal">7174</span>
<span class="normal">7175</span>
<span class="normal">7176</span>
<span class="normal">7177</span>
<span class="normal">7178</span>
<span class="normal">7179</span>
<span class="normal">7180</span>
<span class="normal">7181</span>
<span class="normal">7182</span>
<span class="normal">7183</span>
<span class="normal">7184</span>
<span class="normal">7185</span>
<span class="normal">7186</span>
<span class="normal">7187</span>
<span class="normal">7188</span>
<span class="normal">7189</span>
<span class="normal">7190</span>
<span class="normal">7191</span>
<span class="normal">7192</span>
<span class="normal">7193</span>
<span class="normal">7194</span>
<span class="normal">7195</span>
<span class="normal">7196</span>
<span class="normal">7197</span>
<span class="normal">7198</span>
<span class="normal">7199</span>
<span class="normal">7200</span>
<span class="normal">7201</span>
<span class="normal">7202</span>
<span class="normal">7203</span>
<span class="normal">7204</span>
<span class="normal">7205</span>
<span class="normal">7206</span>
<span class="normal">7207</span>
<span class="normal">7208</span>
<span class="normal">7209</span>
<span class="normal">7210</span>
<span class="normal">7211</span>
<span class="normal">7212</span>
<span class="normal">7213</span>
<span class="normal">7214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nu_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lmbd_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kappa_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">_INVBAT_KAPPA_UPPER</span><span class="p">),</span>
    <span class="n">nu_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">lmbd_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate $(\xi, \kappa, \nu, \lambda)$ from circular data.</span>

<span class="sd">    ``method=&#39;mle&#39;`` maximises the weighted log-likelihood using the cached</span>
<span class="sd">    spectral tables for the pdf and normalising constant. ``method=&#39;moments&#39;``</span>
<span class="sd">    returns the circular mean, ``circ_kappa`` estimate, and sets $(\nu, \lambda)</span>
<span class="sd">    = (0, 0)$.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array_like</span>
<span class="sd">        Sample of angles.</span>
<span class="sd">    weights : array_like, optional</span>
<span class="sd">        Non-negative weights broadcastable to ``data``.</span>
<span class="sd">    method : {&#39;mle&#39;, &#39;moments&#39;}, default &#39;mle&#39;</span>
<span class="sd">        Estimation method.</span>
<span class="sd">    optimizer : str, optional</span>
<span class="sd">        SciPy optimiser for maximum likelihood.</span>
<span class="sd">    options : dict, optional</span>
<span class="sd">        Optimiser options forwarded to :func:`scipy.optimize.minimize`.</span>
<span class="sd">    nu_grid : array_like, optional</span>
<span class="sd">        Candidate $</span>
<span class="sd">        u$ values for profiling the starting point.</span>
<span class="sd">    lmbd_grid : array_like, optional</span>
<span class="sd">        Candidate $</span>
<span class="sd">        u$ values for $</span>
<span class="sd">        lambda$ profiling.</span>
<span class="sd">    kappa_bounds, nu_bounds, lmbd_bounds : tuple, optional</span>
<span class="sd">        Parameter bounds enforced during optimisation.</span>
<span class="sd">    return_info : bool, optional</span>
<span class="sd">        If True, also return a dictionary with optimisation diagnostics.</span>
<span class="sd">    **minimize_kwargs :</span>
<span class="sd">        Additional keyword arguments forwarded to</span>
<span class="sd">        :func:`scipy.optimize.minimize`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : tuple</span>
<span class="sd">        Estimated parameters ``(xi, kappa, nu, lmbd)``.</span>
<span class="sd">    info : dict, optional</span>
<span class="sd">        Returned when ``return_info=True`` with optimisation diagnostics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">xi_mom</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xi_mom</span><span class="p">):</span>
        <span class="n">xi_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">xi_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
    <span class="n">n_adjust</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)))</span>
    <span class="n">kappa_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">circ_kappa</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">r1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_adjust</span><span class="p">),</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="k">if</span> <span class="n">kappa_mom</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39; }.&quot;</span><span class="p">)</span>

    <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">if</span> <span class="n">nu_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nu_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nu_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lmbd_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lmbd_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lmbd_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lmbd_grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">xi_param</span><span class="p">,</span> <span class="n">kappa_param</span><span class="p">,</span> <span class="n">nu_param</span><span class="p">,</span> <span class="n">lmbd_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">xi_param</span> <span class="o">&lt;=</span> <span class="n">two_pi</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">nu_param</span> <span class="o">&lt;=</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">lmbd_param</span> <span class="o">&lt;=</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="n">xi_wrapped</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xi_param</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kappa_param</span> <span class="o">&lt;=</span> <span class="n">_INVBAT_KAPPA_TOL</span><span class="p">:</span>
            <span class="n">log_pdf</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">two_pi</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">log_pdf</span><span class="p">))</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_invbat_table</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kappa_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_param</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_param</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">((</span><span class="n">data_arr</span> <span class="o">-</span> <span class="n">xi_wrapped</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;pdf_interp&quot;</span><span class="p">](</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

    <span class="n">best_nu</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_lmbd</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">,</span> <span class="n">best_lmbd</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">nu_candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">nu_grid</span><span class="p">))):</span>
        <span class="k">for</span> <span class="n">lmbd_candidate</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">lmbd_grid</span><span class="p">))):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">((</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_candidate</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_candidate</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_nu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nu_candidate</span><span class="p">)</span>
                <span class="n">best_lmbd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lmbd_candidate</span><span class="p">)</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xi_mom</span><span class="p">,</span> <span class="n">kappa_mom</span><span class="p">,</span> <span class="n">best_nu</span><span class="p">,</span> <span class="n">best_lmbd</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span><span class="p">),</span>
        <span class="p">(</span><span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="p">]</span>

    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">nll</span><span class="p">,</span>
        <span class="n">init</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
        <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
            <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">xi_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">kappa_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">nu_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nu_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">lmbd_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lmbd_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi_hat</span><span class="p">,</span> <span class="n">kappa_hat</span><span class="p">,</span> <span class="n">nu_hat</span><span class="p">,</span> <span class="n">lmbd_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
        <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
        <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
        <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
        <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.wrapstable_gen" class="doc doc-heading">
            <code>wrapstable_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Wrapped Stable Distribution</p>
<p><img alt="wrapstable" src="../../images/circ-mod-wrapstable.png" /></p>
<p>The wrapped stable family results from wrapping a linear stable law onto
<code>[0, 2π)</code>. Its trigonometric moments satisfy</p>
<div class="arithmatex">\[
\mathbb{E}\big[e^{ip\Theta}\big] = \rho_p e^{i\mu_p}, \qquad
\rho_p = \exp\left[-(\gamma p)^\alpha\right],
\]</div>
<p>with</p>
<div class="arithmatex">\[
\mu_p =
\begin{cases}
    \delta p + \beta \tan\left(\tfrac{\pi\alpha}{2}\right)\bigl((\gamma p)^\alpha - \gamma p\bigr), &amp; \alpha \ne 1, \\[6pt]
    \delta p + \tfrac{2}{\pi}\beta\gamma p \log(\gamma p), &amp; \alpha = 1.
\end{cases}
\]</div>
<p>Special cases include the wrapped normal (<code>α=2, β=0</code>), wrapped Cauchy
(<code>α=1, β=0</code>), and wrapped Lévy (<code>α=1/2, β=1</code>).</p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, delta, alpha, beta, gamma, *args, **kwargs) (pycircstat2.distributions.wrapstable_gen.pdf)" href="#pycircstat2.distributions.wrapstable_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function via adaptive Fourier series.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.wrapstable_gen.cdf">cdf</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Analytic cumulative distribution function using integrated series.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.wrapstable_gen.ppf">ppf</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Quantile function obtained by safeguarded Newton refinement.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="rvs(delta=None, alpha=None, beta=None, gamma=None, size=None, random_state=None) (pycircstat2.distributions.wrapstable_gen.rvs)" href="#pycircstat2.distributions.wrapstable_gen.rvs">rvs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates by Chambers–Mallows–Stuck sampling and wrapping.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="fit(data, *, weights=None, method='mle', optimizer='L-BFGS-B', options=None, alpha_bounds=(0.001, 2.0), beta_bounds=(-0.99, 0.99), gamma_bounds=(1e-06, 10.0), return_info=False, **minimize_kwargs) (pycircstat2.distributions.wrapstable_gen.fit)" href="#pycircstat2.distributions.wrapstable_gen.fit">fit</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Estimate parameters via moment starts with optional MLE refinement.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <ul>
<li>Pewsey (2008). <em>Computational Statistics &amp; Data Analysis</em> 52(3), 1516-1523.</li>
</ul>
<p>Parameters must be scalar; Fourier series coefficients are cached per
parameter set.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7473</span>
<span class="normal">7474</span>
<span class="normal">7475</span>
<span class="normal">7476</span>
<span class="normal">7477</span>
<span class="normal">7478</span>
<span class="normal">7479</span>
<span class="normal">7480</span>
<span class="normal">7481</span>
<span class="normal">7482</span>
<span class="normal">7483</span>
<span class="normal">7484</span>
<span class="normal">7485</span>
<span class="normal">7486</span>
<span class="normal">7487</span>
<span class="normal">7488</span>
<span class="normal">7489</span>
<span class="normal">7490</span>
<span class="normal">7491</span>
<span class="normal">7492</span>
<span class="normal">7493</span>
<span class="normal">7494</span>
<span class="normal">7495</span>
<span class="normal">7496</span>
<span class="normal">7497</span>
<span class="normal">7498</span>
<span class="normal">7499</span>
<span class="normal">7500</span>
<span class="normal">7501</span>
<span class="normal">7502</span>
<span class="normal">7503</span>
<span class="normal">7504</span>
<span class="normal">7505</span>
<span class="normal">7506</span>
<span class="normal">7507</span>
<span class="normal">7508</span>
<span class="normal">7509</span>
<span class="normal">7510</span>
<span class="normal">7511</span>
<span class="normal">7512</span>
<span class="normal">7513</span>
<span class="normal">7514</span>
<span class="normal">7515</span>
<span class="normal">7516</span>
<span class="normal">7517</span>
<span class="normal">7518</span>
<span class="normal">7519</span>
<span class="normal">7520</span>
<span class="normal">7521</span>
<span class="normal">7522</span>
<span class="normal">7523</span>
<span class="normal">7524</span>
<span class="normal">7525</span>
<span class="normal">7526</span>
<span class="normal">7527</span>
<span class="normal">7528</span>
<span class="normal">7529</span>
<span class="normal">7530</span>
<span class="normal">7531</span>
<span class="normal">7532</span>
<span class="normal">7533</span>
<span class="normal">7534</span>
<span class="normal">7535</span>
<span class="normal">7536</span>
<span class="normal">7537</span>
<span class="normal">7538</span>
<span class="normal">7539</span>
<span class="normal">7540</span>
<span class="normal">7541</span>
<span class="normal">7542</span>
<span class="normal">7543</span>
<span class="normal">7544</span>
<span class="normal">7545</span>
<span class="normal">7546</span>
<span class="normal">7547</span>
<span class="normal">7548</span>
<span class="normal">7549</span>
<span class="normal">7550</span>
<span class="normal">7551</span>
<span class="normal">7552</span>
<span class="normal">7553</span>
<span class="normal">7554</span>
<span class="normal">7555</span>
<span class="normal">7556</span>
<span class="normal">7557</span>
<span class="normal">7558</span>
<span class="normal">7559</span>
<span class="normal">7560</span>
<span class="normal">7561</span>
<span class="normal">7562</span>
<span class="normal">7563</span>
<span class="normal">7564</span>
<span class="normal">7565</span>
<span class="normal">7566</span>
<span class="normal">7567</span>
<span class="normal">7568</span>
<span class="normal">7569</span>
<span class="normal">7570</span>
<span class="normal">7571</span>
<span class="normal">7572</span>
<span class="normal">7573</span>
<span class="normal">7574</span>
<span class="normal">7575</span>
<span class="normal">7576</span>
<span class="normal">7577</span>
<span class="normal">7578</span>
<span class="normal">7579</span>
<span class="normal">7580</span>
<span class="normal">7581</span>
<span class="normal">7582</span>
<span class="normal">7583</span>
<span class="normal">7584</span>
<span class="normal">7585</span>
<span class="normal">7586</span>
<span class="normal">7587</span>
<span class="normal">7588</span>
<span class="normal">7589</span>
<span class="normal">7590</span>
<span class="normal">7591</span>
<span class="normal">7592</span>
<span class="normal">7593</span>
<span class="normal">7594</span>
<span class="normal">7595</span>
<span class="normal">7596</span>
<span class="normal">7597</span>
<span class="normal">7598</span>
<span class="normal">7599</span>
<span class="normal">7600</span>
<span class="normal">7601</span>
<span class="normal">7602</span>
<span class="normal">7603</span>
<span class="normal">7604</span>
<span class="normal">7605</span>
<span class="normal">7606</span>
<span class="normal">7607</span>
<span class="normal">7608</span>
<span class="normal">7609</span>
<span class="normal">7610</span>
<span class="normal">7611</span>
<span class="normal">7612</span>
<span class="normal">7613</span>
<span class="normal">7614</span>
<span class="normal">7615</span>
<span class="normal">7616</span>
<span class="normal">7617</span>
<span class="normal">7618</span>
<span class="normal">7619</span>
<span class="normal">7620</span>
<span class="normal">7621</span>
<span class="normal">7622</span>
<span class="normal">7623</span>
<span class="normal">7624</span>
<span class="normal">7625</span>
<span class="normal">7626</span>
<span class="normal">7627</span>
<span class="normal">7628</span>
<span class="normal">7629</span>
<span class="normal">7630</span>
<span class="normal">7631</span>
<span class="normal">7632</span>
<span class="normal">7633</span>
<span class="normal">7634</span>
<span class="normal">7635</span>
<span class="normal">7636</span>
<span class="normal">7637</span>
<span class="normal">7638</span>
<span class="normal">7639</span>
<span class="normal">7640</span>
<span class="normal">7641</span>
<span class="normal">7642</span>
<span class="normal">7643</span>
<span class="normal">7644</span>
<span class="normal">7645</span>
<span class="normal">7646</span>
<span class="normal">7647</span>
<span class="normal">7648</span>
<span class="normal">7649</span>
<span class="normal">7650</span>
<span class="normal">7651</span>
<span class="normal">7652</span>
<span class="normal">7653</span>
<span class="normal">7654</span>
<span class="normal">7655</span>
<span class="normal">7656</span>
<span class="normal">7657</span>
<span class="normal">7658</span>
<span class="normal">7659</span>
<span class="normal">7660</span>
<span class="normal">7661</span>
<span class="normal">7662</span>
<span class="normal">7663</span>
<span class="normal">7664</span>
<span class="normal">7665</span>
<span class="normal">7666</span>
<span class="normal">7667</span>
<span class="normal">7668</span>
<span class="normal">7669</span>
<span class="normal">7670</span>
<span class="normal">7671</span>
<span class="normal">7672</span>
<span class="normal">7673</span>
<span class="normal">7674</span>
<span class="normal">7675</span>
<span class="normal">7676</span>
<span class="normal">7677</span>
<span class="normal">7678</span>
<span class="normal">7679</span>
<span class="normal">7680</span>
<span class="normal">7681</span>
<span class="normal">7682</span>
<span class="normal">7683</span>
<span class="normal">7684</span>
<span class="normal">7685</span>
<span class="normal">7686</span>
<span class="normal">7687</span>
<span class="normal">7688</span>
<span class="normal">7689</span>
<span class="normal">7690</span>
<span class="normal">7691</span>
<span class="normal">7692</span>
<span class="normal">7693</span>
<span class="normal">7694</span>
<span class="normal">7695</span>
<span class="normal">7696</span>
<span class="normal">7697</span>
<span class="normal">7698</span>
<span class="normal">7699</span>
<span class="normal">7700</span>
<span class="normal">7701</span>
<span class="normal">7702</span>
<span class="normal">7703</span>
<span class="normal">7704</span>
<span class="normal">7705</span>
<span class="normal">7706</span>
<span class="normal">7707</span>
<span class="normal">7708</span>
<span class="normal">7709</span>
<span class="normal">7710</span>
<span class="normal">7711</span>
<span class="normal">7712</span>
<span class="normal">7713</span>
<span class="normal">7714</span>
<span class="normal">7715</span>
<span class="normal">7716</span>
<span class="normal">7717</span>
<span class="normal">7718</span>
<span class="normal">7719</span>
<span class="normal">7720</span>
<span class="normal">7721</span>
<span class="normal">7722</span>
<span class="normal">7723</span>
<span class="normal">7724</span>
<span class="normal">7725</span>
<span class="normal">7726</span>
<span class="normal">7727</span>
<span class="normal">7728</span>
<span class="normal">7729</span>
<span class="normal">7730</span>
<span class="normal">7731</span>
<span class="normal">7732</span>
<span class="normal">7733</span>
<span class="normal">7734</span>
<span class="normal">7735</span>
<span class="normal">7736</span>
<span class="normal">7737</span>
<span class="normal">7738</span>
<span class="normal">7739</span>
<span class="normal">7740</span>
<span class="normal">7741</span>
<span class="normal">7742</span>
<span class="normal">7743</span>
<span class="normal">7744</span>
<span class="normal">7745</span>
<span class="normal">7746</span>
<span class="normal">7747</span>
<span class="normal">7748</span>
<span class="normal">7749</span>
<span class="normal">7750</span>
<span class="normal">7751</span>
<span class="normal">7752</span>
<span class="normal">7753</span>
<span class="normal">7754</span>
<span class="normal">7755</span>
<span class="normal">7756</span>
<span class="normal">7757</span>
<span class="normal">7758</span>
<span class="normal">7759</span>
<span class="normal">7760</span>
<span class="normal">7761</span>
<span class="normal">7762</span>
<span class="normal">7763</span>
<span class="normal">7764</span>
<span class="normal">7765</span>
<span class="normal">7766</span>
<span class="normal">7767</span>
<span class="normal">7768</span>
<span class="normal">7769</span>
<span class="normal">7770</span>
<span class="normal">7771</span>
<span class="normal">7772</span>
<span class="normal">7773</span>
<span class="normal">7774</span>
<span class="normal">7775</span>
<span class="normal">7776</span>
<span class="normal">7777</span>
<span class="normal">7778</span>
<span class="normal">7779</span>
<span class="normal">7780</span>
<span class="normal">7781</span>
<span class="normal">7782</span>
<span class="normal">7783</span>
<span class="normal">7784</span>
<span class="normal">7785</span>
<span class="normal">7786</span>
<span class="normal">7787</span>
<span class="normal">7788</span>
<span class="normal">7789</span>
<span class="normal">7790</span>
<span class="normal">7791</span>
<span class="normal">7792</span>
<span class="normal">7793</span>
<span class="normal">7794</span>
<span class="normal">7795</span>
<span class="normal">7796</span>
<span class="normal">7797</span>
<span class="normal">7798</span>
<span class="normal">7799</span>
<span class="normal">7800</span>
<span class="normal">7801</span>
<span class="normal">7802</span>
<span class="normal">7803</span>
<span class="normal">7804</span>
<span class="normal">7805</span>
<span class="normal">7806</span>
<span class="normal">7807</span>
<span class="normal">7808</span>
<span class="normal">7809</span>
<span class="normal">7810</span>
<span class="normal">7811</span>
<span class="normal">7812</span>
<span class="normal">7813</span>
<span class="normal">7814</span>
<span class="normal">7815</span>
<span class="normal">7816</span>
<span class="normal">7817</span>
<span class="normal">7818</span>
<span class="normal">7819</span>
<span class="normal">7820</span>
<span class="normal">7821</span>
<span class="normal">7822</span>
<span class="normal">7823</span>
<span class="normal">7824</span>
<span class="normal">7825</span>
<span class="normal">7826</span>
<span class="normal">7827</span>
<span class="normal">7828</span>
<span class="normal">7829</span>
<span class="normal">7830</span>
<span class="normal">7831</span>
<span class="normal">7832</span>
<span class="normal">7833</span>
<span class="normal">7834</span>
<span class="normal">7835</span>
<span class="normal">7836</span>
<span class="normal">7837</span>
<span class="normal">7838</span>
<span class="normal">7839</span>
<span class="normal">7840</span>
<span class="normal">7841</span>
<span class="normal">7842</span>
<span class="normal">7843</span>
<span class="normal">7844</span>
<span class="normal">7845</span>
<span class="normal">7846</span>
<span class="normal">7847</span>
<span class="normal">7848</span>
<span class="normal">7849</span>
<span class="normal">7850</span>
<span class="normal">7851</span>
<span class="normal">7852</span>
<span class="normal">7853</span>
<span class="normal">7854</span>
<span class="normal">7855</span>
<span class="normal">7856</span>
<span class="normal">7857</span>
<span class="normal">7858</span>
<span class="normal">7859</span>
<span class="normal">7860</span>
<span class="normal">7861</span>
<span class="normal">7862</span>
<span class="normal">7863</span>
<span class="normal">7864</span>
<span class="normal">7865</span>
<span class="normal">7866</span>
<span class="normal">7867</span>
<span class="normal">7868</span>
<span class="normal">7869</span>
<span class="normal">7870</span>
<span class="normal">7871</span>
<span class="normal">7872</span>
<span class="normal">7873</span>
<span class="normal">7874</span>
<span class="normal">7875</span>
<span class="normal">7876</span>
<span class="normal">7877</span>
<span class="normal">7878</span>
<span class="normal">7879</span>
<span class="normal">7880</span>
<span class="normal">7881</span>
<span class="normal">7882</span>
<span class="normal">7883</span>
<span class="normal">7884</span>
<span class="normal">7885</span>
<span class="normal">7886</span>
<span class="normal">7887</span>
<span class="normal">7888</span>
<span class="normal">7889</span>
<span class="normal">7890</span>
<span class="normal">7891</span>
<span class="normal">7892</span>
<span class="normal">7893</span>
<span class="normal">7894</span>
<span class="normal">7895</span>
<span class="normal">7896</span>
<span class="normal">7897</span>
<span class="normal">7898</span>
<span class="normal">7899</span>
<span class="normal">7900</span>
<span class="normal">7901</span>
<span class="normal">7902</span>
<span class="normal">7903</span>
<span class="normal">7904</span>
<span class="normal">7905</span>
<span class="normal">7906</span>
<span class="normal">7907</span>
<span class="normal">7908</span>
<span class="normal">7909</span>
<span class="normal">7910</span>
<span class="normal">7911</span>
<span class="normal">7912</span>
<span class="normal">7913</span>
<span class="normal">7914</span>
<span class="normal">7915</span>
<span class="normal">7916</span>
<span class="normal">7917</span>
<span class="normal">7918</span>
<span class="normal">7919</span>
<span class="normal">7920</span>
<span class="normal">7921</span>
<span class="normal">7922</span>
<span class="normal">7923</span>
<span class="normal">7924</span>
<span class="normal">7925</span>
<span class="normal">7926</span>
<span class="normal">7927</span>
<span class="normal">7928</span>
<span class="normal">7929</span>
<span class="normal">7930</span>
<span class="normal">7931</span>
<span class="normal">7932</span>
<span class="normal">7933</span>
<span class="normal">7934</span>
<span class="normal">7935</span>
<span class="normal">7936</span>
<span class="normal">7937</span>
<span class="normal">7938</span>
<span class="normal">7939</span>
<span class="normal">7940</span>
<span class="normal">7941</span>
<span class="normal">7942</span>
<span class="normal">7943</span>
<span class="normal">7944</span>
<span class="normal">7945</span>
<span class="normal">7946</span>
<span class="normal">7947</span>
<span class="normal">7948</span>
<span class="normal">7949</span>
<span class="normal">7950</span>
<span class="normal">7951</span>
<span class="normal">7952</span>
<span class="normal">7953</span>
<span class="normal">7954</span>
<span class="normal">7955</span>
<span class="normal">7956</span>
<span class="normal">7957</span>
<span class="normal">7958</span>
<span class="normal">7959</span>
<span class="normal">7960</span>
<span class="normal">7961</span>
<span class="normal">7962</span>
<span class="normal">7963</span>
<span class="normal">7964</span>
<span class="normal">7965</span>
<span class="normal">7966</span>
<span class="normal">7967</span>
<span class="normal">7968</span>
<span class="normal">7969</span>
<span class="normal">7970</span>
<span class="normal">7971</span>
<span class="normal">7972</span>
<span class="normal">7973</span>
<span class="normal">7974</span>
<span class="normal">7975</span>
<span class="normal">7976</span>
<span class="normal">7977</span>
<span class="normal">7978</span>
<span class="normal">7979</span>
<span class="normal">7980</span>
<span class="normal">7981</span>
<span class="normal">7982</span>
<span class="normal">7983</span>
<span class="normal">7984</span>
<span class="normal">7985</span>
<span class="normal">7986</span>
<span class="normal">7987</span>
<span class="normal">7988</span>
<span class="normal">7989</span>
<span class="normal">7990</span>
<span class="normal">7991</span>
<span class="normal">7992</span>
<span class="normal">7993</span>
<span class="normal">7994</span>
<span class="normal">7995</span>
<span class="normal">7996</span>
<span class="normal">7997</span>
<span class="normal">7998</span>
<span class="normal">7999</span>
<span class="normal">8000</span>
<span class="normal">8001</span>
<span class="normal">8002</span>
<span class="normal">8003</span>
<span class="normal">8004</span>
<span class="normal">8005</span>
<span class="normal">8006</span>
<span class="normal">8007</span>
<span class="normal">8008</span>
<span class="normal">8009</span>
<span class="normal">8010</span>
<span class="normal">8011</span>
<span class="normal">8012</span>
<span class="normal">8013</span>
<span class="normal">8014</span>
<span class="normal">8015</span>
<span class="normal">8016</span>
<span class="normal">8017</span>
<span class="normal">8018</span>
<span class="normal">8019</span>
<span class="normal">8020</span>
<span class="normal">8021</span>
<span class="normal">8022</span>
<span class="normal">8023</span>
<span class="normal">8024</span>
<span class="normal">8025</span>
<span class="normal">8026</span>
<span class="normal">8027</span>
<span class="normal">8028</span>
<span class="normal">8029</span>
<span class="normal">8030</span>
<span class="normal">8031</span>
<span class="normal">8032</span>
<span class="normal">8033</span>
<span class="normal">8034</span>
<span class="normal">8035</span>
<span class="normal">8036</span>
<span class="normal">8037</span>
<span class="normal">8038</span>
<span class="normal">8039</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">wrapstable_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Wrapped Stable Distribution</span>

<span class="sd">    ![wrapstable](../images/circ-mod-wrapstable.png)</span>

<span class="sd">    The wrapped stable family results from wrapping a linear stable law onto</span>
<span class="sd">    ``[0, 2π)``. Its trigonometric moments satisfy</span>

<span class="sd">    $$</span>
<span class="sd">    \mathbb{E}\big[e^{ip\Theta}\big] = \rho_p e^{i\mu_p}, \qquad</span>
<span class="sd">    \rho_p = \exp\left[-(\gamma p)^\alpha\right],</span>
<span class="sd">    $$</span>

<span class="sd">    with</span>

<span class="sd">    $$</span>
<span class="sd">    \mu_p =</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">        \delta p + \beta \tan\left(\tfrac{\pi\alpha}{2}\right)\bigl((\gamma p)^\alpha - \gamma p\bigr), &amp; \alpha \ne 1, \\[6pt]</span>
<span class="sd">        \delta p + \tfrac{2}{\pi}\beta\gamma p \log(\gamma p), &amp; \alpha = 1.</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    Special cases include the wrapped normal (``α=2, β=0``), wrapped Cauchy</span>
<span class="sd">    (``α=1, β=0``), and wrapped Lévy (``α=1/2, β=1``).</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, delta, alpha, beta, gamma)</span>
<span class="sd">        Probability density function via adaptive Fourier series.</span>

<span class="sd">    cdf(x, delta, alpha, beta, gamma)</span>
<span class="sd">        Analytic cumulative distribution function using integrated series.</span>

<span class="sd">    ppf(q, delta, alpha, beta, gamma)</span>
<span class="sd">        Quantile function obtained by safeguarded Newton refinement.</span>

<span class="sd">    rvs(delta, alpha, beta, gamma, size=None, random_state=None)</span>
<span class="sd">        Random variates by Chambers–Mallows–Stuck sampling and wrapping.</span>

<span class="sd">    fit(data, *, method=&#39;mle&#39; | &#39;moments&#39;, ...)</span>
<span class="sd">        Estimate parameters via moment starts with optional MLE refinement.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    - Pewsey (2008). *Computational Statistics &amp; Data Analysis* 52(3), 1516-1523.</span>

<span class="sd">    Parameters must be scalar; Fourier series coefficients are cached per</span>
<span class="sd">    parameter set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_clear_normalization_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="n">delta_arr</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">beta_arr</span><span class="p">,</span> <span class="n">gamma_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">delta_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">delta_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">alpha_arr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">alpha_arr</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta_arr</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">gamma_arr</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_vals</span><span class="p">,</span> <span class="n">mu_vals</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_terms</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="n">cos_args</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu_vals</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">series_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho_vals</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">cos_args</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pdf_values</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">series_sum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdf_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pdf_values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Wrapped Stable distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        f(\theta) = \frac{1}{2\pi} \left[1 + 2 \sum_{p=1}^{\infty} \rho_p \cos\left(p(\theta - \mu_p)\right)\right]</span>
<span class="sd">        $$</span>

<span class="sd">        , where $\rho_p$ is the $p$th mean resultant length and $\mu_p$ is the $p$th mean direction:</span>

<span class="sd">        $$</span>
<span class="sd">        \rho_p = \exp\left(-(\gamma p)^\alpha\right)</span>
<span class="sd">        $$</span>

<span class="sd">        $$</span>
<span class="sd">        \mu_p = </span>
<span class="sd">        \begin{cases}</span>
<span class="sd">            \delta p + \beta \tan\left(\frac{\pi \alpha}{2}\right) \left((\gamma p)^\alpha - \gamma p\right), &amp; \alpha \neq 1 \\</span>
<span class="sd">            \delta p - \beta \frac{2}{\pi} \log(\gamma p), &amp; \text{if } \alpha = 1</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">        delta : float</span>
<span class="sd">            Location parameter, $0 \leq \delta \leq 2\pi$. This is the mean direction of the distribution.</span>
<span class="sd">        alpha : float</span>
<span class="sd">            Stability parameter, $0 &lt; \alpha \leq 2$. Higher values indicate heavier tails.</span>
<span class="sd">        beta : float</span>
<span class="sd">            Skewness parameter, $-1 &lt; \beta &lt; 1$. Controls the asymmetry of the distribution.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Scale parameter, $\gamma &gt; 0$. Scales the distribution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Values of the probability density function at the specified points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">scalar_input</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x_arr</span><span class="p">)</span>

        <span class="n">rho_vals</span><span class="p">,</span> <span class="n">mu_vals</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_terms</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="n">theta_flat</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_vals</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">sin_args</span> <span class="o">=</span> <span class="n">p_vals</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">theta_flat</span> <span class="o">-</span> <span class="n">mu_vals</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho_vals</span> <span class="o">/</span> <span class="n">p_vals</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">series_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeffs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sin_args</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">series_sum</span>

        <span class="n">anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rho_vals</span> <span class="o">/</span> <span class="n">p_vals</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">mu_vals</span><span class="p">))</span>
        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">cdf_vals</span> <span class="o">-</span> <span class="n">anchor</span>
        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cdf_vals</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cdf_vals</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">cdf_vals</span><span class="p">)</span>
        <span class="n">cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf_vals</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Ensure exact endpoints</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">cdf_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cdf_vals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">theta_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">two_pi</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cdf_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flat</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">delta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">alpha_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">beta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span> <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">shaped</span>

        <span class="n">q_valid</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>
        <span class="n">close_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">close_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_valid</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">theta_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q_valid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">q_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_valid</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">close_zero</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">close_one</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
                <span class="k">continue</span>

            <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">q_val</span> <span class="o">*</span> <span class="n">two_pi</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_WRAPSTABLE_NEWTON_MAXITER</span><span class="p">):</span>
                <span class="n">cdf_theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">delta_val</span><span class="p">,</span> <span class="n">alpha_val</span><span class="p">,</span> <span class="n">beta_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">))</span>
                <span class="n">pdf_theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">delta_val</span><span class="p">,</span> <span class="n">alpha_val</span><span class="p">,</span> <span class="n">beta_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">))</span>
                <span class="n">residual</span> <span class="o">=</span> <span class="n">cdf_theta</span> <span class="o">-</span> <span class="n">q_val</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_NEWTON_TOL</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pdf_theta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_theta</span><span class="p">):</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">step</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">/</span> <span class="n">pdf_theta</span>
                <span class="n">theta_new</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">step</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">theta_new</span><span class="p">)</span> <span class="ow">or</span> <span class="n">theta_new</span> <span class="o">&lt;=</span> <span class="n">lo</span> <span class="ow">or</span> <span class="n">theta_new</span> <span class="o">&gt;=</span> <span class="n">hi</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_new</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover - fallback to bisection if Newton fails</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                    <span class="n">theta_mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                    <span class="n">cdf_mid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">theta_mid</span><span class="p">,</span> <span class="n">delta_val</span><span class="p">,</span> <span class="n">alpha_val</span><span class="p">,</span> <span class="n">beta_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">cdf_mid</span> <span class="o">&gt;</span> <span class="n">q_val</span><span class="p">:</span>
                        <span class="n">hi</span> <span class="o">=</span> <span class="n">theta_mid</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lo</span> <span class="o">=</span> <span class="n">theta_mid</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>

            <span class="n">theta_vals</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">theta</span> <span class="o">+</span> <span class="n">two_pi</span><span class="p">)</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="n">result</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_vals</span>
        <span class="n">shaped</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">shaped</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shaped</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="n">delta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">alpha_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">beta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">alpha_val</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`alpha` must lie in (0, 2].&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">&lt;</span> <span class="n">beta_val</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`beta` must lie in (-1, 1).&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gamma_val</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must be positive.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`size` must describe a non-negative number of samples.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">empty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span> <span class="k">if</span> <span class="n">empty</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">empty</span>

        <span class="n">linear_samples</span> <span class="o">=</span> <span class="n">_wrapstable_sample_linear</span><span class="p">(</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_val</span><span class="p">,</span>
            <span class="n">beta</span><span class="o">=</span><span class="n">beta_val</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma_val</span><span class="p">,</span>
            <span class="n">delta</span><span class="o">=</span><span class="n">delta_val</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
            <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">linear_samples</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">samples</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Draw random variates from the wrapped stable distribution.&quot;&quot;&quot;</span>

        <span class="n">delta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">alpha_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">beta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">delta_val</span><span class="p">,</span> <span class="n">alpha_val</span><span class="p">,</span> <span class="n">beta_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">alpha_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
        <span class="n">beta_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
        <span class="n">gamma_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate ``(delta, alpha, beta, gamma)`` from circular data.&quot;&quot;&quot;</span>

        <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">weighted_moment</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">data_arr</span><span class="p">))</span> <span class="o">/</span> <span class="n">w_sum</span>

        <span class="n">m1</span> <span class="o">=</span> <span class="n">weighted_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">weighted_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">r1</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-6</span> <span class="ow">or</span> <span class="n">r2</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="n">alpha_mom</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">gamma_mom</span> <span class="o">=</span> <span class="mf">1e-3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="p">)))</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r2</span><span class="p">)))</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">alpha_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">gamma_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y1</span> <span class="o">/</span> <span class="n">alpha_mom</span><span class="p">))</span>
            <span class="n">gamma_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma_mom</span><span class="p">,</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">phi1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span>
        <span class="n">phi2_raw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
        <span class="n">phi2</span> <span class="o">=</span> <span class="n">phi2_raw</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">phi2_raw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">alpha_mom</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_ALPHA_TOL</span><span class="p">:</span>
            <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma_mom</span><span class="p">)</span>
            <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">B2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">B1</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">,</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">beta_mom</span> <span class="o">*</span> <span class="n">B1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">alpha_mom</span><span class="p">)</span>
            <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_mom</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha_mom</span> <span class="o">-</span> <span class="n">gamma_mom</span>
            <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha_mom</span> <span class="o">-</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">B1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
                <span class="n">beta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">,</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">beta_mom</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B1</span>

        <span class="n">delta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">alpha_mom</span><span class="p">,</span> <span class="n">beta_mom</span><span class="p">,</span> <span class="n">gamma_mom</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39; }.&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">delta_param</span><span class="p">,</span> <span class="n">alpha_param</span><span class="p">,</span> <span class="n">beta_param</span><span class="p">,</span> <span class="n">gamma_param</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">delta_param</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alpha_param</span> <span class="o">&lt;=</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">beta_param</span> <span class="o">&lt;=</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gamma_param</span> <span class="o">&lt;=</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">delta_param</span><span class="p">,</span> <span class="n">alpha_param</span><span class="p">,</span> <span class="n">beta_param</span><span class="p">,</span> <span class="n">gamma_param</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

        <span class="n">delta_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">phi2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="p">)</span>
        <span class="n">alpha_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha_mom</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.9</span><span class="p">,</span> <span class="n">alpha_mom</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)]),</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">beta_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">beta_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">gamma_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gamma_mom</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)]),</span>
            <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">best_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">alpha_mom</span><span class="p">,</span> <span class="n">beta_mom</span><span class="p">,</span> <span class="n">gamma_mom</span><span class="p">)</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d0</span> <span class="ow">in</span> <span class="n">delta_candidates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a0</span> <span class="ow">in</span> <span class="n">alpha_candidates</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">b0</span> <span class="ow">in</span> <span class="n">beta_candidates</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">gamma_candidates</span><span class="p">:</span>
                        <span class="n">cand</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">d0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">a0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">b0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">g0</span><span class="p">))</span>
                        <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">(</span><span class="n">cand</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                            <span class="n">best_params</span> <span class="o">=</span> <span class="n">cand</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">alpha_bounds</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">beta_bounds</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

        <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
            <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                <span class="n">nll</span><span class="p">,</span>
                <span class="n">init</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
                <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
                <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">delta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">alpha_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">beta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">gamma_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_hat</span><span class="p">,</span> <span class="n">alpha_hat</span><span class="p">,</span> <span class="n">beta_hat</span><span class="p">,</span> <span class="n">gamma_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">estimates</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
            <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
            <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_series_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="n">delta_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="n">alpha_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">beta_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="n">gamma_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache_key</span><span class="p">(</span><span class="n">delta_s</span><span class="p">,</span> <span class="n">alpha_s</span><span class="p">,</span> <span class="n">beta_s</span><span class="p">,</span> <span class="n">gamma_s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_series_terms</span><span class="p">(</span><span class="n">delta_s</span><span class="p">,</span> <span class="n">alpha_s</span><span class="p">,</span> <span class="n">beta_s</span><span class="p">,</span> <span class="n">gamma_s</span><span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_series_terms</span><span class="p">(</span><span class="n">delta_s</span><span class="p">,</span> <span class="n">alpha_s</span><span class="p">,</span> <span class="n">beta_s</span><span class="p">,</span> <span class="n">gamma_s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_series_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gamma</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must be positive for wrapstable.&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_initial_order</span><span class="p">(</span><span class="n">tol</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tol</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="n">log_term</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log_term</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="ow">or</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>

            <span class="n">exponent</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log_term</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">exponent</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_WRAPSTABLE_MAX_TERMS</span>
            <span class="k">if</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_WRAPSTABLE_MAX_TERMS</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_WRAPSTABLE_MAX_TERMS</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_WRAPSTABLE_MAX_TERMS</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">_WRAPSTABLE_MAX_TERMS</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="n">p_pdf</span> <span class="o">=</span> <span class="n">_initial_order</span><span class="p">(</span><span class="n">_WRAPSTABLE_PDF_TOL</span><span class="p">)</span>
        <span class="n">p_cdf</span> <span class="o">=</span> <span class="n">_initial_order</span><span class="p">(</span><span class="n">_WRAPSTABLE_CDF_TOL</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p_pdf</span><span class="p">,</span> <span class="n">p_cdf</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_WRAPSTABLE_MAX_TERMS</span><span class="p">):</span>
            <span class="n">rho_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">P</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">rho_P</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_PDF_TOL</span> <span class="ow">and</span> <span class="n">rho_P</span> <span class="o">/</span> <span class="n">P</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_CDF_TOL</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">P</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">P</span> <span class="o">&gt;=</span> <span class="n">_WRAPSTABLE_MAX_TERMS</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">P</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_ALPHA_TOL</span><span class="p">:</span>
            <span class="n">mu_vals</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mu_vals</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span> <span class="o">-</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">p</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">rho_vals</span><span class="p">,</span> <span class="n">mu_vals</span><span class="p">,</span> <span class="n">p</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_scalar_param</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">first</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;wrapstable parameters must be scalar; vectorised parameters are not supported &quot;</span>
                <span class="s2">&quot;because Fourier series coefficients are cached per parameter set.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">first</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapstable_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Wrapped Stable distribution.</p>
<div class="arithmatex">\[
f(\theta) = \frac{1}{2\pi} \left[1 + 2 \sum_{p=1}^{\infty} \rho_p \cos\left(p(\theta - \mu_p)\right)\right]
\]</div>
<p>, where <span class="arithmatex">\(\rho_p\)</span> is the <span class="arithmatex">\(p\)</span>th mean resultant length and <span class="arithmatex">\(\mu_p\)</span> is the <span class="arithmatex">\(p\)</span>th mean direction:</p>
<div class="arithmatex">\[
\rho_p = \exp\left(-(\gamma p)^\alpha\right)
\]</div>
<div class="arithmatex">\[
\mu_p = 
\begin{cases}
    \delta p + \beta \tan\left(\frac{\pi \alpha}{2}\right) \left((\gamma p)^\alpha - \gamma p\right), &amp; \alpha \neq 1 \\
    \delta p - \beta \frac{2}{\pi} \log(\gamma p), &amp; \text{if } \alpha = 1
\end{cases}
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the PDF, defined on the interval <span class="arithmatex">\([0, 2\pi)\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location parameter, <span class="arithmatex">\(0 \leq \delta \leq 2\pi\)</span>. This is the mean direction of the distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stability parameter, <span class="arithmatex">\(0 &lt; \alpha \leq 2\)</span>. Higher values indicate heavier tails.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skewness parameter, <span class="arithmatex">\(-1 &lt; \beta &lt; 1\)</span>. Controls the asymmetry of the distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scale parameter, <span class="arithmatex">\(\gamma &gt; 0\)</span>. Scales the distribution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values of the probability density function at the specified points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7560</span>
<span class="normal">7561</span>
<span class="normal">7562</span>
<span class="normal">7563</span>
<span class="normal">7564</span>
<span class="normal">7565</span>
<span class="normal">7566</span>
<span class="normal">7567</span>
<span class="normal">7568</span>
<span class="normal">7569</span>
<span class="normal">7570</span>
<span class="normal">7571</span>
<span class="normal">7572</span>
<span class="normal">7573</span>
<span class="normal">7574</span>
<span class="normal">7575</span>
<span class="normal">7576</span>
<span class="normal">7577</span>
<span class="normal">7578</span>
<span class="normal">7579</span>
<span class="normal">7580</span>
<span class="normal">7581</span>
<span class="normal">7582</span>
<span class="normal">7583</span>
<span class="normal">7584</span>
<span class="normal">7585</span>
<span class="normal">7586</span>
<span class="normal">7587</span>
<span class="normal">7588</span>
<span class="normal">7589</span>
<span class="normal">7590</span>
<span class="normal">7591</span>
<span class="normal">7592</span>
<span class="normal">7593</span>
<span class="normal">7594</span>
<span class="normal">7595</span>
<span class="normal">7596</span>
<span class="normal">7597</span>
<span class="normal">7598</span>
<span class="normal">7599</span>
<span class="normal">7600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Wrapped Stable distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    f(\theta) = \frac{1}{2\pi} \left[1 + 2 \sum_{p=1}^{\infty} \rho_p \cos\left(p(\theta - \mu_p)\right)\right]</span>
<span class="sd">    $$</span>

<span class="sd">    , where $\rho_p$ is the $p$th mean resultant length and $\mu_p$ is the $p$th mean direction:</span>

<span class="sd">    $$</span>
<span class="sd">    \rho_p = \exp\left(-(\gamma p)^\alpha\right)</span>
<span class="sd">    $$</span>

<span class="sd">    $$</span>
<span class="sd">    \mu_p = </span>
<span class="sd">    \begin{cases}</span>
<span class="sd">        \delta p + \beta \tan\left(\frac{\pi \alpha}{2}\right) \left((\gamma p)^\alpha - \gamma p\right), &amp; \alpha \neq 1 \\</span>
<span class="sd">        \delta p - \beta \frac{2}{\pi} \log(\gamma p), &amp; \text{if } \alpha = 1</span>
<span class="sd">    \end{cases}</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the PDF, defined on the interval $[0, 2\pi)$.</span>
<span class="sd">    delta : float</span>
<span class="sd">        Location parameter, $0 \leq \delta \leq 2\pi$. This is the mean direction of the distribution.</span>
<span class="sd">    alpha : float</span>
<span class="sd">        Stability parameter, $0 &lt; \alpha \leq 2$. Higher values indicate heavier tails.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Skewness parameter, $-1 &lt; \beta &lt; 1$. Controls the asymmetry of the distribution.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Scale parameter, $\gamma &gt; 0$. Scales the distribution.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Values of the probability density function at the specified points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapstable_gen.rvs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rvs</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Draw random variates from the wrapped stable distribution.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7755</span>
<span class="normal">7756</span>
<span class="normal">7757</span>
<span class="normal">7758</span>
<span class="normal">7759</span>
<span class="normal">7760</span>
<span class="normal">7761</span>
<span class="normal">7762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Draw random variates from the wrapped stable distribution.&quot;&quot;&quot;</span>

    <span class="n">delta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
    <span class="n">alpha_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">beta_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">gamma_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">delta_val</span><span class="p">,</span> <span class="n">alpha_val</span><span class="p">,</span> <span class="n">beta_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.wrapstable_gen.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">beta_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="n">gamma_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-06</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Estimate <code>(delta, alpha, beta, gamma)</code> from circular data.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">7764</span>
<span class="normal">7765</span>
<span class="normal">7766</span>
<span class="normal">7767</span>
<span class="normal">7768</span>
<span class="normal">7769</span>
<span class="normal">7770</span>
<span class="normal">7771</span>
<span class="normal">7772</span>
<span class="normal">7773</span>
<span class="normal">7774</span>
<span class="normal">7775</span>
<span class="normal">7776</span>
<span class="normal">7777</span>
<span class="normal">7778</span>
<span class="normal">7779</span>
<span class="normal">7780</span>
<span class="normal">7781</span>
<span class="normal">7782</span>
<span class="normal">7783</span>
<span class="normal">7784</span>
<span class="normal">7785</span>
<span class="normal">7786</span>
<span class="normal">7787</span>
<span class="normal">7788</span>
<span class="normal">7789</span>
<span class="normal">7790</span>
<span class="normal">7791</span>
<span class="normal">7792</span>
<span class="normal">7793</span>
<span class="normal">7794</span>
<span class="normal">7795</span>
<span class="normal">7796</span>
<span class="normal">7797</span>
<span class="normal">7798</span>
<span class="normal">7799</span>
<span class="normal">7800</span>
<span class="normal">7801</span>
<span class="normal">7802</span>
<span class="normal">7803</span>
<span class="normal">7804</span>
<span class="normal">7805</span>
<span class="normal">7806</span>
<span class="normal">7807</span>
<span class="normal">7808</span>
<span class="normal">7809</span>
<span class="normal">7810</span>
<span class="normal">7811</span>
<span class="normal">7812</span>
<span class="normal">7813</span>
<span class="normal">7814</span>
<span class="normal">7815</span>
<span class="normal">7816</span>
<span class="normal">7817</span>
<span class="normal">7818</span>
<span class="normal">7819</span>
<span class="normal">7820</span>
<span class="normal">7821</span>
<span class="normal">7822</span>
<span class="normal">7823</span>
<span class="normal">7824</span>
<span class="normal">7825</span>
<span class="normal">7826</span>
<span class="normal">7827</span>
<span class="normal">7828</span>
<span class="normal">7829</span>
<span class="normal">7830</span>
<span class="normal">7831</span>
<span class="normal">7832</span>
<span class="normal">7833</span>
<span class="normal">7834</span>
<span class="normal">7835</span>
<span class="normal">7836</span>
<span class="normal">7837</span>
<span class="normal">7838</span>
<span class="normal">7839</span>
<span class="normal">7840</span>
<span class="normal">7841</span>
<span class="normal">7842</span>
<span class="normal">7843</span>
<span class="normal">7844</span>
<span class="normal">7845</span>
<span class="normal">7846</span>
<span class="normal">7847</span>
<span class="normal">7848</span>
<span class="normal">7849</span>
<span class="normal">7850</span>
<span class="normal">7851</span>
<span class="normal">7852</span>
<span class="normal">7853</span>
<span class="normal">7854</span>
<span class="normal">7855</span>
<span class="normal">7856</span>
<span class="normal">7857</span>
<span class="normal">7858</span>
<span class="normal">7859</span>
<span class="normal">7860</span>
<span class="normal">7861</span>
<span class="normal">7862</span>
<span class="normal">7863</span>
<span class="normal">7864</span>
<span class="normal">7865</span>
<span class="normal">7866</span>
<span class="normal">7867</span>
<span class="normal">7868</span>
<span class="normal">7869</span>
<span class="normal">7870</span>
<span class="normal">7871</span>
<span class="normal">7872</span>
<span class="normal">7873</span>
<span class="normal">7874</span>
<span class="normal">7875</span>
<span class="normal">7876</span>
<span class="normal">7877</span>
<span class="normal">7878</span>
<span class="normal">7879</span>
<span class="normal">7880</span>
<span class="normal">7881</span>
<span class="normal">7882</span>
<span class="normal">7883</span>
<span class="normal">7884</span>
<span class="normal">7885</span>
<span class="normal">7886</span>
<span class="normal">7887</span>
<span class="normal">7888</span>
<span class="normal">7889</span>
<span class="normal">7890</span>
<span class="normal">7891</span>
<span class="normal">7892</span>
<span class="normal">7893</span>
<span class="normal">7894</span>
<span class="normal">7895</span>
<span class="normal">7896</span>
<span class="normal">7897</span>
<span class="normal">7898</span>
<span class="normal">7899</span>
<span class="normal">7900</span>
<span class="normal">7901</span>
<span class="normal">7902</span>
<span class="normal">7903</span>
<span class="normal">7904</span>
<span class="normal">7905</span>
<span class="normal">7906</span>
<span class="normal">7907</span>
<span class="normal">7908</span>
<span class="normal">7909</span>
<span class="normal">7910</span>
<span class="normal">7911</span>
<span class="normal">7912</span>
<span class="normal">7913</span>
<span class="normal">7914</span>
<span class="normal">7915</span>
<span class="normal">7916</span>
<span class="normal">7917</span>
<span class="normal">7918</span>
<span class="normal">7919</span>
<span class="normal">7920</span>
<span class="normal">7921</span>
<span class="normal">7922</span>
<span class="normal">7923</span>
<span class="normal">7924</span>
<span class="normal">7925</span>
<span class="normal">7926</span>
<span class="normal">7927</span>
<span class="normal">7928</span>
<span class="normal">7929</span>
<span class="normal">7930</span>
<span class="normal">7931</span>
<span class="normal">7932</span>
<span class="normal">7933</span>
<span class="normal">7934</span>
<span class="normal">7935</span>
<span class="normal">7936</span>
<span class="normal">7937</span>
<span class="normal">7938</span>
<span class="normal">7939</span>
<span class="normal">7940</span>
<span class="normal">7941</span>
<span class="normal">7942</span>
<span class="normal">7943</span>
<span class="normal">7944</span>
<span class="normal">7945</span>
<span class="normal">7946</span>
<span class="normal">7947</span>
<span class="normal">7948</span>
<span class="normal">7949</span>
<span class="normal">7950</span>
<span class="normal">7951</span>
<span class="normal">7952</span>
<span class="normal">7953</span>
<span class="normal">7954</span>
<span class="normal">7955</span>
<span class="normal">7956</span>
<span class="normal">7957</span>
<span class="normal">7958</span>
<span class="normal">7959</span>
<span class="normal">7960</span>
<span class="normal">7961</span>
<span class="normal">7962</span>
<span class="normal">7963</span>
<span class="normal">7964</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mle&quot;</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
    <span class="n">beta_bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span>
    <span class="n">gamma_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
    <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate ``(delta, alpha, beta, gamma)`` from circular data.&quot;&quot;&quot;</span>

    <span class="n">minimize_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_fit_kwargs</span><span class="p">(</span><span class="n">minimize_kwargs</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">minimize_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
    <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">weighted_moment</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">data_arr</span><span class="p">))</span> <span class="o">/</span> <span class="n">w_sum</span>

    <span class="n">m1</span> <span class="o">=</span> <span class="n">weighted_moment</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">weighted_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">r1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">r1</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-6</span> <span class="ow">or</span> <span class="n">r2</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">:</span>
        <span class="n">alpha_mom</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">gamma_mom</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="p">)))</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r2</span><span class="p">)))</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">alpha_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">gamma_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y1</span> <span class="o">/</span> <span class="n">alpha_mom</span><span class="p">))</span>
        <span class="n">gamma_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma_mom</span><span class="p">,</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">phi1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span>
    <span class="n">phi2_raw</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
    <span class="n">phi2</span> <span class="o">=</span> <span class="n">phi2_raw</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="nb">round</span><span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">phi2_raw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">alpha_mom</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_WRAPSTABLE_ALPHA_TOL</span><span class="p">:</span>
        <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma_mom</span><span class="p">)</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">B2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">B1</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">,</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">beta_mom</span> <span class="o">*</span> <span class="n">B1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">alpha_mom</span><span class="p">)</span>
        <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_mom</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha_mom</span> <span class="o">-</span> <span class="n">gamma_mom</span>
        <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha_mom</span> <span class="o">-</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">B1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
            <span class="n">beta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">,</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">delta_mom</span> <span class="o">=</span> <span class="n">phi1</span> <span class="o">-</span> <span class="n">beta_mom</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B1</span>

    <span class="n">delta_mom</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">alpha_mom</span><span class="p">,</span> <span class="n">beta_mom</span><span class="p">,</span> <span class="n">gamma_mom</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="n">method_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method_key</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`method` must be one of {&#39;mle&#39;, &#39;moments&#39; }.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nll</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">delta_param</span><span class="p">,</span> <span class="n">alpha_param</span><span class="p">,</span> <span class="n">beta_param</span><span class="p">,</span> <span class="n">gamma_param</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">delta_param</span> <span class="o">&lt;=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alpha_param</span> <span class="o">&lt;=</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">beta_param</span> <span class="o">&lt;=</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">gamma_param</span> <span class="o">&lt;=</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">delta_param</span><span class="p">,</span> <span class="n">alpha_param</span><span class="p">,</span> <span class="n">beta_param</span><span class="p">,</span> <span class="n">gamma_param</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)))</span>

    <span class="n">delta_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">phi1</span><span class="p">,</span> <span class="n">phi2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>
    <span class="n">alpha_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha_mom</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.9</span><span class="p">,</span> <span class="n">alpha_mom</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)]),</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">beta_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">beta_mom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">beta_mom</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">gamma_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gamma_mom</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma_mom</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)]),</span>
        <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">best_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_mom</span><span class="p">,</span> <span class="n">alpha_mom</span><span class="p">,</span> <span class="n">beta_mom</span><span class="p">,</span> <span class="n">gamma_mom</span><span class="p">)</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d0</span> <span class="ow">in</span> <span class="n">delta_candidates</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a0</span> <span class="ow">in</span> <span class="n">alpha_candidates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b0</span> <span class="ow">in</span> <span class="n">beta_candidates</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">gamma_candidates</span><span class="p">:</span>
                    <span class="n">cand</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">d0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">a0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">b0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">g0</span><span class="p">))</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="n">nll</span><span class="p">(</span><span class="n">cand</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                        <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                        <span class="n">best_params</span> <span class="o">=</span> <span class="n">cand</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">alpha_bounds</span><span class="p">),</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">beta_bounds</span><span class="p">),</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">gamma_bounds</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">best_params</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

    <span class="n">optimizer_used</span> <span class="o">=</span> <span class="n">optimizer</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">nll</span><span class="p">,</span>
        <span class="n">init</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span><span class="p">:</span>
        <span class="n">fallback</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">nll</span><span class="p">,</span>
            <span class="n">init</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Powell&quot;</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">fallback</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fallback</span>
            <span class="n">optimizer_used</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">delta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">alpha_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">beta_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">beta_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">gamma_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gamma_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta_hat</span><span class="p">,</span> <span class="n">alpha_hat</span><span class="p">,</span> <span class="n">beta_hat</span><span class="p">,</span> <span class="n">gamma_hat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_info</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span>
        <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
        <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
        <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer_used</span><span class="p">,</span>
        <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;nfev&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nfev&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pycircstat2.distributions.katojones_gen" class="doc doc-heading">
            <code>katojones_gen</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CircularContinuous (pycircstat2.distributions.CircularContinuous)" href="#pycircstat2.distributions.CircularContinuous">CircularContinuous</a></code></p>



        <p>Kato--Jones (2015) Distribution</p>
<p><img alt="katojones" src="../../images/circ-mod-katojones.png" /></p>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="pdf(x, mu, gamma, rho, lam, *args, **kwargs) (pycircstat2.distributions.katojones_gen.pdf)" href="#pycircstat2.distributions.katojones_gen.pdf">pdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Probability density function.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="cdf(x, mu, gamma, rho, lam, *args, **kwargs) (pycircstat2.distributions.katojones_gen.cdf)" href="#pycircstat2.distributions.katojones_gen.cdf">cdf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cumulative distribution function via adaptive Fourier series.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.katojones_gen.rvs">rvs</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Random variates obtained by inverting the CDF.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="pycircstat2.distributions.katojones_gen.fit">fit</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Method-of-moments or maximum-likelihood parameter estimation.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Implements the tractable four-parameter unimodal family proposed by Kato and
Jones (2015). Parameters control the first two trigonometric moments:
<code>mu</code> sets the mean direction, <code>gamma</code> the mean resultant length, and
<code>rho</code>/<code>lam</code> encode the magnitude/phase of the second-order moment.
Feasible parameter tuples satisfy <code>0 &lt;= mu &lt; 2*pi</code>, <code>0 &lt;= gamma &lt; 1</code>,
<code>0 &lt;= rho &lt; 1</code>, <code>0 &lt;= lam &lt; 2*pi</code> together with the constraint enforced
in <code>_argcheck</code>.</p>
<p>Special cases include the uniform distribution (<code>gamma = 0</code>), the cardioid
(<code>rho = 0</code>) and the wrapped Cauchy (<code>lambda = 0</code> with <code>gamma = rho</code>).</p>
</details>

<details class="references" open>
  <summary>References</summary>
  <ul>
<li>Kato, S., &amp; Jones, M. C. (2015). <em>A tractable and interpretable
  four-parameter family of unimodal distributions on the circle</em>. Biometrika,
  102(1), 181-190.</li>
</ul>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8080</span>
<span class="normal">8081</span>
<span class="normal">8082</span>
<span class="normal">8083</span>
<span class="normal">8084</span>
<span class="normal">8085</span>
<span class="normal">8086</span>
<span class="normal">8087</span>
<span class="normal">8088</span>
<span class="normal">8089</span>
<span class="normal">8090</span>
<span class="normal">8091</span>
<span class="normal">8092</span>
<span class="normal">8093</span>
<span class="normal">8094</span>
<span class="normal">8095</span>
<span class="normal">8096</span>
<span class="normal">8097</span>
<span class="normal">8098</span>
<span class="normal">8099</span>
<span class="normal">8100</span>
<span class="normal">8101</span>
<span class="normal">8102</span>
<span class="normal">8103</span>
<span class="normal">8104</span>
<span class="normal">8105</span>
<span class="normal">8106</span>
<span class="normal">8107</span>
<span class="normal">8108</span>
<span class="normal">8109</span>
<span class="normal">8110</span>
<span class="normal">8111</span>
<span class="normal">8112</span>
<span class="normal">8113</span>
<span class="normal">8114</span>
<span class="normal">8115</span>
<span class="normal">8116</span>
<span class="normal">8117</span>
<span class="normal">8118</span>
<span class="normal">8119</span>
<span class="normal">8120</span>
<span class="normal">8121</span>
<span class="normal">8122</span>
<span class="normal">8123</span>
<span class="normal">8124</span>
<span class="normal">8125</span>
<span class="normal">8126</span>
<span class="normal">8127</span>
<span class="normal">8128</span>
<span class="normal">8129</span>
<span class="normal">8130</span>
<span class="normal">8131</span>
<span class="normal">8132</span>
<span class="normal">8133</span>
<span class="normal">8134</span>
<span class="normal">8135</span>
<span class="normal">8136</span>
<span class="normal">8137</span>
<span class="normal">8138</span>
<span class="normal">8139</span>
<span class="normal">8140</span>
<span class="normal">8141</span>
<span class="normal">8142</span>
<span class="normal">8143</span>
<span class="normal">8144</span>
<span class="normal">8145</span>
<span class="normal">8146</span>
<span class="normal">8147</span>
<span class="normal">8148</span>
<span class="normal">8149</span>
<span class="normal">8150</span>
<span class="normal">8151</span>
<span class="normal">8152</span>
<span class="normal">8153</span>
<span class="normal">8154</span>
<span class="normal">8155</span>
<span class="normal">8156</span>
<span class="normal">8157</span>
<span class="normal">8158</span>
<span class="normal">8159</span>
<span class="normal">8160</span>
<span class="normal">8161</span>
<span class="normal">8162</span>
<span class="normal">8163</span>
<span class="normal">8164</span>
<span class="normal">8165</span>
<span class="normal">8166</span>
<span class="normal">8167</span>
<span class="normal">8168</span>
<span class="normal">8169</span>
<span class="normal">8170</span>
<span class="normal">8171</span>
<span class="normal">8172</span>
<span class="normal">8173</span>
<span class="normal">8174</span>
<span class="normal">8175</span>
<span class="normal">8176</span>
<span class="normal">8177</span>
<span class="normal">8178</span>
<span class="normal">8179</span>
<span class="normal">8180</span>
<span class="normal">8181</span>
<span class="normal">8182</span>
<span class="normal">8183</span>
<span class="normal">8184</span>
<span class="normal">8185</span>
<span class="normal">8186</span>
<span class="normal">8187</span>
<span class="normal">8188</span>
<span class="normal">8189</span>
<span class="normal">8190</span>
<span class="normal">8191</span>
<span class="normal">8192</span>
<span class="normal">8193</span>
<span class="normal">8194</span>
<span class="normal">8195</span>
<span class="normal">8196</span>
<span class="normal">8197</span>
<span class="normal">8198</span>
<span class="normal">8199</span>
<span class="normal">8200</span>
<span class="normal">8201</span>
<span class="normal">8202</span>
<span class="normal">8203</span>
<span class="normal">8204</span>
<span class="normal">8205</span>
<span class="normal">8206</span>
<span class="normal">8207</span>
<span class="normal">8208</span>
<span class="normal">8209</span>
<span class="normal">8210</span>
<span class="normal">8211</span>
<span class="normal">8212</span>
<span class="normal">8213</span>
<span class="normal">8214</span>
<span class="normal">8215</span>
<span class="normal">8216</span>
<span class="normal">8217</span>
<span class="normal">8218</span>
<span class="normal">8219</span>
<span class="normal">8220</span>
<span class="normal">8221</span>
<span class="normal">8222</span>
<span class="normal">8223</span>
<span class="normal">8224</span>
<span class="normal">8225</span>
<span class="normal">8226</span>
<span class="normal">8227</span>
<span class="normal">8228</span>
<span class="normal">8229</span>
<span class="normal">8230</span>
<span class="normal">8231</span>
<span class="normal">8232</span>
<span class="normal">8233</span>
<span class="normal">8234</span>
<span class="normal">8235</span>
<span class="normal">8236</span>
<span class="normal">8237</span>
<span class="normal">8238</span>
<span class="normal">8239</span>
<span class="normal">8240</span>
<span class="normal">8241</span>
<span class="normal">8242</span>
<span class="normal">8243</span>
<span class="normal">8244</span>
<span class="normal">8245</span>
<span class="normal">8246</span>
<span class="normal">8247</span>
<span class="normal">8248</span>
<span class="normal">8249</span>
<span class="normal">8250</span>
<span class="normal">8251</span>
<span class="normal">8252</span>
<span class="normal">8253</span>
<span class="normal">8254</span>
<span class="normal">8255</span>
<span class="normal">8256</span>
<span class="normal">8257</span>
<span class="normal">8258</span>
<span class="normal">8259</span>
<span class="normal">8260</span>
<span class="normal">8261</span>
<span class="normal">8262</span>
<span class="normal">8263</span>
<span class="normal">8264</span>
<span class="normal">8265</span>
<span class="normal">8266</span>
<span class="normal">8267</span>
<span class="normal">8268</span>
<span class="normal">8269</span>
<span class="normal">8270</span>
<span class="normal">8271</span>
<span class="normal">8272</span>
<span class="normal">8273</span>
<span class="normal">8274</span>
<span class="normal">8275</span>
<span class="normal">8276</span>
<span class="normal">8277</span>
<span class="normal">8278</span>
<span class="normal">8279</span>
<span class="normal">8280</span>
<span class="normal">8281</span>
<span class="normal">8282</span>
<span class="normal">8283</span>
<span class="normal">8284</span>
<span class="normal">8285</span>
<span class="normal">8286</span>
<span class="normal">8287</span>
<span class="normal">8288</span>
<span class="normal">8289</span>
<span class="normal">8290</span>
<span class="normal">8291</span>
<span class="normal">8292</span>
<span class="normal">8293</span>
<span class="normal">8294</span>
<span class="normal">8295</span>
<span class="normal">8296</span>
<span class="normal">8297</span>
<span class="normal">8298</span>
<span class="normal">8299</span>
<span class="normal">8300</span>
<span class="normal">8301</span>
<span class="normal">8302</span>
<span class="normal">8303</span>
<span class="normal">8304</span>
<span class="normal">8305</span>
<span class="normal">8306</span>
<span class="normal">8307</span>
<span class="normal">8308</span>
<span class="normal">8309</span>
<span class="normal">8310</span>
<span class="normal">8311</span>
<span class="normal">8312</span>
<span class="normal">8313</span>
<span class="normal">8314</span>
<span class="normal">8315</span>
<span class="normal">8316</span>
<span class="normal">8317</span>
<span class="normal">8318</span>
<span class="normal">8319</span>
<span class="normal">8320</span>
<span class="normal">8321</span>
<span class="normal">8322</span>
<span class="normal">8323</span>
<span class="normal">8324</span>
<span class="normal">8325</span>
<span class="normal">8326</span>
<span class="normal">8327</span>
<span class="normal">8328</span>
<span class="normal">8329</span>
<span class="normal">8330</span>
<span class="normal">8331</span>
<span class="normal">8332</span>
<span class="normal">8333</span>
<span class="normal">8334</span>
<span class="normal">8335</span>
<span class="normal">8336</span>
<span class="normal">8337</span>
<span class="normal">8338</span>
<span class="normal">8339</span>
<span class="normal">8340</span>
<span class="normal">8341</span>
<span class="normal">8342</span>
<span class="normal">8343</span>
<span class="normal">8344</span>
<span class="normal">8345</span>
<span class="normal">8346</span>
<span class="normal">8347</span>
<span class="normal">8348</span>
<span class="normal">8349</span>
<span class="normal">8350</span>
<span class="normal">8351</span>
<span class="normal">8352</span>
<span class="normal">8353</span>
<span class="normal">8354</span>
<span class="normal">8355</span>
<span class="normal">8356</span>
<span class="normal">8357</span>
<span class="normal">8358</span>
<span class="normal">8359</span>
<span class="normal">8360</span>
<span class="normal">8361</span>
<span class="normal">8362</span>
<span class="normal">8363</span>
<span class="normal">8364</span>
<span class="normal">8365</span>
<span class="normal">8366</span>
<span class="normal">8367</span>
<span class="normal">8368</span>
<span class="normal">8369</span>
<span class="normal">8370</span>
<span class="normal">8371</span>
<span class="normal">8372</span>
<span class="normal">8373</span>
<span class="normal">8374</span>
<span class="normal">8375</span>
<span class="normal">8376</span>
<span class="normal">8377</span>
<span class="normal">8378</span>
<span class="normal">8379</span>
<span class="normal">8380</span>
<span class="normal">8381</span>
<span class="normal">8382</span>
<span class="normal">8383</span>
<span class="normal">8384</span>
<span class="normal">8385</span>
<span class="normal">8386</span>
<span class="normal">8387</span>
<span class="normal">8388</span>
<span class="normal">8389</span>
<span class="normal">8390</span>
<span class="normal">8391</span>
<span class="normal">8392</span>
<span class="normal">8393</span>
<span class="normal">8394</span>
<span class="normal">8395</span>
<span class="normal">8396</span>
<span class="normal">8397</span>
<span class="normal">8398</span>
<span class="normal">8399</span>
<span class="normal">8400</span>
<span class="normal">8401</span>
<span class="normal">8402</span>
<span class="normal">8403</span>
<span class="normal">8404</span>
<span class="normal">8405</span>
<span class="normal">8406</span>
<span class="normal">8407</span>
<span class="normal">8408</span>
<span class="normal">8409</span>
<span class="normal">8410</span>
<span class="normal">8411</span>
<span class="normal">8412</span>
<span class="normal">8413</span>
<span class="normal">8414</span>
<span class="normal">8415</span>
<span class="normal">8416</span>
<span class="normal">8417</span>
<span class="normal">8418</span>
<span class="normal">8419</span>
<span class="normal">8420</span>
<span class="normal">8421</span>
<span class="normal">8422</span>
<span class="normal">8423</span>
<span class="normal">8424</span>
<span class="normal">8425</span>
<span class="normal">8426</span>
<span class="normal">8427</span>
<span class="normal">8428</span>
<span class="normal">8429</span>
<span class="normal">8430</span>
<span class="normal">8431</span>
<span class="normal">8432</span>
<span class="normal">8433</span>
<span class="normal">8434</span>
<span class="normal">8435</span>
<span class="normal">8436</span>
<span class="normal">8437</span>
<span class="normal">8438</span>
<span class="normal">8439</span>
<span class="normal">8440</span>
<span class="normal">8441</span>
<span class="normal">8442</span>
<span class="normal">8443</span>
<span class="normal">8444</span>
<span class="normal">8445</span>
<span class="normal">8446</span>
<span class="normal">8447</span>
<span class="normal">8448</span>
<span class="normal">8449</span>
<span class="normal">8450</span>
<span class="normal">8451</span>
<span class="normal">8452</span>
<span class="normal">8453</span>
<span class="normal">8454</span>
<span class="normal">8455</span>
<span class="normal">8456</span>
<span class="normal">8457</span>
<span class="normal">8458</span>
<span class="normal">8459</span>
<span class="normal">8460</span>
<span class="normal">8461</span>
<span class="normal">8462</span>
<span class="normal">8463</span>
<span class="normal">8464</span>
<span class="normal">8465</span>
<span class="normal">8466</span>
<span class="normal">8467</span>
<span class="normal">8468</span>
<span class="normal">8469</span>
<span class="normal">8470</span>
<span class="normal">8471</span>
<span class="normal">8472</span>
<span class="normal">8473</span>
<span class="normal">8474</span>
<span class="normal">8475</span>
<span class="normal">8476</span>
<span class="normal">8477</span>
<span class="normal">8478</span>
<span class="normal">8479</span>
<span class="normal">8480</span>
<span class="normal">8481</span>
<span class="normal">8482</span>
<span class="normal">8483</span>
<span class="normal">8484</span>
<span class="normal">8485</span>
<span class="normal">8486</span>
<span class="normal">8487</span>
<span class="normal">8488</span>
<span class="normal">8489</span>
<span class="normal">8490</span>
<span class="normal">8491</span>
<span class="normal">8492</span>
<span class="normal">8493</span>
<span class="normal">8494</span>
<span class="normal">8495</span>
<span class="normal">8496</span>
<span class="normal">8497</span>
<span class="normal">8498</span>
<span class="normal">8499</span>
<span class="normal">8500</span>
<span class="normal">8501</span>
<span class="normal">8502</span>
<span class="normal">8503</span>
<span class="normal">8504</span>
<span class="normal">8505</span>
<span class="normal">8506</span>
<span class="normal">8507</span>
<span class="normal">8508</span>
<span class="normal">8509</span>
<span class="normal">8510</span>
<span class="normal">8511</span>
<span class="normal">8512</span>
<span class="normal">8513</span>
<span class="normal">8514</span>
<span class="normal">8515</span>
<span class="normal">8516</span>
<span class="normal">8517</span>
<span class="normal">8518</span>
<span class="normal">8519</span>
<span class="normal">8520</span>
<span class="normal">8521</span>
<span class="normal">8522</span>
<span class="normal">8523</span>
<span class="normal">8524</span>
<span class="normal">8525</span>
<span class="normal">8526</span>
<span class="normal">8527</span>
<span class="normal">8528</span>
<span class="normal">8529</span>
<span class="normal">8530</span>
<span class="normal">8531</span>
<span class="normal">8532</span>
<span class="normal">8533</span>
<span class="normal">8534</span>
<span class="normal">8535</span>
<span class="normal">8536</span>
<span class="normal">8537</span>
<span class="normal">8538</span>
<span class="normal">8539</span>
<span class="normal">8540</span>
<span class="normal">8541</span>
<span class="normal">8542</span>
<span class="normal">8543</span>
<span class="normal">8544</span>
<span class="normal">8545</span>
<span class="normal">8546</span>
<span class="normal">8547</span>
<span class="normal">8548</span>
<span class="normal">8549</span>
<span class="normal">8550</span>
<span class="normal">8551</span>
<span class="normal">8552</span>
<span class="normal">8553</span>
<span class="normal">8554</span>
<span class="normal">8555</span>
<span class="normal">8556</span>
<span class="normal">8557</span>
<span class="normal">8558</span>
<span class="normal">8559</span>
<span class="normal">8560</span>
<span class="normal">8561</span>
<span class="normal">8562</span>
<span class="normal">8563</span>
<span class="normal">8564</span>
<span class="normal">8565</span>
<span class="normal">8566</span>
<span class="normal">8567</span>
<span class="normal">8568</span>
<span class="normal">8569</span>
<span class="normal">8570</span>
<span class="normal">8571</span>
<span class="normal">8572</span>
<span class="normal">8573</span>
<span class="normal">8574</span>
<span class="normal">8575</span>
<span class="normal">8576</span>
<span class="normal">8577</span>
<span class="normal">8578</span>
<span class="normal">8579</span>
<span class="normal">8580</span>
<span class="normal">8581</span>
<span class="normal">8582</span>
<span class="normal">8583</span>
<span class="normal">8584</span>
<span class="normal">8585</span>
<span class="normal">8586</span>
<span class="normal">8587</span>
<span class="normal">8588</span>
<span class="normal">8589</span>
<span class="normal">8590</span>
<span class="normal">8591</span>
<span class="normal">8592</span>
<span class="normal">8593</span>
<span class="normal">8594</span>
<span class="normal">8595</span>
<span class="normal">8596</span>
<span class="normal">8597</span>
<span class="normal">8598</span>
<span class="normal">8599</span>
<span class="normal">8600</span>
<span class="normal">8601</span>
<span class="normal">8602</span>
<span class="normal">8603</span>
<span class="normal">8604</span>
<span class="normal">8605</span>
<span class="normal">8606</span>
<span class="normal">8607</span>
<span class="normal">8608</span>
<span class="normal">8609</span>
<span class="normal">8610</span>
<span class="normal">8611</span>
<span class="normal">8612</span>
<span class="normal">8613</span>
<span class="normal">8614</span>
<span class="normal">8615</span>
<span class="normal">8616</span>
<span class="normal">8617</span>
<span class="normal">8618</span>
<span class="normal">8619</span>
<span class="normal">8620</span>
<span class="normal">8621</span>
<span class="normal">8622</span>
<span class="normal">8623</span>
<span class="normal">8624</span>
<span class="normal">8625</span>
<span class="normal">8626</span>
<span class="normal">8627</span>
<span class="normal">8628</span>
<span class="normal">8629</span>
<span class="normal">8630</span>
<span class="normal">8631</span>
<span class="normal">8632</span>
<span class="normal">8633</span>
<span class="normal">8634</span>
<span class="normal">8635</span>
<span class="normal">8636</span>
<span class="normal">8637</span>
<span class="normal">8638</span>
<span class="normal">8639</span>
<span class="normal">8640</span>
<span class="normal">8641</span>
<span class="normal">8642</span>
<span class="normal">8643</span>
<span class="normal">8644</span>
<span class="normal">8645</span>
<span class="normal">8646</span>
<span class="normal">8647</span>
<span class="normal">8648</span>
<span class="normal">8649</span>
<span class="normal">8650</span>
<span class="normal">8651</span>
<span class="normal">8652</span>
<span class="normal">8653</span>
<span class="normal">8654</span>
<span class="normal">8655</span>
<span class="normal">8656</span>
<span class="normal">8657</span>
<span class="normal">8658</span>
<span class="normal">8659</span>
<span class="normal">8660</span>
<span class="normal">8661</span>
<span class="normal">8662</span>
<span class="normal">8663</span>
<span class="normal">8664</span>
<span class="normal">8665</span>
<span class="normal">8666</span>
<span class="normal">8667</span>
<span class="normal">8668</span>
<span class="normal">8669</span>
<span class="normal">8670</span>
<span class="normal">8671</span>
<span class="normal">8672</span>
<span class="normal">8673</span>
<span class="normal">8674</span>
<span class="normal">8675</span>
<span class="normal">8676</span>
<span class="normal">8677</span>
<span class="normal">8678</span>
<span class="normal">8679</span>
<span class="normal">8680</span>
<span class="normal">8681</span>
<span class="normal">8682</span>
<span class="normal">8683</span>
<span class="normal">8684</span>
<span class="normal">8685</span>
<span class="normal">8686</span>
<span class="normal">8687</span>
<span class="normal">8688</span>
<span class="normal">8689</span>
<span class="normal">8690</span>
<span class="normal">8691</span>
<span class="normal">8692</span>
<span class="normal">8693</span>
<span class="normal">8694</span>
<span class="normal">8695</span>
<span class="normal">8696</span>
<span class="normal">8697</span>
<span class="normal">8698</span>
<span class="normal">8699</span>
<span class="normal">8700</span>
<span class="normal">8701</span>
<span class="normal">8702</span>
<span class="normal">8703</span>
<span class="normal">8704</span>
<span class="normal">8705</span>
<span class="normal">8706</span>
<span class="normal">8707</span>
<span class="normal">8708</span>
<span class="normal">8709</span>
<span class="normal">8710</span>
<span class="normal">8711</span>
<span class="normal">8712</span>
<span class="normal">8713</span>
<span class="normal">8714</span>
<span class="normal">8715</span>
<span class="normal">8716</span>
<span class="normal">8717</span>
<span class="normal">8718</span>
<span class="normal">8719</span>
<span class="normal">8720</span>
<span class="normal">8721</span>
<span class="normal">8722</span>
<span class="normal">8723</span>
<span class="normal">8724</span>
<span class="normal">8725</span>
<span class="normal">8726</span>
<span class="normal">8727</span>
<span class="normal">8728</span>
<span class="normal">8729</span>
<span class="normal">8730</span>
<span class="normal">8731</span>
<span class="normal">8732</span>
<span class="normal">8733</span>
<span class="normal">8734</span>
<span class="normal">8735</span>
<span class="normal">8736</span>
<span class="normal">8737</span>
<span class="normal">8738</span>
<span class="normal">8739</span>
<span class="normal">8740</span>
<span class="normal">8741</span>
<span class="normal">8742</span>
<span class="normal">8743</span>
<span class="normal">8744</span>
<span class="normal">8745</span>
<span class="normal">8746</span>
<span class="normal">8747</span>
<span class="normal">8748</span>
<span class="normal">8749</span>
<span class="normal">8750</span>
<span class="normal">8751</span>
<span class="normal">8752</span>
<span class="normal">8753</span>
<span class="normal">8754</span>
<span class="normal">8755</span>
<span class="normal">8756</span>
<span class="normal">8757</span>
<span class="normal">8758</span>
<span class="normal">8759</span>
<span class="normal">8760</span>
<span class="normal">8761</span>
<span class="normal">8762</span>
<span class="normal">8763</span>
<span class="normal">8764</span>
<span class="normal">8765</span>
<span class="normal">8766</span>
<span class="normal">8767</span>
<span class="normal">8768</span>
<span class="normal">8769</span>
<span class="normal">8770</span>
<span class="normal">8771</span>
<span class="normal">8772</span>
<span class="normal">8773</span>
<span class="normal">8774</span>
<span class="normal">8775</span>
<span class="normal">8776</span>
<span class="normal">8777</span>
<span class="normal">8778</span>
<span class="normal">8779</span>
<span class="normal">8780</span>
<span class="normal">8781</span>
<span class="normal">8782</span>
<span class="normal">8783</span>
<span class="normal">8784</span>
<span class="normal">8785</span>
<span class="normal">8786</span>
<span class="normal">8787</span>
<span class="normal">8788</span>
<span class="normal">8789</span>
<span class="normal">8790</span>
<span class="normal">8791</span>
<span class="normal">8792</span>
<span class="normal">8793</span>
<span class="normal">8794</span>
<span class="normal">8795</span>
<span class="normal">8796</span>
<span class="normal">8797</span>
<span class="normal">8798</span>
<span class="normal">8799</span>
<span class="normal">8800</span>
<span class="normal">8801</span>
<span class="normal">8802</span>
<span class="normal">8803</span>
<span class="normal">8804</span>
<span class="normal">8805</span>
<span class="normal">8806</span>
<span class="normal">8807</span>
<span class="normal">8808</span>
<span class="normal">8809</span>
<span class="normal">8810</span>
<span class="normal">8811</span>
<span class="normal">8812</span>
<span class="normal">8813</span>
<span class="normal">8814</span>
<span class="normal">8815</span>
<span class="normal">8816</span>
<span class="normal">8817</span>
<span class="normal">8818</span>
<span class="normal">8819</span>
<span class="normal">8820</span>
<span class="normal">8821</span>
<span class="normal">8822</span>
<span class="normal">8823</span>
<span class="normal">8824</span>
<span class="normal">8825</span>
<span class="normal">8826</span>
<span class="normal">8827</span>
<span class="normal">8828</span>
<span class="normal">8829</span>
<span class="normal">8830</span>
<span class="normal">8831</span>
<span class="normal">8832</span>
<span class="normal">8833</span>
<span class="normal">8834</span>
<span class="normal">8835</span>
<span class="normal">8836</span>
<span class="normal">8837</span>
<span class="normal">8838</span>
<span class="normal">8839</span>
<span class="normal">8840</span>
<span class="normal">8841</span>
<span class="normal">8842</span>
<span class="normal">8843</span>
<span class="normal">8844</span>
<span class="normal">8845</span>
<span class="normal">8846</span>
<span class="normal">8847</span>
<span class="normal">8848</span>
<span class="normal">8849</span>
<span class="normal">8850</span>
<span class="normal">8851</span>
<span class="normal">8852</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">katojones_gen</span><span class="p">(</span><span class="n">CircularContinuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kato--Jones (2015) Distribution</span>

<span class="sd">    ![katojones](../images/circ-mod-katojones.png)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    pdf(x, mu, gamma, rho, lam)</span>
<span class="sd">        Probability density function.</span>
<span class="sd">    cdf(x, mu, gamma, rho, lam)</span>
<span class="sd">        Cumulative distribution function via adaptive Fourier series.</span>

<span class="sd">    rvs(mu, gamma, rho, lam, size=None, random_state=None)</span>
<span class="sd">        Random variates obtained by inverting the CDF.</span>
<span class="sd">    fit(data, method=\&quot;moments\&quot; | \&quot;mle\&quot;, ...)</span>
<span class="sd">        Method-of-moments or maximum-likelihood parameter estimation.</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Implements the tractable four-parameter unimodal family proposed by Kato and</span>
<span class="sd">    Jones (2015). Parameters control the first two trigonometric moments:</span>
<span class="sd">    ``mu`` sets the mean direction, ``gamma`` the mean resultant length, and</span>
<span class="sd">    ``rho``/``lam`` encode the magnitude/phase of the second-order moment.</span>
<span class="sd">    Feasible parameter tuples satisfy ``0 &lt;= mu &lt; 2*pi``, ``0 &lt;= gamma &lt; 1``,</span>
<span class="sd">    ``0 &lt;= rho &lt; 1``, ``0 &lt;= lam &lt; 2*pi`` together with the constraint enforced</span>
<span class="sd">    in `_argcheck`.</span>

<span class="sd">    Special cases include the uniform distribution (``gamma = 0``), the cardioid</span>
<span class="sd">    (``rho = 0``) and the wrapped Cauchy (``lambda = 0`` with ``gamma = rho``).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    - Kato, S., &amp; Jones, M. C. (2015). *A tractable and interpretable</span>
<span class="sd">      four-parameter family of unimodal distributions on the circle*. Biometrika,</span>
<span class="sd">      102(1), 181-190.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_moment_tolerance</span> <span class="o">=</span> <span class="mf">1e-12</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_normalization_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_clear_normalization_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_scalar_param</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">first</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;katojones parameters must be scalar; vectorised parameters are not supported &quot;</span>
                <span class="s2">&quot;because series expansions are cached per parameter set.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">first</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mu_arr</span><span class="p">,</span> <span class="n">gamma_arr</span><span class="p">,</span> <span class="n">rho_arr</span><span class="p">,</span> <span class="n">lam_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">base</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_arr</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">gamma_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">gamma_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lam_arr</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">lam_arr</span> <span class="o">&lt;</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">cos_lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam_arr</span><span class="p">)</span>
        <span class="n">sin_lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam_arr</span><span class="p">)</span>
        <span class="n">constraint_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">*</span> <span class="n">cos_lam</span> <span class="o">-</span> <span class="n">gamma_arr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">rho_arr</span> <span class="o">*</span> <span class="n">sin_lam</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">constraint_limit</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma_arr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-12</span>
        <span class="n">admissible</span> <span class="o">=</span> <span class="n">constraint_val</span> <span class="o">&lt;=</span> <span class="n">constraint_limit</span>
        <span class="k">return</span> <span class="n">base</span> <span class="o">&amp;</span> <span class="n">admissible</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">x_arr</span> <span class="o">-</span> <span class="n">mu</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">)))</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pdf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Probability density function of the Kato--Jones (2015) distribution.</span>

<span class="sd">        $$</span>
<span class="sd">        g(\theta) = \frac{1}{2\pi}\left[1 + \frac{2\gamma\,(\cos(\theta-\mu) - \rho\cos\lambda)}</span>
<span class="sd">        {1 + \rho^2 - 2\rho\cos(\theta-\mu-\lambda)}\right]</span>
<span class="sd">        $$</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the probability density function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">        lam : float</span>
<span class="sd">            Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdf_values : array_like</span>
<span class="sd">            Probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">scalar_input</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">x_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">lam_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">gamma_val</span> <span class="o">&lt;=</span> <span class="n">_KJ_GAMMA_TOL</span><span class="p">:</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_terms</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">)</span>
            <span class="n">cdf_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_cdf_series</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">)</span>
            <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">cdf_raw</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">cdf_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">cdf_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cdf_flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cdf_flat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cdf_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cumulative distribution function of the Kato--Jones (2015) distribution.</span>

<span class="sd">        The CDF has the closed-form Fourier expansion</span>

<span class="sd">        $$</span>
<span class="sd">        G(\theta) = \frac{\theta}{2\pi}</span>
<span class="sd">        + \frac{1}{\pi}\sum_{p=1}^{\infty} \frac{\gamma \rho^{p-1}}{p}</span>
<span class="sd">        \sin\!\bigl(p\theta - [p\mu + (p-1)\lambda]\bigr),</span>
<span class="sd">        $$</span>

<span class="sd">        which is evaluated adaptively by truncating the series once the tail</span>
<span class="sd">        contribution drops below a specified tolerance. No numerical quadrature</span>
<span class="sd">        is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">        lam : float</span>
<span class="sd">            Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cdf_values : array_like</span>
<span class="sd">            Cumulative distribution function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logarithm of the probability density function of the Kato--Jones (2015)</span>
<span class="sd">        distribution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : array_like</span>
<span class="sd">            Points at which to evaluate the log-PDF.</span>
<span class="sd">        mu : float</span>
<span class="sd">            Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">        lam : float</span>
<span class="sd">            Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        logpdf_values : array_like</span>
<span class="sd">            Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">lam_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gamma_val</span> <span class="o">&lt;=</span> <span class="n">_KJ_GAMMA_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">q_arr</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">scalar_input</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">flat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">flat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flat</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">valid</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">if</span> <span class="n">scalar_input</span> <span class="k">else</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_terms</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">)</span>
        <span class="n">two_pi</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">cdf_single</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_cdf_series</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">q_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flat</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_val</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">q_val</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_pi</span>
                <span class="k">continue</span>

            <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">two_pi</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">q_val</span> <span class="o">*</span> <span class="n">two_pi</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_KJ_NEWTON_MAXITER</span><span class="p">):</span>
                <span class="n">cdf_theta</span> <span class="o">=</span> <span class="n">cdf_single</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="n">pdf_theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">))</span>
                <span class="n">residual</span> <span class="o">=</span> <span class="n">cdf_theta</span> <span class="o">-</span> <span class="n">q_val</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_KJ_NEWTON_TOL</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_KJ_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pdf_theta</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_theta</span><span class="p">):</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">step</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">/</span> <span class="n">pdf_theta</span>
                <span class="n">theta_candidate</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">step</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">theta_candidate</span><span class="p">)</span> <span class="ow">or</span> <span class="n">theta_candidate</span> <span class="o">&lt;=</span> <span class="n">lo</span> <span class="ow">or</span> <span class="n">theta_candidate</span> <span class="o">&gt;=</span> <span class="n">hi</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_candidate</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_KJ_NEWTON_WIDTH_TOL</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                    <span class="n">mid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cdf_single</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">q_val</span><span class="p">:</span>
                        <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span>

            <span class="n">result</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">%</span> <span class="n">two_pi</span>

        <span class="k">if</span> <span class="n">scalar_input</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">q_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">),)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

        <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`size` must describe a non-negative number of samples.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
        <span class="n">lam_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">trig_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span><span class="p">:</span>
        <span class="n">shape_args</span><span class="p">,</span> <span class="n">non_shape_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_separate_shape_parameters</span><span class="p">(</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span>
        <span class="p">)</span>
        <span class="n">call_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_call_kwargs</span><span class="p">(</span><span class="n">non_shape_kwargs</span><span class="p">,</span> <span class="s2">&quot;trig_moment&quot;</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">shape_args</span><span class="p">,</span> <span class="o">**</span><span class="n">call_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected parameters (mu, gamma, rho, lam).&quot;</span><span class="p">)</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`p` must be an integer scalar.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">!=</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`p` must be an integer.&quot;</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">abs_k</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span> <span class="k">if</span> <span class="n">abs_k</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">**</span> <span class="p">(</span><span class="n">abs_k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">abs_k</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">abs_k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">lam</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">angle</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_data_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">data_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_angles</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`data` must contain at least one observation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">data_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be broadcastable to the data shape.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`weights` must be non-negative.&quot;</span><span class="p">)</span>

        <span class="n">w_sum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">w_sum</span><span class="p">)</span> <span class="ow">or</span> <span class="n">w_sum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Sum of weights must be positive.&quot;</span><span class="p">)</span>
        <span class="n">n_eff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w_sum</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">w_sum</span><span class="p">,</span> <span class="n">n_eff</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">w_sum</span><span class="p">,</span> <span class="n">n_eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data_weights</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

        <span class="n">mu_hat</span><span class="p">,</span> <span class="n">r1</span> <span class="o">=</span> <span class="n">circ_mean_and_r</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">angmod</span><span class="p">(</span><span class="n">data_arr</span> <span class="o">-</span> <span class="n">mu_hat</span><span class="p">)</span>
        <span class="n">cos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">centered</span><span class="p">)</span>
        <span class="n">sin2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">centered</span><span class="p">)</span>
        <span class="n">alpha2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">cos2</span><span class="p">)</span> <span class="o">/</span> <span class="n">w_sum</span><span class="p">)</span>
        <span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">sin2</span><span class="p">)</span> <span class="o">/</span> <span class="n">w_sum</span><span class="p">)</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mu_hat</span><span class="p">))</span>
        <span class="n">gamma_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>

        <span class="n">alpha2_proj</span><span class="p">,</span> <span class="n">beta2_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_second_order</span><span class="p">(</span><span class="n">gamma_hat</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gamma_hat</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">lam_hat</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">alpha2_proj</span><span class="p">,</span> <span class="n">beta2_proj</span><span class="p">)</span>
            <span class="n">rho_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">gamma_hat</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
            <span class="n">lam_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">beta2_proj</span><span class="p">,</span> <span class="n">alpha2_proj</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">rho_hat</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
                <span class="n">lam_hat</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">gamma_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="n">lam_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;moments&quot;</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_project_second_order</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="n">center_alpha</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">gamma</span>
        <span class="n">vec_alpha</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">-</span> <span class="n">center_alpha</span>
        <span class="n">vec_beta</span> <span class="o">=</span> <span class="n">beta2</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">vec_alpha</span><span class="p">,</span> <span class="n">vec_beta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">center_alpha</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">center_alpha</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="n">distance</span>
        <span class="n">alpha_proj</span> <span class="o">=</span> <span class="n">center_alpha</span> <span class="o">+</span> <span class="n">vec_alpha</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="n">beta_proj</span> <span class="o">=</span> <span class="n">vec_beta</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="k">return</span> <span class="n">alpha_proj</span><span class="p">,</span> <span class="n">beta_proj</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_alpha2_beta2</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert second-order moment parameters to (rho, lambda).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Mean resultant length, 0 &lt;= gamma &lt; 1.</span>
<span class="sd">        alpha2 : float</span>
<span class="sd">            Second-order cosine moment around mu.</span>
<span class="sd">        beta2 : float</span>
<span class="sd">            Second-order sine moment around mu.</span>
<span class="sd">        verify : bool, optional</span>
<span class="sd">            If True (default), check that (alpha2, beta2) lies within the feasible</span>
<span class="sd">            disk for the supplied gamma and raise a ValueError if not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rho : float</span>
<span class="sd">            Second-order magnitude parameter.</span>
<span class="sd">        lam : float</span>
<span class="sd">            Second-order phase parameter in [0, 2 pi).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">alpha2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha2</span><span class="p">)</span>
        <span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">gamma</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must lie in [0, 1).&quot;</span><span class="p">)</span>

        <span class="n">radius_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">center_alpha</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">gamma</span>
        <span class="n">dist_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha2</span> <span class="o">-</span> <span class="n">center_alpha</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">beta2</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">dist_sq</span> <span class="o">&gt;</span> <span class="n">radius_sq</span> <span class="o">+</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;(alpha2, beta2) = (</span><span class="si">{</span><span class="n">alpha2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">beta2</span><span class="si">}</span><span class="s2">) is outside the feasible disk &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gamma</span> <span class="o">&lt;=</span> <span class="n">katojones_gen</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;When gamma is approximately zero, alpha2 and beta2 must also be near zero.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

        <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">r2</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">beta2</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_rho_lambda</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert (rho, lambda) parameters to second-order moments (alpha2, beta2).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Mean resultant length, 0 &lt;= gamma &lt; 1.</span>
<span class="sd">        rho : float</span>
<span class="sd">            Second-order magnitude, 0 &lt;= rho &lt; 1.</span>
<span class="sd">        lam : float</span>
<span class="sd">            Second-order phase, 0 &lt;= lam &lt; 2*pi.</span>
<span class="sd">        verify : bool, optional</span>
<span class="sd">            If True (default), ensure (gamma, rho, lam) satisfies the feasibility</span>
<span class="sd">            constraint and raise a ValueError otherwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        alpha2 : float</span>
<span class="sd">            Second-order cosine moment around mu.</span>
<span class="sd">        beta2 : float</span>
<span class="sd">            Second-order sine moment around mu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">gamma</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must lie in [0, 1).&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rho` must lie in [0, 1).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verify</span><span class="p">:</span>
            <span class="n">constraint</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">constraint</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;(gamma, rho, lam)=(</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lam</span><span class="si">}</span><span class="s2">) violates the feasibility constraint.&quot;</span>
                <span class="p">)</span>

        <span class="n">alpha2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span>
        <span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_aux_from_rho_lam</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">)</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">)</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">gamma</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

        <span class="n">denom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="n">delta_cos</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma</span>
        <span class="n">delta_sin</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">delta_cos</span><span class="p">,</span> <span class="n">delta_sin</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">delta_sin</span><span class="p">,</span> <span class="n">delta_cos</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">katojones_gen</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">phi</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_rho_lam_from_aux</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="n">cos_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">sin_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">delta_cos</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">cos_phi</span>
        <span class="n">delta_sin</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sin_phi</span>
        <span class="n">rho_cos</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">+</span> <span class="n">delta_cos</span>
        <span class="n">rho_sin</span> <span class="o">=</span> <span class="n">delta_sin</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">rho_cos</span><span class="p">,</span> <span class="n">rho_sin</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">rho_sin</span><span class="p">,</span> <span class="n">rho_cos</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_series_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">mu_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">gamma</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">lam_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scalar_param</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalization_cache_key</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_series_terms</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">)</span>

        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_series_cache</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_series_terms</span><span class="p">(</span><span class="n">mu_val</span><span class="p">,</span> <span class="n">gamma_val</span><span class="p">,</span> <span class="n">rho_val</span><span class="p">,</span> <span class="n">lam_val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_series_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gamma</span> <span class="o">&lt;=</span> <span class="n">_KJ_GAMMA_TOL</span> <span class="ow">or</span> <span class="n">rho</span> <span class="o">&lt;=</span> <span class="n">_KJ_GAMMA_TOL</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;coeffs&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="s2">&quot;phases&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
                <span class="s2">&quot;anchor&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">rho_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rho_val</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_KJ_MAX_TERMS</span><span class="p">):</span>
                <span class="n">tail</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma_val</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho_val</span> <span class="o">**</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">rho_val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tail</span> <span class="o">&lt;=</span> <span class="n">_KJ_CDF_TOL</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">P</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">P</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">_KJ_MAX_TERMS</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">P</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">rho_pows</span> <span class="o">=</span> <span class="n">rho_val</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">gamma_val</span> <span class="o">*</span> <span class="n">rho_pows</span> <span class="o">/</span> <span class="n">p</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">lam</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeffs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phases</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;coeffs&quot;</span><span class="p">:</span> <span class="n">coeffs</span><span class="p">,</span>
            <span class="s2">&quot;phases&quot;</span><span class="p">:</span> <span class="n">phases</span><span class="p">,</span>
            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s2">&quot;anchor&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">anchor</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_cdf_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">theta_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">theta_arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">series</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_series_terms</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="s2">&quot;coeffs&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">coeffs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">flat</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">theta_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">phases</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="s2">&quot;phases&quot;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">theta_col</span> <span class="o">=</span> <span class="n">flat</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">sin_terms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">theta_col</span> <span class="o">-</span> <span class="n">phases</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
        <span class="n">series_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">sin_terms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">series_sum</span> <span class="o">-</span> <span class="n">series</span><span class="p">[</span><span class="s2">&quot;anchor&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">theta_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fit_mle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">initial</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="p">,</span>
        <span class="n">options</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">data_arr</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">w_sum</span><span class="p">,</span> <span class="n">n_eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_data_weights</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_moments</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>

        <span class="n">mu0</span><span class="p">,</span> <span class="n">gamma0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">lam0</span> <span class="o">=</span> <span class="n">initial</span>
        <span class="n">mu0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mu0</span><span class="p">))</span>
        <span class="n">gamma0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="n">lam0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lam0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rho0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
            <span class="n">rho0</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">lam0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">s0</span><span class="p">,</span> <span class="n">phi0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aux_from_rho_lam</span><span class="p">(</span><span class="n">gamma0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="n">lam0</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mu0</span><span class="p">,</span> <span class="n">gamma0</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">phi0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho_lam_from_aux</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">1e12</span>
            <span class="n">pdf_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">data_arr</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pdf_vals</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">)):</span>
                <span class="k">return</span> <span class="mf">1e12</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pdf_vals</span><span class="p">))</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="n">objective</span><span class="p">,</span>
            <span class="n">x0</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="n">fallback_method</span> <span class="o">=</span> <span class="s2">&quot;Powell&quot;</span> <span class="k">if</span> <span class="n">optimizer</span> <span class="o">!=</span> <span class="s2">&quot;Powell&quot;</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">fallback_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fallback_result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
                    <span class="n">objective</span><span class="p">,</span>
                    <span class="n">x0</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">fallback_method</span><span class="p">,</span>
                    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="p">{},</span>
                    <span class="o">**</span><span class="n">minimize_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">fallback_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">fallback_result</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum likelihood fit failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">mu_hat</span><span class="p">,</span> <span class="n">gamma_hat</span><span class="p">,</span> <span class="n">s_hat</span><span class="p">,</span> <span class="n">phi_hat</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
        <span class="n">mu_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_direction</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mu_hat</span><span class="p">))</span>
        <span class="n">gamma_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gamma_hat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">s_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s_hat</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">))</span>
        <span class="n">phi_hat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">phi_hat</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">rho_hat</span><span class="p">,</span> <span class="n">lam_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho_lam_from_aux</span><span class="p">(</span><span class="n">gamma_hat</span><span class="p">,</span> <span class="n">s_hat</span><span class="p">,</span> <span class="n">phi_hat</span><span class="p">)</span>

        <span class="n">estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_hat</span><span class="p">,</span> <span class="n">gamma_hat</span><span class="p">,</span> <span class="n">rho_hat</span><span class="p">,</span> <span class="n">lam_hat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_info</span><span class="p">:</span>
            <span class="n">final_nll</span> <span class="o">=</span> <span class="n">objective</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;mle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;converged&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">),</span>
                <span class="s2">&quot;loglik&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="o">-</span><span class="n">final_nll</span><span class="p">),</span>
                <span class="s2">&quot;n_effective&quot;</span><span class="p">:</span> <span class="n">n_eff</span><span class="p">,</span>
                <span class="s2">&quot;nit&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;nit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
                <span class="s2">&quot;initial&quot;</span><span class="p">:</span> <span class="n">initial</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">estimates</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">return_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_loc_scale_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;floc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;fscale&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unexpected optimizer arguments for method=&#39;moments&#39;.&quot;</span><span class="p">)</span>
            <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_moments</span><span class="p">(</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
                <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">estimates</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_info</span> <span class="k">else</span> <span class="n">estimates</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;mle&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;method must be either &#39;moments&#39; or &#39;mle&#39;.&quot;</span><span class="p">)</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">estimates</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_mle</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
            <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">estimates</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_info</span> <span class="k">else</span> <span class="n">estimates</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.katojones_gen.pdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Probability density function of the Kato--Jones (2015) distribution.</p>
<div class="arithmatex">\[
g(\theta) = \frac{1}{2\pi}\left[1 + \frac{2\gamma\,(\cos(\theta-\mu) - \rho\cos\lambda)}
{1 + \rho^2 - 2\rho\cos(\theta-\mu-\lambda)}\right]
\]</div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the probability density function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <span class="arithmatex">\(0 \leq \mu &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, <span class="arithmatex">\(0 \leq \gamma &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order magnitude, <span class="arithmatex">\(0 \leq \rho &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lam</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order phase, <span class="arithmatex">\(0 \leq \lambda &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8176</span>
<span class="normal">8177</span>
<span class="normal">8178</span>
<span class="normal">8179</span>
<span class="normal">8180</span>
<span class="normal">8181</span>
<span class="normal">8182</span>
<span class="normal">8183</span>
<span class="normal">8184</span>
<span class="normal">8185</span>
<span class="normal">8186</span>
<span class="normal">8187</span>
<span class="normal">8188</span>
<span class="normal">8189</span>
<span class="normal">8190</span>
<span class="normal">8191</span>
<span class="normal">8192</span>
<span class="normal">8193</span>
<span class="normal">8194</span>
<span class="normal">8195</span>
<span class="normal">8196</span>
<span class="normal">8197</span>
<span class="normal">8198</span>
<span class="normal">8199</span>
<span class="normal">8200</span>
<span class="normal">8201</span>
<span class="normal">8202</span>
<span class="normal">8203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Probability density function of the Kato--Jones (2015) distribution.</span>

<span class="sd">    $$</span>
<span class="sd">    g(\theta) = \frac{1}{2\pi}\left[1 + \frac{2\gamma\,(\cos(\theta-\mu) - \rho\cos\lambda)}</span>
<span class="sd">    {1 + \rho^2 - 2\rho\cos(\theta-\mu-\lambda)}\right]</span>
<span class="sd">    $$</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the probability density function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">    lam : float</span>
<span class="sd">        Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pdf_values : array_like</span>
<span class="sd">        Probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.katojones_gen.cdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cumulative distribution function of the Kato--Jones (2015) distribution.</p>
<p>The CDF has the closed-form Fourier expansion</p>
<div class="arithmatex">\[
G(\theta) = \frac{\theta}{2\pi}
+ \frac{1}{\pi}\sum_{p=1}^{\infty} \frac{\gamma \rho^{p-1}}{p}
\sin\!\bigl(p\theta - [p\mu + (p-1)\lambda]\bigr),
\]</div>
<p>which is evaluated adaptively by truncating the series once the tail
contribution drops below a specified tolerance. No numerical quadrature
is required.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the cumulative distribution function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <span class="arithmatex">\(0 \leq \mu &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, <span class="arithmatex">\(0 \leq \gamma &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order magnitude, <span class="arithmatex">\(0 \leq \rho &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lam</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order phase, <span class="arithmatex">\(0 \leq \lambda &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative distribution function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8230</span>
<span class="normal">8231</span>
<span class="normal">8232</span>
<span class="normal">8233</span>
<span class="normal">8234</span>
<span class="normal">8235</span>
<span class="normal">8236</span>
<span class="normal">8237</span>
<span class="normal">8238</span>
<span class="normal">8239</span>
<span class="normal">8240</span>
<span class="normal">8241</span>
<span class="normal">8242</span>
<span class="normal">8243</span>
<span class="normal">8244</span>
<span class="normal">8245</span>
<span class="normal">8246</span>
<span class="normal">8247</span>
<span class="normal">8248</span>
<span class="normal">8249</span>
<span class="normal">8250</span>
<span class="normal">8251</span>
<span class="normal">8252</span>
<span class="normal">8253</span>
<span class="normal">8254</span>
<span class="normal">8255</span>
<span class="normal">8256</span>
<span class="normal">8257</span>
<span class="normal">8258</span>
<span class="normal">8259</span>
<span class="normal">8260</span>
<span class="normal">8261</span>
<span class="normal">8262</span>
<span class="normal">8263</span>
<span class="normal">8264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cumulative distribution function of the Kato--Jones (2015) distribution.</span>

<span class="sd">    The CDF has the closed-form Fourier expansion</span>

<span class="sd">    $$</span>
<span class="sd">    G(\theta) = \frac{\theta}{2\pi}</span>
<span class="sd">    + \frac{1}{\pi}\sum_{p=1}^{\infty} \frac{\gamma \rho^{p-1}}{p}</span>
<span class="sd">    \sin\!\bigl(p\theta - [p\mu + (p-1)\lambda]\bigr),</span>
<span class="sd">    $$</span>

<span class="sd">    which is evaluated adaptively by truncating the series once the tail</span>
<span class="sd">    contribution drops below a specified tolerance. No numerical quadrature</span>
<span class="sd">    is required.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the cumulative distribution function.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">    lam : float</span>
<span class="sd">        Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cdf_values : array_like</span>
<span class="sd">        Cumulative distribution function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.katojones_gen.logpdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Logarithm of the probability density function of the Kato--Jones (2015)
distribution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Points at which to evaluate the log-PDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mu</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean direction, <span class="arithmatex">\(0 \leq \mu &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, <span class="arithmatex">\(0 \leq \gamma &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order magnitude, <span class="arithmatex">\(0 \leq \rho &lt; 1\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lam</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order phase, <span class="arithmatex">\(0 \leq \lambda &lt; 2\pi\)</span>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>logpdf_values</code></td>            <td>
                  <code><span title="array_like">array_like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logarithm of the probability density function evaluated at <code>x</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8270</span>
<span class="normal">8271</span>
<span class="normal">8272</span>
<span class="normal">8273</span>
<span class="normal">8274</span>
<span class="normal">8275</span>
<span class="normal">8276</span>
<span class="normal">8277</span>
<span class="normal">8278</span>
<span class="normal">8279</span>
<span class="normal">8280</span>
<span class="normal">8281</span>
<span class="normal">8282</span>
<span class="normal">8283</span>
<span class="normal">8284</span>
<span class="normal">8285</span>
<span class="normal">8286</span>
<span class="normal">8287</span>
<span class="normal">8288</span>
<span class="normal">8289</span>
<span class="normal">8290</span>
<span class="normal">8291</span>
<span class="normal">8292</span>
<span class="normal">8293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logarithm of the probability density function of the Kato--Jones (2015)</span>
<span class="sd">    distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Points at which to evaluate the log-PDF.</span>
<span class="sd">    mu : float</span>
<span class="sd">        Mean direction, $0 \leq \mu &lt; 2\pi$.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Mean resultant length, $0 \leq \gamma &lt; 1$.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Second-order magnitude, $0 \leq \rho &lt; 1$.</span>
<span class="sd">    lam : float</span>
<span class="sd">        Second-order phase, $0 \leq \lambda &lt; 2\pi$.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    logpdf_values : array_like</span>
<span class="sd">        Logarithm of the probability density function evaluated at `x`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.katojones_gen.convert_alpha2_beta2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_alpha2_beta2</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Convert second-order moment parameters to (rho, lambda).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, 0 &lt;= gamma &lt; 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order cosine moment around mu.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order sine moment around mu.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verify</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (default), check that (alpha2, beta2) lies within the feasible
disk for the supplied gamma and raise a ValueError if not.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rho</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order magnitude parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>lam</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order phase parameter in [0, 2 pi).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8509</span>
<span class="normal">8510</span>
<span class="normal">8511</span>
<span class="normal">8512</span>
<span class="normal">8513</span>
<span class="normal">8514</span>
<span class="normal">8515</span>
<span class="normal">8516</span>
<span class="normal">8517</span>
<span class="normal">8518</span>
<span class="normal">8519</span>
<span class="normal">8520</span>
<span class="normal">8521</span>
<span class="normal">8522</span>
<span class="normal">8523</span>
<span class="normal">8524</span>
<span class="normal">8525</span>
<span class="normal">8526</span>
<span class="normal">8527</span>
<span class="normal">8528</span>
<span class="normal">8529</span>
<span class="normal">8530</span>
<span class="normal">8531</span>
<span class="normal">8532</span>
<span class="normal">8533</span>
<span class="normal">8534</span>
<span class="normal">8535</span>
<span class="normal">8536</span>
<span class="normal">8537</span>
<span class="normal">8538</span>
<span class="normal">8539</span>
<span class="normal">8540</span>
<span class="normal">8541</span>
<span class="normal">8542</span>
<span class="normal">8543</span>
<span class="normal">8544</span>
<span class="normal">8545</span>
<span class="normal">8546</span>
<span class="normal">8547</span>
<span class="normal">8548</span>
<span class="normal">8549</span>
<span class="normal">8550</span>
<span class="normal">8551</span>
<span class="normal">8552</span>
<span class="normal">8553</span>
<span class="normal">8554</span>
<span class="normal">8555</span>
<span class="normal">8556</span>
<span class="normal">8557</span>
<span class="normal">8558</span>
<span class="normal">8559</span>
<span class="normal">8560</span>
<span class="normal">8561</span>
<span class="normal">8562</span>
<span class="normal">8563</span>
<span class="normal">8564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_alpha2_beta2</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert second-order moment parameters to (rho, lambda).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Mean resultant length, 0 &lt;= gamma &lt; 1.</span>
<span class="sd">    alpha2 : float</span>
<span class="sd">        Second-order cosine moment around mu.</span>
<span class="sd">    beta2 : float</span>
<span class="sd">        Second-order sine moment around mu.</span>
<span class="sd">    verify : bool, optional</span>
<span class="sd">        If True (default), check that (alpha2, beta2) lies within the feasible</span>
<span class="sd">        disk for the supplied gamma and raise a ValueError if not.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rho : float</span>
<span class="sd">        Second-order magnitude parameter.</span>
<span class="sd">    lam : float</span>
<span class="sd">        Second-order phase parameter in [0, 2 pi).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
    <span class="n">alpha2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha2</span><span class="p">)</span>
    <span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta2</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">gamma</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must lie in [0, 1).&quot;</span><span class="p">)</span>

    <span class="n">radius_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">center_alpha</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">gamma</span>
    <span class="n">dist_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha2</span> <span class="o">-</span> <span class="n">center_alpha</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">beta2</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-12</span>
    <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">dist_sq</span> <span class="o">&gt;</span> <span class="n">radius_sq</span> <span class="o">+</span> <span class="n">tol</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(alpha2, beta2) = (</span><span class="si">{</span><span class="n">alpha2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">beta2</span><span class="si">}</span><span class="s2">) is outside the feasible disk &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gamma</span> <span class="o">&lt;=</span> <span class="n">katojones_gen</span><span class="o">.</span><span class="n">_moment_tolerance</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;When gamma is approximately zero, alpha2 and beta2 must also be near zero.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1e-12</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">beta2</span><span class="p">,</span> <span class="n">alpha2</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pycircstat2.distributions.katojones_gen.convert_rho_lambda" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_rho_lambda</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Convert (rho, lambda) parameters to second-order moments (alpha2, beta2).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean resultant length, 0 &lt;= gamma &lt; 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order magnitude, 0 &lt;= rho &lt; 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lam</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order phase, 0 &lt;= lam &lt; 2*pi.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verify</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (default), ensure (gamma, rho, lam) satisfies the feasibility
constraint and raise a ValueError otherwise.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>alpha2</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order cosine moment around mu.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>beta2</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second-order sine moment around mu.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>pycircstat2/distributions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8566</span>
<span class="normal">8567</span>
<span class="normal">8568</span>
<span class="normal">8569</span>
<span class="normal">8570</span>
<span class="normal">8571</span>
<span class="normal">8572</span>
<span class="normal">8573</span>
<span class="normal">8574</span>
<span class="normal">8575</span>
<span class="normal">8576</span>
<span class="normal">8577</span>
<span class="normal">8578</span>
<span class="normal">8579</span>
<span class="normal">8580</span>
<span class="normal">8581</span>
<span class="normal">8582</span>
<span class="normal">8583</span>
<span class="normal">8584</span>
<span class="normal">8585</span>
<span class="normal">8586</span>
<span class="normal">8587</span>
<span class="normal">8588</span>
<span class="normal">8589</span>
<span class="normal">8590</span>
<span class="normal">8591</span>
<span class="normal">8592</span>
<span class="normal">8593</span>
<span class="normal">8594</span>
<span class="normal">8595</span>
<span class="normal">8596</span>
<span class="normal">8597</span>
<span class="normal">8598</span>
<span class="normal">8599</span>
<span class="normal">8600</span>
<span class="normal">8601</span>
<span class="normal">8602</span>
<span class="normal">8603</span>
<span class="normal">8604</span>
<span class="normal">8605</span>
<span class="normal">8606</span>
<span class="normal">8607</span>
<span class="normal">8608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_rho_lambda</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert (rho, lambda) parameters to second-order moments (alpha2, beta2).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Mean resultant length, 0 &lt;= gamma &lt; 1.</span>
<span class="sd">    rho : float</span>
<span class="sd">        Second-order magnitude, 0 &lt;= rho &lt; 1.</span>
<span class="sd">    lam : float</span>
<span class="sd">        Second-order phase, 0 &lt;= lam &lt; 2*pi.</span>
<span class="sd">    verify : bool, optional</span>
<span class="sd">        If True (default), ensure (gamma, rho, lam) satisfies the feasibility</span>
<span class="sd">        constraint and raise a ValueError otherwise.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    alpha2 : float</span>
<span class="sd">        Second-order cosine moment around mu.</span>
<span class="sd">    beta2 : float</span>
<span class="sd">        Second-order sine moment around mu.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">gamma</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`gamma` must lie in [0, 1).&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">rho</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rho` must lie in [0, 1).&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verify</span><span class="p">:</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">constraint</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;(gamma, rho, lam)=(</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lam</span><span class="si">}</span><span class="s2">) violates the feasibility constraint.&quot;</span>
            <span class="p">)</span>

    <span class="n">alpha2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span>
    <span class="n">beta2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lam</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">alpha2</span><span class="p">,</span> <span class="n">beta2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "content.code.copy", "content.tabs.link", "content.mathjax"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>